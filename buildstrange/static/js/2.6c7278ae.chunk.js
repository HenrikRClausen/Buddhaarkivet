/*! For license information please see 2.6c7278ae.chunk.js.LICENSE.txt */
(this.webpackJsonpbuddhaarkivet=this.webpackJsonpbuddhaarkivet||[]).push([[2],[function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return o})),n.d(t,"d",(function(){return s})),n.d(t,"g",(function(){return u})),n.d(t,"e",(function(){return c})),n.d(t,"f",(function(){return l}));var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var a=function(){return(a=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function o(e,t,n,r){return new(n||(n=Promise))((function(i,a){function o(e){try{u(r.next(e))}catch(t){a(t)}}function s(e){try{u(r.throw(e))}catch(t){a(t)}}function u(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}function s(e,t){var n,r,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(i=2&a[0]?r.return:a[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,a[1])).done)return i;switch(r=0,i&&(a=[2&a[0],i.value]),a[0]){case 0:case 1:i=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,r=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(i=(i=o.trys).length>0&&i[i.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!i||a[1]>i[0]&&a[1]<i[3])){o.label=a[1];break}if(6===a[0]&&o.label<i[1]){o.label=i[1],i=a;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(a);break}i[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(s){a=[6,s],r=0}finally{n=i=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}function u(e){var t="function"===typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"===typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function c(e,t){var n="function"===typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,a=n.call(e),o=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)o.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(i)throw i.error}}return o}function l(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(c(arguments[t]));return e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e,t){this.query=e,this.parameters=t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(8),i=n(13),a=n(15),o=n(59),s=n(10),u=n(22),c=n(47),l=function(){function e(e){this.columns=[],this.indices=[],this.foreignKeys=[],this.uniques=[],this.checks=[],this.exclusions=[],this.justCreated=!1,e&&(this.name=e.name,e.columns&&(this.columns=e.columns.map((function(e){return new r.a(e)}))),e.indices&&(this.indices=e.indices.map((function(e){return new i.a(e)}))),e.foreignKeys&&(this.foreignKeys=e.foreignKeys.map((function(e){return new a.a(e)}))),e.uniques&&(this.uniques=e.uniques.map((function(e){return new s.a(e)}))),e.checks&&(this.checks=e.checks.map((function(e){return new u.a(e)}))),e.exclusions&&(this.exclusions=e.exclusions.map((function(e){return new c.a(e)}))),void 0!==e.justCreated&&(this.justCreated=e.justCreated),this.engine=e.engine)}return Object.defineProperty(e.prototype,"primaryColumns",{get:function(){return this.columns.filter((function(e){return e.isPrimary}))},enumerable:!0,configurable:!0}),e.prototype.clone=function(){return new e({name:this.name,columns:this.columns.map((function(e){return e.clone()})),indices:this.indices.map((function(e){return e.clone()})),foreignKeys:this.foreignKeys.map((function(e){return e.clone()})),uniques:this.uniques.map((function(e){return e.clone()})),checks:this.checks.map((function(e){return e.clone()})),exclusions:this.exclusions.map((function(e){return e.clone()})),justCreated:this.justCreated,engine:this.engine})},e.prototype.addColumn=function(e){this.columns.push(e)},e.prototype.removeColumn=function(e){var t=this.columns.find((function(t){return t.name===e.name}));t&&this.columns.splice(this.columns.indexOf(t),1)},e.prototype.addUniqueConstraint=function(e){if(this.uniques.push(e),1===e.columnNames.length){var t=this.columns.find((function(t){return t.name===e.columnNames[0]}));t&&(t.isUnique=!0)}},e.prototype.removeUniqueConstraint=function(e){var t=this.uniques.find((function(t){return t.name===e.name}));if(t&&(this.uniques.splice(this.uniques.indexOf(t),1),1===t.columnNames.length)){var n=this.columns.find((function(e){return e.name===t.columnNames[0]}));n&&(n.isUnique=!1)}},e.prototype.addCheckConstraint=function(e){this.checks.push(e)},e.prototype.removeCheckConstraint=function(e){var t=this.checks.find((function(t){return t.name===e.name}));t&&this.checks.splice(this.checks.indexOf(t),1)},e.prototype.addExclusionConstraint=function(e){this.exclusions.push(e)},e.prototype.removeExclusionConstraint=function(e){var t=this.exclusions.find((function(t){return t.name===e.name}));t&&this.exclusions.splice(this.exclusions.indexOf(t),1)},e.prototype.addForeignKey=function(e){this.foreignKeys.push(e)},e.prototype.removeForeignKey=function(e){var t=this.foreignKeys.find((function(t){return t.name===e.name}));t&&this.foreignKeys.splice(this.foreignKeys.indexOf(t),1)},e.prototype.addIndex=function(e,t){if(void 0===t&&(t=!1),this.indices.push(e),1===e.columnNames.length&&e.isUnique&&t){var n=this.columns.find((function(t){return t.name===e.columnNames[0]}));n&&(n.isUnique=!0)}},e.prototype.removeIndex=function(e,t){void 0===t&&(t=!1);var n=this.indices.find((function(t){return t.name===e.name}));if(n&&(this.indices.splice(this.indices.indexOf(n),1),1===n.columnNames.length&&n.isUnique&&t)){var r=this.columns.find((function(e){return e.name===n.columnNames[0]}));r&&(r.isUnique=this.indices.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===r.name&&!!n.isUnique})))}},e.prototype.findColumnByName=function(e){return this.columns.find((function(t){return t.name===e}))},e.prototype.findColumnIndices=function(e){return this.indices.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnForeignKeys=function(e){return this.foreignKeys.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnUniques=function(e){return this.uniques.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.prototype.findColumnChecks=function(e){return this.checks.filter((function(t){return!!t.columnNames.find((function(t){return t===e.name}))}))},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),engine:t.engine,columns:t.columns.filter((function(e){return e})).map((function(e){return o.a.createTableColumnOptions(e,n)})),indices:t.indices.filter((function(e){return!0===e.synchronize})).map((function(e){return i.a.create(e)})),uniques:t.uniques.map((function(e){return s.a.create(e)})),checks:t.checks.map((function(e){return u.a.create(e)})),exclusions:t.exclusions.map((function(e){return c.a.create(e)}))})},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"e",(function(){return u}));var r=function(){},i=function(){},a=function(){},o=function(){},s=function(){},u=function(){}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r}));var r=function(){function t(){}return t.getGlobalVariable=function(){return"undefined"!==typeof window?window:e},t.load=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: require("'+e+'").');return""},t.pathNormalize=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.normalize("'+e+'").');return""},t.pathExtname=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.extname("'+e+'").');return""},t.pathResolve=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: path.resolve("'+e+'").');return""},t.fileExist=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.existsSync("'+e+'").');return!1},t.getEnvVariable=function(e){},t.readFileSync=function(e){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.readFileSync("'+e+'").');return null},t.appendFileSync=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.appendFileSync("'+e+'").')},t.writeFile=function(e,t){if("browser"===this.type)throw new Error('This option/function is not supported in the browser environment. Failed operation: fs.writeFile("'+e+'").');return Promise.reject(null)},t.highlightSql=function(e){return e},t.highlightJson=function(e){return e},t.logInfo=function(e,t){console.info(e+" ",t)},t.logError=function(e,t){console.error(e+" ",t)},t.logWarn=function(e,t){console.warn(e+" ",t)},t.log=function(e){console.log(e)},t.warn=function(e){return e},t.type="browser",t}();"undefined"!==typeof window&&(window.Buffer=n(40).Buffer),"undefined"!==typeof e&&(e.Buffer=n(40).Buffer)}).call(this,n(61))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(){}return e.normalizeHydratedDate=function(e){return e&&"string"===typeof e?new Date(e):e},e.mixedDateToDateString=function(e){return e instanceof Date?this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate()):e},e.mixedDateToDate=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var r="string"===typeof e?new Date(e):e;return t&&(r=new Date(r.getUTCFullYear(),r.getUTCMonth(),r.getUTCDate(),r.getUTCHours(),r.getUTCMinutes(),r.getUTCSeconds(),r.getUTCMilliseconds())),n||r.setUTCMilliseconds(0),r},e.mixedDateToTimeString=function(e,t){return void 0===t&&(t=!1),e instanceof Date?this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+(t?"":":"+this.formatZerolessValue(e.getSeconds())):e},e.mixedTimeToDate=function(e){if("string"===typeof e){var t=r.e(e.split(":"),3),n=t[0],i=t[1],a=t[2],o=new Date;return n&&o.setHours(parseInt(n)),i&&o.setMinutes(parseInt(i)),a&&o.setSeconds(parseInt(a)),o}return e},e.mixedTimeToString=function(e,t){return void 0===t&&(t=!1),"string"===typeof(e=e instanceof Date?e.getHours()+":"+e.getMinutes()+(t?"":":"+e.getSeconds()):e)?e.split(":").map((function(e){return 1===e.length?"0"+e:e})).join(":"):e},e.mixedDateToDatetimeString=function(e,t){if("string"===typeof e&&(e=new Date(e)),e instanceof Date){var n=this.formatZerolessValue(e.getFullYear())+"-"+this.formatZerolessValue(e.getMonth()+1)+"-"+this.formatZerolessValue(e.getDate())+" "+this.formatZerolessValue(e.getHours())+":"+this.formatZerolessValue(e.getMinutes())+":"+this.formatZerolessValue(e.getSeconds());t&&(n+="."+this.formatMilliseconds(e.getMilliseconds())),e=n}return e},e.mixedDateToUtcDatetimeString=function(e){return"string"===typeof e&&(e=new Date(e)),e instanceof Date?this.formatZerolessValue(e.getUTCFullYear())+"-"+this.formatZerolessValue(e.getUTCMonth()+1)+"-"+this.formatZerolessValue(e.getUTCDate())+" "+this.formatZerolessValue(e.getUTCHours())+":"+this.formatZerolessValue(e.getUTCMinutes())+":"+this.formatZerolessValue(e.getUTCSeconds())+"."+this.formatMilliseconds(e.getUTCMilliseconds()):e},e.simpleArrayToString=function(e){return Array.isArray(e)?e.map((function(e){return String(e)})).join(","):e},e.stringToSimpleArray=function(e){return e instanceof String||"string"===typeof e?e.length>0?e.split(","):[]:e},e.simpleJsonToString=function(e){return JSON.stringify(e)},e.stringToSimpleJson=function(e){try{var t=JSON.parse(e);return"object"===typeof t?t:{}}catch(n){return{}}},e.simpleEnumToString=function(e){return""+e},e.stringToSimpleEnum=function(e,t){return t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),e},e.formatZerolessValue=function(e){return e<10?"0"+e:String(e)},e.formatMilliseconds=function(e){return e<10?"00"+e:e<100?"0"+e:String(e)},e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r=n(0),i=n(68),a=function(){function t(){}return t.chunk=function(e,t){return Array.from(Array(Math.ceil(e.length/t)),(function(n,r){return e.slice(r*t,r*t+t)}))},t.splitClassesAndStrings=function(e){return[e.filter((function(e){return"string"!==typeof e})),e.filter((function(e){return"string"===typeof e}))]},t.groupBy=function(e,t){return e.reduce((function(e,n){var r=t(n),i=e.find((function(e){return e.id===r}));return i||(i={id:r,items:[]},e.push(i)),i.items.push(n),e}),[])},t.uniq=function(e,t){return e.reduce((function(e,n){var r=!1;if(t instanceof Function){var i=t(n);r=!!e.find((function(e){return t(e)===i}))}else r="string"===typeof t?!!e.find((function(e){return e[t]===n[t]})):-1!==e.indexOf(n);return r||e.push(n),e}),[])},t.isObject=function(e){return e&&"object"===typeof e&&!Array.isArray(e)},t.mergeDeep=function(t){for(var n,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];if(!o.length)return t;var u=o.shift();if(this.isObject(t)&&this.isObject(u))for(var c in u){var l=u[c];"__proto__"===c||l instanceof Promise||(!this.isObject(l)||l instanceof Map||l instanceof Set||l instanceof Date||l instanceof e||l instanceof RegExp||l instanceof i.URL?Object.assign(t,((a={})[c]=l,a)):(t[c]||Object.assign(t,((n={})[c]=Object.create(Object.getPrototypeOf(l)),n)),this.mergeDeep(t[c],l)))}return this.mergeDeep.apply(this,r.f([t],o))},t.deepCompare=function(){for(var e,t,n,r,i=[],a=0;a<arguments.length;a++)i[a]=arguments[a];if(arguments.length<1)return!0;for(e=1,t=arguments.length;e<t;e++)if(n=[],r=[],!this.compare2Objects(n,r,arguments[0],arguments[e]))return!1;return!0},t.compareIds=function(e,n){return void 0!==e&&null!==e&&void 0!==n&&null!==n&&(("string"===typeof e.id&&"string"===typeof n.id||"number"===typeof e.id&&"number"===typeof n.id)&&1===Object.keys(e).length&&1===Object.keys(n).length?e.id===n.id:t.deepCompare(e,n))},t.toBoolean=function(e){return"boolean"===typeof e?e:"string"===typeof e?"true"===e||"1"===e:"number"===typeof e&&e>0},t.zipObject=function(e,t){return e.reduce((function(e,n,r){return e[n]=t[r],e}),{})},t.isArraysEqual=function(e,t){return e.length===t.length&&e.every((function(e){return-1!==t.indexOf(e)}))},t.compare2Objects=function(e,t,n,r){var a;if(Number.isNaN(n)&&Number.isNaN(r))return!0;if(n===r)return!0;if(null===n||null===r||void 0===n||void 0===r)return!1;if(("function"===typeof n.equals||n.equals instanceof Function)&&n.equals(r))return!0;if("function"===typeof n&&"function"===typeof r||n instanceof Date&&r instanceof Date||n instanceof RegExp&&r instanceof RegExp||n instanceof String&&r instanceof String||n instanceof Number&&r instanceof Number||n instanceof i.URL&&r instanceof i.URL)return n.toString()===r.toString();if(!(n instanceof Object&&r instanceof Object))return!1;if(n.isPrototypeOf(r)||r.isPrototypeOf(n))return!1;if(n.constructor!==r.constructor)return!1;if(n.prototype!==r.prototype)return!1;if(e.indexOf(n)>-1||t.indexOf(r)>-1)return!1;for(a in r){if(r.hasOwnProperty(a)!==n.hasOwnProperty(a))return!1;if(typeof r[a]!==typeof n[a])return!1}for(a in n){if(r.hasOwnProperty(a)!==n.hasOwnProperty(a))return!1;if(typeof r[a]!==typeof n[a])return!1;switch(typeof n[a]){case"object":case"function":if(e.push(n),t.push(r),!this.compare2Objects(e,t,n[a],r[a]))return!1;e.pop(),t.pop();break;default:if(n[a]!==r[a])return!1}}return!0},t}()}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.create=function(e){var t=Promise.resolve(e);return t.__value__=e,t},e.extractValue=function(e){return e instanceof Promise&&e.__value__?e.__value__:e},e.runInSequence=function(e,t){var n=[];return e.reduce((function(e,r){return e.then((function(){return t(r)})).then((function(e){n.push(e)}))}),Promise.resolve()).then((function(){return n}))},e.settle=function(e){return Promise.all(e.map((function(e){return Promise.resolve(e).then((function(e){return{state:"fulfilled",value:e}}),(function(e){return{state:"rejected",reason:e}}))}))).then((function(e){var t=e.find((function(e){return"rejected"===e.state}));return t?Promise.reject(t.reason):e.map((function(e){return e.value}))}))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e){this.isNullable=!1,this.isGenerated=!1,this.isPrimary=!1,this.isUnique=!1,this.isArray=!1,this.length="",this.zerofill=!1,this.unsigned=!1,e&&(this.name=e.name,this.type=e.type||"",this.length=e.length||"",this.width=e.width,this.charset=e.charset,this.collation=e.collation,this.precision=e.precision,this.scale=e.scale,this.zerofill=e.zerofill||!1,this.unsigned=!!this.zerofill||(e.unsigned||!1),this.default=e.default,this.onUpdate=e.onUpdate,this.isNullable=e.isNullable||!1,this.isGenerated=e.isGenerated||!1,this.generationStrategy=e.generationStrategy,this.isPrimary=e.isPrimary||!1,this.isUnique=e.isUnique||!1,this.isArray=e.isArray||!1,this.comment=e.comment,this.enum=e.enum,this.enumName=e.enumName,this.asExpression=e.asExpression,this.generatedType=e.generatedType,this.spatialFeatureType=e.spatialFeatureType,this.srid=e.srid)}return e.prototype.clone=function(){return new e({name:this.name,type:this.type,length:this.length,width:this.width,charset:this.charset,collation:this.collation,precision:this.precision,scale:this.scale,zerofill:this.zerofill,unsigned:this.unsigned,enum:this.enum,enumName:this.enumName,asExpression:this.asExpression,generatedType:this.generatedType,default:this.default,onUpdate:this.onUpdate,isNullable:this.isNullable,isGenerated:this.isGenerated,generationStrategy:this.generationStrategy,isPrimary:this.isPrimary,isUnique:this.isUnique,isArray:this.isArray,comment:this.comment,spatialFeatureType:this.spatialFeatureType,srid:this.srid})},e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return m}));var r=n(0),i=n(55),a=n(30),o=n(20),s=n(81),u=n(5),c=n(4),l=n(41),h=n(23),p=n(8),f=n(6),d=n(21),m=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","bigint","bit","decimal","money","numeric","smallint","smallmoney","tinyint","float","real","date","datetime2","datetime","datetimeoffset","smalldatetime","time","char","varchar","text","nchar","nvarchar","ntext","binary","image","varbinary","hierarchyid","sql_variant","timestamp","uniqueidentifier","xml","geometry","geography","rowversion"],this.spatialTypes=["geometry","geography"],this.withLengthColumnTypes=["char","varchar","nchar","nvarchar","binary","varbinary"],this.withPrecisionColumnTypes=["decimal","numeric","time","datetime2","datetimeoffset"],this.withScaleColumnTypes=["decimal","numeric"],this.mappedDataTypes={createDate:"datetime2",createDateDefault:"getdate()",updateDate:"datetime2",updateDateDefault:"getdate()",deleteDate:"datetime2",deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"nvarchar(MAX)",cacheResult:"nvarchar(MAX)",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"nvarchar(MAX)"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},binary:{length:1},varbinary:{length:1},decimal:{precision:18,scale:0},numeric:{precision:18,scale:0},time:{precision:7},datetime2:{precision:7},datetimeoffset:{precision:7}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return t.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map((function(e){return i.createPool(i.options,e)})))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}}))}))},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a("mssql"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map((function(t){return e.closePool(t)})))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}}))}))},t.prototype.closePool=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){return[2,new Promise((function(t,n){e.close((function(e){return e?n(e):t()}))}))]}))}))},t.prototype.createSchemaBuilder=function(){return new l.a(this.connection)},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new s.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map((function(e){return r.push(e),"@"+(r.length-1)})).join(", "):n instanceof Function?n():(r.push(n),"@"+(r.length-1))})),r]},t.prototype.escape=function(e){return'"'+e+'"'},t.prototype.buildTableName=function(e,t,n){var r=e;return t&&(r=t+"."+e),n&&(r=t?n+"."+r:n+".."+e),r},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=d.a.transformTo(t.transformer,e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?u.a.mixedDateToDate(e):"time"===t.type?u.a.mixedTimeToDate(e):"datetime"===t.type||"smalldatetime"===t.type||t.type===Date?u.a.mixedDateToDate(e,!1,!1):"datetime2"===t.type||"datetimeoffset"===t.type?u.a.mixedDateToDate(e,!1,!0):"simple-array"===t.type?u.a.simpleArrayToString(e):"simple-json"===t.type?u.a.simpleJsonToString(e):"simple-enum"===t.type?u.a.simpleEnumToString(e):e},t.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?t.transformer?d.a.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"datetime2"===t.type||"smalldatetime"===t.type||"datetimeoffset"===t.type?e=u.a.normalizeHydratedDate(e):"date"===t.type?e=u.a.mixedDateToDateString(e):"time"===t.type?e=u.a.mixedTimeToString(e):"simple-array"===t.type?e=u.a.stringToSimpleArray(e):"simple-json"===t.type?e=u.a.stringToSimpleJson(e):"simple-enum"===t.type&&(e=u.a.stringToSimpleEnum(e,t)),t.transformer&&(e=d.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||"integer"===t.type?"int":t.type===String?"nvarchar":t.type===Date?"datetime":t.type===Boolean?"bit":t.type===e?"binary":"uuid"===t.type?"uniqueidentifier":"simple-array"===t.type||"simple-json"===t.type?"ntext":"simple-enum"===t.type?"nvarchar":"dec"===t.type?"decimal":"double precision"===t.type?"float":"rowversion"===t.type?"timestamp":t.type||""},t.prototype.normalizeDefault=function(e){var t=e.default;return"number"===typeof t?""+t:"boolean"===typeof t?!0===t?"1":"0":"function"===typeof t?t():"string"===typeof t?"'"+t+"'":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some((function(t){return 1===t.columns.length&&t.columns[0]===e}))},t.prototype.getColumnLength=function(e){return e.length?e.length.toString():"varchar"===e.type||"nvarchar"===e.type||e.type===String?"255":""},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},t.prototype.obtainMasterConnection=function(){return Promise.resolve(this.master)},t.prototype.obtainSlaveConnection=function(){if(!this.slaves.length)return this.obtainMasterConnection();var e=Math.floor(Math.random()*this.slaves.length);return Promise.resolve(this.slaves[e])},t.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce((function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&f.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r}),{})},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&n.lowerDefaultValueIfNessesary(n.normalizeDefault(t))!==n.lowerDefaultValueIfNessesary(r.default)||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||r.isGenerated!==t.isGenerated)}))},t.prototype.lowerDefaultValueIfNessesary=function(e){return e?e.split("'").map((function(e,t){return t%2===1?e:e.toLowerCase()})).join("'"):e},t.prototype.isReturningSqlSupported=function(){return!this.options.options||!this.options.options.disableOutputReturning},t.prototype.isUUIDGenerationSupported=function(){return!0},t.prototype.createParameter=function(e,t){return"@"+t},t.prototype.parametrizeValue=function(e,t){if(t instanceof h.a)return t;var n=this.normalizeType({type:e.type});return e.length?new h.a(t,n,e.length):null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?new h.a(t,n,e.precision,e.scale):null!==e.precision&&void 0!==e.precision?new h.a(t,n,e.precision):null!==e.scale&&void 0!==e.scale?new h.a(t,n,e.scale):new h.a(t,n)},t.prototype.parametrizeMap=function(e,t){var n=this;if(!this.connection.hasMetadata(e))return t;var r=this.connection.getMetadata(e);return Object.keys(t).reduce((function(e,i){var a=t[i],o=r.findColumnWithDatabaseName(i);return o?(e[i]=n.parametrizeValue(o,a),e):a}),{})},t.prototype.buildTableVariableDeclaration=function(e,t){var n=this;return"DECLARE "+e+" TABLE ("+t.map((function(e){return n.escape(e.databaseName)+" "+n.createFullType(new p.a({name:e.databaseName,type:n.normalizeType(e),length:e.length,isNullable:e.isNullable,isArray:e.isArray}))})).join(", ")+")"},t.prototype.loadDependencies=function(){try{this.mssql=c.a.load("mssql")}catch(e){throw new a.a("SQL Server","mssql")}},t.prototype.createPool=function(e,t){var n=this;t=Object.assign({},t,o.a.buildDriverOptions(t));var r=Object.assign({},{connectionTimeout:this.options.connectionTimeout,requestTimeout:this.options.requestTimeout,stream:this.options.stream,pool:this.options.pool,options:this.options.options},{server:t.host,user:t.username,password:t.password,database:t.database,port:t.port,domain:t.domain},e.extra||{});return r.options?r.options.useUTC||(r.options.useUTC=!1):r.options={useUTC:!1},new Promise((function(t,i){var a=new n.mssql.ConnectionPool(r),o=n.connection.logger,s=e.pool&&e.pool.errorHandler||function(e){return o.log("warn","MSSQL pool raised an error. "+e)};a.on("error",s);var u=a.connect((function(e){if(e)return i(e);t(u)}))}))},t}()}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames}return e.prototype.clone=function(){return new e({name:this.name,columnNames:r.f(this.columnNames)})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map((function(e){return e.databaseName}))})},e}()},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var r=n(0),i=n(20),a=n(82),o=n(5),s=n(4),u=n(41),c=n(6),l=n(21),h=function(){function t(e){var t=this;this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["bit","int","integer","tinyint","smallint","mediumint","bigint","float","double","double precision","real","decimal","dec","numeric","fixed","bool","boolean","date","datetime","timestamp","time","year","char","nchar","national char","varchar","nvarchar","national varchar","blob","text","tinyblob","tinytext","mediumblob","mediumtext","longblob","longtext","enum","binary","varbinary","json","geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.spatialTypes=["geometry","point","linestring","polygon","multipoint","multilinestring","multipolygon","geometrycollection"],this.withLengthColumnTypes=["char","varchar","nvarchar","binary","varbinary"],this.withWidthColumnTypes=["bit","tinyint","smallint","mediumint","int","integer","bigint"],this.withPrecisionColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real","time","datetime","timestamp"],this.withScaleColumnTypes=["decimal","dec","numeric","fixed","float","double","double precision","real"],this.unsignedAndZerofillTypes=["int","integer","smallint","tinyint","mediumint","bigint","decimal","dec","numeric","fixed","float","double","double precision","real"],this.mappedDataTypes={createDate:"datetime",createDatePrecision:6,createDateDefault:"CURRENT_TIMESTAMP(6)",updateDate:"datetime",updateDatePrecision:6,updateDateDefault:"CURRENT_TIMESTAMP(6)",deleteDate:"datetime",deleteDatePrecision:6,deleteDateNullable:!0,version:"int",treeLevel:"int",migrationId:"int",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.dataTypeDefaults={varchar:{length:255},nvarchar:{length:255},"national varchar":{length:255},char:{length:1},binary:{length:1},varbinary:{length:255},decimal:{precision:10,scale:0},dec:{precision:10,scale:0},numeric:{precision:10,scale:0},fixed:{precision:10,scale:0},float:{precision:12},double:{precision:22},time:{precision:0},datetime:{precision:0},timestamp:{precision:0},bit:{width:1},int:{width:11},integer:{width:11},tinyint:{width:4},smallint:{width:6},mediumint:{width:9},bigint:{width:20}},this.maxAliasLength=63,this.connection=e,this.options=e.options,this.loadDependencies(),this.client=new this.DataApiDriver(this.options.region,this.options.secretArn,this.options.resourceArn,this.options.database,(function(e,n){return t.connection.logger.logQuery(e,n)}),this.options.serviceConfigOptions)}return t.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2]}))}))},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2]}))}))},t.prototype.createSchemaBuilder=function(){return new u.a(this.connection)},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new a.a(this)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n;return(n=":..."===e.substr(0,4)?t[e.substr(4)]:t[e.substr(1)])instanceof Function?n():(r.push(n),"?")})),r]},t.prototype.escape=function(e){return"`"+e+"`"},t.prototype.buildTableName=function(e,t,n){return n?n+"."+e:e},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=l.a.transformTo(t.transformer,e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?o.a.mixedDateToDateString(e):"time"===t.type?o.a.mixedDateToTimeString(e):"json"===t.type?JSON.stringify(e):"timestamp"===t.type||"datetime"===t.type||t.type===Date?o.a.mixedDateToDate(e):"simple-array"===t.type?o.a.simpleArrayToString(e):"simple-json"===t.type?o.a.simpleJsonToString(e):"enum"===t.type||"simple-enum"===t.type?""+e:e},t.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?t.transformer?l.a.transformFrom(t.transformer,e):e:(t.type===Boolean||"bool"===t.type||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?e=o.a.normalizeHydratedDate(e):"date"===t.type?e=o.a.mixedDateToDateString(e):"json"===t.type?e="string"===typeof e?JSON.parse(e):e:"time"===t.type?e=o.a.mixedTimeToString(e):"simple-array"===t.type?e=o.a.stringToSimpleArray(e):"simple-json"===t.type?e=o.a.stringToSimpleJson(e):("enum"===t.type||"simple-enum"===t.type)&&t.enum&&!isNaN(e)&&t.enum.indexOf(parseInt(e))>=0&&(e=parseInt(e)),t.transformer&&(e=l.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||"integer"===t.type?"int":t.type===String?"varchar":t.type===Date?"datetime":t.type===e?"blob":t.type===Boolean?"tinyint":"uuid"===t.type?"varchar":"simple-array"===t.type||"simple-json"===t.type?"text":"simple-enum"===t.type?"enum":"double precision"===t.type||"real"===t.type?"double":"dec"===t.type||"numeric"===t.type||"fixed"===t.type?"decimal":"bool"===t.type||"boolean"===t.type?"tinyint":"nvarchar"===t.type||"national varchar"===t.type?"varchar":"nchar"===t.type||"national char"===t.type?"char":t.type||""},t.prototype.normalizeDefault=function(e){var t=e.default;return"enum"!==e.type&&"simple-enum"!==e.type||void 0===t?"number"===typeof t?""+t:"boolean"===typeof t?!0===t?"1":"0":"function"===typeof t?t():"string"===typeof t?"'"+t+"'":null===t?"null":t:"'"+t+"'"},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.indices.some((function(t){return t.isUnique&&1===t.columns.length&&t.columns[0]===e}))},t.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case String:case"varchar":case"nvarchar":case"national varchar":case"varbinary":return"255";default:return""}},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":e.width?t+="("+e.width+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},t.prototype.obtainMasterConnection=function(){var e=this;return new Promise((function(t,n){e.poolCluster?e.poolCluster.getConnection("MASTER",(function(r,i){r?n(r):t(e.prepareDbConnection(i))})):e.pool?e.pool.getConnection((function(r,i){r?n(r):t(e.prepareDbConnection(i))})):n(new Error("Connection is not established with mysql database"))}))},t.prototype.obtainSlaveConnection=function(){var e=this;return this.poolCluster?new Promise((function(t,n){e.poolCluster.getConnection("SLAVE*",(function(e,r){e?n(e):t(r)}))})):this.obtainMasterConnection()},t.prototype.createGeneratedMap=function(e,t){var n=e.generatedColumns.reduce((function(e,n){var r;return"increment"===n.generationStrategy&&t.insertId&&(r=t.insertId),c.a.mergeDeep(e,n.createValueMap(r))}),{});return Object.keys(n).length>0?n:void 0},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));if(!r)return!1;var i=t.length;return i||"uuid"!==t.generationStrategy||(i=n.getColumnLength(t)),r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==i||r.width!==t.width||r.precision!==t.precision||r.scale!==t.scale||r.zerofill!==t.zerofill||r.unsigned!==t.unsigned||r.asExpression!==t.asExpression||r.generatedType!==t.generatedType||!n.compareDefaultValues(n.normalizeDefault(t),r.default)||r.enum&&t.enum&&!c.a.isArraysEqual(r.enum,t.enum.map((function(e){return e+""})))||r.onUpdate!==t.onUpdate||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated}))},t.prototype.isReturningSqlSupported=function(){return!1},t.prototype.isUUIDGenerationSupported=function(){return!1},t.prototype.createParameter=function(e,t){return"?"},t.prototype.loadDependencies=function(){this.DataApiDriver=s.a.load("typeorm-aurora-data-api-driver"),this.DataApiDriver=this.DataApiDriver.default||this.DataApiDriver},t.prototype.createConnectionOptions=function(e,t){return t=Object.assign({},t,i.a.buildDriverOptions(t)),Object.assign({},{resourceArn:e.resourceArn,secretArn:e.secretArn,database:e.database,region:e.region,type:e.type},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:e.ssl},e.extra||{})},t.prototype.createPool=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,{}]}))}))},t.prototype.prepareDbConnection=function(e){var t=this.connection.logger;return 0===e.listeners("error").length&&e.on("error",(function(e){return t.log("warn","MySQL connection raised an error. "+e)})),e},t.prototype.compareDefaultValues=function(e,t){return"string"===typeof e&&"string"===typeof t&&(e=e.replace(/^'+|'+$/g,""),t=t.replace(/^'+|'+$/g,"")),e===t},t}()}).call(this,n(40).Buffer)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return f}));var r=n(0),i=n(55),a=n(30),o=n(84),s=n(5),u=n(4),c=n(41),l=n(20),h=n(6),p=n(21),f=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["char","nchar","nvarchar2","varchar2","long","raw","long raw","number","numeric","float","dec","decimal","integer","int","smallint","real","double precision","date","timestamp","timestamp with time zone","timestamp with local time zone","interval year to month","interval day to second","bfile","blob","clob","nclob","rowid","urowid"],this.spatialTypes=[],this.withLengthColumnTypes=["char","nchar","nvarchar2","varchar2","varchar","raw"],this.withPrecisionColumnTypes=["number","float","timestamp","timestamp with time zone","timestamp with local time zone"],this.withScaleColumnTypes=["number"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"timestamp",updateDateDefault:"CURRENT_TIMESTAMP",deleteDate:"timestamp",deleteDateNullable:!0,version:"number",treeLevel:"number",migrationId:"number",migrationName:"varchar2",migrationTimestamp:"number",cacheId:"number",cacheIdentifier:"varchar2",cacheTime:"number",cacheDuration:"number",cacheQuery:"clob",cacheResult:"clob",metadataType:"varchar2",metadataDatabase:"varchar2",metadataSchema:"varchar2",metadataTable:"varchar2",metadataName:"varchar2",metadataValue:"clob"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},varchar2:{length:255},nvarchar2:{length:255},raw:{length:2e3},float:{precision:126},timestamp:{precision:6},"timestamp with time zone":{precision:6},"timestamp with local time zone":{precision:6}},this.maxAliasLength=30,this.connection=e,this.options=e.options,this.loadDependencies(),this.oracle.outFormat=this.oracle.OBJECT}return t.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return this.oracle.fetchAsString=[this.oracle.CLOB],this.oracle.fetchAsBuffer=[this.oracle.BLOB],this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map((function(e){return i.createPool(i.options,e)})))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}}))}))},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a("oracle"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map((function(t){return e.closePool(t)})))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}}))}))},t.prototype.createSchemaBuilder=function(){return new c.a(this.connection)},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new o.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return"boolean"===typeof n[e]?n[e]?1:0:n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map((function(t,n){return r.push(t),":"+e.substr(4)+n})).join(", "):n instanceof Function?n():"boolean"===typeof n?n?1:0:(r.push(n),e)})),r]},t.prototype.escape=function(e){return'"'+e+'"'},t.prototype.buildTableName=function(e,t,n){return e},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=p.a.transformTo(t.transformer,e)),null===e||void 0===e?e:t.type===Boolean?e?1:0:"date"===t.type?("string"===typeof e&&(e=e.replace(/[^0-9-]/g,"")),function(){return"TO_DATE('"+s.a.mixedDateToDateString(e)+"', 'YYYY-MM-DD')"}):t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp with local time zone"===t.type?s.a.mixedDateToDate(e):"simple-array"===t.type?s.a.simpleArrayToString(e):"simple-json"===t.type?s.a.simpleJsonToString(e):e},t.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?t.transformer?p.a.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:"date"===t.type?e=s.a.mixedDateToDateString(e):"time"===t.type?e=s.a.mixedTimeToString(e):t.type===Date||"timestamp"===t.type||"timestamp with time zone"===t.type||"timestamp with local time zone"===t.type?e=s.a.normalizeHydratedDate(e):"json"===t.type?e=JSON.parse(e):"simple-array"===t.type?e=s.a.stringToSimpleArray(e):"simple-json"===t.type&&(e=s.a.stringToSimpleJson(e)),t.transformer&&(e=p.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||t.type===Boolean||"numeric"===t.type||"dec"===t.type||"decimal"===t.type||"int"===t.type||"integer"===t.type||"smallint"===t.type?"number":"real"===t.type||"double precision"===t.type?"float":t.type===String||"varchar"===t.type?"varchar2":t.type===Date?"timestamp":t.type===e?"blob":"uuid"===t.type?"varchar2":"simple-array"===t.type||"simple-json"===t.type?"clob":t.type||""},t.prototype.normalizeDefault=function(e){var t=e.default;return"number"===typeof t?""+t:"boolean"===typeof t?!0===t?"1":"0":"function"===typeof t?t():"string"===typeof t?"'"+t+"'":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some((function(t){return 1===t.columns.length&&t.columns[0]===e}))},t.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();switch(e.type){case String:case"varchar":case"varchar2":case"nvarchar2":return"255";case"raw":return"2000";case"uuid":return"36";default:return""}},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),"timestamp with time zone"===e.type?t="TIMESTAMP"+(null!==e.precision&&void 0!==e.precision?"("+e.precision+")":"")+" WITH TIME ZONE":"timestamp with local time zone"===e.type&&(t="TIMESTAMP"+(null!==e.precision&&void 0!==e.precision?"("+e.precision+")":"")+" WITH LOCAL TIME ZONE"),e.isArray&&(t+=" array"),t},t.prototype.obtainMasterConnection=function(){var e=this;return new Promise((function(t,n){e.master.getConnection((function(e,r,i){if(e)return n(e);t(r)}))}))},t.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise((function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].getConnection((function(e,r){if(e)return n(e);t(r)}))})):this.obtainMasterConnection()},t.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce((function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&h.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r}),{})},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)}))},t.prototype.isReturningSqlSupported=function(){return!0},t.prototype.isUUIDGenerationSupported=function(){return!1},t.prototype.createParameter=function(e,t){return":"+e},t.prototype.columnTypeToNativeParameter=function(e){switch(this.normalizeType({type:e})){case"number":case"numeric":case"int":case"integer":case"smallint":case"dec":case"decimal":return this.oracle.NUMBER;case"char":case"nchar":case"nvarchar2":case"varchar2":return this.oracle.STRING;case"blob":return this.oracle.BLOB;case"clob":return this.oracle.CLOB;case"date":case"timestamp":case"timestamp with time zone":case"timestamp with local time zone":return this.oracle.DATE}},t.prototype.loadDependencies=function(){try{this.oracle=u.a.load("oracledb")}catch(e){throw new a.a("Oracle","oracledb")}},t.prototype.createPool=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){return t=Object.assign({},t,l.a.buildDriverOptions(t)),n=Object.assign({},{user:t.username,password:t.password,connectString:t.connectString?t.connectString:t.host+":"+t.port+"/"+t.sid},e.extra||{}),[2,new Promise((function(e,t){i.oracle.createPool(n,(function(n,r){if(n)return t(n);e(r)}))}))]}))}))},t.prototype.closePool=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){return[2,new Promise((function(t,n){e.close((function(e){return e?n(e):t()})),e=void 0}))]}))}))},t}()}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.isUnique=!!e.isUnique,this.isSpatial=!!e.isSpatial,this.isFulltext=!!e.isFulltext,this.parser=e.parser,this.where=e.where?e.where:""}return e.prototype.clone=function(){return new e({name:this.name,columnNames:r.f(this.columnNames),isUnique:this.isUnique,isSpatial:this.isSpatial,isFulltext:this.isFulltext,parser:this.parser,where:this.where})},e.create=function(t){return new e({name:t.name,columnNames:t.columns.map((function(e){return e.databaseName})),isUnique:t.isUnique,isSpatial:t.isSpatial,isFulltext:t.isFulltext,parser:t.parser,where:t.where})},e}()},function(e,t,n){"use strict";n.d(t,"d",(function(){return Re.a})),n.d(t,"e",(function(){return O})),n.d(t,"f",(function(){return x})),n.d(t,"b",(function(){return m.d})),n.d(t,"a",(function(){return pt.a})),n.d(t,"c",(function(){return p.a})),n.d(t,"i",(function(){return Lt})),n.d(t,"g",(function(){return jt})),n.d(t,"h",(function(){return Ut}));var r=n(0),i=(n(74),n(45)),a=n(38),o=n(2),s=function(){function e(){this.nestedSetColumnNames={left:"nsleft",right:"nsright"},this.materializedPathColumnName="mpath"}return e.prototype.tableName=function(e,t){return t||Object(a.d)(e)},e.prototype.closureJunctionTableName=function(e){return e+"_closure"},e.prototype.columnName=function(e,t,n){var r=t||e;return n.length?Object(a.a)(n.join("_"))+Object(a.e)(r):r},e.prototype.relationName=function(e){return e},e.prototype.primaryKeyName=function(e,t){var n=r.f(t);n.sort();var a=(e instanceof o.a?e.name:e).replace(".","_")+"_"+n.join("_");return"PK_"+i.a.sha1(a).substr(0,27)},e.prototype.uniqueConstraintName=function(e,t){var n=r.f(t);n.sort();var a=(e instanceof o.a?e.name:e).replace(".","_")+"_"+n.join("_");return"UQ_"+i.a.sha1(a).substr(0,27)},e.prototype.relationConstraintName=function(e,t,n){var a=r.f(t);a.sort();var s=(e instanceof o.a?e.name:e).replace(".","_")+"_"+a.join("_");return n&&(s+="_"+n),"REL_"+i.a.sha1(s).substr(0,26)},e.prototype.defaultConstraintName=function(e,t){var n=(e instanceof o.a?e.name:e).replace(".","_")+"_"+t;return"DF_"+i.a.sha1(n).substr(0,27)},e.prototype.foreignKeyName=function(e,t,n,a){var s=r.f(t);s.sort();var u=(e instanceof o.a?e.name:e).replace(".","_")+"_"+s.join("_");return"FK_"+i.a.sha1(u).substr(0,27)},e.prototype.indexName=function(e,t,n){var a=r.f(t);a.sort();var s=(e instanceof o.a?e.name:e).replace(".","_")+"_"+a.join("_");return n&&(s+="_"+n),"IDX_"+i.a.sha1(s).substr(0,26)},e.prototype.checkConstraintName=function(e,t){var n=(e instanceof o.a?e.name:e).replace(".","_")+"_"+t;return"CHK_"+i.a.sha1(n).substr(0,26)},e.prototype.exclusionConstraintName=function(e,t){var n=(e instanceof o.a?e.name:e).replace(".","_")+"_"+t;return"XCL_"+i.a.sha1(n).substr(0,26)},e.prototype.joinColumnName=function(e,t){return Object(a.a)(e+"_"+t)},e.prototype.joinTableName=function(e,t,n,r){return Object(a.d)(e+"_"+n.replace(/\./gi,"_")+"_"+t)},e.prototype.joinTableColumnDuplicationPrefix=function(e,t){return e+"_"+t},e.prototype.joinTableColumnName=function(e,t,n){return Object(a.a)(e+"_"+(n||t))},e.prototype.joinTableInverseColumnName=function(e,t,n){return this.joinTableColumnName(e,t,n)},e.prototype.prefixTableName=function(e,t){return e+t},e.prototype.eagerJoinRelationAlias=function(e,t){return e+"_"+t.replace(".","_")},e}(),u=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotExecuteNotConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot execute operation on "'+n+'" connection because connection is not yet established.',r}return r.c(t,e),t}(Error),c=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotConnectAlreadyConnectedError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a "'+n+'" connection because connection to the database already established.',r}return r.c(t,e),t}(Error),l=function(e){function t(n){var r,i=e.call(this)||this;return i.name="EntityMetadataNotFound",Object.setPrototypeOf(i,t.prototype),r=n instanceof pt.a?n.options.name:"function"===typeof n?n.name:n,i.message='No metadata for "'+r+'" was found.',i}return r.c(t,e),t}(Error),h=function(e,t,n,r){this.id=e,this.timestamp=t,this.name=n,this.instance=r},p=n(7),f=n(9),d=n(23),m=n(3),y=function(){function e(e,t){this.connection=e,this.queryRunner=t,this.transaction="all";var n=this.connection.driver.options;this.migrationsTableName=e.options.migrationsTableName||"migrations",this.migrationsTable=this.connection.driver.buildTableName(this.migrationsTableName,n.schema,n.database)}return e.prototype.executeMigration=function(e){return r.b(this,void 0,void 0,(function(){var t=this;return r.d(this,(function(n){return[2,this.withQueryRunner((function(n){return r.b(t,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.createMigrationsTableIfNotExist(n)];case 1:return t.sent(),[4,e.instance.up(n)];case 2:return t.sent(),[4,this.insertExecutedMigration(n,e)];case 3:return t.sent(),[2,e]}}))}))}))]}))}))},e.prototype.getAllMigrations=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve(this.getMigrations())]}))}))},e.prototype.getExecutedMigrations=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,this.withQueryRunner((function(t){return r.b(e,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.createMigrationsTableIfNotExist(t)];case 1:return e.sent(),[4,this.loadExecutedMigrations(t)];case 2:return[2,e.sent()]}}))}))}))]}))}))},e.prototype.getPendingMigrations=function(){return r.b(this,void 0,void 0,(function(){var e,t;return r.d(this,(function(n){switch(n.label){case 0:return[4,this.getAllMigrations()];case 1:return e=n.sent(),[4,this.getExecutedMigrations()];case 2:return t=n.sent(),[2,e.filter((function(e){return t.find((function(t){return t.name===e.name}))}))]}}))}))},e.prototype.insertMigration=function(e){var t=this;return new Promise((function(n,r){t.withQueryRunner((function(i){t.insertExecutedMigration(i,e).then(n).catch(r)}))}))},e.prototype.deleteMigration=function(e){var t=this;return new Promise((function(n,r){t.withQueryRunner((function(i){t.deleteExecutedMigration(i,e).then(n).catch(r)}))}))},e.prototype.showMigrations=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l,h;return r.d(this,(function(p){switch(p.label){case 0:return n=!1,i=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(i)];case 1:return p.sent(),[4,this.loadExecutedMigrations(i)];case 2:a=p.sent(),o=this.getMigrations(),s=function(e){a.find((function(t){return t.name===e.name}))?u.connection.logger.logSchemaBuild(" [X] "+e.name):(n=!0,u.connection.logger.logSchemaBuild(" [ ] "+e.name))},u=this;try{for(c=r.g(o),l=c.next();!l.done;l=c.next())h=l.value,s(h)}catch(f){e={error:f}}finally{try{l&&!l.done&&(t=c.return)&&t.call(c)}finally{if(e)throw e.error}}return this.queryRunner?[3,4]:[4,i.release()];case 3:p.sent(),p.label=4;case 4:return[2,n]}}))}))},e.prototype.executePendingMigrations=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return r.d(this,(function(l){switch(l.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return l.sent(),[4,this.loadExecutedMigrations(e)];case 2:return t=l.sent(),n=this.getLatestTimestampMigration(t),i=this.getMigrations(),a=[],(o=i.filter((function(e){return!t.find((function(t){return t.name===e.name}))}))).length?[3,5]:(this.connection.logger.logSchemaBuild("No migrations are pending"),this.queryRunner?[3,4]:[4,e.release()]);case 3:l.sent(),l.label=4;case 4:return[2,[]];case 5:return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(i.length+" migrations were found in the source code."),n&&this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild(o.length+" migrations are new migrations that needs to be executed."),s=!1,"all"!==this.transaction||e.isTransactionActive?[3,7]:[4,e.startTransaction()];case 6:l.sent(),s=!0,l.label=7;case 7:return l.trys.push([7,11,16,19]),[4,p.a.runInSequence(o,(function(t){return r.b(c,void 0,void 0,(function(){var n=this;return r.d(this,(function(i){switch(i.label){case 0:return"each"!==this.transaction||e.isTransactionActive?[3,2]:[4,e.startTransaction()];case 1:i.sent(),s=!0,i.label=2;case 2:return[2,t.instance.up(e).then((function(){return r.b(n,void 0,void 0,(function(){return r.d(this,(function(n){switch(n.label){case 0:return[4,this.insertExecutedMigration(e,t)];case 1:return n.sent(),"each"===this.transaction&&s?[4,e.commitTransaction()]:[3,3];case 2:n.sent(),n.label=3;case 3:return[2]}}))}))})).then((function(){a.push(t),n.connection.logger.logSchemaBuild("Migration "+t.name+" has been executed successfully.")}))]}}))}))}))];case 8:return l.sent(),"all"===this.transaction&&s?[4,e.commitTransaction()]:[3,10];case 9:l.sent(),l.label=10;case 10:return[3,19];case 11:if(u=l.sent(),!s)return[3,15];l.label=12;case 12:return l.trys.push([12,14,,15]),[4,e.rollbackTransaction()];case 13:return l.sent(),[3,15];case 14:return l.sent(),[3,15];case 15:throw u;case 16:return this.queryRunner?[3,18]:[4,e.release()];case 17:l.sent(),l.label=18;case 18:return[7];case 19:return[2,a]}}))}))},e.prototype.undoLastMigration=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e=this.queryRunner||this.connection.createQueryRunner("master"),[4,this.createMigrationsTableIfNotExist(e)];case 1:return r.sent(),[4,this.loadExecutedMigrations(e)];case 2:if(t=r.sent(),!(n=this.getLatestExecutedMigration(t)))return this.connection.logger.logSchemaBuild("No migrations was found in the database. Nothing to revert!"),[2];if(i=this.getMigrations(),!(a=i.find((function(e){return e.name===n.name}))))throw new Error("No migration "+n.name+" was found in the source code. Make sure you have this migration in your codebase and its included in the connection options.");return this.connection.logger.logSchemaBuild(t.length+" migrations are already loaded in the database."),this.connection.logger.logSchemaBuild(n.name+" is the last executed migration. It was executed on "+new Date(n.timestamp).toString()+"."),this.connection.logger.logSchemaBuild("Now reverting it..."),o=!1,"none"===this.transaction||e.isTransactionActive?[3,4]:[4,e.startTransaction()];case 3:r.sent(),o=!0,r.label=4;case 4:return r.trys.push([4,9,14,17]),[4,a.instance.down(e)];case 5:return r.sent(),[4,this.deleteExecutedMigration(e,a)];case 6:return r.sent(),this.connection.logger.logSchemaBuild("Migration "+a.name+" has been reverted successfully."),o?[4,e.commitTransaction()]:[3,8];case 7:r.sent(),r.label=8;case 8:return[3,17];case 9:if(s=r.sent(),!o)return[3,13];r.label=10;case 10:return r.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return r.sent(),[3,13];case 12:return r.sent(),[3,13];case 13:throw s;case 14:return this.queryRunner?[3,16]:[4,e.release()];case 15:r.sent(),r.label=16;case 16:return[7];case 17:return[2]}}))}))},e.prototype.createMigrationsTableIfNotExist=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof m.a?[2]:[4,e.hasTable(this.migrationsTable)];case 1:return t.sent()?[3,3]:[4,e.createTable(new o.a({name:this.migrationsTable,columns:[{name:"id",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationId}),isGenerated:!0,generationStrategy:"increment",isPrimary:!0,isNullable:!1},{name:"timestamp",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp}),isPrimary:!1,isNullable:!1},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}),isNullable:!1}]}))];case 2:t.sent(),t.label=3;case 3:return[2]}}))}))},e.prototype.loadExecutedMigrations=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof m.a?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).find().sort({_id:-1}).toArray()]:[3,2];case 1:return[2,t.sent()];case 2:return[4,this.connection.manager.createQueryBuilder(e).select().orderBy(this.connection.driver.escape("id"),"DESC").from(this.migrationsTable,this.migrationsTableName).getRawMany()];case 3:return[2,t.sent().map((function(e){return new h(parseInt(e.id),parseInt(e.timestamp),e.name)}))]}}))}))},e.prototype.getMigrations=function(){var e=this.connection.migrations.map((function(e){var t=e.name||e.constructor.name,n=parseInt(t.substr(-13),10);if(!n||isNaN(n))throw new Error(t+" migration name is wrong. Migration class name should have a JavaScript timestamp appended.");return new h(void 0,n,t,e)}));return this.checkForDuplicateMigrations(e),e.sort((function(e,t){return e.timestamp-t.timestamp}))},e.prototype.checkForDuplicateMigrations=function(e){var t=e.map((function(e){return e.name})),n=Array.from(new Set(t.filter((function(e,n){return t.indexOf(e)<n}))));if(n.length>0)throw Error("Duplicate migrations: "+n.join(", "))},e.prototype.getLatestTimestampMigration=function(e){var t=e.map((function(e){return e})).sort((function(e,t){return-1*(e.timestamp-t.timestamp)}));return t.length>0?t[0]:void 0},e.prototype.getLatestExecutedMigration=function(e){return e.length>0?e[0]:void 0},e.prototype.insertExecutedMigration=function(e,t){return r.b(this,void 0,void 0,(function(){var n;return r.d(this,(function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof f.a?(n.timestamp=new d.a(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new d.a(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof m.a?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).insert(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,e.manager.createQueryBuilder().insert().into(this.migrationsTable).values(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.deleteExecutedMigration=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n={},this.connection.driver instanceof f.a?(n.timestamp=new d.a(t.timestamp,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationTimestamp})),n.name=new d.a(t.name,this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.migrationName}))):(n.timestamp=t.timestamp,n.name=t.name),this.connection.driver instanceof m.a?[4,e.databaseConnection.db(this.connection.driver.database).collection(this.migrationsTableName).deleteOne(n)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,(i=e.manager.createQueryBuilder()).delete().from(this.migrationsTable).where(i.escape("timestamp")+" = :timestamp").andWhere(i.escape("name")+" = :name").setParameters(n).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},e.prototype.withQueryRunner=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:t=this.queryRunner||this.connection.createQueryRunner("master"),n.label=1;case 1:return n.trys.push([1,,2,5]),[2,e(t)];case 2:return this.queryRunner?[3,4]:[4,t.release()];case 3:n.sent(),n.label=4;case 4:return[7];case 5:return[2]}}))}))},e}(),v=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingPrimaryColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have a primary column. Primary column is required to have in all your entities. Use @PrimaryColumn decorator to add a primary column to your entity.',r}return r.c(t,e),t}(Error),g=function(e){function t(n){var r=e.call(this)||this;return r.name="CircularRelationsError",Object.setPrototypeOf(r,t.prototype),r.message="Circular relations detected: "+n+". To resolve this issue you need to set nullable: true somewhere in this dependency structure.",r}return r.c(t,e),t}(Error);function b(e,t,n){var r=[],i={};return function a(o){i[o]=!0,r.push(o),e[o].forEach((function(e){if(i[e]){if(r.indexOf(e)>=0)throw r.push(e),new Error("Dependency Cycle Found: "+r.join(" -> "))}else a(e)})),r.pop(),t&&0!==e[o].length||-1!==n.indexOf(o)||n.push(o)}}var E=function(){function e(){this.nodes={},this.outgoingEdges={},this.incomingEdges={}}return e.prototype.addNode=function(e,t){this.hasNode(e)||(this.nodes[e]=2===arguments.length?t:e,this.outgoingEdges[e]=[],this.incomingEdges[e]=[])},e.prototype.removeNode=function(e){this.hasNode(e)&&(delete this.nodes[e],delete this.outgoingEdges[e],delete this.incomingEdges[e],[this.incomingEdges,this.outgoingEdges].forEach((function(t){Object.keys(t).forEach((function(n){var r=t[n].indexOf(e);r>=0&&t[n].splice(r,1)}),this)})))},e.prototype.hasNode=function(e){return this.nodes.hasOwnProperty(e)},e.prototype.getNodeData=function(e){if(this.hasNode(e))return this.nodes[e];throw new Error("Node does not exist: "+e)},e.prototype.setNodeData=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);this.nodes[e]=t},e.prototype.addDependency=function(e,t){if(!this.hasNode(e))throw new Error("Node does not exist: "+e);if(!this.hasNode(t))throw new Error("Node does not exist: "+t);return-1===this.outgoingEdges[e].indexOf(t)&&this.outgoingEdges[e].push(t),-1===this.incomingEdges[t].indexOf(e)&&this.incomingEdges[t].push(e),!0},e.prototype.removeDependency=function(e,t){var n;this.hasNode(e)&&(n=this.outgoingEdges[e].indexOf(t))>=0&&this.outgoingEdges[e].splice(n,1),this.hasNode(t)&&(n=this.incomingEdges[t].indexOf(e))>=0&&this.incomingEdges[t].splice(n,1)},e.prototype.dependenciesOf=function(e,t){if(this.hasNode(e)){var n=[];b(this.outgoingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.dependantsOf=function(e,t){if(this.hasNode(e)){var n=[];b(this.incomingEdges,t,n)(e);var r=n.indexOf(e);return r>=0&&n.splice(r,1),n}throw new Error("Node does not exist: "+e)},e.prototype.overallOrder=function(e){var t=this,n=[],r=Object.keys(this.nodes);if(0===r.length)return n;var i=b(this.outgoingEdges,!1,[]);r.forEach((function(e){i(e)}));var a=b(this.outgoingEdges,e,n);return r.filter((function(e){return 0===t.incomingEdges[e].length})).forEach((function(e){a(e)})),n},e}(),T=function(e){function t(n,r,i){var a=e.call(this)||this;a.name="DataTypeNotSupportedError",Object.setPrototypeOf(a,t.prototype);var o="string"===typeof r?r:r.name;return a.message='Data type "'+o+'" in "'+n.entityMetadata.targetName+"."+n.propertyName+'" is not supported by "'+i+'" database.',a}return r.c(t,e),t}(Error),N=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Option "'+n+'" is not set in your connection options, please define "'+n+'" option in your connection options or ormconfig.json',r}return r.c(t,e),t}(Error),w=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),r.message='Array initializations are not allowed in entity relations. Please remove array initialization (= []) from "'+n.entityMetadata.targetName+"#"+n.propertyPath+'". This is ORM requirement to make relations to work properly. Refer docs for more information.',r}return r.c(t,e),t}(Error),A=n(11),C=function(){function e(){}return e.prototype.validateMany=function(e,t){var n=this;e.forEach((function(r){return n.validate(r,e,t)})),this.validateDependencies(e),this.validateEagerRelations(e)},e.prototype.validate=function(e,t,n){if(!e.primaryColumns.length&&!e.isJunction)throw new v(e);if("STI"===e.inheritancePattern){if(!e.discriminatorColumn)throw new Error("Entity "+e.name+" using single-table inheritance, it should also have a discriminator column. Did you forget to put discriminator column options?");if(-1!==["",void 0,null].indexOf(e.discriminatorValue))throw new Error("Entity "+e.name+" has empty discriminator value. Discriminator value should not be empty.");var r=t.find((function(t){return t!==e&&t.discriminatorValue===e.discriminatorValue}));if(r)throw new Error("Entities "+e.name+" and "+r.name+" as equal discriminator values. Make sure their discriminator values are not equal using @DiscriminatorValue decorator.")}if((e.relationCounts.forEach((function(e){if(e.relation.isManyToOne||e.relation.isOneToOne)throw new Error("Relation count can not be implemented on ManyToOne or OneToOne relations.")})),n instanceof m.a||e.columns.forEach((function(t){var r=n.normalizeType(t);if(-1===n.supportedDataTypes.indexOf(r))throw new T(t,r,n.options.type);if(t.length&&-1===n.withLengthColumnTypes.indexOf(r))throw new Error("Column "+t.propertyName+" of Entity "+e.name+" does not support length property.")})),n instanceof m.e||n instanceof A.a)&&e.columns.filter((function(e){return e.isGenerated&&"uuid"!==e.generationStrategy})).length>1)throw new Error("Error in "+e.name+" entity. There can be only one auto-increment column in MySql table.");if(n instanceof m.e&&(0===t.filter((function(e){return e.database})).length&&!n.database))throw new N("database");if(n instanceof f.a&&e.columns.filter((function(e){return e.charset})).length>1)throw new Error("Character set specifying is not supported in Sql Server");var i=e.create();e.relations.forEach((function(e){if(e.isManyToMany||e.isOneToMany){if(!1===e.persistenceEnabled)return;var t=e.getEntityValue(i);if(Array.isArray(t))throw new w(e)}})),e.relations.forEach((function(e){})),e.relations.forEach((function(t){if(t.isCascadeRemove&&t.inverseRelation&&t.inverseRelation.isCascadeRemove)throw new Error("Relation "+e.name+"#"+t.propertyName+" and "+t.inverseRelation.entityMetadata.name+"#"+t.inverseRelation.propertyName+" both has cascade remove set. This may lead to unexpected circular removals. Please set cascade remove only from one side of relationship.")})),e.eagerRelations.forEach((function(e){}))},e.prototype.validateDependencies=function(e){var t=new E;e.forEach((function(e){t.addNode(e.name)})),e.forEach((function(e){e.relationsWithJoinColumns.filter((function(e){return!e.isNullable})).forEach((function(n){t.addDependency(e.name,n.inverseEntityMetadata.name)}))}));try{t.overallOrder()}catch(n){throw new g(n.toString().replace("Error: Dependency Cycle Found: ",""))}},e.prototype.validateEagerRelations=function(e){e.forEach((function(e){e.eagerRelations.forEach((function(t){if(t.inverseRelation&&t.inverseRelation.isEager)throw new Error("Circular eager relations are disallowed. "+e.targetName+"#"+t.propertyPath+' contains "eager: true", and its inverse side '+t.inverseEntityMetadata.targetName+"#"+t.inverseRelation.propertyPath+' contains "eager: true" as well. Remove "eager: true" from one side of the relation.')}))}))},e}(),S=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerProviderAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Database connection provided by a query runner was already released, cannot continue to use its querying methods anymore.",n}return r.c(t,e),t}(Error),R=function(e){function t(n,r){var i,a=e.call(this)||this;a.name="EntityNotFound",Object.setPrototypeOf(a,t.prototype),i=n instanceof pt.a?n.options.name:"function"===typeof n?n.name:n;var o=a.stringifyCriteria(r);return a.message='Could not find any entity of type "'+i+'" matching: '+o,a}return r.c(t,e),t.prototype.stringifyCriteria=function(e){try{return JSON.stringify(e,null,4)}catch(t){}return""+e},t}(Error),M=function(e){function t(){var n=e.call(this)||this;return n.name="NoNeedToReleaseEntityManagerError",Object.setPrototypeOf(n,t.prototype),n.message="Entity manager is not using single database connection and cannot be released. Only entity managers created by connection#createEntityManagerWithSingleDatabaseConnection methods have a single database connection and they should be released.",n}return r.c(t,e),t}(Error),O=function(){function e(){}return e.prototype.createQueryBuilder=function(e,t){return this.manager.createQueryBuilder(this.metadata.target,e||this.metadata.targetName,t||this.queryRunner)},Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),e.prototype.hasId=function(e){return this.manager.hasId(this.metadata.target,e)},e.prototype.getId=function(e){return this.manager.getId(this.metadata.target,e)},e.prototype.create=function(e){return this.manager.create(this.metadata.target,e)},e.prototype.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.manager).merge.apply(t,r.f([this.metadata.target,e],n))},e.prototype.preload=function(e){return this.manager.preload(this.metadata.target,e)},e.prototype.save=function(e,t){return this.manager.save(this.metadata.target,e,t)},e.prototype.remove=function(e,t){return this.manager.remove(this.metadata.target,e,t)},e.prototype.softRemove=function(e,t){return this.manager.softRemove(this.metadata.target,e,t)},e.prototype.recover=function(e,t){return this.manager.recover(this.metadata.target,e,t)},e.prototype.insert=function(e){return this.manager.insert(this.metadata.target,e)},e.prototype.update=function(e,t){return this.manager.update(this.metadata.target,e,t)},e.prototype.delete=function(e){return this.manager.delete(this.metadata.target,e)},e.prototype.softDelete=function(e){return this.manager.softDelete(this.metadata.target,e)},e.prototype.restore=function(e){return this.manager.restore(this.metadata.target,e)},e.prototype.count=function(e){return this.manager.count(this.metadata.target,e)},e.prototype.find=function(e){return this.manager.find(this.metadata.target,e)},e.prototype.findAndCount=function(e){return this.manager.findAndCount(this.metadata.target,e)},e.prototype.findByIds=function(e,t){return this.manager.findByIds(this.metadata.target,e,t)},e.prototype.findOne=function(e,t){return this.manager.findOne(this.metadata.target,e,t)},e.prototype.findOneOrFail=function(e,t){return this.manager.findOneOrFail(this.metadata.target,e,t)},e.prototype.query=function(e,t){return this.manager.query(e,t)},e.prototype.clear=function(){return this.manager.clear(this.metadata.target)},e.prototype.increment=function(e,t,n){return this.manager.increment(this.metadata.target,e,t,n)},e.prototype.decrement=function(e,t,n){return this.manager.decrement(this.metadata.target,e,t,n)},e}(),P=n(19),x=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.findTrees=function(){return r.b(this,void 0,void 0,(function(){var e,t=this;return r.d(this,(function(n){switch(n.label){case 0:return[4,this.findRoots()];case 1:return e=n.sent(),[4,Promise.all(e.map((function(e){return t.findDescendantsTree(e)})))];case 2:return n.sent(),[2,e]}}))}))},t.prototype.findRoots=function(){var e,t,n=this,r=this.manager.connection.namingStrategy.joinColumnName(this.metadata.treeParentRelation.propertyName,"id");return this.createQueryBuilder("treeEntity").where((t="treeEntity",n.manager.connection.driver.escape(t)+"."+(e=r,n.manager.connection.driver.escape(e)+" IS NULL"))).getMany()},t.prototype.findDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findDescendantsTree=function(e){var t=this;return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then((function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildChildrenEntityTree(e,n.entities,r),e}))},t.prototype.countDescendants=function(e){return this.createDescendantsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createDescendantsQueryBuilder=function(e,t,n){var r=this,i=function(e){return r.manager.connection.driver.escape(e)};if("closure-table"===this.metadata.treeType){var a=this.metadata.closureJunctionTable.descendantColumns.map((function(n){return i(t)+"."+i(n.propertyPath)+" = "+i(e)+"."+i(n.referencedColumn.propertyPath)})).join(" AND "),o={},s=this.metadata.closureJunctionTable.ancestorColumns.map((function(e){return o[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),i(t)+"."+i(e.propertyPath)+" = :"+e.referencedColumn.propertyName})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,a).where(s).setParameters(o)}if("nested-set"===this.metadata.treeType){s=e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN joined."+this.metadata.nestedSetLeftColumn.propertyPath+" AND joined."+this.metadata.nestedSetRightColumn.propertyPath;var u={};a=this.metadata.treeParentRelation.joinColumns.map((function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return u[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",s).where(a,u)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof P.a?e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE "+i.getQuery()+" || '%'":e+"."+r.metadata.materializedPathColumn.propertyPath+" LIKE CONCAT("+i.getQuery()+", '%')"}));throw new Error("Supported only in tree entities")},t.prototype.findAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getMany()},t.prototype.findAncestorsTree=function(e){var t=this;return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getRawAndEntities().then((function(n){var r=t.createRelationMaps("treeEntity",n.raw);return t.buildParentEntityTree(e,n.entities,r),e}))},t.prototype.countAncestors=function(e){return this.createAncestorsQueryBuilder("treeEntity","treeClosure",e).getCount()},t.prototype.createAncestorsQueryBuilder=function(e,t,n){var r=this;if("closure-table"===this.metadata.treeType){var i=this.metadata.closureJunctionTable.ancestorColumns.map((function(n){return t+"."+n.propertyPath+" = "+e+"."+n.referencedColumn.propertyPath})).join(" AND "),a={},o=this.metadata.closureJunctionTable.descendantColumns.map((function(e){return a[e.referencedColumn.propertyName]=e.referencedColumn.getEntityValue(n),t+"."+e.propertyPath+" = :"+e.referencedColumn.propertyName})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.closureJunctionTable.tableName,t,i).where(o).setParameters(a)}if("nested-set"===this.metadata.treeType){i="joined."+this.metadata.nestedSetLeftColumn.propertyPath+" BETWEEN "+e+"."+this.metadata.nestedSetLeftColumn.propertyPath+" AND "+e+"."+this.metadata.nestedSetRightColumn.propertyPath;var s={};o=this.metadata.treeParentRelation.joinColumns.map((function(e){var t=e.referencedColumn.propertyPath.replace(".","_");return s[t]=e.referencedColumn.getEntityValue(n),"joined."+e.referencedColumn.propertyPath+" = :"+t})).join(" AND ");return this.createQueryBuilder(e).innerJoin(this.metadata.targetName,"joined",i).where(o,s)}if("materialized-path"===this.metadata.treeType)return this.createQueryBuilder(e).where((function(t){var i=t.subQuery().select(r.metadata.targetName+"."+r.metadata.materializedPathColumn.propertyPath,"path").from(r.metadata.target,r.metadata.targetName).whereInIds(r.metadata.getEntityIdMap(n));return t.setNativeParameters(i.expressionMap.nativeParameters),r.manager.connection.driver instanceof P.a?i.getQuery()+" LIKE "+e+"."+r.metadata.materializedPathColumn.propertyPath+" || '%'":i.getQuery()+" LIKE CONCAT("+e+"."+r.metadata.materializedPathColumn.propertyPath+", '%')"}));throw new Error("Supported only in tree entities")},t.prototype.createRelationMaps=function(e,t){var n=this;return t.map((function(t){var r=n.metadata.treeParentRelation.joinColumns[0],i=r.givenDatabaseName||r.databaseName,a=t[e+"_"+n.metadata.primaryColumns[0].databaseName],o=t[e+"_"+i];return{id:n.manager.connection.driver.prepareHydratedValue(a,n.metadata.primaryColumns[0]),parentId:n.manager.connection.driver.prepareHydratedValue(o,r)}}))},t.prototype.buildChildrenEntityTree=function(e,t,n){var r=this,i=this.metadata.treeChildrenRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.filter((function(e){return e.parentId===a})),s=new Set(o.map((function(e){return e.id})));e[i]=t.filter((function(e){return s.has(e.id)})),e[i].forEach((function(e){r.buildChildrenEntityTree(e,t,n)}))},t.prototype.buildParentEntityTree=function(e,t,n){var r=this,i=this.metadata.treeParentRelation.propertyName,a=this.metadata.primaryColumns[0].getEntityValue(e),o=n.find((function(e){return e.id===a})),s=t.find((function(e){return!!o&&e[r.metadata.primaryColumns[0].propertyName]===o.parentId}));s&&(e[i]=s,this.buildParentEntityTree(e[i],t,n))},t}(O),I=function(e){function t(n){var r=e.call(this)||this;return Object.setPrototypeOf(r,t.prototype),1===n.length?r.message='Relation "'+n[0]+'" was not found, please check if it is correct and really exist in your entity.':r.message="Relations "+n.map((function(e){return'"'+e+'"'})).join(", ")+" were not found, please check if relations are correct and they exist in your entities.",r}return r.c(t,e),t}(Error),_=function(){function e(){}return e.isFindOneOptions=function(e){var t=e;return t&&(Array.isArray(t.select)||t.where instanceof Object||"string"===typeof t.where||Array.isArray(t.relations)||t.join instanceof Object||t.order instanceof Object||t.cache instanceof Object||"boolean"===typeof t.cache||"number"===typeof t.cache||t.lock instanceof Object||t.loadRelationIds instanceof Object||"boolean"===typeof t.loadRelationIds||"boolean"===typeof t.loadEagerRelations||"boolean"===typeof t.withDeleted)},e.isFindManyOptions=function(e){var t=e;return t&&(this.isFindOneOptions(t)||"number"===typeof t.skip||"number"===typeof t.take||"string"===typeof t.skip||"string"===typeof t.take)},e.extractFindManyOptionsAlias=function(e){if(this.isFindManyOptions(e)&&e.join)return e.join.alias},e.applyFindManyOptionsOrConditionsToQueryBuilder=function(e,t){return this.isFindManyOptions(t)?this.applyOptionsToQueryBuilder(e,t):t?e.where(t):e},e.applyOptionsToQueryBuilder=function(e,t){if(!t||!this.isFindOneOptions(t)&&!this.isFindManyOptions(t))return e;if(!e.expressionMap.mainAlias||!e.expressionMap.mainAlias.hasMetadata)return e;var n=e.expressionMap.mainAlias.metadata;if(t.select&&(e.select([]),t.select.forEach((function(t){if(!n.findColumnWithPropertyPath(String(t)))throw new Error(t+" column was not found in the "+n.name+" entity.");e.addSelect(e.alias+"."+t)}))),t.where&&e.where(t.where),t.skip&&e.skip(t.skip),t.take&&e.take(t.take),t.order&&Object.keys(t.order).forEach((function(r){var i=t.order[r];if(!n.findColumnWithPropertyPath(r))throw new Error(r+" column was not found in the "+n.name+" entity.");switch(i){case 1:e.addOrderBy(e.alias+"."+r,"ASC");break;case-1:e.addOrderBy(e.alias+"."+r,"DESC");break;case"ASC":e.addOrderBy(e.alias+"."+r,"ASC");break;case"DESC":e.addOrderBy(e.alias+"."+r,"DESC")}})),t.relations){var r=t.relations.map((function(e){return e}));if(this.applyRelationsRecursively(e,r,e.expressionMap.mainAlias.name,e.expressionMap.mainAlias.metadata,""),r.length>0)throw new I(r)}if(t.join&&(t.join.leftJoin&&Object.keys(t.join.leftJoin).forEach((function(n){e.leftJoin(t.join.leftJoin[n],n)})),t.join.innerJoin&&Object.keys(t.join.innerJoin).forEach((function(n){e.innerJoin(t.join.innerJoin[n],n)})),t.join.leftJoinAndSelect&&Object.keys(t.join.leftJoinAndSelect).forEach((function(n){e.leftJoinAndSelect(t.join.leftJoinAndSelect[n],n)})),t.join.innerJoinAndSelect&&Object.keys(t.join.innerJoinAndSelect).forEach((function(n){e.innerJoinAndSelect(t.join.innerJoinAndSelect[n],n)}))),t.cache)if(t.cache instanceof Object){var i=t.cache;e.cache(i.id,i.milliseconds)}else e.cache(t.cache);return t.lock&&("optimistic"===t.lock.mode?e.setLock(t.lock.mode,t.lock.version):"pessimistic_read"!==t.lock.mode&&"pessimistic_write"!==t.lock.mode&&"dirty_read"!==t.lock.mode&&"pessimistic_partial_write"!==t.lock.mode&&"pessimistic_write_or_fail"!==t.lock.mode||e.setLock(t.lock.mode)),t.withDeleted&&e.withDeleted(),!0===t.loadRelationIds?e.loadAllRelationIds():t.loadRelationIds instanceof Object&&e.loadAllRelationIds(t.loadRelationIds),e},e.applyRelationsRecursively=function(e,t,n,r,i){var o=this,s=[];if(i){var u=new RegExp("^"+i.replace(".","\\.")+"\\.");s=t.filter((function(e){return e.match(u)})).map((function(e){return e.replace(u,"")})).filter((function(e){return r.findRelationWithPropertyPath(e)}))}else s=t.filter((function(e){return r.findRelationWithPropertyPath(e)}));s.forEach((function(s){var u=n+"__"+s;e.connection.driver.maxAliasLength&&u.length>e.connection.driver.maxAliasLength&&(u=Object(a.c)(u));var c=n+"."+s;e.leftJoinAndSelect(c,u);var l=r.relations.find((function(e){return e.propertyName===s}));l&&o.joinEagerRelations(e,u,l.inverseEntityMetadata),t.splice(t.indexOf(i?i+"."+s:s),1);var h=e.expressionMap.joinAttributes.find((function(e){return e.entityOrProperty===c}));o.applyRelationsRecursively(e,t,h.alias.name,h.metadata,i?i+"."+s:s)}))},e.joinEagerRelations=function(e,t,n){var r=this;n.eagerRelations.forEach((function(n){var i=e.connection.namingStrategy.eagerJoinRelationAlias(t,n.propertyPath);e.leftJoinAndSelect(t+"."+n.propertyPath,i),r.joinEagerRelations(e,i,n.inverseEntityMetadata)}))},e}(),L=function(){function e(){}return e.prototype.transform=function(e,t,n,r){return void 0===r&&(r=!1),this.groupAndTransform(e,t,n,r),e},e.prototype.groupAndTransform=function(e,t,n,r){var i=this;void 0===r&&(r=!1),n.nonVirtualColumns.forEach((function(n){var r=n.getEntityValue(t);void 0!==r&&n.setEntityValue(e,r)})),n.relations.length&&n.relations.forEach((function(n){var a=n.getEntityValue(e),o=n.getEntityValue(t,r);if(void 0!==o)if(n.isOneToMany||n.isManyToMany){if(!Array.isArray(o))return;a||(a=[],n.setEntityValue(e,a)),o.forEach((function(e){var t=a.find((function(t){return n.inverseEntityMetadata.compareEntities(e,t)}));t||(t=n.inverseEntityMetadata.create(),a.push(t)),i.groupAndTransform(t,e,n.inverseEntityMetadata,r)}))}else{if(!(o instanceof Object))return void(a instanceof Object||n.setEntityValue(e,o));a||(a=n.inverseEntityMetadata.create(),n.setEntityValue(e,a)),i.groupAndTransform(a,o,n.inverseEntityMetadata,r)}}))},e}(),D=function(){function e(e,t,n,r){this.plainEntity=e,this.metadata=t,this.parentLoadMapItem=n,this.relation=r}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"id",{get:function(){return this.metadata.getEntityIdMixedMap(this.plainEntity)},enumerable:!0,configurable:!0}),e}(),q=function(){function e(){this.loadMapItems=[]}return Object.defineProperty(e.prototype,"mainLoadMapItem",{get:function(){return this.loadMapItems.find((function(e){return!e.relation&&!e.parentLoadMapItem}))},enumerable:!0,configurable:!0}),e.prototype.addLoadMap=function(e){this.loadMapItems.find((function(t){return t.target===e.target&&t.id===e.id}))||this.loadMapItems.push(e)},e.prototype.fillEntities=function(e,t){var n=this;t.forEach((function(t){var r=n.loadMapItems.find((function(n){return n.target===e&&n.metadata.compareEntities(t,n.plainEntity)}));r&&(r.entity=t)}))},e.prototype.groupByTargetIds=function(){var e=[];return this.loadMapItems.forEach((function(t){var n=e.find((function(e){return e.target===t.target}));n||(n={target:t.target,ids:[]},e.push(n)),n.ids.push(t.id)})),e},e}(),j=function(){function e(e){this.manager=e}return e.prototype.transform=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a=this;return r.d(this,(function(o){switch(o.label){case 0:return t.hasAllPrimaryKeys(e)?(n=new q,(i=function(e,a,o,s){var u=new D(e,a,o,s);n.addLoadMap(u),a.extractRelationValuesFromEntity(e,t.relations).filter((function(e){return null!==e&&void 0!==e})).forEach((function(e){var t=r.e(e,3),n=t[0],a=t[1],o=t[2];return i(a,o,u,n)}))})(e,t),[4,Promise.all(n.groupByTargetIds().map((function(e){return a.manager.findByIds(e.target,e.ids).then((function(t){return n.fillEntities(e.target,t)}))})))]):[2,Promise.reject("Given object does not have a primary column, cannot transform it to database entity.")];case 1:return o.sent(),n.loadMapItems.forEach((function(e){e.relation&&e.entity&&e.parentLoadMapItem&&e.parentLoadMapItem.entity&&(e.relation.isManyToMany||e.relation.isOneToMany?(e.parentLoadMapItem.entity[e.relation.propertyName]||(e.parentLoadMapItem.entity[e.relation.propertyName]=[]),e.parentLoadMapItem.entity[e.relation.propertyName].push(e.entity)):e.parentLoadMapItem.entity[e.relation.propertyName]=e.entity)})),[2,n.mainLoadMapItem?n.mainLoadMapItem.entity:void 0]}}))}))},e}(),U=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" was not found. Did you forgot to put @EntityRepository decorator on it?",r}return r.c(t,e),t}(Error),B=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryDoesNotHaveEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Custom repository "+(n instanceof Function?n.name:n.constructor.name)+" does not have managed entity. Did you forget to specify entity for it @EntityRepository(MyEntity)? ",r}return r.c(t,e),t}(Error),k=function(){function e(){}return Object.defineProperty(e.prototype,"repository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new B(this.constructor);return this.manager.getRepository(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"treeRepository",{get:function(){var e=this.getCustomRepositoryTarget(this);if(!e)throw new B(this.constructor);return this.manager.getTreeRepository(e)},enumerable:!0,configurable:!0}),e.prototype.createQueryBuilder=function(e){var t=this.getCustomRepositoryTarget(this.constructor);if(!t)throw new B(this.constructor);return this.manager.getRepository(t).createQueryBuilder(e)},e.prototype.createQueryBuilderFor=function(e,t){return this.getRepositoryFor(e).createQueryBuilder(t)},e.prototype.getRepositoryFor=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepositoryFor=function(e){return this.manager.getTreeRepository(e)},e.prototype.getCustomRepositoryTarget=function(e){var t=Lt().entityRepositories.find((function(t){return t.target===(e instanceof Function?e:e.constructor)}));if(!t)throw new U(e);return t.entity},e}(),F=function(e){function t(n){var r=e.call(this)||this;return r.name="CustomRepositoryCannotInheritRepositoryError",Object.setPrototypeOf(r,t.prototype),r.message="Custom entity repository "+(n instanceof Function?n.name:n.constructor.name)+"  cannot inherit Repository class without entity being set in the @EntityRepository decorator.",r}return r.c(t,e),t}(Error),V=function(e){function t(n,r){var i,a=e.call(this)||this;return a.name="RepositoryNotFoundError",Object.setPrototypeOf(a,t.prototype),i=r instanceof pt.a?r.options.name:"function"===typeof r?r.name:r,a.message='No repository for "'+i+'" was found. Looks like this entity is not registered in current "'+n+'" connection?',a}return r.c(t,e),t}(Error),Q=function(e){function t(n){var r,i=e.call(this)||this;return i.name="RepositoryNotTreeError",Object.setPrototypeOf(i,t.prototype),r=n instanceof pt.a?n.options.name:"function"===typeof n?n.name:n,i.message='Repository of the "'+r+'" class is not a TreeRepository. Try to apply @Tree decorator on your entity.',i}return r.c(t,e),t}(Error),K=function(){function e(){}return e.prototype.create=function(e,t,n){if(t.treeType){var r=new x;return Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r}r=void 0;return r=e.connection.driver instanceof m.a?new m.d:new O,Object.assign(r,{manager:e,metadata:t,queryRunner:n}),r},e}(),H=function(e){function t(n){var r=e.call(this)||this;return r.name="TreeRepositoryNotSupportedError",Object.setPrototypeOf(r,t.prototype),r.message="Tree repositories are not supported in "+n.options.type+" driver.",r}return r.c(t,e),t}(Error),z=function(e){function t(n,r){var i=e.call(this)||this;return i.name="MustBeEntityError",Object.setPrototypeOf(i,t.prototype),i.message="Cannot "+n+', given value must be an entity, instead "'+r+'" is given.',i}return r.c(t,e),t}(Error),W=n(24),Y=function(){function e(e){this.subjects=r.f(e),this.metadatas=this.getUniqueMetadatas(this.subjects)}return e.prototype.sort=function(e){var t=this;if(!this.metadatas.length)return this.subjects;var n=[];if("delete"===e){var i=this.subjects.filter((function(e){return!e.entity&&!e.databaseEntity}));n.push.apply(n,r.f(i)),this.removeAlreadySorted(i)}var a=this.getNonNullableDependencies(),o=this.toposort(a);"insert"===e&&(o=o.reverse()),o.forEach((function(e){var i=t.subjects.filter((function(t){return t.metadata.targetName===e}));n.push.apply(n,r.f(i)),t.removeAlreadySorted(i)}));var s=this.getDependencies(),u=this.toposort(s);return"insert"===e&&(u=u.reverse()),u.forEach((function(e){var i=t.subjects.filter((function(t){return t.metadata.targetName===e}));n.push.apply(n,r.f(i)),t.removeAlreadySorted(i)})),n.push.apply(n,r.f(this.subjects)),n},e.prototype.removeAlreadySorted=function(e){var t=this;e.forEach((function(e){t.subjects.splice(t.subjects.indexOf(e),1)}))},e.prototype.getUniqueMetadatas=function(e){var t=[];return e.forEach((function(e){-1===t.indexOf(e.metadata)&&t.push(e.metadata)})),t},e.prototype.getNonNullableDependencies=function(){return this.metadatas.reduce((function(e,t){return t.relationsWithJoinColumns.forEach((function(n){n.isNullable||e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e}),[])},e.prototype.getDependencies=function(){return this.metadatas.reduce((function(e,t){return t.relationsWithJoinColumns.forEach((function(n){n.inverseEntityMetadata!==t&&e.push([t.targetName,n.inverseEntityMetadata.targetName])})),e}),[])},e.prototype.toposort=function(e){for(var t=function(e){for(var t=[],n=0,r=e.length;n<r;n++){var i=e[n];t.indexOf(i[0])<0&&t.push(i[0]),t.indexOf(i[1])<0&&t.push(i[1])}return t}(e),n=t.length,r=new Array(n),i={},a=n;a--;)i[a]||o(t[a],a,[]);function o(a,s,u){if(u.indexOf(a)>=0)throw new Error("Cyclic dependency: "+JSON.stringify(a));if(!~t.indexOf(a))throw new Error("Found unknown node. Make sure to provided all involved nodes. Unknown node: "+JSON.stringify(a));if(!i[s]){i[s]=!0;var c=e.filter((function(e){return e[0]===a}));if(s=c.length){var l=u.concat(a);do{var h=c[--s][1];o(h,t.indexOf(h),l)}while(s)}r[--n]=a}}return r},e}(),G=n(5),J=n(6),X=n(21),$=function(){function e(){}return e.prototype.compute=function(e){var t=this;e.forEach((function(n){t.computeDiffColumns(n),t.computeDiffRelationalColumns(e,n)}))},e.prototype.computeDiffColumns=function(e){e.entity&&e.metadata.columns.forEach((function(t){if(!t.isVirtual&&!t.isDiscriminator){var n=e.changeMaps.find((function(e){return e.column===t}));n&&e.changeMaps.splice(e.changeMaps.indexOf(n),1);var r=t.getEntityValue(e.entity);if(void 0!==r){if(e.databaseEntity){var i=t.getEntityValue(e.databaseEntity,!0);if(t.relationMetadata){var a=t.relationMetadata.getEntityValue(e.entity);if(null!==a&&void 0!==a)return}var o=r;if(null!==r){switch(t.type){case"date":o=G.a.mixedDateToDateString(r);break;case"time":case"time with time zone":case"time without time zone":case"timetz":o=G.a.mixedDateToTimeString(r);break;case"datetime":case"datetime2":case Date:case"timestamp":case"timestamp without time zone":case"timestamp with time zone":case"timestamp with local time zone":case"timestamptz":o=G.a.mixedDateToUtcDatetimeString(r),i=G.a.mixedDateToUtcDatetimeString(i);break;case"json":case"jsonb":if(J.a.deepCompare(r,i))return;break;case"simple-array":o=G.a.simpleArrayToString(r),i=G.a.simpleArrayToString(i);break;case"simple-enum":o=G.a.simpleEnumToString(r),i=G.a.simpleEnumToString(i);break;case"simple-json":o=G.a.simpleJsonToString(r),i=G.a.simpleJsonToString(i)}t.transformer&&(o=X.a.transformTo(t.transformer,r))}if(o===i)return}e.diffColumns.push(t),e.changeMaps.push({column:t,value:r})}}}))},e.prototype.computeDiffRelationalColumns=function(e,t){t.entity&&t.metadata.relationsWithJoinColumns.forEach((function(n){var r=n.getEntityValue(t.entity);if(void 0!==r){if(t.databaseEntity){var i=r;null!==i&&i instanceof Object&&(i=n.getRelationIdMap(i));var a=n.getEntityValue(t.databaseEntity);if(J.a.compareIds(i,a))return;t.diffRelations.push(n)}var o=e.find((function(e){return e.mustBeInserted&&e.entity===r}));o&&(r=o);var s=t.changeMaps.find((function(e){return e.relation===n}));s?s.value=r:t.changeMaps.push({relation:n,value:r})}}))},e}(),Z=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectWithoutIdentifierError",Object.setPrototypeOf(r,t.prototype),r.message="Internal error. Subject "+n.metadata.targetName+" must have an identifier to perform operation. Please report a github issue if you face this error.",r}return r.c(t,e),t}(Error),ee=function(e){function t(n){var r=e.call(this)||this;return r.name="SubjectRemovedAndUpdatedError",Object.setPrototypeOf(r,t.prototype),r.message='Removed entity "'+n.metadata.name+'" is also scheduled for update operation. Make sure you are not updating and removing same object (note that update or remove may be executed by cascade operations).',r}return r.c(t,e),t}(Error),te=n(32),ne=n(12),re=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c=this;return r.d(this,(function(r){switch(r.label){case 0:return t=function(e){return c.queryRunner.connection.driver.escape(e)},n=this.getTableName(e.metadata.tablePath),i=t(e.metadata.nestedSetLeftColumn.databaseName),a=t(e.metadata.nestedSetRightColumn.databaseName),!(o=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(o=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),s=e.metadata.getEntityIdMap(o),u=void 0,s?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.nestedSetRightColumn.propertyPath,"right").from(e.metadata.target,e.metadata.targetName).whereInIds(s).getRawOne().then((function(e){var t=e?e.right:void 0;return"string"===typeof t?parseInt(t):t}))]:[3,2];case 1:u=r.sent(),r.label=2;case 2:return void 0===u?[3,4]:[4,this.queryRunner.query("UPDATE "+n+" SET "+i+" = CASE WHEN "+i+" > "+u+" THEN "+i+" + 2 ELSE "+i+" END,"+a+" = "+a+" + 2 WHERE "+a+" >= "+u)];case 3:return r.sent(),J.a.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(u),e.metadata.nestedSetRightColumn.createValueMap(u+1)),[3,5];case 4:J.a.mergeDeep(e.insertedValueSet,e.metadata.nestedSetLeftColumn.createValueMap(1),e.metadata.nestedSetRightColumn.createValueMap(2)),r.label=5;case 5:return[2]}}))}))},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)})).join(".")},e}(),ie=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotAttachTreeChildrenEntityError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot attach entity "'+n+'" to its parent. Please make sure parent is saved in the database before saving children nodes.',r}return r.c(t,e),t}(Error),ae=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p=this;return r.d(this,(function(f){switch(f.label){case 0:return t={},e.metadata.closureJunctionTable.ancestorColumns.forEach((function(n){t[n.databaseName]=e.identifier})),e.metadata.closureJunctionTable.descendantColumns.forEach((function(n){t[n.databaseName]=e.identifier})),[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.closureJunctionTable.tablePath).values(t).updateEntity(!1).callListeners(!1).execute()];case 1:return f.sent(),!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),n?(i=function(e){return p.queryRunner.connection.driver.escape(e)},a=this.getTableName(e.metadata.closureJunctionTable.tablePath),o=e.metadata.closureJunctionTable.ancestorColumns.map((function(e){return i(e.databaseName)})),s=e.metadata.closureJunctionTable.descendantColumns.map((function(e){return i(e.databaseName)})),u=[],c=e.metadata.primaryColumns.map((function(t){return t.getEntityValue(e.insertedValueSet)})),l=e.metadata.primaryColumns.map((function(e,t){return u.push(c[t]),p.queryRunner.connection.driver.createParameter("child_entity_"+e.databaseName,u.length-1)})),h=e.metadata.primaryColumns.map((function(t){var r=i(t.databaseName+"_descendant"),a=t.getEntityValue(n);if(!a)throw new ie(e.metadata.name);return u.push(a),r+" = "+p.queryRunner.connection.driver.createParameter("parent_entity_"+t.databaseName,u.length-1)})).join(", "),[4,this.queryRunner.query("INSERT INTO "+a+" ("+r.f(o,s).join(", ")+") SELECT "+o.join(", ")+", "+l.join(", ")+" FROM "+a+" WHERE "+h,u)]):[3,3];case 2:f.sent(),f.label=3;case 3:return[2]}}))}))},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.queryRunner.connection.driver.escape(e)})).join(".")},e}(),oe=function(){function e(e){this.queryRunner=e}return e.prototype.insert=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return!(n=e.metadata.treeParentRelation.getEntityValue(e.entity))&&e.parentSubject&&e.parentSubject.entity&&(n=e.parentSubject.insertedValueSet?e.parentSubject.insertedValueSet:e.parentSubject.entity),i=e.metadata.getEntityIdMap(n),a="",i?[4,this.queryRunner.manager.createQueryBuilder().select(e.metadata.targetName+"."+e.metadata.materializedPathColumn.propertyPath,"path").from(e.metadata.target,e.metadata.targetName).whereInIds(i).getRawOne().then((function(e){return e?e.path:void 0}))]:[3,2];case 1:a=r.sent(),r.label=2;case 2:return o=e.metadata.treeParentRelation.joinColumns.map((function(t){return t.referencedColumn.getEntityValue(e.insertedValueSet)})).join("_"),[4,this.queryRunner.manager.createQueryBuilder().update(e.metadata.target).set((t={},t[e.metadata.materializedPathColumn.propertyPath]=a+o+".",t)).where(e.identifier).execute()];case 3:return r.sent(),[2]}}))}))},e}(),se=function(){function e(e,t,n){this.hasExecutableOperations=!1,this.insertSubjects=[],this.updateSubjects=[],this.removeSubjects=[],this.softRemoveSubjects=[],this.recoverSubjects=[],this.queryRunner=e,this.allSubjects=t,this.options=n,this.validate(),this.recompute()}return e.prototype.execute=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:return e=void 0,this.options&&!1===this.options.listeners?[3,2]:(e=this.broadcastBeforeEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,2];case 1:t.sent(),t.label=2;case 2:return e&&e.count>0&&(this.insertSubjects.forEach((function(e){return e.recompute()})),this.updateSubjects.forEach((function(e){return e.recompute()})),this.removeSubjects.forEach((function(e){return e.recompute()})),this.softRemoveSubjects.forEach((function(e){return e.recompute()})),this.recoverSubjects.forEach((function(e){return e.recompute()})),this.recompute()),this.insertSubjects=new Y(this.insertSubjects).sort("insert"),[4,this.executeInsertOperations()];case 3:return t.sent(),this.updateSubjects=this.allSubjects.filter((function(e){return e.mustBeUpdated})),[4,this.executeUpdateOperations()];case 4:return t.sent(),this.removeSubjects=new Y(this.removeSubjects).sort("delete"),[4,this.executeRemoveOperations()];case 5:return t.sent(),this.softRemoveSubjects=this.allSubjects.filter((function(e){return e.mustBeSoftRemoved})),[4,this.executeSoftRemoveOperations()];case 6:return t.sent(),this.recoverSubjects=this.allSubjects.filter((function(e){return e.mustBeRecovered})),[4,this.executeRecoverOperations()];case 7:return t.sent(),[4,this.updateSpecialColumnsInPersistedEntities()];case 8:return t.sent(),this.options&&!1===this.options.listeners?[3,10]:(e=this.broadcastAfterEventsForAll()).promises.length>0?[4,Promise.all(e.promises)]:[3,10];case 9:t.sent(),t.label=10;case 10:return[2]}}))}))},e.prototype.validate=function(){this.allSubjects.forEach((function(e){if(e.mustBeUpdated&&e.mustBeRemoved)throw new ee(e)}))},e.prototype.recompute=function(){(new $).compute(this.allSubjects),this.insertSubjects=this.allSubjects.filter((function(e){return e.mustBeInserted})),this.updateSubjects=this.allSubjects.filter((function(e){return e.mustBeUpdated})),this.removeSubjects=this.allSubjects.filter((function(e){return e.mustBeRemoved})),this.softRemoveSubjects=this.allSubjects.filter((function(e){return e.mustBeSoftRemoved})),this.recoverSubjects=this.allSubjects.filter((function(e){return e.mustBeRecovered})),this.hasExecutableOperations=this.insertSubjects.length>0||this.updateSubjects.length>0||this.removeSubjects.length>0||this.softRemoveSubjects.length>0||this.recoverSubjects.length>0},e.prototype.broadcastBeforeEventsForAll=function(){var e=this,t=new te.a;return this.insertSubjects.length&&this.insertSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeInsertEvent(t,n.metadata,n.entity)})),this.updateSubjects.length&&this.updateSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.removeSubjects.length&&this.removeSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)})),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.recoverSubjects.length&&this.recoverSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastBeforeUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),t},e.prototype.broadcastAfterEventsForAll=function(){var e=this,t=new te.a;return this.insertSubjects.length&&this.insertSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterInsertEvent(t,n.metadata,n.entity)})),this.updateSubjects.length&&this.updateSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.removeSubjects.length&&this.removeSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterRemoveEvent(t,n.metadata,n.entity,n.databaseEntity)})),this.softRemoveSubjects.length&&this.softRemoveSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),this.recoverSubjects.length&&this.recoverSubjects.forEach((function(n){return e.queryRunner.broadcaster.broadcastAfterUpdateEvent(t,n.metadata,n.entity,n.databaseEntity,n.diffColumns,n.diffRelations)})),t},e.prototype.executeInsertOperations=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(a){switch(a.label){case 0:return e=r.e(this.groupBulkSubjects(this.insertSubjects,"insert"),2),t=e[0],n=e[1],[4,p.a.runInSequence(n,(function(e){return r.b(i,void 0,void 0,(function(){var n,i,a,o,s,u,c=this;return r.d(this,(function(l){switch(l.label){case 0:return n=t[e],i=[],a=[],o=[],this.queryRunner.connection.driver instanceof m.a?n.forEach((function(e){e.metadata.createDateColumn&&e.entity&&(e.entity[e.metadata.createDateColumn.databaseName]=new Date),e.metadata.updateDateColumn&&e.entity&&(e.entity[e.metadata.updateDateColumn.databaseName]=new Date),e.createValueSetAndPopChangeMap(),a.push(e),i.push(e.entity)})):this.queryRunner.connection.driver instanceof ne.a?n.forEach((function(e){o.push(e)})):n.forEach((function(e){0===e.changeMaps.length||e.metadata.treeType||c.queryRunner.connection.driver instanceof ne.a||c.queryRunner.connection.driver instanceof W.a?o.push(e):(a.push(e),i.push(e.createValueSetAndPopChangeMap()))})),this.queryRunner instanceof m.c?[4,this.queryRunner.manager.insert(n[0].metadata.target,i)]:[3,2];case 1:return s=l.sent(),n.forEach((function(e,t){e.identifier=s.identifiers[t],e.generatedMap=s.generatedMaps[t],e.insertedValueSet=i[t]})),[3,6];case 2:return i.length>0?[4,this.queryRunner.manager.createQueryBuilder().insert().into(n[0].metadata.target).values(i).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute()]:[3,4];case 3:u=l.sent(),a.forEach((function(e,t){e.identifier=u.identifiers[t],e.generatedMap=u.generatedMaps[t],e.insertedValueSet=i[t]})),l.label=4;case 4:return o.length>0?[4,p.a.runInSequence(o,(function(e){return r.b(c,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return e.insertedValueSet=e.createValueSetAndPopChangeMap(),"nested-set"!==e.metadata.treeType?[3,2]:[4,new re(this.queryRunner).insert(e)];case 1:t.sent(),t.label=2;case 2:return[4,this.queryRunner.manager.createQueryBuilder().insert().into(e.metadata.target).values(e.insertedValueSet).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1).execute().then((function(t){e.identifier=t.identifiers[0],e.generatedMap=t.generatedMaps[0]}))];case 3:return t.sent(),"closure-table"!==e.metadata.treeType?[3,5]:[4,new ae(this.queryRunner).insert(e)];case 4:return t.sent(),[3,7];case 5:return"materialized-path"!==e.metadata.treeType?[3,7]:[4,new oe(this.queryRunner).insert(e)];case 6:t.sent(),t.label=7;case 7:return[2]}}))}))}))]:[3,6];case 5:l.sent(),l.label=6;case 6:return n.forEach((function(e){e.generatedMap&&e.metadata.columns.forEach((function(t){var n=t.getEntityValue(e.generatedMap);if(void 0!==n&&null!==n){var r=c.queryRunner.connection.driver.prepareHydratedValue(n,t);t.setEntityValue(e.generatedMap,r)}}))})),[2]}}))}))}))];case 1:return a.sent(),[2]}}))}))},e.prototype.executeUpdateOperations=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.updateSubjects.map((function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a,o=this;return r.d(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new Z(t);return this.queryRunner instanceof m.c?(e=J.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=t.createValueSetAndPopChangeMap(),i=this.queryRunner.manager.createQueryBuilder().update(t.metadata.target).set(n).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?i.whereEntity(t.identifier):i.where(t.identifier),[4,i.execute()];case 3:a=r.sent(),t.generatedMap=a.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(void 0!==n&&null!==n){var r=o.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),r.label=4;case 4:return[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.executeRemoveOperations=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(a){switch(a.label){case 0:return e=r.e(this.groupBulkSubjects(this.removeSubjects,"delete"),2),t=e[0],n=e[1],[4,p.a.runInSequence(n,(function(e){return r.b(i,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=t[e],i=n.map((function(e){if(!e.identifier)throw new Z(e);return e.identifier})),this.queryRunner instanceof m.c?[4,this.queryRunner.manager.delete(n[0].metadata.target,i)]:[3,2];case 1:return r.sent(),[3,4];case 2:return[4,this.queryRunner.manager.createQueryBuilder().delete().from(n[0].metadata.target).where(i).callListeners(!1).execute()];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))}))];case 1:return a.sent(),[2]}}))}))},e.prototype.executeSoftRemoveOperations=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.softRemoveSubjects.map((function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a=this;return r.d(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new Z(t);return this.queryRunner instanceof m.c?(e=J.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=new Date),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().softDelete().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:i=r.sent(),t.generatedMap=i.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(void 0!==n&&null!==n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),r.label=4;case 4:return[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.executeRecoverOperations=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.recoverSubjects.map((function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a=this;return r.d(this,(function(r){switch(r.label){case 0:if(!t.identifier)throw new Z(t);return this.queryRunner instanceof m.c?(e=J.a.mergeDeep({},t.entity),t.metadata.objectIdColumn&&t.metadata.objectIdColumn.propertyName&&delete e[t.metadata.objectIdColumn.propertyName],t.metadata.createDateColumn&&t.metadata.createDateColumn.propertyName&&delete e[t.metadata.createDateColumn.propertyName],t.metadata.updateDateColumn&&t.metadata.updateDateColumn.propertyName&&(e[t.metadata.updateDateColumn.propertyName]=new Date),t.metadata.deleteDateColumn&&t.metadata.deleteDateColumn.propertyName&&(e[t.metadata.deleteDateColumn.propertyName]=null),[4,this.queryRunner.manager.update(t.metadata.target,t.identifier,e)]):[3,2];case 1:return r.sent(),[3,4];case 2:return n=this.queryRunner.manager.createQueryBuilder().restore().from(t.metadata.target).updateEntity(!this.options||!1!==this.options.reload).callListeners(!1),t.entity?n.whereEntity(t.identifier):n.where(t.identifier),[4,n.execute()];case 3:i=r.sent(),t.generatedMap=i.generatedMaps[0],t.generatedMap&&t.metadata.columns.forEach((function(e){var n=e.getEntityValue(t.generatedMap);if(void 0!==n&&null!==n){var r=a.queryRunner.connection.driver.prepareHydratedValue(n,e);e.setEntityValue(t.generatedMap,r)}})),r.label=4;case 4:return[2]}}))}))})))];case 1:return t.sent(),[2]}}))}))},e.prototype.updateSpecialColumnsInPersistedEntities=function(){var e=this;this.insertSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.insertSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.updateSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.softRemoveSubjects),this.updateSubjects.length&&this.updateSpecialColumnsInInsertedAndUpdatedEntities(this.recoverSubjects),this.removeSubjects.length&&this.removeSubjects.forEach((function(e){e.entity&&e.metadata.primaryColumns.forEach((function(t){t.setEntityValue(e.entity,void 0)}))})),this.allSubjects.forEach((function(t){t.entity&&(t.metadata.relationIds.forEach((function(e){e.setValue(t.entity)})),e.queryRunner instanceof m.c&&t.metadata.objectIdColumn&&t.metadata.objectIdColumn.databaseName&&t.metadata.objectIdColumn.databaseName!==t.metadata.objectIdColumn.propertyName&&delete t.entity[t.metadata.objectIdColumn.databaseName])}))},e.prototype.updateSpecialColumnsInInsertedAndUpdatedEntities=function(e){var t=this;e.forEach((function(e){e.entity&&(e.metadata.columns.forEach((function(t){if(!(e.metadata.childEntityMetadatas.length>0&&-1!==e.metadata.childEntityMetadatas.map((function(e){return e.target})).indexOf(t.target))&&!t.isVirtual){if(t.isNullable)void 0===t.getEntityValue(e.entity)&&t.setEntityValue(e.entity,null);e.updatedRelationMaps.length>0&&e.updatedRelationMaps.forEach((function(t){t.relation.joinColumns.forEach((function(n){!0!==n.isVirtual&&n.setEntityValue(e.entity,t.value instanceof Object?n.referencedColumn.getEntityValue(t.value):t.value)}))}))}})),e.generatedMap&&t.queryRunner.manager.merge(e.metadata.target,e.entity,e.generatedMap))}))},e.prototype.groupBulkSubjects=function(e,t){var n={},r=[],i="delete"===t||this.queryRunner.connection.driver.isReturningSqlSupported();return e.forEach((function(e,t){var a=i||e.metadata.isJunction?e.metadata.name:e.metadata.name+"_"+t;n[a]?n[a].push(e):(n[a]=[e],r.push(a))})),[n,r]},e}(),ue=function(e){function t(n){var r=e.call(this)||this;return r.name="CannotDetermineEntityError",Object.setPrototypeOf(r,t.prototype),r.message="Cannot "+n+", given value must be instance of entity class, instead object literal is given. Or you must specify an entity target to method call.",r}return r.c(t,e),t}(Error),ce=function(){function e(e){var t;this.identifier=void 0,this.entityWithFulfilledIds=void 0,this.databaseEntityLoaded=!1,this.changeMaps=[],this.canBeInserted=!1,this.canBeUpdated=!1,this.mustBeRemoved=!1,this.canBeSoftRemoved=!1,this.canBeRecovered=!1,this.updatedRelationMaps=[],this.diffColumns=[],this.diffRelations=[],this.metadata=e.metadata,this.entity=e.entity,this.parentSubject=e.parentSubject,void 0!==e.canBeInserted&&(this.canBeInserted=e.canBeInserted),void 0!==e.canBeUpdated&&(this.canBeUpdated=e.canBeUpdated),void 0!==e.mustBeRemoved&&(this.mustBeRemoved=e.mustBeRemoved),void 0!==e.canBeSoftRemoved&&(this.canBeSoftRemoved=e.canBeSoftRemoved),void 0!==e.canBeRecovered&&(this.canBeRecovered=e.canBeRecovered),void 0!==e.identifier&&(this.identifier=e.identifier),void 0!==e.changeMaps&&(t=this.changeMaps).push.apply(t,r.f(e.changeMaps)),this.recompute()}return Object.defineProperty(e.prototype,"mustBeInserted",{get:function(){return this.canBeInserted&&!this.databaseEntity},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeUpdated",{get:function(){return this.canBeUpdated&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)&&this.changeMaps.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeSoftRemoved",{get:function(){return this.canBeSoftRemoved&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mustBeRecovered",{get:function(){return this.canBeRecovered&&this.identifier&&(!1===this.databaseEntityLoaded||this.databaseEntityLoaded&&this.databaseEntity)},enumerable:!0,configurable:!0}),e.prototype.createValueSetAndPopChangeMap=function(){var t=this,n=[],r=this.changeMaps.reduce((function(r,i){var a,o=i.value;if(o instanceof e&&(o=o.insertedValueSet?o.insertedValueSet:o.entity),t.metadata.isJunction&&i.column)a=i.column.createValueMap(i.column.referencedColumn.getEntityValue(o));else if(i.column)a=i.column.createValueMap(o);else if(i.relation)if(o instanceof Object){var s=i.relation.getRelationIdMap(o);if(void 0===s)return n.push(i),t.canBeUpdated=!0,r;a=i.relation.createValueMap(s),t.updatedRelationMaps.push({relation:i.relation,value:s})}else a=i.relation.createValueMap(o),t.updatedRelationMaps.push({relation:i.relation,value:o});return J.a.mergeDeep(r,a),r}),{});return this.changeMaps=n,r},e.prototype.recompute=function(){var e=this;this.entity?(this.entityWithFulfilledIds=Object.assign({},this.entity),this.parentSubject&&this.metadata.primaryColumns.forEach((function(t){t.relationMetadata&&t.relationMetadata.inverseEntityMetadata===e.parentSubject.metadata&&t.setEntityValue(e.entityWithFulfilledIds,e.parentSubject.entity)})),this.identifier=this.metadata.getEntityIdMap(this.entityWithFulfilledIds)):this.databaseEntity&&(this.identifier=this.metadata.getEntityIdMap(this.databaseEntity))},e}(),le=n(33),he=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.metadata.oneToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),void 0!==i){var a=[];i.forEach((function(i){var o=t.inverseEntityMetadata.getEntityIdMap(i),s=n.subjects.find((function(e){return e.entity===i}));if(s&&(o=s.identifier),o){r.find((function(e){return J.a.compareIds(o,e)}))||(s||(s=new ce({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:o}),n.subjects.push(s)),s.changeMaps.push({relation:t.inverseRelation,value:e})),a.push(o)}else{if(!s)return;s.changeMaps.push({relation:t.inverseRelation,value:e})}})),le.a.difference(r,a).forEach((function(r){var i=new ce({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:r,changeMaps:[{relation:t.inverseRelation,value:null}]});n.subjects.push(i)}))}},e}(),pe=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.metadata.oneToOneRelations.forEach((function(n){n.isOwning||!1===n.persistenceEnabled||e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=void 0;e.databaseEntity&&(n=t.getEntityValue(e.databaseEntity));var r=t.getEntityValue(e.entity);if(void 0!==r)if(null!==r){var i=t.inverseEntityMetadata.getEntityIdMap(r),a=this.subjects.find((function(e){return!!e.entity&&e.entity===r}));if(a&&(i=a.identifier),!i){if(!a)return;a.changeMaps.push({relation:t.inverseRelation,value:e})}n&&J.a.compareIds(i,n)||(a||(a=new ce({metadata:t.inverseEntityMetadata,canBeUpdated:!0,identifier:i}),this.subjects.push(a)),a.changeMaps.push({relation:t.inverseRelation,value:e}))}else if(n){var o=new ce({metadata:t.inverseEntityMetadata,parentSubject:e,canBeUpdated:!0,identifier:n,changeMaps:[{relation:t.inverseRelation,value:null}]});this.subjects.push(o)}},e}(),fe=function(){function e(e){this.subjects=e}return e.prototype.build=function(){var e=this;this.subjects.forEach((function(t){t.entity&&t.metadata.manyToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&e.buildForSubjectRelation(t,n)}))}))},e.prototype.buildForAllRemoval=function(e){var t=this;e.databaseEntity&&e.metadata.manyToManyRelations.forEach((function(n){!1!==n.persistenceEnabled&&n.getEntityValue(e.databaseEntity).forEach((function(r){var i=new ce({metadata:n.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:t.buildJunctionIdentifier(e,n,r)});t.subjects.push(i)}))}))},e.prototype.buildForSubjectRelation=function(e,t){var n=this,r=[];e.databaseEntity&&(r=t.getEntityValue(e.databaseEntity));var i=t.getEntityValue(e.entity);if(null===i&&(i=[]),Array.isArray(i)){i.forEach((function(i){var a=t.inverseEntityMetadata.getEntityIdMap(i),o=n.subjects.find((function(e){return e.entity===i}));if((o&&(a=o.identifier),a||o)&&!r.find((function(e){return J.a.compareIds(e,a)}))){var s=t.isOwning?e:o||i,u=t.isOwning?o||i:e,c=new ce({metadata:t.junctionEntityMetadata,parentSubject:e,canBeInserted:!0});n.subjects.push(c),t.junctionEntityMetadata.ownerColumns.forEach((function(e){c.changeMaps.push({column:e,value:s})})),t.junctionEntityMetadata.inverseColumns.forEach((function(e){c.changeMaps.push({column:e,value:u})}))}}));var a=[];i.forEach((function(e){var r=t.inverseEntityMetadata.getEntityIdMap(e),i=n.subjects.find((function(t){return t.entity===e}));i&&(r=i.identifier),void 0!==r&&null!==r&&a.push(r)})),r.filter((function(e){return!a.find((function(t){return J.a.compareIds(t,e)}))})).forEach((function(r){var i=new ce({metadata:t.junctionEntityMetadata,parentSubject:e,mustBeRemoved:!0,identifier:n.buildJunctionIdentifier(e,t,r)});n.subjects.push(i)}))}},e.prototype.buildJunctionIdentifier=function(e,t,n){var r=t.isOwning?e.entity:n,i=t.isOwning?n:e.entity,a={};return t.junctionEntityMetadata.ownerColumns.forEach((function(e){J.a.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(r)))})),t.junctionEntityMetadata.inverseColumns.forEach((function(e){J.a.mergeDeep(a,e.createValueMap(e.referencedColumn.getEntityValue(i)))})),a},e}(),de=function(){function e(e,t){this.queryRunner=e,this.subjects=t}return e.prototype.load=function(e){return r.b(this,void 0,void 0,(function(){var t,n=this;return r.d(this,(function(i){switch(i.label){case 0:return t=this.groupByEntityTargets().map((function(t){return r.b(n,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h=this;return r.d(this,(function(p){switch(p.label){case 0:return a=[],o=[],t.subjects.forEach((function(e){!e.databaseEntity&&e.identifier&&(a.push(e.identifier),o.push(e))})),a.length?(s=[],"save"===e||"soft-remove"===e||"recover"===e?t.subjects.forEach((function(e){e.metadata.relations.forEach((function(t){void 0!==t.getEntityValue(e.entityWithFulfilledIds)&&-1===s.indexOf(t.propertyPath)&&s.push(t.propertyPath)}))})):s.push.apply(s,r.f(t.subjects[0].metadata.manyToManyRelations.map((function(e){return e.propertyPath})))),u={loadEagerRelations:!1,loadRelationIds:{relations:s,disableMixedMap:!0},withDeleted:!0},[4,this.queryRunner.manager.getRepository(t.target).findByIds(a,u)]):[2];case 1:p.sent().forEach((function(e){h.findByPersistEntityLike(t.target,e).forEach((function(t){t.databaseEntity=e,t.identifier||(t.identifier=t.metadata.hasAllPrimaryKeys(e)?t.metadata.getEntityIdMap(e):void 0)}))}));try{for(c=r.g(o),l=c.next();!l.done;l=c.next())l.value.databaseEntityLoaded=!0}catch(f){n={error:f}}finally{try{l&&!l.done&&(i=c.return)&&i.call(c)}finally{if(n)throw n.error}}return[2]}}))}))})),[4,Promise.all(t)];case 1:return i.sent(),[2]}}))}))},e.prototype.findByPersistEntityLike=function(e,t){return this.subjects.filter((function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))}))},e.prototype.groupByEntityTargets=function(){return this.subjects.reduce((function(e,t){var n=e.find((function(e){return e.target===t.metadata.target}));return n||(n={target:t.metadata.target,subjects:[]},e.push(n)),n.subjects.push(t),e}),[])},e}(),me=function(){function e(e){this.allSubjects=e}return e.prototype.build=function(e,t){var n=this;e.metadata.extractRelationValuesFromEntity(e.entity,e.metadata.relations).forEach((function(i){var a=r.e(i,3),o=a[0],s=a[1],u=a[2];if(void 0!==s&&null!==s&&(o.isCascadeInsert||o.isCascadeUpdate||o.isCascadeSoftRemove||o.isCascadeRecover)&&s instanceof Object){var c=n.findByPersistEntityLike(u.target,s);if(c)return!1===c.canBeInserted&&(c.canBeInserted=!0===o.isCascadeInsert&&"save"===t),!1===c.canBeUpdated&&(c.canBeUpdated=!0===o.isCascadeUpdate&&"save"===t),!1===c.canBeSoftRemoved&&(c.canBeSoftRemoved=!0===o.isCascadeSoftRemove&&"soft-remove"===t),void(!1===c.canBeRecovered&&(c.canBeRecovered=!0===o.isCascadeRecover&&"recover"===t));var l=new ce({metadata:u,parentSubject:e,entity:s,canBeInserted:!0===o.isCascadeInsert&&"save"===t,canBeUpdated:!0===o.isCascadeUpdate&&"save"===t,canBeSoftRemoved:!0===o.isCascadeSoftRemove&&"soft-remove"===t,canBeRecovered:!0===o.isCascadeRecover&&"recover"===t});n.allSubjects.push(l),n.build(l,t)}}))},e.prototype.findByPersistEntityLike=function(e,t){return this.allSubjects.find((function(n){return!!n.entity&&(n.entity===t||n.metadata.target===e&&n.metadata.compareEntities(n.entityWithFulfilledIds,t))}))},e}(),ye=function(){function e(e,t,n,r,i,a){this.connection=e,this.queryRunner=t,this.mode=n,this.target=r,this.entity=i,this.options=a}return e.prototype.execute=function(){var e=this;return this.entity&&this.entity instanceof Object?Promise.resolve().then((function(){return r.b(e,void 0,void 0,(function(){var e,t,n,i,a,o,s,u=this;return r.d(this,(function(c){switch(c.label){case 0:e=this.queryRunner||this.connection.createQueryRunner("master"),this.options&&this.options.data&&(e.data=this.options.data),c.label=1;case 1:return c.trys.push([1,,15,18]),t=Array.isArray(this.entity)?this.entity:[this.entity],n=this.options&&this.options.chunk&&this.options.chunk>0?J.a.chunk(t,this.options.chunk):[t],[4,Promise.all(n.map((function(t){return r.b(u,void 0,void 0,(function(){var n,i,a=this;return r.d(this,(function(r){switch(r.label){case 0:return n=[],t.forEach((function(e){var t=a.target?a.target:e.constructor;if(t===Object)throw new ue(a.mode);n.push(new ce({metadata:a.connection.getMetadata(t),entity:e,canBeInserted:"save"===a.mode,canBeUpdated:"save"===a.mode,mustBeRemoved:"remove"===a.mode,canBeSoftRemoved:"soft-remove"===a.mode,canBeRecovered:"recover"===a.mode}))})),i=new me(n),n.forEach((function(e){i.build(e,a.mode)})),[4,new de(e,n).load(this.mode)];case 1:return r.sent(),"save"===this.mode||"soft-remove"===this.mode||"recover"===this.mode?(new he(n).build(),new pe(n).build(),new fe(n).build()):n.forEach((function(e){e.mustBeRemoved&&new fe(n).buildForAllRemoval(e)})),[2,new se(e,n,this.options)]}}))}))})))];case 2:if(i=c.sent(),0===(a=i.filter((function(e){return e.hasExecutableOperations}))).length)return[2];o=!1,c.label=3;case 3:return c.trys.push([3,9,,14]),e.isTransactionActive?[3,5]:this.options&&!1===this.options.transaction?[3,5]:(o=!0,[4,e.startTransaction()]);case 4:c.sent(),c.label=5;case 5:return[4,p.a.runInSequence(a,(function(e){return e.execute()}))];case 6:return c.sent(),!0!==o?[3,8]:[4,e.commitTransaction()];case 7:c.sent(),c.label=8;case 8:return[3,14];case 9:if(s=c.sent(),!o)return[3,13];c.label=10;case 10:return c.trys.push([10,12,,13]),[4,e.rollbackTransaction()];case 11:return c.sent(),[3,13];case 12:return c.sent(),[3,13];case 13:throw s;case 14:return[3,18];case 15:return this.queryRunner?[3,17]:[4,e.release()];case 16:c.sent(),c.label=17;case 17:return[7];case 18:return[2]}}))}))})):Promise.reject(new z(this.mode,this.entity))},e}(),ve=n(52),ge=n(26),be=function(){function e(e,t){this.repositories=[],this.plainObjectToEntityTransformer=new L,this.connection=e,t&&(this.queryRunner=t,ge.a.assign(this.queryRunner,{manager:this}))}return e.prototype.transaction=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:if(n="string"===typeof e?e:void 0,!(i="function"===typeof e?e:t))throw new Error("Transaction method requires callback in second paramter if isolation level is supplied.");if(this.connection.driver instanceof m.a)throw new Error("Transactions aren't supported by MongoDB.");if(this.queryRunner&&this.queryRunner.isReleased)throw new S;if(this.queryRunner&&this.queryRunner.isTransactionActive)throw new Error("Cannot start transaction because its already started");a=this.queryRunner||this.connection.createQueryRunner("master"),r.label=1;case 1:return r.trys.push([1,8,13,16]),n?[4,a.startTransaction(n)]:[3,3];case 2:return r.sent(),[3,5];case 3:return[4,a.startTransaction()];case 4:r.sent(),r.label=5;case 5:return[4,i(a.manager)];case 6:return o=r.sent(),[4,a.commitTransaction()];case 7:return r.sent(),[2,o];case 8:s=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,a.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw s;case 13:return this.queryRunner?[3,15]:[4,a.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}}))}))},e.prototype.query=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(n){return[2,this.connection.query(e,t,this.queryRunner)]}))}))},e.prototype.createQueryBuilder=function(e,t,n){return t?this.connection.createQueryBuilder(e,t,n||this.queryRunner):this.connection.createQueryBuilder(e||n||this.queryRunner)},e.prototype.hasId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e,i=this.connection.getMetadata(n);return i.hasId(r)},e.prototype.getId=function(e,t){var n=2===arguments.length?e:e.constructor,r=2===arguments.length?t:e,i=this.connection.getMetadata(n);return i.getEntityIdMixedMap(r)},e.prototype.create=function(e,t){var n=this,r=this.connection.getMetadata(e);if(!t)return r.create(this.queryRunner);if(Array.isArray(t))return t.map((function(t){return n.create(e,t)}));var i=r.create(this.queryRunner);return this.plainObjectToEntityTransformer.transform(i,t,r,!0),i},e.prototype.merge=function(e,t){for(var n=this,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var a=this.connection.getMetadata(e);return r.forEach((function(e){return n.plainObjectToEntityTransformer.transform(t,e,a)})),t},e.prototype.preload=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=this.connection.getMetadata(e),[4,new j(this.connection.manager).transform(t,n)];case 1:return(i=r.sent())?[2,this.merge(e,i,t)]:[2,void 0]}}))}))},e.prototype.save=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof pt.a||"string"===typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof pt.a&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new ye(this.connection,this.queryRunner,"save",r,i,a).execute().then((function(){return i}))},e.prototype.remove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||"string"===typeof e)?e:void 0,i=r?t:e,a=r?n:t;return Array.isArray(i)&&0===i.length?Promise.resolve(i):new ye(this.connection,this.queryRunner,"remove",r,i,a).execute().then((function(){return i}))},e.prototype.softRemove=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof pt.a||"string"===typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof pt.a&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new ye(this.connection,this.queryRunner,"soft-remove",r,i,a).execute().then((function(){return i}))},e.prototype.recover=function(e,t,n){var r=arguments.length>1&&(e instanceof Function||e instanceof pt.a||"string"===typeof e)?e:void 0,i=r?t:e,a=r?n:t;return r instanceof pt.a&&(r=r.options.name),Array.isArray(i)&&0===i.length?Promise.resolve(i):new ye(this.connection,this.queryRunner,"recover",r,i,a).execute().then((function(){return i}))},e.prototype.insert=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return Array.isArray(t)&&0===t.length?[2,Promise.resolve(new ve.a)]:this.connection.driver instanceof ne.a&&Array.isArray(t)?[4,Promise.all(t.map((function(t){return n.insert(e,t)})))]:[3,2];case 1:return[2,r.sent().reduce((function(e,t){return Object.assign(e,t)}),{})];case 2:return[2,this.createQueryBuilder().insert().into(e).values(t).execute()]}}))}))},e.prototype.update=function(e,t,n){return void 0===t||null===t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the update method.")):"string"===typeof t||"number"===typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().update(e).set(n).whereInIds(t).execute():this.createQueryBuilder().update(e).set(n).where(t).execute()},e.prototype.delete=function(e,t){return void 0===t||null===t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"===typeof t||"number"===typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().delete().from(e).whereInIds(t).execute():this.createQueryBuilder().delete().from(e).where(t).execute()},e.prototype.softDelete=function(e,t){return void 0===t||null===t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"===typeof t||"number"===typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().softDelete().from(e).whereInIds(t).execute():this.createQueryBuilder().softDelete().from(e).where(t).execute()},e.prototype.restore=function(e,t){return void 0===t||null===t||""===t||Array.isArray(t)&&0===t.length?Promise.reject(new Error("Empty criteria(s) are not allowed for the delete method.")):"string"===typeof t||"number"===typeof t||t instanceof Date||Array.isArray(t)?this.createQueryBuilder().restore().from(e).whereInIds(t).execute():this.createQueryBuilder().restore().from(e).where(t).execute()},e.prototype.count=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(t)||n.name),[2,_.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getCount()]}))}))},e.prototype.find=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(t)||n.name),_.isFindManyOptions(t)&&!1===t.loadEagerRelations||_.joinEagerRelations(i,i.alias,n),[2,_.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getMany()]}))}))},e.prototype.findAndCount=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){return n=this.connection.getMetadata(e),i=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(t)||n.name),_.isFindManyOptions(t)&&!1===t.loadEagerRelations||_.joinEagerRelations(i,i.alias,n),[2,_.applyFindManyOptionsOrConditionsToQueryBuilder(i,t).getManyAndCount()]}))}))},e.prototype.findByIds=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a;return r.d(this,(function(r){return t.length?(i=this.connection.getMetadata(e),a=this.createQueryBuilder(e,_.extractFindManyOptionsAlias(n)||i.name),_.applyFindManyOptionsOrConditionsToQueryBuilder(a,n),_.isFindManyOptions(n)&&!1===n.loadEagerRelations||_.joinEagerRelations(a,a.alias,i),[2,a.andWhereInIds(t).getMany()]):[2,Promise.resolve([])]}))}))},e.prototype.findOne=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s,u,c;return r.d(this,(function(l){return i=void 0,_.isFindOneOptions(t)?i=t:n&&_.isFindOneOptions(n)&&(i=n),a=void 0,t instanceof Object&&!_.isFindOneOptions(t)&&(a=t),o=this.connection.getMetadata(e),s=o.name,i&&i.join?s=i.join.alias:n&&_.isFindOneOptions(n)&&n.join&&(s=n.join.alias),u=this.createQueryBuilder(e,s),i&&!1===i.loadEagerRelations||_.joinEagerRelations(u,u.alias,u.expressionMap.mainAlias.metadata),(c="string"===typeof t||"number"===typeof t||t instanceof Date)||(i=r.a({},i||{},{take:1})),_.applyOptionsToQueryBuilder(u,i),a?u.where(a):c&&u.andWhereInIds(o.ensureEntityIdMap(t)),[2,u.getOne()]}))}))},e.prototype.findOneOrFail=function(e,t,n){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(r){return[2,this.findOne(e,t,n).then((function(n){return void 0===n?Promise.reject(new R(e,t)):Promise.resolve(n)}))]}))}))},e.prototype.clear=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:t=this.connection.getMetadata(e),n=this.queryRunner||this.connection.createQueryRunner("master"),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,n.clearTable(t.tablePath)];case 2:return[2,r.sent()];case 3:return this.queryRunner?[3,5]:[4,n.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.increment=function(e,t,n,i){return r.b(this,void 0,void 0,(function(){var a,o,s,u=this;return r.d(this,(function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new Error("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new Error('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight((function(e,t){var n;return(n={})[t]=e,n}),(function(){return u.connection.driver.escape(o.databaseName)+" + "+i})),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]}))}))},e.prototype.decrement=function(e,t,n,i){return r.b(this,void 0,void 0,(function(){var a,o,s,u=this;return r.d(this,(function(r){if(a=this.connection.getMetadata(e),!(o=a.findColumnWithPropertyPath(n)))throw new Error("Column "+n+" was not found in "+a.targetName+" entity.");if(isNaN(Number(i)))throw new Error('Value "'+i+'" is not a number.');return s=n.split(".").reduceRight((function(e,t){var n;return(n={})[t]=e,n}),(function(){return u.connection.driver.escape(o.databaseName)+" - "+i})),[2,this.createQueryBuilder(e,"entity").update(e).set(s).where(t).execute()]}))}))},e.prototype.getRepository=function(e){if(!this.connection.hasMetadata(e))throw new V(this.connection.name,e);var t=this.connection.getMetadata(e),n=this.repositories.find((function(e){return e.metadata===t}));if(n)return n;var r=(new K).create(this,t,this.queryRunner);return this.repositories.push(r),r},e.prototype.getTreeRepository=function(e){if(!1===this.connection.driver.treeSupport)throw new H(this.connection.driver);var t=this.getRepository(e);if(!(t instanceof x))throw new Q(e);return t},e.prototype.getMongoRepository=function(e){return this.connection.getMongoRepository(e)},e.prototype.getCustomRepository=function(e){var t=Lt().entityRepositories.find((function(t){return t.target===(e instanceof Function?e:e.constructor)}));if(!t)throw new U(e);var n=t.entity?this.connection.getMetadata(t.entity):void 0,r=new t.target(this,n);if(r instanceof k&&(r.manager||(r.manager=this)),r instanceof O){if(!n)throw new F(e);r.manager=this,r.metadata=n}return r},e.prototype.release=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){if(!this.queryRunner)throw new M;return[2,this.queryRunner.release()]}))}))},e}(),Ee=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.driver=t.driver,r}return r.c(t,e),t.prototype.loadDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.driver.load(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.saveDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.driver.save(e)];case 1:return t.sent(),[2]}}))}))},t.prototype.exportDatabase=function(){return this.driver.export()},t}(be),Te=n(37),Ne=function(){function e(){}return e.prototype.create=function(e,t){return e.driver instanceof m.a?new m.b(e):e.driver instanceof Te.a?new Ee(e,t):new be(e,t)},e}(),we=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDriverError",Object.setPrototypeOf(r,t.prototype),r.message='Wrong driver: "'+n+'" given. Supported drivers are: "cordova", "expo", "mariadb", "mongodb", "mssql", "mysql", "oracle", "postgres", "sqlite", "sqljs", "react-native", "aurora-data-api", "aurora-data-api-pg".',r}return r.c(t,e),t}(Error),Ae=n(29),Ce=n(86),Se=n(17),Re=n(28),Me=n(42),Oe=n(25),Pe=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Oe.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Se.a;return new Promise((function(i,a){return r.b(n,void 0,void 0,(function(){var n,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.executeSql(e,t,(function(n){var r=s.driver.connection.options.maxQueryExecutionTime,a=+new Date-o;if(r&&a>r&&s.driver.connection.logger.logQuerySlow(a,e,t,s),"INSERT INTO"===e.substr(0,11))i(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));i(u)}}),(function(n){s.driver.connection.logger.logQueryError(n,e,t,s),a(new Re.a(e,t,n))})),[2]}}))}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Me.a),xe=n(34),Ie=n(30),_e=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new xe.a("database");if(!n.options.location)throw new xe.a("location");return n.loadDependencies(),n}return r.c(t,e),t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)}))]}))}))},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new Pe(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,(function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],(function(e){t(r)}),(function(e){n(e)}))}),(function(e){n(e)}))}))},t.prototype.loadDependencies=function(){try{this.sqlite=window.sqlitePlugin}catch(e){throw new Ie.a("Cordova-SQLite","cordova-sqlite-storage")}},t}(P.a),Le=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Oe.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Se.a;return new Promise((function(i,a){return r.b(n,void 0,void 0,(function(){var n,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.executeSql(e,t,(function(n){var r=s.driver.connection.options.maxQueryExecutionTime,a=+new Date-o;if(r&&a>r&&s.driver.connection.logger.logQuerySlow(a,e,t,s),"INSERT INTO"===e.substr(0,11))i(n.insertId);else{for(var u=[],c=0;c<n.rows.length;c++)u.push(n.rows.item(c));i(u)}}),(function(n){s.driver.connection.logger.logQueryError(n,e,t,s),a(new Re.a(e,t,n))})),[2]}}))}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(Me.a),De=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new xe.a("database");if(!n.options.location)throw new xe.a("location");return n.loadDependencies(),n}return r.c(t,e),t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close(t,n)}))]}))}))},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new Le(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{name:e.options.database,location:e.options.location},e.options.extra||{});e.sqlite.openDatabase(r,(function(e){var r=e;r.executeSql("PRAGMA foreign_keys = ON;",[],(function(e){t(r)}),(function(e){n(e)}))}),(function(e){n(e)}))}))},t.prototype.loadDependencies=function(){try{this.sqlite=n(!function(){var e=new Error("Cannot find module 'react-native-sqlite-storage'");throw e.code="MODULE_NOT_FOUND",e}())}catch(e){throw new Ie.a("React-Native","react-native-sqlite-storage")}},t}(P.a),qe=n(88),je=n(36),Ue=n(27),Be=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new Oe.a(n),n}return r.c(t,e),t.prototype.startTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){if(this.isTransactionActive&&"undefined"!==typeof this.transaction)throw new je.a;return this.isTransactionActive=!0,[2]}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){if(!this.isTransactionActive&&"undefined"===typeof this.transaction)throw new Ue.a;return this.isTransactionActive=!1,this.transaction=void 0,[2]}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){if(!this.isTransactionActive&&"undefined"===typeof this.transaction)throw new Ue.a;return this.isTransactionActive=!1,this.transaction=void 0,[2]}))}))},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new Se.a;return new Promise((function(i,a){return r.b(n,void 0,void 0,(function(){var n,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.connect()];case 1:return n=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,n.transaction((function(n){"undefined"===typeof s.transaction&&(s.startTransaction(),s.transaction=n),s.transaction.executeSql(e,t,(function(n,r){var a=s.driver.connection.options.maxQueryExecutionTime,u=+new Date-o;if(a&&u>a&&s.driver.connection.logger.logQuerySlow(u,e,t,s),"INSERT INTO"===e.substr(0,11))i(r.insertId);else{for(var c=[],l=0;l<r.rows.length;l++)c.push(r.rows.item(l));i(c)}}),(function(n,r){s.driver.connection.logger.logQueryError(r,e,t,s),a(new Re.a(e,t,r))}))}),(function(e){s.rollbackTransaction()}),(function(){s.isTransactionActive=!1,s.transaction=void 0})),[2]}}))}))}))},t}(Me.a),ke=function(e){function t(t){var n=e.call(this,t)||this;if(n.database=n.options.database,!n.options.database)throw new xe.a("database");if(!n.options.driver)throw new xe.a("driver");return n.sqlite=n.options.driver,n}return r.c(t,e),t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){try{e.queryRunner=void 0,e.databaseConnection._db.close(),e.databaseConnection=void 0,t()}catch(r){n(r)}}))]}))}))},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new Be(this)),this.queryRunner},t.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){try{var r=e.sqlite.openDatabase(e.options.database);r.transaction((function(e){e.executeSql("PRAGMA foreign_keys = ON;",[],(function(e,n){t(r)}),(function(e,t){n({transaction:e,error:t})}))}),(function(e){n(e)}))}catch(i){n(i)}}))},t}(P.a),Fe=function(){function e(){}return e.prototype.create=function(e){var t=e.options.type;switch(t){case"mysql":return new m.e(e);case"postgres":return new m.f(e);case"cockroachdb":return new Ae.a(e);case"sap":return new W.a(e);case"mariadb":return new m.e(e);case"sqlite":return new Ce.a(e);case"cordova":return new _e(e);case"nativescript":return new qe.a(e);case"react-native":return new De(e);case"sqljs":return new Te.a(e);case"oracle":return new ne.a(e);case"mssql":return new f.a(e);case"mongodb":return new m.a(e);case"expo":return new ke(e);case"aurora-data-api":return new A.a(e);case"aurora-data-api-pg":return new AuroraDataApiPostgresDriver(e);default:throw new we(t)}},e}(),Ve=n(4);function Qe(e,t,n){void 0===n&&(n=[".js",".ts"]);var r=t.reduce((function(e,t){return e.concat(Ve.a.load("glob").sync(Ve.a.pathNormalize(t)))}),[]);return t.length>0&&0===r.length?e.log("info",'No classes were found using the provided glob pattern:  "'+t+'"'):r.length>0&&e.log("info",'All classes found using provided glob pattern "'+t+'" : "'+r+'"'),function e(t,n){return"function"===typeof t||t instanceof pt.a?n.push(t):Array.isArray(t)?t.forEach((function(t){return e(t,n)})):"object"===typeof t&&null!==t&&Object.keys(t).forEach((function(r){return e(t[r],n)})),n}(r.filter((function(e){var t=e.substring(e.length-5,e.length);return-1!==n.indexOf(Ve.a.pathExtname(e))&&".d.ts"!==t})).map((function(e){return Ve.a.load(Ve.a.pathResolve(e))})),[])}var Ke,He,ze=new(function(){function e(){this.instances=[]}return e.prototype.get=function(e){var t=this.instances.find((function(t){return t.type===e}));return t||(t={type:e,object:new e},this.instances.push(t)),t.object},e}());function We(e){if(Ke)try{var t=Ke.get(e);if(t)return t;if(!He||!He.fallback)return t}catch(n){if(!He||!He.fallbackOnErrors)throw n}return ze.get(e)}var Ye=n(31),Ge=function(){function e(e){this.isUnique=!1,this.isSpatial=!1,this.isFulltext=!1,this.synchronize=!0,this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,null!==e.args.synchronize&&void 0!==e.args.synchronize&&(this.synchronize=e.args.synchronize),this.isUnique=!!e.args.unique,this.isSpatial=!!e.args.spatial,this.isFulltext=!!e.args.fulltext,this.parser=e.args.parser,this.where=e.args.where,this.isSparse=e.args.sparse,this.isBackground=e.args.background,this.expireAfterSeconds=e.args.expireAfterSeconds,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this;if(!1===this.synchronize)return this.name=this.givenName,this;var n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map((function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e}))).forEach((function(e){return n[e]=1}));else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map((function(e){return String(e)}))).forEach((function(e){return n[e]=1})):(r=Object.keys(i).map((function(e){return String(e)})),Object.keys(i).forEach((function(e){return n[e]=i[e]})))}this.columns=r.map((function(e){var n=t.entityMetadata.columns.find((function(t){return t.propertyPath===e}));if(n)return[n];var r=t.entityMetadata.relations.find((function(t){return t.isWithJoinColumn&&t.propertyName===e}));if(r)return r.joinColumns;var i=t.givenName?'"'+t.givenName+'" ':"",a=t.entityMetadata.targetName;throw new Error("Index "+i+"contains column that is missing in the entity ("+a+"): "+e)})).reduce((function(e,t){return e.concat(t)}))}return this.columnNamesWithOrderingMap=Object.keys(n).reduce((function(e,r){var i=t.entityMetadata.columns.find((function(e){return e.propertyPath===r}));return i&&(e[i.databasePath]=n[r]),e}),{}),this.name=this.givenName?this.givenName:e.indexName(this.entityMetadata.tablePath,this.columns.map((function(e){return e.databaseName})),this.where),this},e}(),Je=function(){function e(e){this.isTreeParent=!1,this.isTreeChildren=!1,this.isPrimary=!1,this.isLazy=!1,this.isEager=!1,this.persistenceEnabled=!0,this.isCascadeInsert=!1,this.isCascadeUpdate=!1,this.isCascadeRemove=!1,this.isCascadeSoftRemove=!1,this.isCascadeRecover=!1,this.isNullable=!0,this.isOwning=!1,this.isOneToOne=!1,this.isOneToOneOwner=!1,this.isWithJoinColumn=!1,this.isOneToOneNotOwner=!1,this.isOneToMany=!1,this.isManyToOne=!1,this.isManyToMany=!1,this.isManyToManyOwner=!1,this.isManyToManyNotOwner=!1,this.foreignKeys=[],this.joinColumns=[],this.inverseJoinColumns=[],this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata;var t=e.args;this.target=t.target,this.propertyName=t.propertyName,this.relationType=t.relationType,t.inverseSideProperty&&(this.givenInverseSidePropertyFactory=t.inverseSideProperty),this.isLazy=t.isLazy||!1,this.isCascadeInsert=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("insert"),this.isCascadeUpdate=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("update"),this.isCascadeRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("remove"),this.isCascadeSoftRemove=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("soft-remove"),this.isCascadeRecover=!0===t.options.cascade||Array.isArray(t.options.cascade)&&-1!==t.options.cascade.indexOf("recover"),this.isPrimary=t.options.primary||!1,this.isNullable=!1!==t.options.nullable&&!this.isPrimary,this.onDelete=t.options.onDelete,this.onUpdate=t.options.onUpdate,this.deferrable=t.options.deferrable,this.isEager=t.options.eager||!1,this.persistenceEnabled=!1!==t.options.persistence,this.isTreeParent=t.isTreeParent||!1,this.isTreeChildren=t.isTreeChildren||!1,this.type=t.type instanceof Function?t.type():t.type,this.isOneToOne="one-to-one"===this.relationType,this.isOneToMany="one-to-many"===this.relationType,this.isManyToOne="many-to-one"===this.relationType,this.isManyToMany="many-to-many"===this.relationType,this.isOneToOneNotOwner=!!this.isOneToOne,this.isManyToManyNotOwner=!!this.isManyToMany}return e.prototype.getRelationIdMap=function(e){var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((function(e){return e.referencedColumn}));return le.a.getValueMap(e,t)},e.prototype.ensureRelationIdMap=function(e){if(e instanceof Object)return e;var t=(this.isOwning?this.joinColumns:this.inverseRelation.joinColumns).map((function(e){return e.referencedColumn}));if(t.length>1)throw new Error("Cannot create relation id map for a single value because relation contains multiple referenced columns.");return t[0].createValueMap(e)},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),null!==e&&void 0!==e){if(this.embeddedMetadata){var n=function e(t,n){var r=t.shift();return r?n[r]?e(t,n[r]):void 0:n}(r.f(this.embeddedMetadata.parentPropertyNames),e);return this.isLazy?void 0!==n["__"+this.propertyName+"__"]?n["__"+this.propertyName+"__"]:!0===t?n[this.propertyName]:void 0:n?n[this.isLazy?"__"+this.propertyName+"__":this.propertyName]:void 0}return this.isLazy?void 0!==e["__"+this.propertyName+"__"]?e["__"+this.propertyName+"__"]:!0===t?e[this.propertyName]:void 0:e[this.propertyName]}},e.prototype.setEntityValue=function(e,t){var n=this.isLazy?"__"+this.propertyName+"__":this.propertyName;if(this.embeddedMetadata){return function e(r,i){var a=r.shift();return a?(i[a.propertyName]||(i[a.propertyName]=a.create()),e(r,i[a.propertyName]),i):(i[n]=t,i)}(r.f(this.embeddedMetadata.embeddedMetadataTree),e)}e[n]=t},e.prototype.createValueMap=function(e){var t,n=this;if(this.embeddedMetadata){return function t(r,i){var a=r.shift();return a?(i[a]={},t(r,i[a]),i):(i[n.propertyName]=e,i)}(r.f(this.embeddedMetadata.parentPropertyNames),{})}return(t={})[this.propertyName]=e,t},e.prototype.build=function(){this.propertyPath=this.buildPropertyPath()},e.prototype.registerForeignKeys=function(){for(var e,t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];(e=this.foreignKeys).push.apply(e,r.f(t)),this.joinColumns=this.foreignKeys[0]?this.foreignKeys[0].columns:[],this.inverseJoinColumns=this.foreignKeys[1]?this.foreignKeys[1].columns:[],this.isOwning=this.isManyToOne||(this.isManyToMany||this.isOneToOne)&&this.joinColumns.length>0,this.isOneToOneOwner=this.isOneToOne&&this.isOwning,this.isOneToOneNotOwner=this.isOneToOne&&!this.isOwning,this.isManyToManyOwner=this.isManyToMany&&this.isOwning,this.isManyToManyNotOwner=this.isManyToMany&&!this.isOwning,this.isWithJoinColumn=this.isManyToOne||this.isOneToOneOwner},e.prototype.registerJunctionEntityMetadata=function(e){this.junctionEntityMetadata=e,this.joinTableName=e.tableName,this.inverseRelation&&(this.inverseRelation.junctionEntityMetadata=e,this.joinTableName=e.tableName)},e.prototype.buildInverseSidePropertyPath=function(){if(this.givenInverseSidePropertyFactory){var e=this.inverseEntityMetadata.propertiesMap;if("function"===typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory(e);if("string"===typeof this.givenInverseSidePropertyFactory)return this.givenInverseSidePropertyFactory}else{if(this.isTreeParent&&this.entityMetadata.treeChildrenRelation)return this.entityMetadata.treeChildrenRelation.propertyName;if(this.isTreeChildren&&this.entityMetadata.treeParentRelation)return this.entityMetadata.treeParentRelation.propertyName}return""},e.prototype.buildPropertyPath=function(){return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length?this.embeddedMetadata.parentPropertyNames.join(".")+"."+this.propertyName:this.propertyName},e}(),Xe=function(){function e(e){this.columns=[],this.relations=[],this.listeners=[],this.indices=[],this.uniques=[],this.relationIds=[],this.relationCounts=[],this.embeddeds=[],this.isArray=!1,this.parentPropertyNames=[],this.parentPrefixes=[],this.embeddedMetadataTree=[],this.columnsFromTree=[],this.relationsFromTree=[],this.listenersFromTree=[],this.indicesFromTree=[],this.uniquesFromTree=[],this.relationIdsFromTree=[],this.relationCountsFromTree=[],this.entityMetadata=e.entityMetadata,this.type=e.args.type(),this.propertyName=e.args.propertyName,this.customPrefix=e.args.prefix,this.isArray=e.args.isArray}return e.prototype.create=function(){return new this.type},e.prototype.build=function(e){return this.embeddeds.forEach((function(t){return t.build(e)})),this.prefix=this.buildPrefix(e),this.parentPropertyNames=this.buildParentPropertyNames(),this.parentPrefixes=this.buildParentPrefixes(),this.propertyPath=this.parentPropertyNames.join("."),this.embeddedMetadataTree=this.buildEmbeddedMetadataTree(),this.columnsFromTree=this.buildColumnsFromTree(),this.relationsFromTree=this.buildRelationsFromTree(),this.listenersFromTree=this.buildListenersFromTree(),this.indicesFromTree=this.buildIndicesFromTree(),this.uniquesFromTree=this.buildUniquesFromTree(),this.relationIdsFromTree=this.buildRelationIdsFromTree(),this.relationCountsFromTree=this.buildRelationCountsFromTree(),this},e.prototype.buildPartialPrefix=function(){if(void 0===this.customPrefix||!0===this.customPrefix)return[this.propertyName];if(""===this.customPrefix||!1===this.customPrefix)return[];if("string"===typeof this.customPrefix)return[this.customPrefix];throw new Error("Invalid prefix option given for "+this.entityMetadata.targetName+"#"+this.propertyName)},e.prototype.buildPrefix=function(e){if(e.driver instanceof m.a)return this.propertyName;var t=[];return this.parentEmbeddedMetadata&&t.push(this.parentEmbeddedMetadata.buildPrefix(e)),t.push.apply(t,r.f(this.buildPartialPrefix())),t.join("_")},e.prototype.buildParentPropertyNames=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPropertyNames().concat(this.propertyName):[this.propertyName]},e.prototype.buildParentPrefixes=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildParentPrefixes().concat(this.buildPartialPrefix()):this.buildPartialPrefix()},e.prototype.buildEmbeddedMetadataTree=function(){return this.parentEmbeddedMetadata?this.parentEmbeddedMetadata.buildEmbeddedMetadataTree().concat(this):[this]},e.prototype.buildColumnsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildColumnsFromTree())}),this.columns)},e.prototype.buildRelationsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationsFromTree())}),this.relations)},e.prototype.buildListenersFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildListenersFromTree())}),this.listeners)},e.prototype.buildIndicesFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildIndicesFromTree())}),this.indices)},e.prototype.buildUniquesFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildUniquesFromTree())}),this.uniques)},e.prototype.buildRelationIdsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationIdsFromTree())}),this.relationIds)},e.prototype.buildRelationCountsFromTree=function(){return this.embeddeds.reduce((function(e,t){return e.concat(t.buildRelationCountsFromTree())}),this.relationCounts)},e}(),$e=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.setValue=function(e){var t=this,n=this.relation.getEntityValue(e);if(Array.isArray(n))e[this.propertyName]=n.map((function(e){return t.relation.inverseEntityMetadata.getEntityIdMixedMap(e)})).filter((function(e){return null!==e&&void 0!==e}));else{var r=this.relation.inverseEntityMetadata.getEntityIdMixedMap(n);void 0!==r&&(e[this.propertyName]=r)}},e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationId decorator.");this.relation=t},e}(),Ze=function(){function e(e){this.entityMetadata=e.entityMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.relationNameOrFactory=e.args.relation,this.alias=e.args.alias,this.queryBuilderFactory=e.args.queryBuilderFactory}return e.prototype.build=function(){var e=this.relationNameOrFactory instanceof Function?this.relationNameOrFactory(this.entityMetadata.propertiesMap):this.relationNameOrFactory,t=this.entityMetadata.findRelationWithPropertyPath(e);if(!t)throw new Error("Cannot find relation "+e+". Wrong relation specified for @RelationCount decorator.");this.relation=t},e}(),et=function(){function e(){}return e.getInheritanceTree=function(e){var t=[e];return function e(n){var r=Object.getPrototypeOf(n);r&&r.name&&(t.push(r),e(r))}(e),t},e.isInherited=function(e,t){return e.prototype instanceof t},e.filterByTarget=function(e,t){return t?e.filter((function(e){return e.target&&-1!==t.indexOf(e.target)})):e},e}(),tt=function(){function e(e){this.columns=[],this.referencedColumns=[],this.columnNames=[],this.referencedColumnNames=[],this.entityMetadata=e.entityMetadata,this.referencedEntityMetadata=e.referencedEntityMetadata,this.columns=e.columns,this.referencedColumns=e.referencedColumns,this.onDelete=e.onDelete||"NO ACTION",this.onUpdate=e.onUpdate||"NO ACTION",this.deferrable=e.deferrable,e.namingStrategy&&this.build(e.namingStrategy)}return e.prototype.build=function(e){this.columnNames=this.columns.map((function(e){return e.databaseName})),this.referencedColumnNames=this.referencedColumns.map((function(e){return e.databaseName})),this.referencedTablePath=this.referencedEntityMetadata.tablePath,this.name=e.foreignKeyName(this.entityMetadata.tablePath,this.columnNames,this.referencedTablePath,this.referencedColumnNames)},e}(),nt=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this,i=this.collectReferencedColumns(e,t),a=this.collectInverseReferencedColumns(e,t),o=t.name||this.connection.namingStrategy.joinTableName(e.entityMetadata.tableNameWithoutPrefix,e.inverseEntityMetadata.tableNameWithoutPrefix,e.propertyPath,e.inverseRelation?e.inverseRelation.propertyName:""),s=new le.a({connection:this.connection,args:{target:"",name:o,type:"junction",database:t.database||e.entityMetadata.database,schema:t.schema||e.entityMetadata.schema}});s.build();var u=i.map((function(r){var i=t.joinColumns?t.joinColumns.find((function(e){return(!e.referencedColumnName||e.referencedColumnName===r.propertyName)&&!!e.name})):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableColumnName(e.entityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new Ye.a({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{name:a,length:r.length||!(n.connection.driver instanceof m.e||n.connection.driver instanceof A.a)||"uuid"!==r.generationStrategy&&"uuid"!==r.type?r.length:"36",width:r.width,type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,nullable:!1,primary:!0}}})})),c=a.map((function(r){var i=t.inverseJoinColumns?t.inverseJoinColumns.find((function(e){return(!e.referencedColumnName||e.referencedColumnName===r.propertyName)&&!!e.name})):void 0,a=i&&i.name?i.name:n.connection.namingStrategy.joinTableInverseColumnName(e.inverseEntityMetadata.tableNameWithoutPrefix,r.propertyName,r.databaseName);return new Ye.a({connection:n.connection,entityMetadata:s,referencedColumn:r,args:{target:"",mode:"virtual",propertyName:a,options:{length:r.length||!(n.connection.driver instanceof m.e||n.connection.driver instanceof A.a)||"uuid"!==r.generationStrategy&&"uuid"!==r.type?r.length:"36",type:r.type,precision:r.precision,scale:r.scale,charset:r.charset,collation:r.collation,zerofill:r.zerofill,unsigned:!!r.zerofill||r.unsigned,name:a,nullable:!1,primary:!0}}})}));return this.changeDuplicatedColumnNames(u,c),s.ownerColumns=u,s.inverseColumns=c,s.ownColumns=r.f(u,c),s.ownColumns.forEach((function(t){return t.relationMetadata=e})),s.foreignKeys=[new tt({entityMetadata:s,referencedEntityMetadata:e.entityMetadata,columns:u,referencedColumns:i,onDelete:e.onDelete||"CASCADE"}),new tt({entityMetadata:s,referencedEntityMetadata:e.inverseEntityMetadata,columns:c,referencedColumns:a,onDelete:e.onDelete||"CASCADE"})],s.ownIndices=[new Ge({entityMetadata:s,columns:u,args:{target:s.target,synchronize:!0}}),new Ge({entityMetadata:s,columns:c,args:{target:s.target,synchronize:!0}})],s},e.prototype.collectReferencedColumns=function(e,t){var n=!!t.joinColumns&&t.joinColumns.find((function(e){return!!e.referencedColumnName}));return!t.joinColumns||t.joinColumns&&!n?e.entityMetadata.columns.filter((function(e){return e.isPrimary})):t.joinColumns.map((function(t){var n=e.entityMetadata.columns.find((function(e){return e.propertyName===t.referencedColumnName}));if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.entityMetadata.name);return n}))},e.prototype.collectInverseReferencedColumns=function(e,t){var n=!!t.inverseJoinColumns,r=!!n&&t.inverseJoinColumns.find((function(e){return!!e.referencedColumnName}));return!n||n&&!r?e.inverseEntityMetadata.primaryColumns:t.inverseJoinColumns.map((function(t){var n=e.inverseEntityMetadata.ownColumns.find((function(e){return e.propertyName===t.referencedColumnName}));if(!n)throw new Error("Referenced column "+t.referencedColumnName+" was not found in entity "+e.inverseEntityMetadata.name);return n}))},e.prototype.changeDuplicatedColumnNames=function(e,t){var n=this;e.forEach((function(e){t.forEach((function(t){if(e.givenDatabaseName===t.givenDatabaseName){var r=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(e.propertyName,1);e.propertyName=r,e.givenDatabaseName=r;var i=n.connection.namingStrategy.joinTableColumnDuplicationPrefix(t.propertyName,2);t.propertyName=i,t.givenDatabaseName=i}}))}))},e}(),rt=function(){function e(e){this.connection=e}return e.prototype.build=function(e){var t=this,n=new le.a({parentClosureEntityMetadata:e,connection:this.connection,args:{target:"",name:e.tableNameWithoutPrefix,type:"closure-junction"}});return n.build(),e.primaryColumns.forEach((function(e){n.ownColumns.push(new Ye.a({connection:t.connection,entityMetadata:n,closureType:"ancestor",referencedColumn:e,args:{target:"",mode:"virtual",propertyName:e.propertyName+"_ancestor",options:{primary:!0,length:e.length,type:e.type}}})),n.ownColumns.push(new Ye.a({connection:t.connection,entityMetadata:n,closureType:"descendant",referencedColumn:e,args:{target:"",mode:"virtual",propertyName:e.propertyName+"_descendant",options:{primary:!0,length:e.length,type:e.type}}}))})),n.ownIndices=[new Ge({entityMetadata:n,columns:[n.ownColumns[0]],args:{target:n.target,synchronize:!0}}),new Ge({entityMetadata:n,columns:[n.ownColumns[1]],args:{target:n.target,synchronize:!0}})],e.treeLevelColumn&&n.ownColumns.push(new Ye.a({connection:this.connection,entityMetadata:n,args:{target:"",mode:"virtual",propertyName:"level",options:{type:this.connection.driver.mappedDataTypes.treeLevel}}})),n.foreignKeys=[new tt({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[0]],referencedColumns:e.primaryColumns}),new tt({entityMetadata:n,referencedEntityMetadata:e,columns:[n.ownColumns[1]],referencedColumns:e.primaryColumns})],n},e}(),it=function(){function e(e){this.columns=[],this.columnNamesWithOrderingMap={},this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,e.columns&&(this.columns=e.columns),e.args&&(this.target=e.args.target,this.givenName=e.args.name,this.givenColumnNames=e.args.columns)}return e.prototype.build=function(e){var t=this,n={};if(this.givenColumnNames){var r=[];if(Array.isArray(this.givenColumnNames))(r=this.givenColumnNames.map((function(e){return t.embeddedMetadata?t.embeddedMetadata.propertyPath+"."+e:e}))).forEach((function(e){return n[e]=1}));else{var i=this.givenColumnNames(this.entityMetadata.propertiesMap);Array.isArray(i)?(r=i.map((function(e){return String(e)}))).forEach((function(e){return n[e]=1})):(r=Object.keys(i).map((function(e){return String(e)})),Object.keys(i).forEach((function(e){return n[e]=i[e]})))}this.columns=r.map((function(e){var n=t.entityMetadata.columns.find((function(t){return t.propertyPath===e}));if(n)return[n];var r=t.entityMetadata.relations.find((function(t){return t.isWithJoinColumn&&t.propertyName===e}));if(r)return r.joinColumns;var i=t.givenName?'"'+t.givenName+'" ':"",a=t.entityMetadata.targetName;throw new Error("Unique constraint "+i+"contains column that is missing in the entity ("+a+"): "+e)})).reduce((function(e,t){return e.concat(t)}))}return this.columnNamesWithOrderingMap=Object.keys(n).reduce((function(e,r){var i=t.entityMetadata.columns.find((function(e){return e.propertyPath===r}));return i&&(e[i.databasePath]=n[r]),e}),{}),this.name=this.givenName?this.givenName:e.uniqueConstraintName(this.entityMetadata.tablePath,this.columns.map((function(e){return e.databaseName}))),this},e}(),at=function(){function e(e){this.connection=e}return e.prototype.build=function(e,t){var n=this.collectReferencedColumns(e,t);if(!n.length)return{foreignKey:void 0,uniqueConstraint:void 0};var r=this.collectColumns(e,t,n),i=new tt({entityMetadata:t.entityMetadata,referencedEntityMetadata:t.inverseEntityMetadata,namingStrategy:this.connection.namingStrategy,columns:r,referencedColumns:n,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable});if(this.connection.driver instanceof ne.a&&r.every((function(e){return e.isPrimary})))return{foreignKey:i,uniqueConstraint:void 0};if(n.length>0&&t.isOneToOne){var a=new it({entityMetadata:t.entityMetadata,columns:i.columns,args:{name:this.connection.namingStrategy.relationConstraintName(t.entityMetadata.tablePath,i.columns.map((function(e){return e.databaseName}))),target:t.entityMetadata.target}});return a.build(this.connection.namingStrategy),{foreignKey:i,uniqueConstraint:a}}return{foreignKey:i,uniqueConstraint:void 0}},e.prototype.collectReferencedColumns=function(e,t){var n=e.find((function(e){return!!e.referencedColumnName})),r=0===e.length&&t.isManyToOne,i=e.length>0&&!n;return r||i?t.inverseEntityMetadata.primaryColumns:e.map((function(e){var n=t.inverseEntityMetadata.ownColumns.find((function(t){return t.propertyName===e.referencedColumnName}));if(!n)throw new Error("Referenced column "+e.referencedColumnName+" was not found in entity "+t.inverseEntityMetadata.name);return n}))},e.prototype.collectColumns=function(e,t,n){var r=this;return n.map((function(n){var i=e.find((function(e){return(!e.referencedColumnName||e.referencedColumnName===n.propertyName)&&!!e.name})),a=i?i.name:r.connection.namingStrategy.joinColumnName(t.propertyName,n.propertyName),o=t.entityMetadata.ownColumns.find((function(e){return e.databaseName===a}));return o||(o=new Ye.a({connection:r.connection,entityMetadata:t.entityMetadata,args:{target:"",mode:"virtual",propertyName:t.propertyName,options:{name:a,type:n.type,length:n.length||!(r.connection.driver instanceof m.e||r.connection.driver instanceof A.a)||"uuid"!==n.generationStrategy&&"uuid"!==n.type?n.length:"36",width:n.width,charset:n.charset,collation:n.collation,precision:n.precision,scale:n.scale,zerofill:n.zerofill,unsigned:n.unsigned,comment:n.comment,primary:t.isPrimary,nullable:t.isNullable}}}),t.entityMetadata.registerColumn(o)),o.referencedColumn=n,o.type=n.type,o.relationMetadata=t,o.build(r.connection),o}))},e}(),ot=function(){function e(e){this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.target=e.args.target,this.propertyName=e.args.propertyName,this.type=e.args.type}return e.prototype.isAllowed=function(e){return this.entityMetadata.target===e.constructor||this.entityMetadata.target instanceof Function&&e.constructor.prototype instanceof this.entityMetadata.target},e.prototype.execute=function(e){if(!this.embeddedMetadata)return e[this.propertyName]();this.callEntityEmbeddedMethod(e,this.embeddedMetadata.propertyPath.split("."))},e.prototype.callEntityEmbeddedMethod=function(e,t){var n=t.shift();n&&e[n]&&(0===t.length?e[n][this.propertyName]():e[n]&&this.callEntityEmbeddedMethod(e[n],t))},e}(),st=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.checkConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),ut=function(){function e(e){this.entityMetadata=e.entityMetadata,e.args&&(this.target=e.args.target,this.expression=e.args.expression,this.givenName=e.args.name)}return e.prototype.build=function(e){return this.name=this.givenName?this.givenName:e.exclusionConstraintName(this.entityMetadata.tablePath,this.expression),this},e}(),ct=function(){function e(e,t){this.connection=e,this.metadataArgsStorage=t,this.junctionEntityMetadataBuilder=new nt(e),this.closureJunctionEntityMetadataBuilder=new rt(e),this.relationJoinColumnBuilder=new at(e)}return e.prototype.build=function(e){var t=this,n=(e?this.metadataArgsStorage.filterTables(e):this.metadataArgsStorage.tables).filter((function(e){return"regular"===e.type||"closure"===e.type||"entity-child"===e.type||"view"===e.type})).map((function(e){return t.createEntityMetadata(e)}));return n.forEach((function(e){return t.computeParentEntityMetadata(n,e)})),n.forEach((function(e){e.childEntityMetadatas=n.filter((function(t){return e.target instanceof Function&&t.target instanceof Function&&et.isInherited(t.target,e.target)}))})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){return e.build()})),n.filter((function(e){return"entity-child"===e.tableType})).forEach((function(e){return e.build()})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){return t.computeEntityMetadataStep1(n,e)})),n.filter((function(e){return"entity-child"===e.tableType})).forEach((function(e){return t.computeEntityMetadataStep1(n,e)})),n.forEach((function(e){return t.computeEntityMetadataStep2(e)})),n.forEach((function(e){return t.computeInverseProperties(e,n)})),n.filter((function(e){return"entity-child"!==e.tableType})).forEach((function(e){e.relations.filter((function(e){return e.isOneToOne||e.isManyToOne})).forEach((function(n){var r=t.metadataArgsStorage.filterJoinColumns(n.target,n.propertyName),i=t.relationJoinColumnBuilder.build(r,n),a=i.foreignKey,o=i.uniqueConstraint;if(a&&(n.registerForeignKeys(a),e.foreignKeys.push(a)),o)if(t.connection.driver instanceof m.e||t.connection.driver instanceof A.a||t.connection.driver instanceof f.a||t.connection.driver instanceof W.a){var s=new Ge({entityMetadata:o.entityMetadata,columns:o.columns,args:{target:o.target,name:o.name,unique:!0,synchronize:!0}});t.connection.driver instanceof f.a&&(s.where=s.columns.map((function(e){return t.connection.driver.escape(e.databaseName)+" IS NOT NULL"})).join(" AND ")),n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}else n.embeddedMetadata?n.embeddedMetadata.uniques.push(o):n.entityMetadata.ownUniques.push(o),t.computeEntityMetadataStep2(e);if(a&&t.connection.driver instanceof Ae.a){s=new Ge({entityMetadata:n.entityMetadata,columns:a.columns,args:{target:n.entityMetadata.target,synchronize:!0}});n.embeddedMetadata?n.embeddedMetadata.indices.push(s):n.entityMetadata.ownIndices.push(s),t.computeEntityMetadataStep2(e)}})),e.relations.filter((function(e){return e.isManyToMany})).forEach((function(e){var i=t.metadataArgsStorage.findJoinTable(e.target,e.propertyName);if(i){var a=t.junctionEntityMetadataBuilder.build(e,i);e.registerForeignKeys.apply(e,r.f(a.foreignKeys)),e.registerJunctionEntityMetadata(a),t.computeEntityMetadataStep2(a),t.computeInverseProperties(a,n),n.push(a)}}))})),n.forEach((function(e){e.relationsWithJoinColumns=e.relations.filter((function(e){return e.isWithJoinColumn})),e.hasNonNullableRelations=e.relationsWithJoinColumns.some((function(e){return!e.isNullable||e.isPrimary}))})),n.filter((function(e){return"closure-table"===e.treeType})).forEach((function(e){var r=t.closureJunctionEntityMetadataBuilder.build(e);e.closureJunctionTable=r,t.computeEntityMetadataStep2(r),t.computeInverseProperties(r,n),n.push(r)})),n.filter((function(e){return"STI"===e.inheritancePattern&&e.discriminatorColumn})).forEach((function(e){return t.createKeysForTableInheritance(e)})),n.forEach((function(e){e.indices.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.uniques.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.checks.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.forEach((function(e){e.exclusions.forEach((function(e){return e.build(t.connection.namingStrategy)}))})),n.filter((function(e){return e.target instanceof Function})).forEach((function(e){e.relations.filter((function(e){return e.isLazy})).forEach((function(n){t.connection.relationLoader.enableLazyLoad(n,e.target.prototype)}))})),n.forEach((function(e){e.columns.forEach((function(n){var r=t.metadataArgsStorage.findGenerated(n.target,n.propertyName);r&&(n.isGenerated=!0,n.generationStrategy=r.strategy,"uuid"===r.strategy?n.type="uuid":"rowid"===r.strategy?n.type="int":n.type=n.type||Number,n.build(t.connection),t.computeEntityMetadataStep2(e))}))})),n},e.prototype.createEntityMetadata=function(e){var t,n=e.target instanceof Function?et.getInheritanceTree(e.target):[e.target],i=this.metadataArgsStorage.findInheritanceType(e.target),a=this.metadataArgsStorage.findTree(e.target);return(i&&"STI"===i.pattern||"entity-child"===e.type)&&(t=this.metadataArgsStorage.filterSingleTableChildren(e.target).map((function(e){return e.target})).filter((function(e){return e instanceof Function})),n.push.apply(n,r.f(t))),new le.a({connection:this.connection,args:e,inheritanceTree:n,tableTree:a,inheritancePattern:i?i.pattern:void 0})},e.prototype.computeParentEntityMetadata=function(e,t){"entity-child"===t.tableType&&(t.parentEntityMetadata=e.find((function(e){return-1!==e.inheritanceTree.indexOf(t.target)&&"STI"===e.inheritancePattern})))},e.prototype.computeEntityMetadataStep1=function(e,t){var n,i,a,o=this,s=this.metadataArgsStorage.findInheritanceType(t.target),u=this.metadataArgsStorage.findDiscriminatorValue(t.target);if(t.discriminatorValue=u?u.value:t.target.name,t.embeddeds=this.createEmbeddedsRecursively(t,this.metadataArgsStorage.filterEmbeddeds(t.inheritanceTree)).map((function(e){return"STI"===t.inheritancePattern&&(e.columns=e.columns.map((function(e){return e.isNullable=!0,e}))),e})),t.ownColumns=this.metadataArgsStorage.filterColumns(t.inheritanceTree).map((function(n){if("entity-child"===t.tableType)return t.parentEntityMetadata.ownColumns.find((function(e){return e.propertyName===n.propertyName}));var r=new Ye.a({connection:o.connection,entityMetadata:t,args:n});return e.find((function(e){return"entity-child"===e.tableType&&e.target===n.target}))&&(r.isNullable=!0),r})),s&&s.column){var c=s.column&&s.column.name?s.column.name:"type",l=t.ownColumns.find((function(e){return e.propertyName===c}));l?l.isDiscriminator=!0:((l=new Ye.a({connection:this.connection,entityMetadata:t,args:{target:t.target,mode:"virtual",propertyName:c,options:s.column||{name:c,type:"varchar",nullable:!1}}})).isVirtual=!0,l.isDiscriminator=!0,t.ownColumns.push(l))}if("entity-child"===t.tableType){var h=t.parentEntityMetadata.ownColumns.find((function(e){return e.isDiscriminator}));h&&!t.ownColumns.find((function(e){return e===h}))&&t.ownColumns.push(h)}var p=this.connection.namingStrategy;if("materialized-path"===t.treeType)t.ownColumns.push(new Ye.a({connection:this.connection,entityMetadata:t,materializedPath:!0,args:{target:t.target,mode:"virtual",propertyName:"mpath",options:{name:p.materializedPathColumnName,type:"varchar",nullable:!0,default:""}}}));else if("nested-set"===t.treeType){var f=p.nestedSetColumnNames,d=f.left,y=f.right;t.ownColumns.push(new Ye.a({connection:this.connection,entityMetadata:t,nestedSetLeft:!0,args:{target:t.target,mode:"virtual",propertyName:d,options:{name:d,type:"integer",nullable:!1,default:1}}})),t.ownColumns.push(new Ye.a({connection:this.connection,entityMetadata:t,nestedSetRight:!0,args:{target:t.target,mode:"virtual",propertyName:y,options:{name:y,type:"integer",nullable:!1,default:2}}}))}if(t.ownRelations=this.metadataArgsStorage.filterRelations(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.ownRelations.find((function(t){return t.propertyName===e.propertyName})):new Je({entityMetadata:t,args:e})})),t.relationIds=this.metadataArgsStorage.filterRelationIds(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationIds.find((function(t){return t.propertyName===e.propertyName})):new $e({entityMetadata:t,args:e})})),t.relationCounts=this.metadataArgsStorage.filterRelationCounts(t.inheritanceTree).map((function(e){return"entity-child"===t.tableType?t.parentEntityMetadata.relationCounts.find((function(t){return t.propertyName===e.propertyName})):new Ze({entityMetadata:t,args:e})})),t.ownListeners=this.metadataArgsStorage.filterListeners(t.inheritanceTree).map((function(e){return new ot({entityMetadata:t,args:e})})),t.checks=this.metadataArgsStorage.filterChecks(t.inheritanceTree).map((function(e){return new st({entityMetadata:t,args:e})})),this.connection.driver instanceof m.f&&(t.exclusions=this.metadataArgsStorage.filterExclusions(t.inheritanceTree).map((function(e){return new ut({entityMetadata:t,args:e})}))),this.connection.driver instanceof Ae.a){t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((function(e){return!e.unique})).map((function(e){return new Ge({entityMetadata:t,args:e})}));var v=this.metadataArgsStorage.filterIndices(t.inheritanceTree).filter((function(e){return e.unique})).map((function(e){return new it({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns}})}));(n=t.ownUniques).push.apply(n,r.f(v))}else t.ownIndices=this.metadataArgsStorage.filterIndices(t.inheritanceTree).map((function(e){return new Ge({entityMetadata:t,args:e})}));if(this.connection.driver instanceof m.e||this.connection.driver instanceof A.a||this.connection.driver instanceof W.a){var g=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((function(e){return new Ge({entityMetadata:t,args:{target:e.target,name:e.name,columns:e.columns,unique:!0,synchronize:!0}})}));(i=t.ownIndices).push.apply(i,r.f(g))}else{v=this.metadataArgsStorage.filterUniques(t.inheritanceTree).map((function(e){return new it({entityMetadata:t,args:e})}));(a=t.ownUniques).push.apply(a,r.f(v))}},e.prototype.createEmbeddedsRecursively=function(e,t){var n=this;return t.map((function(t){var r=new Xe({entityMetadata:e,args:t}),i=et.getInheritanceTree(r.type);return r.columns=n.metadataArgsStorage.filterColumns(i).map((function(t){return new Ye.a({connection:n.connection,entityMetadata:e,embeddedMetadata:r,args:t})})),r.relations=n.metadataArgsStorage.filterRelations(i).map((function(t){return new Je({entityMetadata:e,embeddedMetadata:r,args:t})})),r.listeners=n.metadataArgsStorage.filterListeners(i).map((function(t){return new ot({entityMetadata:e,embeddedMetadata:r,args:t})})),r.indices=n.metadataArgsStorage.filterIndices(i).map((function(t){return new Ge({entityMetadata:e,embeddedMetadata:r,args:t})})),r.uniques=n.metadataArgsStorage.filterUniques(i).map((function(t){return new it({entityMetadata:e,embeddedMetadata:r,args:t})})),r.relationIds=n.metadataArgsStorage.filterRelationIds(i).map((function(t){return new $e({entityMetadata:e,args:t})})),r.relationCounts=n.metadataArgsStorage.filterRelationCounts(i).map((function(t){return new Ze({entityMetadata:e,args:t})})),r.embeddeds=n.createEmbeddedsRecursively(e,n.metadataArgsStorage.filterEmbeddeds(i)),r.embeddeds.forEach((function(e){return e.parentEmbeddedMetadata=r})),e.allEmbeddeds.push(r),r}))},e.prototype.computeEntityMetadataStep2=function(e){var t=this;e.embeddeds.forEach((function(e){return e.build(t.connection)})),e.embeddeds.forEach((function(e){e.columnsFromTree.forEach((function(e){return e.build(t.connection)})),e.relationsFromTree.forEach((function(e){return e.build()}))})),e.ownColumns.forEach((function(e){return e.build(t.connection)})),e.ownRelations.forEach((function(e){return e.build()})),e.relations=e.embeddeds.reduce((function(e,t){return e.concat(t.relationsFromTree)}),e.ownRelations),e.eagerRelations=e.relations.filter((function(e){return e.isEager})),e.lazyRelations=e.relations.filter((function(e){return e.isLazy})),e.oneToOneRelations=e.relations.filter((function(e){return e.isOneToOne})),e.oneToManyRelations=e.relations.filter((function(e){return e.isOneToMany})),e.manyToOneRelations=e.relations.filter((function(e){return e.isManyToOne})),e.manyToManyRelations=e.relations.filter((function(e){return e.isManyToMany})),e.ownerOneToOneRelations=e.relations.filter((function(e){return e.isOneToOneOwner})),e.ownerManyToManyRelations=e.relations.filter((function(e){return e.isManyToManyOwner})),e.treeParentRelation=e.relations.find((function(e){return e.isTreeParent})),e.treeChildrenRelation=e.relations.find((function(e){return e.isTreeChildren})),e.columns=e.embeddeds.reduce((function(e,t){return e.concat(t.columnsFromTree)}),e.ownColumns),e.listeners=e.embeddeds.reduce((function(e,t){return e.concat(t.listenersFromTree)}),e.ownListeners),e.afterLoadListeners=e.listeners.filter((function(e){return"after-load"===e.type})),e.afterInsertListeners=e.listeners.filter((function(e){return"after-insert"===e.type})),e.afterUpdateListeners=e.listeners.filter((function(e){return"after-update"===e.type})),e.afterRemoveListeners=e.listeners.filter((function(e){return"after-remove"===e.type})),e.beforeInsertListeners=e.listeners.filter((function(e){return"before-insert"===e.type})),e.beforeUpdateListeners=e.listeners.filter((function(e){return"before-update"===e.type})),e.beforeRemoveListeners=e.listeners.filter((function(e){return"before-remove"===e.type})),e.indices=e.embeddeds.reduce((function(e,t){return e.concat(t.indicesFromTree)}),e.ownIndices),e.uniques=e.embeddeds.reduce((function(e,t){return e.concat(t.uniquesFromTree)}),e.ownUniques),e.primaryColumns=e.columns.filter((function(e){return e.isPrimary})),e.nonVirtualColumns=e.columns.filter((function(e){return!e.isVirtual})),e.ancestorColumns=e.columns.filter((function(e){return"ancestor"===e.closureType})),e.descendantColumns=e.columns.filter((function(e){return"descendant"===e.closureType})),e.hasMultiplePrimaryKeys=e.primaryColumns.length>1,e.generatedColumns=e.columns.filter((function(e){return e.isGenerated||e.isObjectId})),e.hasUUIDGeneratedColumns=e.columns.filter((function(e){return e.isGenerated||"uuid"===e.generationStrategy})).length>0,e.createDateColumn=e.columns.find((function(e){return e.isCreateDate})),e.updateDateColumn=e.columns.find((function(e){return e.isUpdateDate})),e.deleteDateColumn=e.columns.find((function(e){return e.isDeleteDate})),e.versionColumn=e.columns.find((function(e){return e.isVersion})),e.discriminatorColumn=e.columns.find((function(e){return e.isDiscriminator})),e.treeLevelColumn=e.columns.find((function(e){return e.isTreeLevel})),e.nestedSetLeftColumn=e.columns.find((function(e){return e.isNestedSetLeft})),e.nestedSetRightColumn=e.columns.find((function(e){return e.isNestedSetRight})),e.materializedPathColumn=e.columns.find((function(e){return e.isMaterializedPath})),e.objectIdColumn=e.columns.find((function(e){return e.isObjectId})),e.foreignKeys.forEach((function(e){return e.build(t.connection.namingStrategy)})),e.propertiesMap=e.createPropertiesMap(),e.relationIds.forEach((function(e){return e.build()})),e.relationCounts.forEach((function(e){return e.build()})),e.embeddeds.forEach((function(e){e.relationIdsFromTree.forEach((function(e){return e.build()})),e.relationCountsFromTree.forEach((function(e){return e.build()}))}))},e.prototype.computeInverseProperties=function(e,t){e.relations.forEach((function(n){var r=t.find((function(e){return e.target===n.type||"string"===typeof n.type&&e.targetName===n.type}));if(!r)throw new Error("Entity metadata for "+e.name+"#"+n.propertyPath+" was not found. Check if you specified a correct entity object and if it's connected in the connection options.");n.inverseEntityMetadata=r,n.inverseSidePropertyPath=n.buildInverseSidePropertyPath(),n.inverseRelation=r.relations.find((function(e){return e.propertyPath===n.inverseSidePropertyPath}))}))},e.prototype.createKeysForTableInheritance=function(e){e.indices.push(new Ge({entityMetadata:e,columns:[e.discriminatorColumn],args:{target:e.target,unique:!1}}))},e}(),lt=function(){function e(){this.tables=[],this.trees=[],this.entityRepositories=[],this.transactionEntityManagers=[],this.transactionRepositories=[],this.namingStrategies=[],this.entitySubscribers=[],this.indices=[],this.uniques=[],this.checks=[],this.exclusions=[],this.columns=[],this.generations=[],this.relations=[],this.joinColumns=[],this.joinTables=[],this.entityListeners=[],this.relationCounts=[],this.relationIds=[],this.embeddeds=[],this.inheritances=[],this.discriminatorValues=[]}return e.prototype.filterTables=function(e){return this.filterByTarget(this.tables,e)},e.prototype.filterColumns=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.columns,e)},e.prototype.findGenerated=function(e,t){return this.generations.find((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.propertyName===t}))},e.prototype.findTree=function(e){return this.trees.find((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterRelations=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relations,e)},e.prototype.filterRelationIds=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationIds,e)},e.prototype.filterRelationCounts=function(e){return this.filterByTargetAndWithoutDuplicateProperties(this.relationCounts,e)},e.prototype.filterIndices=function(e){return this.indices.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterUniques=function(e){return this.uniques.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterChecks=function(e){return this.checks.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterExclusions=function(e){return this.exclusions.filter((function(t){return Array.isArray(e)?-1!==e.indexOf(t.target):t.target===e}))},e.prototype.filterListeners=function(e){return this.filterByTarget(this.entityListeners,e)},e.prototype.filterEmbeddeds=function(e){return this.filterByTargetAndWithoutDuplicateEmbeddedProperties(this.embeddeds,e)},e.prototype.findJoinTable=function(e,t){return this.joinTables.find((function(n){return n.target===e&&n.propertyName===t}))},e.prototype.filterJoinColumns=function(e,t){return this.joinColumns.filter((function(n){return n.target===e&&n.propertyName===t}))},e.prototype.filterSubscribers=function(e){return this.filterByTarget(this.entitySubscribers,e)},e.prototype.filterNamingStrategies=function(e){return this.filterByTarget(this.namingStrategies,e)},e.prototype.filterTransactionEntityManagers=function(e,t){return this.transactionEntityManagers.filter((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t}))},e.prototype.filterTransactionRepository=function(e,t){return this.transactionRepositories.filter((function(n){return(Array.isArray(e)?-1!==e.indexOf(n.target):n.target===e)&&n.methodName===t}))},e.prototype.filterSingleTableChildren=function(e){return this.tables.filter((function(t){return t.target instanceof Function&&e instanceof Function&&et.isInherited(t.target,e)&&"entity-child"===t.type}))},e.prototype.findInheritanceType=function(e){return this.inheritances.find((function(t){return t.target===e}))},e.prototype.findDiscriminatorValue=function(e){return this.discriminatorValues.find((function(t){return t.target===e}))},e.prototype.filterByTarget=function(e,t){return e.filter((function(e){return Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t}))},e.prototype.filterByTargetAndWithoutDuplicateProperties=function(e,t){var n=[];return e.forEach((function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((function(t){return t.propertyName===e.propertyName}))||n.push(e))})),n},e.prototype.filterByTargetAndWithoutDuplicateEmbeddedProperties=function(e,t){var n=[];return e.forEach((function(e){(Array.isArray(t)?-1!==t.indexOf(e.target):e.target===t)&&(n.find((function(t){return t.prefix===e.prefix&&t.propertyName===e.propertyName}))||n.push(e))})),n},e}(),ht=function(){function e(){}return e.prototype.transform=function(e){var t=new lt;return e.forEach((function(e){var n=e.options,r={target:n.target||n.name,name:n.tableName,database:n.database,schema:n.schema,type:n.type||"regular",orderBy:n.orderBy,synchronize:n.synchronize,expression:n.expression};t.tables.push(r),Object.keys(n.columns).forEach((function(e){var r=n.columns[e],i="regular";r.createDate&&(i="createDate"),r.updateDate&&(i="updateDate"),r.deleteDate&&(i="deleteDate"),r.version&&(i="version"),r.treeChildrenCount&&(i="treeChildrenCount"),r.treeLevel&&(i="treeLevel"),r.objectId&&(i="objectId");var a={target:n.target||n.name,mode:i,propertyName:e,options:{type:r.type,name:r.objectId?"_id":r.name,length:r.length,width:r.width,nullable:r.nullable,readonly:r.readonly,update:r.update,select:r.select,insert:r.insert,primary:r.primary,unique:r.unique,comment:r.comment,default:r.default,onUpdate:r.onUpdate,precision:r.precision,scale:r.scale,zerofill:r.zerofill,unsigned:r.unsigned,charset:r.charset,collation:r.collation,enum:r.enum,asExpression:r.asExpression,generatedType:r.generatedType,hstoreType:r.hstoreType,array:r.array,transformer:r.transformer,spatialFeatureType:r.spatialFeatureType,srid:r.srid}};if(t.columns.push(a),r.generated){var o={target:n.target||n.name,propertyName:e,strategy:"string"===typeof r.generated?r.generated:"increment"};t.generations.push(o)}r.unique&&t.uniques.push({target:n.target||n.name,columns:[e]})})),n.relations&&Object.keys(n.relations).forEach((function(e){var r=n.relations[e],i={target:n.target||n.name,propertyName:e,relationType:r.type,isLazy:r.lazy||!1,type:r.target,inverseSideProperty:r.inverseSide,isTreeParent:r.treeParent,isTreeChildren:r.treeChildren,options:{eager:r.eager||!1,cascade:r.cascade,nullable:r.nullable,onDelete:r.onDelete,onUpdate:r.onUpdate,deferrable:r.deferrable,primary:r.primary,persistence:r.persistence}};if(t.relations.push(i),r.joinColumn)if("boolean"===typeof r.joinColumn){var a={target:n.target||n.name,propertyName:e};t.joinColumns.push(a)}else{a={target:n.target||n.name,propertyName:e,name:r.joinColumn.name,referencedColumnName:r.joinColumn.referencedColumnName};t.joinColumns.push(a)}if(r.joinTable)if("boolean"===typeof r.joinTable){var o={target:n.target||n.name,propertyName:e};t.joinTables.push(o)}else{o={target:n.target||n.name,propertyName:e,name:r.joinTable.name,database:r.joinTable.database,schema:r.joinTable.schema,joinColumns:r.joinTable.joinColumn?[r.joinTable.joinColumn]:r.joinTable.joinColumns,inverseJoinColumns:r.joinTable.inverseJoinColumn?[r.joinTable.inverseJoinColumn]:r.joinTable.inverseJoinColumns};t.joinTables.push(o)}})),n.indices&&n.indices.forEach((function(e){var r={target:n.target||n.name,name:e.name,unique:!0===e.unique,spatial:!0===e.spatial,fulltext:!0===e.fulltext,parser:e.parser,synchronize:!1!==e.synchronize,where:e.where,sparse:e.sparse,columns:e.columns};t.indices.push(r)})),n.uniques&&n.uniques.forEach((function(e){var r={target:n.target||n.name,name:e.name,columns:e.columns};t.uniques.push(r)})),n.checks&&n.checks.forEach((function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.checks.push(r)})),n.exclusions&&n.exclusions.forEach((function(e){var r={target:n.target||n.name,name:e.name,expression:e.expression};t.exclusions.push(r)}))})),t},e}(),pt=n(46),ft=function(){function e(e){this.connection=e}return e.prototype.buildMigrations=function(e){var t=r.e(J.a.splitClassesAndStrings(e),2),n=t[0],i=t[1];return r.f(n,Qe(this.connection.logger,i)).map((function(e){return We(e)}))},e.prototype.buildSubscribers=function(e){var t=r.e(J.a.splitClassesAndStrings(e||[]),2),n=t[0],i=t[1],a=r.f(n,Qe(this.connection.logger,i));return Lt().filterSubscribers(a).map((function(e){return We(e.target)}))},e.prototype.buildEntityMetadatas=function(e){var t=r.e(J.a.splitClassesAndStrings(e||[]),2),n=t[0],i=t[1],a=n.filter((function(e){return e instanceof pt.a===!1})),o=n.filter((function(e){return e instanceof pt.a})),s=r.f(a,Qe(this.connection.logger,i));s.forEach((function(e){e instanceof pt.a&&(o.push(e),s.slice(s.indexOf(e),1))}));var u=new ct(this.connection,Lt()).build(s),c=(new ht).transform(o),l=new ct(this.connection,c).build();return r.f(u,l)},e}(),dt=n(54),mt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");console.log("query: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query failed: "+i),console.log("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");console.log("query is slow: "+i),console.log("execution time: "+e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&console.log(e)},e.prototype.logMigration=function(e,t){console.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&console.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&console.info(t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(t)}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),yt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");Ve.a.logInfo("query:",Ve.a.highlightSql(r))}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");Ve.a.logError("query failed:",Ve.a.highlightSql(i)),Ve.a.logError("error:",e)}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");Ve.a.logWarn("query is slow:",Ve.a.highlightSql(i)),Ve.a.logWarn("execution time:",e)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&Ve.a.log(e)},e.prototype.logMigration=function(e,t){Ve.a.log(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&Ve.a.log(t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&Ve.a.logInfo("INFO:",t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&console.warn(Ve.a.warn(t))}},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),vt=function(){function e(e){this.options=e}return e.prototype.logQuery=function(e,t,n){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("query")){var r=e+(t&&t.length?" -- PARAMETERS: "+this.stringifyParams(t):"");this.write("[QUERY]: "+r)}},e.prototype.logQueryError=function(e,t,n,r){if("all"===this.options||!0===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("error")){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");this.write(["[FAILED QUERY]: "+i,"[QUERY ERROR]: "+e])}},e.prototype.logQuerySlow=function(e,t,n,r){var i=t+(n&&n.length?" -- PARAMETERS: "+this.stringifyParams(n):"");this.write("[SLOW QUERY: "+e+" ms]: "+i)},e.prototype.logSchemaBuild=function(e,t){("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("schema"))&&this.write(e)},e.prototype.logMigration=function(e,t){this.write(e)},e.prototype.log=function(e,t,n){switch(e){case"log":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("log"))&&this.write("[LOG]: "+t);break;case"info":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("info"))&&this.write("[INFO]: "+t);break;case"warn":("all"===this.options||Array.isArray(this.options)&&-1!==this.options.indexOf("warn"))&&this.write("[WARN]: "+t)}},e.prototype.write=function(e){e=Array.isArray(e)?e:[e];var t=Ve.a.load("app-root-path").path;e=e.map((function(e){return"["+(new Date).toISOString()+"]"+e})),Ve.a.appendFileSync(t+"/ormlogs.log",e.join("\r\n")+"\r\n")},e.prototype.stringifyParams=function(e){try{return JSON.stringify(e)}catch(t){return e}},e}(),gt=function(){function e(){this.debug=Ve.a.load("debug"),this.debugQueryLog=this.debug("typeorm:query:log"),this.debugQueryError=this.debug("typeorm:query:error"),this.debugQuerySlow=this.debug("typeorm:query:slow"),this.debugSchemaBuild=this.debug("typeorm:schema"),this.debugMigration=this.debug("typeorm:migration"),this.debugLog=this.debug("typeorm:log"),this.debugInfo=this.debug("typeorm:info"),this.debugWarn=this.debug("typeorm:warn")}return e.prototype.logQuery=function(e,t,n){this.debugQueryLog.enabled&&(this.debugQueryLog(Ve.a.highlightSql(e)+";"),t&&t.length&&this.debugQueryLog("parameters:",t))},e.prototype.logQueryError=function(e,t,n,r){this.debugQueryError.enabled&&(this.debugQueryError(Ve.a.highlightSql(t)+";"),n&&n.length&&this.debugQueryError("parameters:",n),this.debugQueryError("error: ",e))},e.prototype.logQuerySlow=function(e,t,n,r){this.debugQuerySlow.enabled&&(this.debugQuerySlow(Ve.a.highlightSql(t)+";"),n&&n.length&&this.debugQuerySlow("parameters:",n),this.debugQuerySlow("execution time:",e))},e.prototype.logSchemaBuild=function(e,t){this.debugSchemaBuild.enabled&&this.debugSchemaBuild(e)},e.prototype.logMigration=function(e,t){this.debugMigration.enabled&&this.debugMigration(e)},e.prototype.log=function(e,t,n){switch(e){case"log":this.debugLog.enabled&&this.debugLog(t);break;case"info":this.debugInfo.enabled&&this.debugInfo(t);break;case"warn":this.debugWarn.enabled&&this.debugWarn(t)}},e}(),bt=function(){function e(){}return e.prototype.create=function(e,t){if(e instanceof Object)return e;if(e)switch(e){case"simple-console":return new mt(t);case"file":return new vt(t);case"advanced-console":return new yt(t);case"debug":return new gt}return new yt(t)},e}(),Et=function(){function e(e,t){this.connection=e,this.clientType=t,this.redis=this.loadRedis()}return e.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){if(e=this.connection.options.cache,"redis"===this.clientType)e&&e.options?this.client=this.redis.createClient(e.options):this.client=this.redis.createClient();else if("ioredis"===this.clientType)e&&e.options?this.client=new this.redis(e.options):this.client=new this.redis;else if("ioredis/cluster"===this.clientType)if(e&&e.options&&Array.isArray(e.options))this.client=new this.redis.Cluster(e.options);else{if(!(e&&e.options&&e.options.startupNodes))throw new Error("options.startupNodes required for "+this.clientType+".");this.client=new this.redis.Cluster(e.options.startupNodes,e.options.options)}return[2]}))}))},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.client.quit((function(r,i){if(r)return n(r);t(),e.client=void 0}))}))]}))}))},e.prototype.synchronize=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2]}))}))},e.prototype.getFromCache=function(e,t){var n=this;return new Promise((function(t,r){e.identifier?n.client.get(e.identifier,(function(e,n){if(e)return r(e);t(JSON.parse(n))})):e.query?n.client.get(e.query,(function(e,n){if(e)return r(e);t(JSON.parse(n))})):t(void 0)}))},e.prototype.isExpired=function(e){return e.time+e.duration<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return r.b(this,void 0,void 0,(function(){var t=this;return r.d(this,(function(n){return[2,new Promise((function(n,r){e.identifier?t.client.set(e.identifier,JSON.stringify(e),"PX",e.duration,(function(e,t){if(e)return r(e);n()})):e.query&&t.client.set(e.query,JSON.stringify(e),"PX",e.duration,(function(e,t){if(e)return r(e);n()}))}))]}))}))},e.prototype.clear=function(e){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.client.flushdb((function(e,r){if(e)return n(e);t()}))}))]}))}))},e.prototype.remove=function(e,t){return r.b(this,void 0,void 0,(function(){var t=this;return r.d(this,(function(n){switch(n.label){case 0:return[4,Promise.all(e.map((function(e){return t.deleteKey(e)})))];case 1:return n.sent(),[2]}}))}))},e.prototype.deleteKey=function(e){var t=this;return new Promise((function(n,r){t.client.del(e,(function(e,t){if(e)return r(e);n()}))}))},e.prototype.loadRedis=function(){try{return Ve.a.load(this.clientType)}catch(e){throw new Error("Cannot use cache because "+this.clientType+' is not installed. Please run "npm i '+this.clientType+' --save".')}},e}(),Tt=function(){function e(e){this.connection=e;var t=this.connection.driver.options,n=("object"===typeof this.connection.options.cache?this.connection.options.cache:{}).tableName||"query-result-cache";this.queryResultCacheTable=this.connection.driver.buildTableName(n,t.schema,t.database)}return e.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2]}))}))},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2]}))}))},e.prototype.synchronize=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return e=this.getQueryRunner(e),t=this.connection.driver,[4,e.hasTable(this.queryResultCacheTable)];case 1:return n.sent()?[2]:[4,e.createTable(new o.a({name:this.queryResultCacheTable,columns:[{name:"id",isPrimary:!0,isNullable:!1,type:t.normalizeType({type:t.mappedDataTypes.cacheId}),generationStrategy:"increment",isGenerated:!0},{name:"identifier",type:t.normalizeType({type:t.mappedDataTypes.cacheIdentifier}),isNullable:!0},{name:"time",type:t.normalizeType({type:t.mappedDataTypes.cacheTime}),isPrimary:!1,isNullable:!1},{name:"duration",type:t.normalizeType({type:t.mappedDataTypes.cacheDuration}),isPrimary:!1,isNullable:!1},{name:"query",type:t.normalizeType({type:t.mappedDataTypes.cacheQuery}),isPrimary:!1,isNullable:!1},{name:"result",type:t.normalizeType({type:t.mappedDataTypes.cacheResult}),isNullable:!1}]}))];case 2:return n.sent(),[2]}}))}))},e.prototype.getFromCache=function(e,t){t=this.getQueryRunner(t);var n=this.connection.createQueryBuilder(t).select().from(this.queryResultCacheTable,"cache");return e.identifier?n.where(n.escape("cache")+"."+n.escape("identifier")+" = :identifier").setParameters({identifier:this.connection.driver instanceof f.a?new d.a(e.identifier,"nvarchar"):e.identifier}).getRawOne():e.query?this.connection.driver instanceof ne.a?n.where("dbms_lob.compare("+n.escape("cache")+"."+n.escape("query")+", :query) = 0",{query:e.query}).getRawOne():n.where(n.escape("cache")+"."+n.escape("query")+" = :query").setParameters({query:this.connection.driver instanceof f.a?new d.a(e.query,"nvarchar"):e.query}).getRawOne():Promise.resolve(void 0)},e.prototype.isExpired=function(e){var t="string"===typeof e.duration?parseInt(e.duration):e.duration;return("string"===typeof e.time?parseInt(e.time):e.time)+t<(new Date).getTime()},e.prototype.storeInCache=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a;return r.d(this,(function(r){switch(r.label){case 0:return n=this.getQueryRunner(n),i=e,this.connection.driver instanceof f.a&&(i={identifier:new d.a(e.identifier,"nvarchar"),time:new d.a(e.time,"bigint"),duration:new d.a(e.duration,"int"),query:new d.a(e.query,"nvarchar"),result:new d.a(e.result,"nvarchar")}),t&&t.identifier?((a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i)).where(a.escape("identifier")+" = :condition",{condition:i.identifier}),[4,a.execute()]):[3,2];case 1:return r.sent(),[3,6];case 2:return t&&t.query?(a=n.manager.createQueryBuilder().update(this.queryResultCacheTable).set(i),this.connection.driver instanceof ne.a?a.where('dbms_lob.compare("query", :condition) = 0',{condition:i.query}):a.where(a.escape("query")+" = :condition",{condition:i.query}),[4,a.execute()]):[3,4];case 3:return r.sent(),[3,6];case 4:return[4,n.manager.createQueryBuilder().insert().into(this.queryResultCacheTable).values(i).execute()];case 5:r.sent(),r.label=6;case 6:return[2]}}))}))},e.prototype.clear=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){return[2,this.getQueryRunner(e).clearTable(this.queryResultCacheTable)]}))}))},e.prototype.remove=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,Promise.all(e.map((function(e){var r=n.getQueryRunner(t).manager.createQueryBuilder();return r.delete().from(n.queryResultCacheTable).where(r.escape("identifier")+" = :identifier",{identifier:e}).execute()})))];case 1:return r.sent(),[2]}}))}))},e.prototype.getQueryRunner=function(e){return e||this.connection.createQueryRunner("master")},e}(),Nt=function(){function e(e){this.connection=e}return e.prototype.create=function(){if(!this.connection.options.cache)throw new Error("To use cache you need to enable it in connection options by setting cache: true or providing some caching options. Example: { host: ..., username: ..., cache: true }");var e=this.connection.options.cache;return e.provider&&"function"===typeof e.provider?e.provider(this.connection):"redis"===e.type||"ioredis"===e.type||"ioredis/cluster"===e.type?new Et(this.connection,e.type):new Tt(this.connection)},e}(),wt=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n){return n&&n.isReleased&&(n=void 0),e.isManyToOne||e.isOneToOneOwner?this.loadManyToOneOrOneToOneOwner(e,t,n):e.isOneToMany||e.isOneToOneNotOwner?this.loadOneToManyOrOneToOneNotOwner(e,t,n):e.isManyToManyOwner?this.loadManyToManyOwner(e,t,n):this.loadManyToManyNotOwner(e,t,n)},e.prototype.loadManyToOneOrOneToOneOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.entityMetadata.primaryColumns,a=(e.isOwning?e.joinColumns:e.inverseRelation.joinColumns).map((function(t){return e.entityMetadata.name+"."+t.propertyName+" = "+e.propertyName+"."+t.referencedColumn.propertyName})).join(" AND "),o=e.entityMetadata.name,s=this.connection.createQueryBuilder(n).select(e.propertyName).from(e.type,e.propertyName).innerJoin(e.entityMetadata.target,o,a);if(1===i.length)s.where(o+"."+i[0].propertyPath+" IN (:..."+o+"_"+i[0].propertyName+")"),s.setParameter(o+"_"+i[0].propertyName,r.map((function(e){return i[0].getEntityValue(e)})));else{var u=r.map((function(e,t){return i.map((function(n,r){var i=o+"_entity_"+t+"_"+r;return s.setParameter(i,n.getEntityValue(e)),o+"."+n.propertyPath+" = :"+i})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ");s.where(u)}return s.getMany()},e.prototype.loadOneToManyOrOneToOneNotOwner=function(e,t,n){var r=Array.isArray(t)?t:[t],i=e.propertyName,a=e.inverseRelation.joinColumns,o=this.connection.createQueryBuilder(n).select(i).from(e.inverseRelation.entityMetadata.target,i);if(1===a.length)o.where(i+"."+a[0].propertyPath+" IN (:..."+i+"_"+a[0].propertyName+")"),o.setParameter(i+"_"+a[0].propertyName,r.map((function(e){return a[0].referencedColumn.getEntityValue(e)})));else{var s=r.map((function(e,t){return a.map((function(n,r){var a=i+"_entity_"+t+"_"+r;return o.setParameter(a,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+a})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ");o.where(s)}return o.getMany()},e.prototype.loadManyToManyOwner=function(e,t,n){var i=Array.isArray(t)?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.joinColumns.map((function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"})),u=e.inverseJoinColumns.map((function(e){return o+"."+e.propertyName+"="+a+"."+e.referencedColumn.propertyName})),c=e.joinColumns.reduce((function(e,t){return e[t.propertyName]=i.map((function(e){return t.referencedColumn.getEntityValue(e)})),e}),{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,r.f(s,u).join(" AND ")).setParameters(c).getMany()},e.prototype.loadManyToManyNotOwner=function(e,t,n){var i=Array.isArray(t)?t:[t],a=e.propertyName,o=e.junctionEntityMetadata.tableName,s=e.inverseRelation.joinColumns.map((function(e){return o+"."+e.propertyName+" = "+a+"."+e.referencedColumn.propertyName})),u=e.inverseRelation.inverseJoinColumns.map((function(e){return o+"."+e.propertyName+" IN (:..."+e.propertyName+")"})),c=e.inverseRelation.inverseJoinColumns.reduce((function(e,t){return e[t.propertyName]=i.map((function(e){return t.referencedColumn.getEntityValue(e)})),e}),{});return this.connection.createQueryBuilder(n).select(a).from(e.type,a).innerJoin(o,o,r.f(s,u).join(" AND ")).setParameters(c).getMany()},e.prototype.enableLazyLoad=function(e,t,n){var r=this,i="__"+e.propertyName+"__",a="__promise_"+e.propertyName+"__",o="__has_"+e.propertyName+"__",s=function(e,t){return e[i]=t,e[o]=!0,delete e[a],t},u=function(e,t){return delete e[o],delete e[i],e[a]=t,t.then((function(n){return e[a]===t?s(e,n):n})),t};Object.defineProperty(t,e.propertyName,{get:function(){if(!0===this[o]||void 0!==this[i])return Promise.resolve(this[i]);if(this[a])return this[a];var t=r.load(e,this,n).then((function(t){return e.isOneToOne||e.isManyToOne?t[0]:t}));return u(this,t)},set:function(e){e instanceof Promise?u(this,e):s(this,e)},configurable:!0})},e}(),At=function(){function e(e){this.connection=e}return e.prototype.load=function(e,t,n,i){return r.b(this,void 0,void 0,(function(){var a,o,s,u;return r.d(this,(function(r){if(e instanceof Je)a=e,o=Array.isArray(t)?t:[t],s=Array.isArray(n)?n:n?[n]:void 0;else{if(u=this.connection.getMetadata(e),!(a=u.findRelationWithPropertyPath(t)))throw new Error('Relation "'+a+'" was not found in "'+u.name+'".');o=Array.isArray(n)?n:[n],s=Array.isArray(i)?i:i?[i]:void 0}return a.isManyToMany?[2,this.loadForManyToMany(a,o,s)]:a.isManyToOne||a.isOneToOneOwner?[2,this.loadForManyToOneAndOneToOneOwner(a,o,s)]:[2,this.loadForOneToManyAndOneToOneNotOwner(a,o,s)]}))}))},e.prototype.loadManyToManyRelationIdsAndGroup=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s,u,c;return r.d(this,(function(r){switch(r.label){case 0:return i=e.isManyToMany||e.isOneToMany,a=Array.isArray(t)?t:[t],n?[3,2]:[4,this.connection.relationLoader.load(e,t)];case 1:if(!(n=r.sent()).length)return[2,a.map((function(e){return{entity:e,related:i?[]:void 0}}))];r.label=2;case 2:return[4,this.load(e,t,n)];case 3:return o=r.sent(),s=Array.isArray(n)?n:[n],e.isManyToManyOwner?(u=e.junctionEntityMetadata.inverseColumns.map((function(e){return e.referencedColumn})),c=e.junctionEntityMetadata.ownerColumns.map((function(e){return e.referencedColumn}))):e.isManyToManyNotOwner?(u=e.junctionEntityMetadata.ownerColumns.map((function(e){return e.referencedColumn})),c=e.junctionEntityMetadata.inverseColumns.map((function(e){return e.referencedColumn}))):e.isManyToOne||e.isOneToOneOwner?(u=e.joinColumns.map((function(e){return e.referencedColumn})),c=e.entityMetadata.primaryColumns):(e.isOneToMany||e.isOneToOneNotOwner)&&(u=e.inverseRelation.entityMetadata.primaryColumns,c=e.inverseRelation.joinColumns.map((function(e){return e.referencedColumn}))),[2,a.map((function(t){var n={entity:t,related:i?[]:void 0};return o.forEach((function(r){c.every((function(e){return e.getEntityValue(t)===r[e.entityMetadata.name+"_"+e.propertyPath.replace(".","_")]}))&&s.forEach((function(t){u.every((function(n){return n.getEntityValue(t)===r[n.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+n.propertyPath.replace(".","_")]}))&&(i?n.related.push(t):n.related=t)}))})),n}))]}}))}))},e.prototype.loadForManyToMany=function(e,t,n){var r=e.junctionEntityMetadata,i=r.name,a=e.isOwning?r.ownerColumns:r.inverseColumns,o=e.isOwning?r.inverseColumns:r.ownerColumns,s=this.connection.createQueryBuilder();r.ownerColumns.forEach((function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+e.propertyPath,t)})),r.inverseColumns.forEach((function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");s.addSelect(i+"."+t.propertyPath,n)}));var u="";1===a.length?(s.setParameter("values1",t.map((function(e){return a[0].referencedColumn.getEntityValue(e)}))),u=i+"."+a[0].propertyPath+" IN (:...values1)"):u="("+t.map((function(e,t){return a.map((function(n){var r="entity1_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ")+")";var c="";return n&&(1===o.length?(s.setParameter("values2",n.map((function(e){return o[0].referencedColumn.getEntityValue(e)}))),c=i+"."+o[0].propertyPath+" IN (:...values2)"):c="("+n.map((function(e,t){return o.map((function(n){var r="entity2_"+t+"_"+n.propertyName;return s.setParameter(r,n.referencedColumn.getEntityValue(e)),i+"."+n.propertyPath+" = :"+r})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR ")+")"),s.from(r.target,i).where(u+(c?" AND "+c:"")).getRawMany()},e.prototype.loadForManyToOneAndOneToOneOwner=function(e,t,n){var r=e.entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((function(e){var t=e.entityMetadata.name+"_"+e.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)})),e.joinColumns.forEach((function(t){var n=t.referencedColumn.entityMetadata.name+"_"+e.propertyPath.replace(".","_")+"_"+t.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)}));var a="";return 1===e.entityMetadata.primaryColumns.length?(i.setParameter("values",t.map((function(t){return e.entityMetadata.primaryColumns[0].getEntityValue(t)}))),a=r+"."+e.entityMetadata.primaryColumns[0].propertyPath+" IN (:...values)"):a=t.map((function(t,n){return e.entityMetadata.primaryColumns.map((function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e.prototype.loadForOneToManyAndOneToOneNotOwner=function(e,t,n){var r=(e=e.inverseRelation).entityMetadata.targetName,i=this.connection.createQueryBuilder();e.entityMetadata.primaryColumns.forEach((function(t){var n=t.entityMetadata.name+"_"+e.inverseRelation.propertyPath.replace(".","_")+"_"+t.propertyPath.replace(".","_");i.addSelect(r+"."+t.propertyPath,n)})),e.joinColumns.forEach((function(e){var t=e.referencedColumn.entityMetadata.name+"_"+e.referencedColumn.propertyPath.replace(".","_");i.addSelect(r+"."+e.propertyPath,t)}));var a="";return 1===e.joinColumns.length?(i.setParameter("values",t.map((function(t){return e.joinColumns[0].referencedColumn.getEntityValue(t)}))),a=r+"."+e.joinColumns[0].propertyPath+" IN (:...values)"):a=t.map((function(t,n){return e.joinColumns.map((function(e,a){var o="entity"+n+"_"+a;return i.setParameter(o,e.referencedColumn.getEntityValue(t)),r+"."+e.propertyPath+" = :"+o})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR "),i.from(e.entityMetadata.target,r).where(a).getRawMany()},e}(),Ct=n(20),St=function(){function e(e){this.migrations=[],this.subscribers=[],this.entityMetadatas=[],this.name=e.name||"default",this.options=e,this.logger=(new bt).create(this.options.logger,this.options.logging),this.driver=(new Fe).create(this),this.manager=this.createEntityManager(),this.namingStrategy=e.namingStrategy||new s,this.queryResultCache=e.cache?new Nt(this).create():void 0,this.relationLoader=new wt(this),this.relationIdLoader=new At(this),this.isConnected=!1}return Object.defineProperty(e.prototype,"mongoManager",{get:function(){if(!(this.manager instanceof m.b))throw new Error("MongoEntityManager is only available for MongoDB databases.");return this.manager},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"sqljsManager",{get:function(){if(!(this.manager instanceof Ee))throw new Error("SqljsEntityManager is only available for Sqljs databases.");return this.manager},enumerable:!0,configurable:!0}),e.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:if(this.isConnected)throw new c(this.name);return[4,this.driver.connect()];case 1:return t.sent(),this.queryResultCache?[4,this.queryResultCache.connect()]:[3,3];case 2:t.sent(),t.label=3;case 3:ge.a.assign(this,{isConnected:!0}),t.label=4;case 4:return t.trys.push([4,12,,14]),this.buildMetadatas(),[4,this.driver.afterConnect()];case 5:return t.sent(),this.options.dropSchema?[4,this.dropDatabase()]:[3,7];case 6:t.sent(),t.label=7;case 7:return this.options.synchronize?[4,this.synchronize()]:[3,9];case 8:t.sent(),t.label=9;case 9:return this.options.migrationsRun?[4,this.runMigrations({transaction:this.options.migrationsTransactionMode})]:[3,11];case 10:t.sent(),t.label=11;case 11:return[3,14];case 12:return e=t.sent(),[4,this.close()];case 13:throw t.sent(),e;case 14:return[2,this]}}))}))},e.prototype.close=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isConnected)throw new u(this.name);return[4,this.driver.disconnect()];case 1:return e.sent(),this.queryResultCache?[4,this.queryResultCache.disconnect()]:[3,3];case 2:e.sent(),e.label=3;case 3:return ge.a.assign(this,{isConnected:!1}),[2]}}))}))},e.prototype.synchronize=function(e){return void 0===e&&(e=!1),r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:if(!this.isConnected)throw new u(this.name);return e?[4,this.dropDatabase()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[4,this.driver.createSchemaBuilder().build()];case 3:return t.sent(),[2]}}))}))},e.prototype.dropDatabase=function(){return r.b(this,void 0,void 0,(function(){var e,t;return r.d(this,(function(n){switch(n.label){case 0:e=this.createQueryRunner("master"),n.label=1;case 1:return n.trys.push([1,,6,8]),this.driver instanceof f.a||this.driver instanceof m.e||this.driver instanceof A.a?(t=this.driver.database?[this.driver.database]:[],this.entityMetadatas.forEach((function(e){e.database&&-1===t.indexOf(e.database)&&t.push(e.database)})),[4,p.a.runInSequence(t,(function(t){return e.clearDatabase(t)}))]):[3,3];case 2:return n.sent(),[3,5];case 3:return[4,e.clearDatabase()];case 4:n.sent(),n.label=5;case 5:return[3,8];case 6:return[4,e.release()];case 7:return n.sent(),[7];case 8:return[2]}}))}))},e.prototype.runMigrations=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new u(this.name);return(t=new y(this)).transaction=e&&e.transaction||"all",[4,t.executePendingMigrations()];case 1:return[2,n.sent()]}}))}))},e.prototype.undoLastMigration=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:if(!this.isConnected)throw new u(this.name);return(t=new y(this)).transaction=e&&e.transaction||"all",[4,t.undoLastMigration()];case 1:return n.sent(),[2]}}))}))},e.prototype.showMigrations=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isConnected)throw new u(this.name);return[4,new y(this).showMigrations()];case 1:return[2,e.sent()]}}))}))},e.prototype.hasMetadata=function(e){return!!this.findMetadata(e)},e.prototype.getMetadata=function(e){var t=this.findMetadata(e);if(!t)throw new l(e);return t},e.prototype.getRepository=function(e){return this.manager.getRepository(e)},e.prototype.getTreeRepository=function(e){return this.manager.getTreeRepository(e)},e.prototype.getMongoRepository=function(e){if(!(this.driver instanceof m.a))throw new Error("You can use getMongoRepository only for MongoDB connections.");return this.manager.getRepository(e)},e.prototype.getCustomRepository=function(e){return this.manager.getCustomRepository(e)},e.prototype.transaction=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(n){return[2,this.manager.transaction(e,t)]}))}))},e.prototype.query=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i;return r.d(this,(function(r){switch(r.label){case 0:if(this instanceof m.b)throw new Error("Queries aren't supported by MongoDB.");if(n&&n.isReleased)throw new S;i=n||this.createQueryRunner("master"),r.label=1;case 1:return r.trys.push([1,,3,6]),[4,i.query(e,t)];case 2:return[2,r.sent()];case 3:return n?[3,5]:[4,i.release()];case 4:r.sent(),r.label=5;case 5:return[7];case 6:return[2]}}))}))},e.prototype.createQueryBuilder=function(e,t,n){if(this instanceof m.b)throw new Error("Query Builder is not supported by MongoDB.");if(t){var r=this.getMetadata(e);return new dt.SelectQueryBuilder(this,n).select(t).from(r.target,t)}return new dt.SelectQueryBuilder(this,e)},e.prototype.createQueryRunner=function(e){void 0===e&&(e="master");var t=this.driver.createQueryRunner(e),n=this.createEntityManager(t);return Object.assign(t,{manager:n}),t},e.prototype.getManyToManyMetadata=function(e,t){var n=this.getMetadata(e).findRelationWithPropertyPath(t);if(!n)throw new Error('Relation "'+t+'" was not found in '+e+" entity.");if(!n.isManyToMany)throw new Error('Relation "'+e+"#"+t+'" does not have a many-to-many relationship.You can use this method only on many-to-many relations.');return n.junctionEntityMetadata},e.prototype.createEntityManager=function(e){return(new Ne).create(this,e)},e.prototype.findMetadata=function(e){return this.entityMetadatas.find((function(t){return t.target===e||(e instanceof pt.a?t.name===e.options.name:"string"===typeof e&&(-1!==e.indexOf(".")?t.tablePath===e:t.name===e||t.tableName===e))}))},e.prototype.buildMetadatas=function(){var e=new ft(this),t=new C,n=e.buildSubscribers(this.options.subscribers||[]);ge.a.assign(this,{subscribers:n});var r=e.buildEntityMetadatas(this.options.entities||[]);ge.a.assign(this,{entityMetadatas:r});var i=e.buildMigrations(this.options.migrations||[]);ge.a.assign(this,{migrations:i}),this.driver.database=this.getDatabaseName(),t.validateMany(this.entityMetadatas.filter((function(e){return"view"!==e.tableType})),this.driver)},e.prototype.getDatabaseName=function(){var e=this.options;switch(e.type){case"mysql":case"mariadb":case"postgres":case"cockroachdb":case"mssql":case"oracle":return Ct.a.buildDriverOptions(e.replication?e.replication.master:e).database;default:return Ct.a.buildDriverOptions(e).database}},e}(),Rt=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionNotFoundError",Object.setPrototypeOf(r,t.prototype),r.message='Connection "'+n+'" was not found.',r}return r.c(t,e),t}(Error),Mt=function(e){function t(n){var r=e.call(this)||this;return r.name="AlreadyHasActiveConnectionError",Object.setPrototypeOf(r,t.prototype),r.message='Cannot create a new connection named "'+n+'", because connection with such name already exist and it now has an active connection session.',r}return r.c(t,e),t}(Error),Ot=function(){function e(){this.connections=[]}return e.prototype.has=function(e){return!!this.connections.find((function(t){return t.name===e}))},e.prototype.get=function(e){void 0===e&&(e="default");var t=this.connections.find((function(t){return t.name===e}));if(!t)throw new Rt(e);return t},e.prototype.create=function(e){var t=this.connections.find((function(t){return t.name===(e.name||"default")}));if(t){if(t.isConnected)throw new Mt(e.name||"default");this.connections.splice(this.connections.indexOf(t),1)}var n=new St(e);return this.connections.push(n),n},e}(),Pt=function(){function e(){}return e.prototype.read=function(){return{type:Ve.a.getEnvVariable("TYPEORM_CONNECTION")||(Ve.a.getEnvVariable("TYPEORM_URL")?Ve.a.getEnvVariable("TYPEORM_URL").split("://")[0]:void 0),url:Ve.a.getEnvVariable("TYPEORM_URL"),host:Ve.a.getEnvVariable("TYPEORM_HOST"),port:Ve.a.getEnvVariable("TYPEORM_PORT"),username:Ve.a.getEnvVariable("TYPEORM_USERNAME"),password:Ve.a.getEnvVariable("TYPEORM_PASSWORD"),database:Ve.a.getEnvVariable("TYPEORM_DATABASE"),sid:Ve.a.getEnvVariable("TYPEORM_SID"),schema:Ve.a.getEnvVariable("TYPEORM_SCHEMA"),extra:Ve.a.getEnvVariable("TYPEORM_DRIVER_EXTRA")?JSON.parse(Ve.a.getEnvVariable("TYPEORM_DRIVER_EXTRA")):void 0,synchronize:J.a.toBoolean(Ve.a.getEnvVariable("TYPEORM_SYNCHRONIZE")),dropSchema:J.a.toBoolean(Ve.a.getEnvVariable("TYPEORM_DROP_SCHEMA")),migrationsRun:J.a.toBoolean(Ve.a.getEnvVariable("TYPEORM_MIGRATIONS_RUN")),entities:this.stringToArray(Ve.a.getEnvVariable("TYPEORM_ENTITIES")),migrations:this.stringToArray(Ve.a.getEnvVariable("TYPEORM_MIGRATIONS")),migrationsTableName:Ve.a.getEnvVariable("TYPEORM_MIGRATIONS_TABLE_NAME"),subscribers:this.stringToArray(Ve.a.getEnvVariable("TYPEORM_SUBSCRIBERS")),logging:this.transformLogging(Ve.a.getEnvVariable("TYPEORM_LOGGING")),logger:Ve.a.getEnvVariable("TYPEORM_LOGGER"),entityPrefix:Ve.a.getEnvVariable("TYPEORM_ENTITY_PREFIX"),maxQueryExecutionTime:Ve.a.getEnvVariable("TYPEORM_MAX_QUERY_EXECUTION_TIME"),debug:Ve.a.getEnvVariable("TYPEORM_DEBUG"),cli:{entitiesDir:Ve.a.getEnvVariable("TYPEORM_ENTITIES_DIR"),migrationsDir:Ve.a.getEnvVariable("TYPEORM_MIGRATIONS_DIR"),subscribersDir:Ve.a.getEnvVariable("TYPEORM_SUBSCRIBERS_DIR")},cache:this.transformCaching(),uuidExtension:Ve.a.getEnvVariable("TYPEORM_UUID_EXTENSION")}},e.prototype.transformLogging=function(e){return"true"===e||"TRUE"===e||"1"===e||("all"===e?"all":this.stringToArray(e))},e.prototype.transformCaching=function(){var e=Ve.a.getEnvVariable("TYPEORM_CACHE");return"true"===e||"TRUE"===e||"1"===e||"false"!==e&&"FALSE"!==e&&"0"!==e&&("redis"===e||"database"===e?{type:e,options:Ve.a.getEnvVariable("TYPEORM_CACHE_OPTIONS")?JSON.parse(Ve.a.getEnvVariable("TYPEORM_CACHE_OPTIONS")):void 0,alwaysEnabled:Ve.a.getEnvVariable("TYPEORM_CACHE_ALWAYS_ENABLED"),duration:parseInt(Ve.a.getEnvVariable("TYPEORM_CACHE_DURATION"))}:void 0)},e.prototype.stringToArray=function(e){return e?e.split(",").map((function(e){return e.trim()})):[]},e}(),xt=function(){function e(){}return e.prototype.read=function(e){var t=Ve.a.load("js-yaml").safeLoad(Ve.a.readFileSync(e));return Object.keys(t).map((function(e){return Object.assign({name:e},t[e])}))},e}(),It=function(){function e(){}return e.prototype.read=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.readXml(e)];case 1:return[2,t.sent().connection.map((function(e){return{name:e.$.name,type:e.$.type,url:e.url?e.url[0]:void 0,host:e.host?e.host[0]:void 0,port:e.port&&e.port[0]?parseInt(e.port[0]):void 0,username:e.username?e.username[0]:void 0,password:e.password?e.password[0]:void 0,database:e.database?e.database[0]:void 0,sid:e.sid?e.sid[0]:void 0,extra:e.extra?e.extra[0]:void 0,synchronize:e.synchronize?e.synchronize[0]:void 0,entities:e.entities?e.entities[0].entity:[],subscribers:e.subscribers?e.subscribers[0].entity:[],logging:e.logging[0]?e.logging[0].split(","):void 0}}))]}}))}))},e.prototype.readXml=function(e){var t=Ve.a.load("xml2js").parseString,n={trim:!0,explicitRoot:!1};return new Promise((function(r,i){t(Ve.a.readFileSync(e),n,(function(e,t){return e?i(e):r(t)}))}))},e}(),_t=function(){function e(e){this.options=e}return e.prototype.all=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:return[4,this.load()];case 1:if(!(e=t.sent()))throw new Error("No connection options were found in any orm configuration files.");return[2,e]}}))}))},e.prototype.get=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.all()];case 1:if(t=r.sent(),!(n=t.find((function(t){return t.name===e||"default"===e&&!t.name}))))throw new Error("Cannot find connection "+e+" because its not defined in any orm configuration files.");return[2,n]}}))}))},e.prototype.has=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return[4,this.load()];case 1:return(t=n.sent())?[2,!!t.find((function(t){return t.name===e||"default"===e&&!t.name}))]:[2,!1]}}))}))},e.prototype.load=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return e=void 0,t=["env","js","ts","json","yml","yaml","xml"],n=this.baseFilePath.substr(this.baseFilePath.lastIndexOf(".")),i=t.find((function(e){return"."+e===n})),"env"===(a=i||t.find((function(e){return Ve.a.fileExist(s.baseFilePath+"."+e)})))?Ve.a.load("dotenv").config({path:this.baseFilePath}):Ve.a.fileExist(".env")&&Ve.a.load("dotenv").config({path:".env"}),o=i?this.baseFilePath:this.baseFilePath+"."+a,Ve.a.getEnvVariable("TYPEORM_CONNECTION")||Ve.a.getEnvVariable("TYPEORM_URL")?(e=(new Pt).read(),[3,10]):[3,1];case 1:return"js"!==a?[3,3]:[4,Ve.a.load(o)];case 2:return e=r.sent(),[3,10];case 3:return"ts"!==a?[3,5]:[4,Ve.a.load(o)];case 4:return e=r.sent(),[3,10];case 5:return"json"!==a?[3,6]:(e=Ve.a.load(o),[3,10]);case 6:return"yml"!==a?[3,7]:(e=(new xt).read(o),[3,10]);case 7:return"yaml"!==a?[3,8]:(e=(new xt).read(o),[3,10]);case 8:return"xml"!==a?[3,10]:[4,(new It).read(o)];case 9:e=r.sent(),r.label=10;case 10:return e?[2,this.normalizeConnectionOptions(e)]:[2,void 0]}}))}))},e.prototype.normalizeConnectionOptions=function(e){var t=this;return Array.isArray(e)||(e=[e]),e.forEach((function(n){if(n.entities){var r=n.entities.map((function(e){return"string"===typeof e&&"/"!==e.substr(0,1)?t.baseDirectory+"/"+e:e}));Object.assign(e,{entities:r})}if(n.subscribers){var i=n.subscribers.map((function(e){return"string"===typeof e&&"/"!==e.substr(0,1)?t.baseDirectory+"/"+e:e}));Object.assign(e,{subscribers:i})}if(n.migrations){var a=n.migrations.map((function(e){return"string"===typeof e&&"/"!==e.substr(0,1)?t.baseDirectory+"/"+e:e}));Object.assign(e,{migrations:a})}"sqlite"===n.type&&"string"===typeof n.database&&"/"!==n.database.substr(0,1)&&":\\"!==n.database.substr(1,2)&&":memory:"!==n.database&&Object.assign(n,{database:t.baseDirectory+"/"+n.database})})),e},Object.defineProperty(e.prototype,"baseFilePath",{get:function(){return this.baseDirectory+"/"+this.baseConfigName},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseDirectory",{get:function(){return this.options&&this.options.root?this.options.root:Ve.a.load("app-root-path").path},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"baseConfigName",{get:function(){return this.options&&this.options.configName?this.options.configName:"ormconfig"},enumerable:!0,configurable:!0}),e}();!function(e){function t(n,r){var i=e.call(this)||this;return i.name="ColumnTypeUndefinedError",Object.setPrototypeOf(i,t.prototype),i.message="Column type for "+n.constructor.name+"#"+r+' is not defined and cannot be guessed. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application (before any entity imported).If you are using JavaScript instead of TypeScript you must explicitly provide a column type.',i}r.c(t,e)}(Error);!function(e){function t(n,r){var i=e.call(this)||this;return i.name="PrimaryColumnCannotBeNullableError",Object.setPrototypeOf(i,t.prototype),i.message="Primary column "+n.constructor.name+"#"+r+" cannot be nullable. Its not allowed for primary keys. Try to remove nullable option.",i}r.c(t,e)}(Error);!function(){function e(){}e.AFTER_LOAD="after-load",e.BEFORE_INSERT="before-insert",e.AFTER_INSERT="after-insert",e.BEFORE_UPDATE="before-update",e.AFTER_UPDATE="after-update",e.BEFORE_REMOVE="before-remove",e.AFTER_REMOVE="after-remove"}();!function(e){function t(n,r){var i=e.call(this)||this;return i.name="CannotReflectMethodParameterTypeError",Object.setPrototypeOf(i,t.prototype),i.message='Cannot get reflected type for a "'+r+'" method\'s parameter of "'+n.name+'" class. Make sure you have turned on an "emitDecoratorMetadata": true option in tsconfig.json. Also make sure you have imported "reflect-metadata" on top of the main entry file in your application.',i}r.c(t,e)}(Error);n(16);n(63);(function(){function e(){}e.prototype.hasId=function(){return this.constructor.getRepository().hasId(this)},e.prototype.save=function(e){return this.constructor.getRepository().save(this,e)},e.prototype.remove=function(e){return this.constructor.getRepository().remove(this,e)},e.prototype.softRemove=function(e){return this.constructor.getRepository().softRemove(this,e)},e.prototype.recover=function(e){return this.constructor.getRepository().recover(this,e)},e.prototype.reload=function(){return r.b(this,void 0,void 0,(function(){var e,t;return r.d(this,(function(n){switch(n.label){case 0:return[4,(e=this.constructor).getRepository().findOneOrFail(e.getId(this))];case 1:return t=n.sent(),ge.a.assign(this,t),[2]}}))}))},e.useConnection=function(e){this.usedConnection=e},e.getRepository=function(){return(this.usedConnection||Ut()).getRepository(this)},Object.defineProperty(e,"target",{get:function(){return this.getRepository().target},enumerable:!0,configurable:!0}),e.hasId=function(e){return this.getRepository().hasId(e)},e.getId=function(e){return this.getRepository().getId(e)},e.createQueryBuilder=function(e){return this.getRepository().createQueryBuilder(e)},e.create=function(e){return this.getRepository().create(e)},e.merge=function(e){for(var t,n=[],i=1;i<arguments.length;i++)n[i-1]=arguments[i];return(t=this.getRepository()).merge.apply(t,r.f([e],n))},e.preload=function(e){return this.getRepository().preload(e)},e.save=function(e,t){return this.getRepository().save(e,t)},e.remove=function(e,t){return this.getRepository().remove(e,t)},e.softRemove=function(e,t){return this.getRepository().softRemove(e,t)},e.insert=function(e,t){return this.getRepository().insert(e,t)},e.update=function(e,t,n){return this.getRepository().update(e,t,n)},e.delete=function(e,t){return this.getRepository().delete(e,t)},e.count=function(e){return this.getRepository().count(e)},e.find=function(e){return this.getRepository().find(e)},e.findAndCount=function(e){return this.getRepository().findAndCount(e)},e.findByIds=function(e,t){return this.getRepository().findByIds(e,t)},e.findOne=function(e,t){return this.getRepository().findOne(e,t)},e.findOneOrFail=function(e,t){return this.getRepository().findOneOrFail(e,t)},e.query=function(e,t){return this.getRepository().query(e,t)},e.clear=function(){return this.getRepository().clear()}})(),n(22),n(8),n(47),n(15),n(13),n(10),n(35),n(70),n(72),n(69),n(71),n(62),n(53),n(64);function Lt(){var e=Ve.a.getGlobalVariable();return e.typeormMetadataArgsStorage||(e.typeormMetadataArgsStorage=new lt),e.typeormMetadataArgsStorage}function Dt(e){return void 0===e&&(e="default"),r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){return[2,(new _t).get(e)]}))}))}function qt(){return We(Ot)}function jt(e){return r.b(this,void 0,void 0,(function(){var t,n,i;return r.d(this,(function(r){switch(r.label){case 0:return t="string"===typeof e?e:"default",e instanceof Object?(i=e,[3,3]):[3,1];case 1:return[4,Dt(t)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,qt().create(n).connect()]}}))}))}function Ut(e){return void 0===e&&(e="default"),qt().get(e)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(e){this.columnNames=[],this.referencedColumnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.referencedColumnNames=e.referencedColumnNames,this.referencedTableName=e.referencedTableName,this.onDelete=e.onDelete,this.onUpdate=e.onUpdate,this.deferrable=e.deferrable}return e.prototype.clone=function(){return new e({name:this.name,columnNames:r.f(this.columnNames),referencedColumnNames:r.f(this.referencedColumnNames),referencedTableName:this.referencedTableName,onDelete:this.onDelete,onUpdate:this.onUpdate,deferrable:this.deferrable})},e.create=function(t){return new e({name:t.name,columnNames:t.columnNames,referencedColumnNames:t.referencedColumnNames,referencedTableName:t.referencedTablePath,onDelete:t.onDelete,onUpdate:t.onUpdate,deferrable:t.deferrable})},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(12),i=function(){function e(e,t,n,r){void 0===n&&(n=!0),void 0===r&&(r=!1),this._type=e,this._value=t,this._useParameter=n,this._multipleParameters=r}return Object.defineProperty(e.prototype,"useParameter",{get:function(){return this._value instanceof e?this._value.useParameter:this._useParameter},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"multipleParameters",{get:function(){return this._value instanceof e?this._value.multipleParameters:this._multipleParameters},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"value",{get:function(){return this._value instanceof e?this._value.value:this._value},enumerable:!0,configurable:!0}),e.prototype.toSql=function(t,n,i){switch(this._type){case"not":return this._value instanceof e?"NOT("+this._value.toSql(t,n,i)+")":n+" != "+i[0];case"lessThan":return n+" < "+i[0];case"lessThanOrEqual":return n+" <= "+i[0];case"moreThan":return n+" > "+i[0];case"moreThanOrEqual":return n+" >= "+i[0];case"equal":return n+" = "+i[0];case"like":return n+" LIKE "+i[0];case"between":return n+" BETWEEN "+i[0]+" AND "+i[1];case"in":return t.driver instanceof r.a&&0===i.length?n+" IN (null)":n+" IN ("+i.join(", ")+")";case"any":return n+" = ANY("+i[0]+")";case"isNull":return n+" IS NULL";case"raw":return this.value instanceof Function?this.value(n):n+" = "+this.value}return""},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="QueryRunnerAlreadyReleasedError",Object.setPrototypeOf(n,t.prototype),n.message="Query runner already released. Cannot run queries anymore.",n}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e){e&&(this.name=e.name,this.expression=e.expression,this.materialized=!!e.materialized)}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression,materialized:this.materialized})},e.create=function(t,n){return new e({name:n.buildTableName(t.tableName,t.schema,t.database),expression:t.expression,materialized:t.tableMetadataArgs.materialized})},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),i=n(5),a=n(41),o=n(6),s=n(21),u=function(){function e(e){this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["int","integer","tinyint","smallint","mediumint","bigint","unsigned big int","int2","int8","integer","character","varchar","varying character","nchar","native character","nvarchar","text","clob","text","blob","real","double","double precision","float","real","numeric","decimal","boolean","date","time","datetime"],this.withLengthColumnTypes=["character","varchar","varying character","nchar","native character","nvarchar","text","blob","clob"],this.spatialTypes=[],this.withPrecisionColumnTypes=[],this.withScaleColumnTypes=[],this.mappedDataTypes={createDate:"datetime",createDateDefault:"datetime('now')",updateDate:"datetime",updateDateDefault:"datetime('now')",deleteDate:"datetime",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"varchar",migrationTimestamp:"bigint",cacheId:"int",cacheIdentifier:"varchar",cacheTime:"bigint",cacheDuration:"int",cacheQuery:"text",cacheResult:"text",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"text"},this.connection=e,this.options=e.options}return e.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}}))}))},e.prototype.afterConnect=function(){return Promise.resolve()},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close((function(e){return e?n(e):t()}))}))]}))}))},e.prototype.createSchemaBuilder=function(){return new a.a(this.connection)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=s.a.transformTo(t.transformer,e)),null===e||void 0===e?e:t.type===Boolean||"boolean"===t.type?!0===e?1:0:"date"===t.type?i.a.mixedDateToDateString(e):"time"===t.type?i.a.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date?i.a.mixedDateToUtcDatetimeString(e):"simple-array"===t.type?i.a.simpleArrayToString(e):"simple-json"===t.type?i.a.simpleJsonToString(e):"simple-enum"===t.type?i.a.simpleEnumToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?t.transformer?s.a.transformFrom(t.transformer,e):e:(t.type===Boolean||"boolean"===t.type?e=!!e:"datetime"===t.type||t.type===Date?(e&&"string"===typeof e&&(/^\d\d\d\d-\d\d-\d\d \d\d:\d\d/.test(e)&&(e=e.replace(" ","T")),/^\d\d\d\d-\d\d-\d\dT\d\d:\d\d(:\d\d(\.\d\d\d)?)?$/.test(e)&&(e+="Z")),e=i.a.normalizeHydratedDate(e)):"date"===t.type?e=i.a.mixedDateToDateString(e):"time"===t.type?e=i.a.mixedTimeToString(e):"simple-array"===t.type?e=i.a.stringToSimpleArray(e):"simple-json"===t.type?e=i.a.stringToSimpleJson(e):"simple-enum"===t.type&&(e=i.a.stringToSimpleEnum(e,t)),t.transformer&&(e=s.a.transformFrom(t.transformer,e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return"boolean"===typeof n[e]?!0===n[e]?1:0:n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map((function(e){return r.push(e),"?"})).join(", "):n instanceof Function?n():(r.push(n),"?")})),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t,n){return e},e.prototype.normalizeType=function(e){return e.type===Number||"int"===e.type?"integer":e.type===String?"varchar":e.type===Date?"datetime":e.type===Boolean?"boolean":"uuid"===e.type?"varchar":"simple-array"===e.type||"simple-json"===e.type?"text":"simple-enum"===e.type?"varchar":e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default;return"number"===typeof t?""+t:"boolean"===typeof t?!0===t?"1":"0":"function"===typeof t?t():"string"===typeof t?"'"+t+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some((function(t){return 1===t.columns.length&&t.columns[0]===e}))},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.enum?"varchar":(e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t)},e.prototype.obtainMasterConnection=function(){return Promise.resolve()},e.prototype.obtainSlaveConnection=function(){return Promise.resolve()},e.prototype.createGeneratedMap=function(e,t){var n=e.generatedColumns.reduce((function(e,n){var r;return"increment"===n.generationStrategy&&t&&(r=t),r?o.a.mergeDeep(e,n.createValueMap(r)):e}),{});return Object.keys(n).length>0?n:void 0},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||n.normalizeDefault(t)!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated)}))},e.prototype.isReturningSqlSupported=function(){return!1},e.prototype.isUUIDGenerationSupported=function(){return!1},e.prototype.createParameter=function(e,t){return"?"},e.prototype.createDatabaseConnection=function(){throw new Error("Do not use AbstractSqlite directly, it has to be used with one of the sqlite drivers")},e.prototype.loadDependencies=function(){},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n(38),a=function(){function e(){}return e.buildDriverOptions=function(e,t){if(e.url){var n=this.parseConnectionUrl(e.url),r={type:n.type,host:n.host,username:n.username,password:n.password,port:n.port,database:n.database};return t&&t.useSid&&(r.sid=n.database),Object.assign({},e,r)}return Object.assign({},e)},e.buildColumnAlias=function(e,t,n){var r=e.maxAliasLength,a=t+"_"+n;return r&&r>0&&a.length>r?Object(i.b)(a,{length:r}):a},e.parseConnectionUrl=function(e){var t=e.split(":")[0],n=e.indexOf("//"),i=e.substr(n+2),a=i.indexOf("/"),o=-1!==a?i.substr(0,a):i,s=-1!==a?i.substr(a+1):void 0,u=o.lastIndexOf("@"),c=o.substr(0,u),l=o.substr(u+1),h=c,p="",f=c.indexOf(":");-1!==f&&(h=c.substr(0,f),p=c.substr(f+1));var d=r.e(l.split(":"),2),m=d[0],y=d[1];return{type:t,host:m,username:decodeURIComponent(h),password:decodeURIComponent(p),port:y?parseInt(y):void 0,database:s||void 0}},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.transformFrom=function(e,t){return Array.isArray(e)?e.slice().reverse().reduce((function(e,t){return t.from(e)}),t):e.from(t)},e.transformTo=function(e,t){return Array.isArray(e)?e.reduce((function(e,t){return t.to(e)}),t):e.to(t)},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(e){this.columnNames=[],this.name=e.name,this.columnNames=e.columnNames,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,columnNames:this.columnNames?r.f(this.columnNames):[],expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e,t){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];this.value=e,this.type=t,this.params=[],this.params=n||[]}},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return h}));var r=n(0),i=n(30),a=n(4),o=n(41),s=n(21),u=n(5),c=n(6),l=n(83),h=function(){function t(e){this.slaves=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["tinyint","smallint","int","integer","bigint","smalldecimal","decimal","dec","real","double","float","date","time","seconddate","timestamp","boolean","char","nchar","varchar","nvarchar","text","alphanum","shorttext","array","varbinary","blob","clob","nclob","st_geometry","st_point"],this.spatialTypes=["st_geometry","st_point"],this.withLengthColumnTypes=["varchar","nvarchar","alphanum","shorttext","varbinary"],this.withPrecisionColumnTypes=["decimal"],this.withScaleColumnTypes=["decimal"],this.mappedDataTypes={createDate:"timestamp",createDateDefault:"CURRENT_TIMESTAMP",updateDate:"timestamp",updateDateDefault:"CURRENT_TIMESTAMP",deleteDate:"timestamp",deleteDateNullable:!0,version:"integer",treeLevel:"integer",migrationId:"integer",migrationName:"nvarchar",migrationTimestamp:"bigint",cacheId:"integer",cacheIdentifier:"nvarchar",cacheTime:"bigint",cacheDuration:"integer",cacheQuery:"nvarchar(5000)",cacheResult:"text",metadataType:"nvarchar",metadataDatabase:"nvarchar",metadataSchema:"nvarchar",metadataTable:"nvarchar",metadataName:"nvarchar",metadataValue:"nvarchar(5000)"},this.dataTypeDefaults={char:{length:1},nchar:{length:1},varchar:{length:255},nvarchar:{length:255},shorttext:{length:255},varbinary:{length:255},decimal:{precision:18,scale:0}},this.maxAliasLength=128,this.connection=e,this.options=e.options,this.loadDependencies()}return t.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i;return r.d(this,(function(a){return e=r.a({hostName:this.options.host,port:this.options.port,userName:this.options.username,password:this.options.password},this.options.extra),this.options.database&&(e.databaseName=this.options.database),this.options.encrypt&&(e.encrypt=this.options.encrypt),this.options.sslValidateCertificate&&(e.validateCertificate=this.options.sslValidateCertificate),this.options.key&&(e.key=this.options.key),this.options.cert&&(e.cert=this.options.cert),this.options.ca&&(e.ca=this.options.ca),t={min:this.options.pool&&this.options.pool.min?this.options.pool.min:1,max:this.options.pool&&this.options.pool.max?this.options.pool.max:10},this.options.pool&&this.options.pool.checkInterval&&(t.checkInterval=this.options.pool.checkInterval),this.options.pool&&this.options.pool.maxWaitingRequests&&(t.maxWaitingRequests=this.options.pool.maxWaitingRequests),this.options.pool&&this.options.pool.requestTimeout&&(t.requestTimeout=this.options.pool.requestTimeout),this.options.pool&&this.options.pool.idleTimeout&&(t.idleTimeout=this.options.pool.idleTimeout),n=this.connection.logger,i=t.poolErrorHandler||function(e){return n.log("warn","SAP Hana pool raised an error. "+e)},this.client.eventEmitter.on("poolError",i),this.master=this.client.createPool(e,t),this.database=this.options.database,[2]}))}))},t.prototype.afterConnect=function(){return Promise.resolve()},t.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){return e=this.master.clear(),this.master=void 0,[2,e]}))}))},t.prototype.createSchemaBuilder=function(){return new o.a(this.connection)},t.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new l.a(this,e)},t.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return n[e]instanceof Date?u.a.mixedDateToDatetimeString(n[e],!0):n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map((function(e){return r.push(e),"?"})).join(", "):n instanceof Function?n():n instanceof Date?u.a.mixedDateToDatetimeString(n,!0):(r.push(n),"?")})),r]},t.prototype.escape=function(e){return'"'+e+'"'},t.prototype.buildTableName=function(e,t){return t?t+"."+e:e},t.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=s.a.transformTo(t.transformer,e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?u.a.mixedDateToDateString(e):"time"===t.type?u.a.mixedDateToTimeString(e):"timestamp"===t.type||t.type===Date?u.a.mixedDateToDatetimeString(e,!0):"seconddate"===t.type?u.a.mixedDateToDatetimeString(e,!1):"simple-array"===t.type?u.a.simpleArrayToString(e):"simple-json"===t.type?u.a.simpleJsonToString(e):"simple-enum"===t.type?u.a.simpleEnumToString(e):t.isArray?function(){return"ARRAY("+e.map((function(e){return"'"+e+"'"}))+")"}:e},t.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?t.transformer?s.a.transformFrom(t.transformer,e):e:(t.type===Boolean?e=!!e:"timestamp"===t.type||"seconddate"===t.type||t.type===Date?e=u.a.normalizeHydratedDate(e):"date"===t.type?e=u.a.mixedDateToDateString(e):"time"===t.type?e=u.a.mixedTimeToString(e):"simple-array"===t.type?e=u.a.stringToSimpleArray(e):"simple-json"===t.type?e=u.a.stringToSimpleJson(e):"simple-enum"===t.type&&(e=u.a.stringToSimpleEnum(e,t)),t.transformer&&(e=s.a.transformFrom(t.transformer,e)),e)},t.prototype.normalizeType=function(t){return t.type===Number||"int"===t.type?"integer":t.type===String?"nvarchar":t.type===Date?"timestamp":t.type===Boolean?"boolean":t.type===e?"blob":"uuid"===t.type?"nvarchar":"simple-array"===t.type||"simple-json"===t.type?"text":"simple-enum"===t.type?"nvarchar":t.type||""},t.prototype.normalizeDefault=function(e){var t=e.default;return"number"===typeof t?""+t:"boolean"===typeof t?!0===t?"true":"false":"function"===typeof t?t():"string"===typeof t?"'"+t+"'":t},t.prototype.normalizeIsUnique=function(e){return e.entityMetadata.indices.some((function(t){return t.isUnique&&1===t.columns.length&&t.columns[0]===e}))},t.prototype.getColumnLength=function(e){if(e.length)return e.length.toString();if("uuid"===e.generationStrategy)return"36";switch(e.type){case"varchar":case"nvarchar":case"shorttext":case String:return"255";case"alphanum":return"127";case"varbinary":return"255"}return""},t.prototype.createFullType=function(e){var t=e.type;return this.getColumnLength(e)?t+="("+this.getColumnLength(e)+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},t.prototype.obtainMasterConnection=function(){return this.master.getConnection()},t.prototype.obtainSlaveConnection=function(){return this.obtainMasterConnection()},t.prototype.createGeneratedMap=function(e,t){var n=e.generatedColumns.reduce((function(e,n){var r;return"increment"===n.generationStrategy&&t&&(r=t),c.a.mergeDeep(e,n.createValueMap(r))}),{});return Object.keys(n).length>0?n:void 0},t.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));if(!r)return!1;var i=n.normalizeDefault(t),a=null==i?void 0:i;return r.name!==t.databaseName||r.type!==n.normalizeType(t)||t.length&&r.length!==n.getColumnLength(t)||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&a!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||"uuid"!==t.generationStrategy&&r.isGenerated!==t.isGenerated}))},t.prototype.isReturningSqlSupported=function(){return!1},t.prototype.isUUIDGenerationSupported=function(){return!1},t.prototype.createParameter=function(e,t){return"?"},t.prototype.loadDependencies=function(){try{this.client=a.a.load("hdb-pool")}catch(e){throw new i.a("SAP Hana","hdb-pool")}try{a.a.load("@sap/hana-client")}catch(e){throw new i.a("SAP Hana","@sap/hana-client")}},t}()}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e){this.queryRunner=e}return e.prototype.broadcastBeforeInsertEvent=function(e,t,n){var r=this;n&&t.beforeInsertListeners.length&&t.beforeInsertListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.beforeInsert){var a=i.beforeInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))},e.prototype.broadcastBeforeUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.beforeUpdateListeners.length&&t.beforeUpdateListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(s){if(o.isAllowedSubscriber(s,t.target)&&s.beforeUpdate){var u=s.beforeUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}}))},e.prototype.broadcastBeforeRemoveEvent=function(e,t,n,r){var i=this;n&&t.beforeRemoveListeners.length&&t.beforeRemoveListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(a){if(i.isAllowedSubscriber(a,t.target)&&a.beforeRemove){var o=a.beforeRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}}))},e.prototype.broadcastAfterInsertEvent=function(e,t,n){var r=this;n&&t.afterInsertListeners.length&&t.afterInsertListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterInsert){var a=i.afterInsert({connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}}))},e.prototype.broadcastAfterUpdateEvent=function(e,t,n,r,i,a){var o=this;n&&t.afterUpdateListeners.length&&t.afterUpdateListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(s){if(o.isAllowedSubscriber(s,t.target)&&s.afterUpdate){var u=s.afterUpdate({connection:o.queryRunner.connection,queryRunner:o.queryRunner,manager:o.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,updatedColumns:i||[],updatedRelations:a||[]});u instanceof Promise&&e.promises.push(u),e.count++}}))},e.prototype.broadcastAfterRemoveEvent=function(e,t,n,r){var i=this;n&&t.afterRemoveListeners.length&&t.afterRemoveListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),this.queryRunner.connection.subscribers.length&&this.queryRunner.connection.subscribers.forEach((function(a){if(i.isAllowedSubscriber(a,t.target)&&a.afterRemove){var o=a.afterRemove({connection:i.queryRunner.connection,queryRunner:i.queryRunner,manager:i.queryRunner.manager,entity:n,metadata:t,databaseEntity:r,entityId:t.getEntityIdMixedMap(r)});o instanceof Promise&&e.promises.push(o),e.count++}}))},e.prototype.broadcastLoadEventsForAll=function(e,t,n){var r=this;n.forEach((function(n){n instanceof Promise||(t.relations.length&&t.relations.forEach((function(t){if(!t.isLazy||n.hasOwnProperty(t.propertyName)){var i=t.getEntityValue(n);i instanceof Object&&r.broadcastLoadEventsForAll(e,t.inverseEntityMetadata,Array.isArray(i)?i:[i])}})),t.afterLoadListeners.length&&t.afterLoadListeners.forEach((function(t){if(t.isAllowed(n)){var r=t.execute(n);r instanceof Promise&&e.promises.push(r),e.count++}})),r.queryRunner.connection.subscribers.length&&r.queryRunner.connection.subscribers.forEach((function(i){if(r.isAllowedSubscriber(i,t.target)&&i.afterLoad){var a=i.afterLoad(n,{connection:r.queryRunner.connection,queryRunner:r.queryRunner,manager:r.queryRunner.manager,entity:n,metadata:t});a instanceof Promise&&e.promises.push(a),e.count++}})))}))},e.prototype.isAllowedSubscriber=function(e,t){return!e.listenTo||!e.listenTo()||e.listenTo()===Object||e.listenTo()===t||e.listenTo().isPrototypeOf(t)},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(){}return e.assign=function(e){for(var t,n,i,a,o=[],s=1;s<arguments.length;s++)o[s-1]=arguments[s];try{for(var u=r.g(o),c=u.next();!c.done;c=u.next()){var l=c.value;try{for(var h=r.g(Object.getOwnPropertyNames(l)),p=h.next();!p.done;p=h.next()){var f=p.value;e[f]=l[f]}}catch(d){i={error:d}}finally{try{p&&!p.done&&(a=h.return)&&a.call(h)}finally{if(i)throw i.error}}}}catch(m){t={error:m}}finally{try{c&&!c.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionNotStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction is not started yet, start transaction before committing or rolling it back.",n}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(0),i=n(26),a=function(e){function t(n,a,o){var s=e.call(this)||this;return Object.setPrototypeOf(s,t.prototype),s.message=o.toString().replace(/^error: /,"").replace(/^Error: /,"").replace(/^Request/,""),i.a.assign(s,r.a({},o,{name:"QueryFailedError",query:n,parameters:a||[]})),s}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return O}));var r=n(0),i=n(55),a=n(30),o=n(20),s=n(5),u=n(4),c=n(41),l=n(6),h=n(36),p=n(27),f=n(8),d=n(2),m=n(13),y=n(15),v=n(17),g=n(18),b=n(1),E=n(28),T=n(25),N=n(10),w=n(43),A=n(14),C=n(22),S=n(47),R=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.queries=[],r.storeQueries=!1,r.driver=t,r.connection=t.connection,r.mode=n,r.broadcaster=new T.a(r),r}return r.c(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((function(t){var n=r.e(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((function(t){var n=r.e(t,2),i=n[0],a=n[1];return e.driver.connectedQueryRunners.push(e),e.databaseConnection=i,e.releaseCallback=a,e.databaseConnection}))),this.databaseConnectionPromise)},t.prototype.release=function(){this.isReleased=!0,this.releaseCallback&&this.releaseCallback();var e=this.driver.connectedQueryRunners.indexOf(this);return-1!==e&&this.driver.connectedQueryRunners.splice(e),Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:if(this.isTransactionActive)throw new h.a;return this.isTransactionActive=!0,[4,this.query("START TRANSACTION")];case 1:return t.sent(),[4,this.query("SAVEPOINT cockroach_restart")];case 2:return t.sent(),e?[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)]:[3,4];case 3:t.sent(),t.label=4;case 4:return this.storeQueries=!0,[2]}}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:if(!this.isTransactionActive)throw new p.a;this.storeQueries=!1,t.label=1;case 1:return t.trys.push([1,4,,9]),[4,this.query("RELEASE SAVEPOINT cockroach_restart")];case 2:return t.sent(),[4,this.query("COMMIT")];case 3:return t.sent(),this.queries=[],this.isTransactionActive=!1,[3,9];case 4:return"40001"!==t.sent().code?[3,8]:[4,this.query("ROLLBACK TO SAVEPOINT cockroach_restart")];case 5:return t.sent(),[4,A.c.runInSequence(this.queries,(function(t){return e.query(t.query,t.parameters)}))];case 6:return t.sent(),[4,this.commitTransaction()];case 7:t.sent(),t.label=8;case 8:return[3,9];case 9:return[2]}}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new p.a;return this.storeQueries=!1,[4,this.query("ROLLBACK")];case 1:return e.sent(),this.queries=[],this.isTransactionActive=!1,[2]}}))}))},t.prototype.query=function(e,t,n){var i=this;if(this.isReleased)throw new v.a;return new Promise((function(n,a){return r.b(i,void 0,void 0,(function(){var i,o,s,u=this;return r.d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return i=r.sent(),this.driver.connection.logger.logQuery(e,t,this),o=+new Date,i.query(e,t,(function(r,i){u.isTransactionActive&&u.storeQueries&&u.queries.push({query:e,parameters:t});var s=u.driver.connection.options.maxQueryExecutionTime,c=+new Date-o;if(s&&c>s&&u.driver.connection.logger.logQuerySlow(c,e,t,u),r)"40001"!==r.code&&u.driver.connection.logger.logQueryError(r,e,t,u),a(new E.a(e,t,r));else switch(i.command){case"DELETE":n([i.rows,i.rowCount]);break;default:n(i.rows)}})),[3,3];case 2:return s=r.sent(),a(s),[3,3];case 3:return[2]}}))}))}))},t.prototype.stream=function(e,t,n,i){var a=this,o=this.driver.loadStreamDependency();if(this.isReleased)throw new v.a;return new Promise((function(s,u){return r.b(a,void 0,void 0,(function(){var a,c,l;return r.d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return a=r.sent(),this.driver.connection.logger.logQuery(e,t,this),c=a.query(new o(e,t)),n&&c.on("end",n),i&&c.on("error",i),s(c),[3,3];case 2:return l=r.sent(),u(l),[3,3];case 3:return[2]}}))}))}))},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM "pg_database" WHERE "datname" = \''+e+"'")];case 1:return[2,!!t.sent().length]}}))}))},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query('SELECT * FROM "information_schema"."schemata" WHERE "schema_name" = \''+e+"'")];case 1:return[2,!!t.sent().length]}}))}))},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return t=this.parseTableName(e),n='SELECT * FROM "information_schema"."tables" WHERE "table_schema" = '+t.schema+' AND "table_name" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=this.parseTableName(e),i='SELECT * FROM "information_schema"."columns" WHERE "table_schema" = '+n.schema+' AND "table_name" = '+n.tableName+' AND "column_name" = \''+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n="CREATE DATABASE "+(t?"IF NOT EXISTS ":"")+' "'+e+'"',i='DROP DATABASE "'+e+'"',[4,this.executeQueries(new b.a(n),new b.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n="DROP DATABASE "+(t?"IF EXISTS ":"")+' "'+e+'"',i='CREATE DATABASE "'+e+'"',[4,this.executeQueries(new b.a(n),new b.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=t?'CREATE SCHEMA IF NOT EXISTS "'+e+'"':'CREATE SCHEMA "'+e+'"',i='DROP SCHEMA "'+e+'" CASCADE',[4,this.executeQueries(new b.a(n),new b.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropSchema=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return i=-1===e.indexOf(".")?e:e.split(".")[0],a=t?'DROP SCHEMA IF EXISTS "'+i+'" '+(n?"CASCADE":""):'DROP SCHEMA "'+i+'" '+(n?"CASCADE":""),o='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(new b.a(a),new b.a(o))];case 1:return r.sent(),[2]}}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=[],o=[],e.columns.filter((function(e){return e.isGenerated&&"increment"===e.generationStrategy})).forEach((function(t){a.push(new b.a("CREATE SEQUENCE "+s.buildSequenceName(e,t))),o.push(new b.a("DROP SEQUENCE "+s.buildSequenceName(e,t)))})),a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((function(t){return o.push(s.dropForeignKeySql(e,t))})),i&&e.indices.filter((function(e){return!e.isUnique})).forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s,u,c,l=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,o=e instanceof d.a?e.name:e,[4,this.getCachedTable(o)];case 3:return s=r.sent(),u=[],c=[],n&&s.foreignKeys.forEach((function(e){return u.push(l.dropForeignKeySql(s,e))})),i&&s.indices.forEach((function(e){u.push(l.dropIndexSql(s,e)),c.push(l.createIndexSql(s,e))})),u.push(this.dropTableSql(s)),c.push(this.createTableSql(s,a)),s.columns.filter((function(e){return e.isGenerated&&"increment"===e.generationStrategy})).forEach((function(e){u.push(new b.a("DROP SEQUENCE "+l.buildSequenceName(s,e))),c.push(new b.a("CREATE SEQUENCE "+l.buildSequenceName(s,e)))})),[4,this.executeQueries(u,c)];case 4:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof g.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p,f=this;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],e instanceof d.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=-1===a.name.indexOf(".")?a.name:a.name.split(".")[1],c=-1===a.name.indexOf(".")?void 0:a.name.split(".")[0],s.name=c?c+"."+t:t,n.push(new b.a("ALTER TABLE "+this.escapePath(a)+' RENAME TO "'+t+'"')),i.push(new b.a("ALTER TABLE "+this.escapePath(s)+' RENAME TO "'+u+'"')),s.primaryColumns.length>0&&(l=s.primaryColumns.map((function(e){return e.name})),h=this.connection.namingStrategy.primaryKeyName(a,l),p=this.connection.namingStrategy.primaryKeyName(s,l),n.push(new b.a("ALTER TABLE "+this.escapePath(s)+' RENAME CONSTRAINT "'+h+'" TO "'+p+'"')),i.push(new b.a("ALTER TABLE "+this.escapePath(s)+' RENAME CONSTRAINT "'+p+'" TO "'+h+'"'))),s.uniques.forEach((function(e){var t=f.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);n.push(new b.a("ALTER TABLE "+f.escapePath(s)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new b.a("ALTER TABLE "+f.escapePath(s)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),s.indices.forEach((function(e){var t=f.extractSchema(s),r=f.connection.namingStrategy.indexName(s,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',o=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';n.push(new b.a(a)),i.push(new b.a(o)),e.name=r})),s.foreignKeys.forEach((function(e){var t=f.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new b.a("ALTER TABLE "+f.escapePath(s)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new b.a("ALTER TABLE "+f.escapePath(s)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}}))}))},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p,f,m,y;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(a=(n=i).clone(),o=[],s=[],"increment"===t.generationStrategy)throw new Error("Adding sequential generated columns into existing table is not supported");return o.push(new b.a("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,t))),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+t.name+'"')),t.isPrimary&&((u=a.primaryColumns).length>0&&(c=this.connection.namingStrategy.primaryKeyName(a.name,u.map((function(e){return e.name}))),l=u.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+c+'"')),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+l+")"))),u.push(t),h=this.connection.namingStrategy.primaryKeyName(a.name,u.map((function(e){return e.name}))),p=u.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")")),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+h+'"'))),(f=a.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))&&(f.isUnique?(m=new N.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,f.columnNames),columnNames:f.columnNames}),o.push(this.createUniqueConstraintSql(n,m)),s.push(this.dropIndexSql(n,m)),a.uniques.push(m)):(o.push(this.createIndexSql(n,f)),s.push(this.dropIndexSql(n,f)))),t.isUnique&&(y=new N.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(y),o.push(this.createUniqueConstraintSql(n,y)),s.push(this.dropIndexSql(n,y.name))),[4,this.executeQueries(o,s)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.addColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof f.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n instanceof f.a?s=n:(s=o.clone()).name=n,[2,this.changeColumn(i,o,s)]}}))}))},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s,u,c,l,h,p,m,y,v,g,E,T=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(c=t instanceof f.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c.type===n.type&&c.length===n.length?[3,6]:[4,this.dropColumn(i,c)];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,7];case 6:if(c.name!==n.name&&(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+c.name+'" TO "'+n.name+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' RENAME COLUMN "'+n.name+'" TO "'+c.name+'"')),!0===c.isPrimary&&(m=o.primaryColumns,g=m.map((function(e){return e.name})),l=this.connection.namingStrategy.primaryKeyName(o,g),g.splice(g.indexOf(c.name),1),g.push(n.name),h=this.connection.namingStrategy.primaryKeyName(o,g),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+l+'" TO "'+h+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' RENAME CONSTRAINT "'+h+'" TO "'+l+'"'))),o.findColumnUniques(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=T.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);s.push(new b.a("ALTER TABLE "+T.escapePath(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),u.push(new b.a("ALTER TABLE "+T.escapePath(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),o.findColumnIndices(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=T.extractSchema(i),r=T.connection.namingStrategy.indexName(o,e.columnNames,e.where),a=t?'ALTER INDEX "'+t+'"."'+e.name+'" RENAME TO "'+r+'"':'ALTER INDEX "'+e.name+'" RENAME TO "'+r+'"',l=t?'ALTER INDEX "'+t+'"."'+r+'" RENAME TO "'+e.name+'"':'ALTER INDEX "'+r+'" RENAME TO "'+e.name+'"';s.push(new b.a(a)),u.push(new b.a(l)),e.name=r})),o.findColumnForeignKeys(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=T.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(new b.a("ALTER TABLE "+T.escapePath(i)+' RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),u.push(new b.a("ALTER TABLE "+T.escapePath(i)+' RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),p=o.columns.find((function(e){return e.name===c.name})),o.columns[o.columns.indexOf(p)].name=n.name,c.name=n.name),n.precision===c.precision&&n.scale===c.scale||(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(n))),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" TYPE '+this.driver.createFullType(c)))),c.isNullable!==n.isNullable&&(n.isNullable?(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+c.name+'" DROP NOT NULL')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+c.name+'" SET NOT NULL'))):(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+c.name+'" SET NOT NULL')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+c.name+'" DROP NOT NULL')))),c.comment!==n.comment&&(s.push(new b.a("COMMENT ON COLUMN "+this.escapePath(i)+'."'+c.name+"\" IS '"+n.comment+"'")),u.push(new b.a("COMMENT ON COLUMN "+this.escapePath(i)+'."'+n.name+"\" IS '"+c.comment+"'"))),n.isPrimary!==c.isPrimary&&((m=o.primaryColumns).length>0&&(v=this.connection.namingStrategy.primaryKeyName(o.name,m.map((function(e){return e.name}))),g=m.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+v+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+g+")"))),!0===n.isPrimary?(m.push(n),o.columns.find((function(e){return e.name===n.name})).isPrimary=!0,v=this.connection.namingStrategy.primaryKeyName(o.name,m.map((function(e){return e.name}))),g=m.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+g+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+v+'"'))):(y=m.find((function(e){return e.name===n.name})),m.splice(m.indexOf(y),1),o.columns.find((function(e){return e.name===n.name})).isPrimary=!1,m.length>0&&(v=this.connection.namingStrategy.primaryKeyName(o.name,m.map((function(e){return e.name}))),g=m.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+g+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+v+'"'))))),n.isUnique!==c.isUnique&&(n.isUnique?(E=new N.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),o.uniques.push(E),s.push(this.createUniqueConstraintSql(i,E)),u.push(this.dropIndexSql(i,E))):(E=o.uniques.find((function(e){return 1===e.columnNames.length&&!!e.columnNames.find((function(e){return e===n.name}))})),o.uniques.splice(o.uniques.indexOf(E),1),s.push(this.dropIndexSql(i,E)),u.push(this.createUniqueConstraintSql(i,E)))),c.isGenerated!==n.isGenerated&&"uuid"!==n.generationStrategy)if(n.isGenerated){if("increment"===n.generationStrategy)throw new Error("Adding sequential generated columns into existing table is not supported");"rowid"===n.generationStrategy&&(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT unique_rowid()')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')))}else s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT unique_rowid()'));n.default!==c.default&&(null!==n.default&&void 0!==n.default?(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+n.default)),null!==c.default&&void 0!==c.default?u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+c.default)):u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT'))):null!==c.default&&void 0!==c.default&&(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" DROP DEFAULT')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ALTER COLUMN "'+n.name+'" SET DEFAULT '+c.default)))),r.label=7;case 7:return[4,this.executeQueries(s,u)];case 8:return r.sent(),this.replaceCachedTable(i,o),[2]}}))}))},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p,m,y,v;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return o=n.clone(),s=[],u=[],a.isPrimary&&(c=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map((function(e){return e.name}))),l=o.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+c+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+l+")")),o.findColumnByName(a.name).isPrimary=!1,o.primaryColumns.length>0&&(h=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map((function(e){return e.name}))),p=o.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+h+'"')))),(m=o.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.indices.splice(o.indices.indexOf(m),1),s.push(this.dropIndexSql(n,m)),u.push(this.createIndexSql(n,m))),(y=o.checks.find((function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.checks.splice(o.checks.indexOf(y),1),s.push(this.dropCheckConstraintSql(n,y)),u.push(this.createCheckConstraintSql(n,y))),(v=o.uniques.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.uniques.splice(o.uniques.indexOf(v),1),s.push(this.dropIndexSql(n,v.name)),u.push(this.createUniqueConstraintSql(n,v))),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+a.name+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,a))),"increment"===a.generationStrategy&&(s.push(new b.a("DROP SEQUENCE "+this.buildSequenceName(n,a))),u.push(new b.a("CREATE SEQUENCE "+this.buildSequenceName(n,a)))),[4,this.executeQueries(s,u)];case 4:return r.sent(),o.removeColumn(a),this.replaceCachedTable(n,o),[2]}}))}))},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.dropColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p,f;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map((function(e){return e.name})),s=[],u=[],(c=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map((function(e){return e.name}))),h=c.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+l+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")"))),a.columns.filter((function(e){return-1!==o.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),p=this.connection.namingStrategy.primaryKeyName(a.name,o),f=o.map((function(e){return'"'+e+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+f+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+p+'"')),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name}))),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.createUniqueConstraint(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof N.a?t:n.uniques.find((function(e){return e.name===t}))))throw new Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.dropUniqueConstraint(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof C.a?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("CockroachDB does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("CockroachDB does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("CockroachDB does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("CockroachDB does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.createForeignKey(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.a?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.dropForeignKey(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),t.isUnique?(a=new N.a({name:t.name,columnNames:t.columnNames}),o=this.createUniqueConstraintSql(n,a),s=this.dropIndexSql(n,a),[4,this.executeQueries(o,s)]):[3,5];case 4:return r.sent(),n.addUniqueConstraint(a),[3,7];case 5:return o=this.createIndexSql(n,t),s=this.dropIndexSql(n,t),[4,this.executeQueries(o,s)];case 6:r.sent(),n.addIndex(t),r.label=7;case 7:return[2]}}))}))},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.createIndex(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof d.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof m.a?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,A.c.runInSequence(t,(function(t){return n.dropIndex(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c,l=this;return r.d(this,(function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter((function(e){return e.schema})).forEach((function(t){!!e.find((function(e){return e===t.schema}))||e.push(t.schema)})),e.push(this.driver.options.schema||"current_schema()"),t=e.map((function(e){return"current_schema()"===e?e:"'"+e+"'"})).join(", "),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,10,,15]),n='SELECT \'DROP VIEW IF EXISTS "\' || schemaname || \'"."\' || viewname || \'" CASCADE;\' as "query" FROM "pg_views" WHERE "schemaname" IN ('+t+")",[4,this.query(n)];case 3:return i=r.sent(),[4,Promise.all(i.map((function(e){return l.query(e.query)})))];case 4:return r.sent(),a='SELECT \'DROP TABLE IF EXISTS "\' || table_schema || \'"."\' || table_name || \'" CASCADE;\' as "query" FROM "information_schema"."tables" WHERE "table_schema" IN ('+t+")",[4,this.query(a)];case 5:return o=r.sent(),[4,Promise.all(o.map((function(e){return l.query(e.query)})))];case 6:return r.sent(),s='SELECT \'DROP SEQUENCE "\' || sequence_schema || \'"."\' || sequence_name || \'";\' as "query" FROM "information_schema"."sequences" WHERE "sequence_schema" IN ('+t+")",[4,this.query(s)];case 7:return u=r.sent(),[4,Promise.all(u.map((function(e){return l.query(e.query)})))];case 8:return r.sent(),[4,this.commitTransaction()];case 9:return r.sent(),[3,15];case 10:c=r.sent(),r.label=11;case 11:return r.trys.push([11,13,,14]),[4,this.rollbackTransaction()];case 12:return r.sent(),[3,14];case 13:return r.sent(),[3,14];case 14:throw c;case 15:return[2]}}))}))},t.prototype.loadViews=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o=this;return r.d(this,(function(s){switch(s.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return s.sent()?[4,this.query("SELECT * FROM current_schema()")]:[2,Promise.resolve([])];case 2:return t=s.sent(),n=t[0].current_schema,i=e.map((function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=o.driver.options.schema||n),'("t"."schema" = \''+i+'\' AND "t"."name" = \''+a+"')"})).join(" OR "),a='SELECT "t".*, "v"."check_option" FROM '+this.escapePath(this.getTypeormMetadataTableName())+' "t" INNER JOIN "information_schema"."views" "v" ON "v"."table_schema" = "t"."schema" AND "v"."table_name" = "t"."name" WHERE "t"."type" = \'VIEW\' '+(i?"AND ("+i+")":""),[4,this.query(a)];case 3:return[2,s.sent().map((function(e){var t=new g.a,r=e.schema!==n||o.driver.options.schema?e.schema:void 0;return t.name=o.driver.buildTableName(e.name,r),t.expression=e.value,t}))]}}))}))},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,h,p,v,g,b,E,T,w,A=this;return r.d(this,(function(R){switch(R.label){case 0:return e&&e.length?[4,this.query("SELECT * FROM current_schema()")]:[2,[]];case 1:return t=R.sent(),n=t[0].current_schema,i=e.map((function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=A.driver.options.schema||n),'("table_schema" = \''+i+"' AND \"table_name\" = '"+a+"')"})).join(" OR "),a='SELECT * FROM "information_schema"."tables" WHERE '+i,o='SELECT * FROM "information_schema"."columns" WHERE "is_hidden" = \'NO\' AND '+i,s=e.map((function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=A.driver.options.schema||n),'("ns"."nspname" = \''+i+'\' AND "t"."relname" = \''+a+"')"})).join(" OR "),u='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "cnst"."conname" AS "constraint_name", pg_get_constraintdef("cnst"."oid") AS "expression", CASE "cnst"."contype" WHEN \'p\' THEN \'PRIMARY\' WHEN \'u\' THEN \'UNIQUE\' WHEN \'c\' THEN \'CHECK\' WHEN \'x\' THEN \'EXCLUDE\' END AS "constraint_type", "a"."attname" AS "column_name" FROM "pg_constraint" "cnst" INNER JOIN "pg_class" "t" ON "t"."oid" = "cnst"."conrelid" INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "cnst"."connamespace" LEFT JOIN "pg_attribute" "a" ON "a"."attrelid" = "cnst"."conrelid" AND "a"."attnum" = ANY ("cnst"."conkey") WHERE "t"."relkind" = \'r\' AND ('+s+")",c='SELECT "ns"."nspname" AS "table_schema", "t"."relname" AS "table_name", "i"."relname" AS "constraint_name", "a"."attname" AS "column_name", CASE "ix"."indisunique" WHEN \'t\' THEN \'TRUE\' ELSE\'FALSE\' END AS "is_unique", pg_get_expr("ix"."indpred", "ix"."indrelid") AS "condition", "types"."typname" AS "type_name" FROM "pg_class" "t" INNER JOIN "pg_index" "ix" ON "ix"."indrelid" = "t"."oid" INNER JOIN "pg_attribute" "a" ON "a"."attrelid" = "t"."oid"  AND "a"."attnum" = ANY ("ix"."indkey") INNER JOIN "pg_namespace" "ns" ON "ns"."oid" = "t"."relnamespace" INNER JOIN "pg_class" "i" ON "i"."oid" = "ix"."indexrelid" INNER JOIN "pg_type" "types" ON "types"."oid" = "a"."atttypid" LEFT JOIN "pg_constraint" "cnst" ON "cnst"."conname" = "i"."relname" WHERE "t"."relkind" = \'r\' AND "cnst"."contype" IS NULL AND ('+s+")",h=e.map((function(e){var t=r.e(e.split("."),2),i=t[0],a=t[1];return a||(a=i,i=A.driver.options.schema||n),'("ns"."nspname" = \''+i+'\' AND "cl"."relname" = \''+a+"')"})).join(" OR "),p='SELECT "con"."conname" AS "constraint_name", "con"."nspname" AS "table_schema", "con"."relname" AS "table_name", "att2"."attname" AS "column_name", "ns"."nspname" AS "referenced_table_schema", "cl"."relname" AS "referenced_table_name", "att"."attname" AS "referenced_column_name", "con"."confdeltype" AS "on_delete", "con"."confupdtype" AS "on_update" FROM ( SELECT UNNEST ("con1"."conkey") AS "parent", UNNEST ("con1"."confkey") AS "child", "con1"."confrelid", "con1"."conrelid", "con1"."conname", "con1"."contype", "ns"."nspname", "cl"."relname", CASE "con1"."confdeltype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confdeltype", CASE "con1"."confupdtype" WHEN \'a\' THEN \'NO ACTION\' WHEN \'r\' THEN \'RESTRICT\' WHEN \'c\' THEN \'CASCADE\' WHEN \'n\' THEN \'SET NULL\' WHEN \'d\' THEN \'SET DEFAULT\' END as "confupdtype" FROM "pg_class" "cl" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_constraint" "con1" ON "con1"."conrelid" = "cl"."oid" WHERE "con1"."contype" = \'f\' AND ('+h+') ) "con" INNER JOIN "pg_attribute" "att" ON "att"."attrelid" = "con"."confrelid" AND "att"."attnum" = "con"."child" INNER JOIN "pg_class" "cl" ON "cl"."oid" = "con"."confrelid" INNER JOIN "pg_namespace" "ns" ON "cl"."relnamespace" = "ns"."oid" INNER JOIN "pg_attribute" "att2" ON "att2"."attrelid" = "con"."conrelid" AND "att2"."attnum" = "con"."parent"',[4,Promise.all([this.query(a),this.query(o),this.query(u),this.query(c),this.query(p)])];case 2:return v=r.e.apply(void 0,[R.sent(),5]),g=v[0],b=v[1],E=v[2],T=v[3],w=v[4],g.length?[2,Promise.all(g.map((function(e){return r.b(A,void 0,void 0,(function(){var t,i,a,o,s,u,c,h,p,v=this;return r.d(this,(function(g){switch(g.label){case 0:return t=new d.a,i=e.table_schema!==n||this.driver.options.schema?e.table_schema:void 0,t.name=this.driver.buildTableName(e.table_name,i),a=this.driver.buildTableName(e.table_name,e.table_schema),o=t,[4,Promise.all(b.filter((function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a})).map((function(e){return r.b(v,void 0,void 0,(function(){var n,i,o,s,u,c,l=this;return r.d(this,(function(r){return n=E.filter((function(t){return l.driver.buildTableName(t.table_name,t.table_schema)===a&&t.column_name===e.column_name})),(i=new f.a).name=e.column_name,i.type=e.crdb_sql_type.toLowerCase(),-1!==e.crdb_sql_type.indexOf("COLLATE")&&(i.collation=e.crdb_sql_type.substr(e.crdb_sql_type.indexOf("COLLATE")+"COLLATE".length+1,e.crdb_sql_type.length),i.type=i.type.substr(0,e.crdb_sql_type.indexOf("COLLATE")-1)),-1!==i.type.indexOf("(")&&(i.type=i.type.substr(0,i.type.indexOf("("))),"numeric"!==i.type&&"decimal"!==i.type||(null===e.numeric_precision||this.isDefaultColumnPrecision(t,i,e.numeric_precision)?null===e.numeric_scale||this.isDefaultColumnScale(t,i,e.numeric_scale)||(i.precision=void 0):i.precision=parseInt(e.numeric_precision),null===e.numeric_scale||this.isDefaultColumnScale(t,i,e.numeric_scale)?null===e.numeric_precision||this.isDefaultColumnPrecision(t,i,e.numeric_precision)||(i.scale=void 0):i.scale=parseInt(e.numeric_scale)),"array"===e.data_type.toLowerCase()&&(i.isArray=!0,o=e.crdb_sql_type.replace("[]","").toLowerCase(),i.type=this.connection.driver.normalizeType({type:o})),-1!==this.driver.withLengthColumnTypes.indexOf(i.type)&&e.character_maximum_length&&(s=e.character_maximum_length.toString(),i.length=this.isDefaultColumnLength(t,i,s)?"":s),i.isNullable="YES"===e.is_nullable,i.isPrimary=!!n.find((function(e){return"PRIMARY"===e.constraint_type})),u=n.find((function(e){return"UNIQUE"===e.constraint_type})),c=!!u&&!!E.find((function(t){return"UNIQUE"===t.constraint_type&&t.constraint_name===u.constraint_name&&t.column_name!==e.column_name})),i.isUnique=!!u&&!c,null!==e.column_default&&void 0!==e.column_default&&("unique_rowid()"===e.column_default?(i.isGenerated=!0,i.generationStrategy="rowid"):-1!==e.column_default.indexOf("nextval")?(i.isGenerated=!0,i.generationStrategy="increment"):"gen_random_uuid()"===e.column_default?(i.isGenerated=!0,i.generationStrategy="uuid"):i.default=e.column_default.replace(/:::.*/,"")),i.comment="",e.character_set_name&&(i.charset=e.character_set_name),[2,i]}))}))})))];case 1:return o.columns=g.sent(),s=l.a.uniq(E.filter((function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a&&"UNIQUE"===e.constraint_type})),(function(e){return e.constraint_name})),t.uniques=s.map((function(e){var t=E.filter((function(t){return t.constraint_name===e.constraint_name}));return new N.a({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name}))})})),u=l.a.uniq(E.filter((function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a&&"CHECK"===e.constraint_type})),(function(e){return e.constraint_name})),t.checks=u.map((function(e){var t=E.filter((function(t){return t.constraint_name===e.constraint_name}));return new C.a({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),expression:e.expression.replace(/^\s*CHECK\s*\((.*)\)\s*$/i,"$1")})})),c=l.a.uniq(E.filter((function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a&&"EXCLUDE"===e.constraint_type})),(function(e){return e.constraint_name})),t.exclusions=c.map((function(e){return new S.a({name:e.constraint_name,expression:e.expression.substring(8)})})),h=l.a.uniq(w.filter((function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a})),(function(e){return e.constraint_name})),t.foreignKeys=h.map((function(e){var t=w.filter((function(t){return t.constraint_name===e.constraint_name})),r=e.referenced_table_schema===n?void 0:e.referenced_table_schema,i=v.driver.buildTableName(e.referenced_table_name,r);return new y.a({name:e.constraint_name,columnNames:t.map((function(e){return e.column_name})),referencedTableName:i,referencedColumnNames:t.map((function(e){return e.referenced_column_name})),onDelete:e.on_delete,onUpdate:e.on_update})})),p=l.a.uniq(T.filter((function(e){return v.driver.buildTableName(e.table_name,e.table_schema)===a})),(function(e){return e.constraint_name})),t.indices=p.map((function(e){var n=T.filter((function(t){return t.constraint_name===e.constraint_name}));return new m.a({table:t,name:e.constraint_name,columnNames:n.map((function(e){return e.column_name})),isUnique:"TRUE"===e.is_unique,where:e.condition,isSpatial:n.every((function(e){return v.driver.spatialTypes.indexOf(e.type_name)>=0})),isFulltext:!1})})),[2,t]}}))}))})))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(t){return n.buildCreateColumnSql(e,t)})).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new N.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))})),e.indices.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.push(new N.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames),columnNames:t.columnNames}))})),e.uniques.length>0)&&(i+=", "+e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", "));e.checks.length>0&&(i+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapePath(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a})).join(", "));var a=e.columns.filter((function(e){return e.isPrimary}));a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map((function(e){return e.name})))+'" PRIMARY KEY ('+a.map((function(e){return'"'+e.name+'"'})).join(", ")+")");return i+=")",new b.a(i)},t.prototype.extractSchema=function(e){var t=e instanceof d.a?e.name:e;return-1===t.indexOf(".")?this.driver.options.schema:t.split(".")[0]},t.prototype.dropTableSql=function(e){return new b.a("DROP TABLE "+this.escapePath(e))},t.prototype.createViewSql=function(e){return"string"===typeof e.expression?new b.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression):new b.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l;return r.d(this,(function(h){switch(h.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return t=h.sent(),n=t[0].current_schema,i=e.name.split("."),a=this.driver.options.schema||n,o=e.name,2===i.length&&(a=i[0],o=i[1]),s="string"===typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),u=r.e(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",schema:a,name:o,value:s}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new b.a(c,l)]}}))}))},t.prototype.dropViewSql=function(e){return new b.a("DROP VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h;return r.d(this,(function(p){switch(p.label){case 0:return[4,this.query("SELECT * FROM current_schema()")];case 1:return t=p.sent(),n=t[0].current_schema,i=e instanceof g.a?e.name:e,a=i.split("."),o=this.driver.options.schema||n,s=i,2===a.length&&(o=a[0],s=a[1]),u=this.connection.createQueryBuilder(),c=r.e(u.delete().from(this.getTypeormMetadataTableName()).where(u.escape("type")+" = 'VIEW'").andWhere(u.escape("schema")+" = :schema",{schema:o}).andWhere(u.escape("name")+" = :name",{name:s}).getQueryAndParameters(),2),l=c[0],h=c[1],[2,new b.a(l,h)]}}))}))},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new b.a('CREATE INDEX "'+t.name+'" ON '+this.escapePath(e)+" ("+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof m.a||t instanceof N.a?t.name:t;return new b.a("DROP INDEX "+this.escapePath(e)+'@"'+n+'" CASCADE')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map((function(e){return'"'+e+'"'})).join(", ");return new b.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map((function(e){return e.name})),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new b.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof N.a?t.name:t;return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new b.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof C.a?t.name:t;return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(","),i="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapePath(t.referencedTableName)+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),new b.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof y.a?t.name:t;return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.buildSequenceName=function(e,t,n){var r=t instanceof f.a?t.name:t;return n?e.name+"_"+r+"_seq":'"'+e.name+"_"+r+'_seq"'},t.prototype.escapePath=function(e,t){var n=e instanceof d.a||e instanceof g.a?e.name:e;return(n=-1===n.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+n:n).split(".").map((function(e){return t?e:'"'+e+'"'})).join(".")},t.prototype.parseTableName=function(e){var t=e instanceof d.a?e.name:e;return-1===t.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema()",tableName:"'"+t+"'"}:{schema:"'"+t.split(".")[0]+"'",tableName:"'"+t.split(".")[1]+"'"}},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+t.name+'"';return t.isGenerated&&("increment"===t.generationStrategy?n+=" INT DEFAULT nextval('"+this.buildSequenceName(e,t)+"')":"rowid"===t.generationStrategy?n+=" INT DEFAULT unique_rowid()":"uuid"===t.generationStrategy&&(n+=" UUID DEFAULT gen_random_uuid()")),t.isGenerated||(n+=" "+this.connection.driver.createFullType(t)),t.charset&&(n+=' CHARACTER SET "'+t.charset+'"'),t.collation&&(n+=' COLLATE "'+t.collation+'"'),t.isNullable||(n+=" NOT NULL"),t.isGenerated||void 0===t.default||null===t.default||(n+=" DEFAULT "+t.default),n},t}(w.a),M=n(21),O=function(){function e(e){this.slaves=[],this.connectedQueryRunners=[],this.isReplicated=!1,this.treeSupport=!0,this.supportedDataTypes=["array","bool","boolean","bytes","bytea","blob","date","numeric","decimal","dec","float","float4","float8","double precision","real","inet","int","int4","integer","int2","int8","int64","smallint","bigint","interval","string","character varying","character","char","char varying","varchar","text","time","time without time zone","timestamp","timestamptz","timestamp without time zone","timestamp with time zone","json","jsonb","uuid"],this.spatialTypes=[],this.withLengthColumnTypes=["character varying","char varying","varchar","character","char","string"],this.withPrecisionColumnTypes=["numeric","decimal","dec"],this.withScaleColumnTypes=["numeric","decimal","dec"],this.mappedDataTypes={createDate:"timestamptz",createDateDefault:"now()",updateDate:"timestamptz",updateDateDefault:"now()",deleteDate:"timestamptz",deleteDateNullable:!0,version:Number,treeLevel:Number,migrationId:Number,migrationName:"varchar",migrationTimestamp:"int8",cacheId:Number,cacheIdentifier:"varchar",cacheTime:"int8",cacheDuration:Number,cacheQuery:"string",cacheResult:"string",metadataType:"varchar",metadataDatabase:"varchar",metadataSchema:"varchar",metadataTable:"varchar",metadataName:"varchar",metadataValue:"string"},this.dataTypeDefaults={char:{length:1}},this.connection=e,this.options=e.options,this.isReplicated=!!this.options.replication,this.loadDependencies()}return e.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return this.options.replication?(e=this,[4,Promise.all(this.options.replication.slaves.map((function(e){return i.createPool(i.options,e)})))]):[3,3];case 1:return e.slaves=r.sent(),t=this,[4,this.createPool(this.options,this.options.replication.master)];case 2:return t.master=r.sent(),this.database=this.options.replication.master.database,[3,5];case 3:return n=this,[4,this.createPool(this.options,this.options)];case 4:n.master=r.sent(),this.database=this.options.database,r.label=5;case 5:return[2]}}))}))},e.prototype.afterConnect=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},e.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.master?[4,this.closePool(this.master)]:[2,Promise.reject(new i.a("cockroachdb"))];case 1:return t.sent(),[4,Promise.all(this.slaves.map((function(t){return e.closePool(t)})))];case 2:return t.sent(),this.master=void 0,this.slaves=[],[2]}}))}))},e.prototype.createSchemaBuilder=function(){return new c.a(this.connection)},e.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),new R(this,e)},e.prototype.preparePersistentValue=function(e,t){return t.transformer&&(e=M.a.transformTo(t.transformer,e)),null===e||void 0===e?e:t.type===Boolean?!0===e?1:0:"date"===t.type?s.a.mixedDateToDateString(e):"time"===t.type?s.a.mixedDateToTimeString(e):"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamptz"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?s.a.mixedDateToDate(e):r.f(["json","jsonb"],this.spatialTypes).indexOf(t.type)>=0?JSON.stringify(e):"simple-array"===t.type?s.a.simpleArrayToString(e):"simple-json"===t.type?s.a.simpleJsonToString(e):e},e.prototype.prepareHydratedValue=function(e,t){return null===e||void 0===e?t.transformer?M.a.transformFrom(t.transformer,e):e:([Number,"int4","smallint","int2"].some((function(e){return e===t.type}))&&!t.isArray||"increment"===t.generationStrategy?e=parseInt(e):t.type===Boolean?e=!!e:"datetime"===t.type||t.type===Date||"timestamp"===t.type||"timestamptz"===t.type||"timestamp with time zone"===t.type||"timestamp without time zone"===t.type?e=s.a.normalizeHydratedDate(e):"date"===t.type?e=s.a.mixedDateToDateString(e):"time"===t.type?e=s.a.mixedTimeToString(e):"simple-array"===t.type?e=s.a.stringToSimpleArray(e):"simple-json"===t.type&&(e=s.a.stringToSimpleJson(e)),t.transformer&&(e=M.a.transformFrom(t.transformer,e)),e)},e.prototype.escapeQueryWithParameters=function(e,t,n){var r=Object.keys(n).map((function(e){return n[e]}));if(!t||!Object.keys(t).length)return[e,r];var i=Object.keys(t).map((function(e){return"(:(\\.\\.\\.)?"+e+"\\b)"})).join("|");return[e=e.replace(new RegExp(i,"g"),(function(e){var n,i=!1;return":..."===e.substr(0,4)?(i=!0,n=t[e.substr(4)]):n=t[e.substr(1)],i?n.map((function(e){return r.push(e),"$"+r.length})).join(", "):n instanceof Function?n():(r.push(n),"$"+r.length)})),r]},e.prototype.escape=function(e){return'"'+e+'"'},e.prototype.buildTableName=function(e,t){return t?t+"."+e:e},e.prototype.normalizeType=function(e){return e.type===Number||"integer"===e.type||"int"===e.type||"bigint"===e.type||"int64"===e.type?"int8":e.type===String||"character varying"===e.type||"char varying"===e.type?"varchar":e.type===Date||"timestamp without time zone"===e.type?"timestamp":"timestamp with time zone"===e.type?"timestamptz":"time without time zone"===e.type?"time":e.type===Boolean||"boolean"===e.type?"bool":"simple-array"===e.type||"simple-json"===e.type||"text"===e.type?"string":"bytea"===e.type||"blob"===e.type?"bytes":"smallint"===e.type?"int2":"numeric"===e.type||"dec"===e.type?"decimal":"double precision"===e.type||"float"===e.type?"float8":"real"===e.type?"float4":"character"===e.type?"char":"json"===e.type?"jsonb":e.type||""},e.prototype.normalizeDefault=function(e){var t=e.default,n=e.isArray?"::"+e.type+"[]":"";return"number"===typeof t?""+t:"boolean"===typeof t?!0===t?"true":"false":"function"===typeof t?t():"string"===typeof t?"'"+t+"'"+n:null===t?"null":"object"===typeof t?"'"+JSON.stringify(t)+"'":t},e.prototype.normalizeIsUnique=function(e){return e.entityMetadata.uniques.some((function(t){return 1===t.columns.length&&t.columns[0]===e}))},e.prototype.getColumnLength=function(e){return e.length?e.length.toString():""},e.prototype.createFullType=function(e){var t=e.type;return e.length?t+="("+e.length+")":null!==e.precision&&void 0!==e.precision&&null!==e.scale&&void 0!==e.scale?t+="("+e.precision+","+e.scale+")":null!==e.precision&&void 0!==e.precision&&(t+="("+e.precision+")"),e.isArray&&(t+=" array"),t},e.prototype.obtainMasterConnection=function(){var e=this;return new Promise((function(t,n){e.master.connect((function(e,r,i){e?n(e):t([r,i])}))}))},e.prototype.obtainSlaveConnection=function(){var e=this;return this.slaves.length?new Promise((function(t,n){var r=Math.floor(Math.random()*e.slaves.length);e.slaves[r].connect((function(e,r,i){e?n(e):t([r,i])}))})):this.obtainMasterConnection()},e.prototype.createGeneratedMap=function(e,t){var n=this;if(t)return Object.keys(t).reduce((function(r,i){var a=e.findColumnWithDatabaseName(i);return a&&l.a.mergeDeep(r,a.createValueMap(n.prepareHydratedValue(t[i],a))),r}),{})},e.prototype.findChangedColumns=function(e,t){var n=this;return t.filter((function(t){var r=e.find((function(e){return e.name===t.databaseName}));return!!r&&(r.name!==t.databaseName||r.type!==n.normalizeType(t)||r.length!==t.length||r.precision!==t.precision||r.scale!==t.scale||!r.isGenerated&&n.lowerDefaultValueIfNecessary(n.normalizeDefault(t))!==r.default||r.isPrimary!==t.isPrimary||r.isNullable!==t.isNullable||r.isUnique!==n.normalizeIsUnique(t)||r.isGenerated!==t.isGenerated)}))},e.prototype.lowerDefaultValueIfNecessary=function(e){return e?e.split("'").map((function(e,t){return t%2===1?e:e.toLowerCase()})).join("'"):e},e.prototype.isReturningSqlSupported=function(){return!0},e.prototype.isUUIDGenerationSupported=function(){return!0},e.prototype.createParameter=function(e,t){return"$"+(t+1)},e.prototype.loadStreamDependency=function(){try{return u.a.load("pg-query-stream")}catch(e){throw new Error("To use streams you should install pg-query-stream package. Please run npm i pg-query-stream --save command.")}},e.prototype.loadDependencies=function(){try{this.postgres=u.a.load("pg");try{u.a.load("pg-native")&&this.postgres.native&&(this.postgres=this.postgres.native)}catch(e){}}catch(e){throw new a.a("Postgres","pg")}},e.prototype.createPool=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,s;return r.d(this,(function(r){return t=Object.assign({},t,o.a.buildDriverOptions(t)),n=Object.assign({},{host:t.host,user:t.username,password:t.password,database:t.database,port:t.port,ssl:t.ssl},e.extra||{}),i=new this.postgres.Pool(n),a=this.connection.logger,s=e.poolErrorHandler||function(e){return a.log("warn","Postgres pool raised an error. "+e)},i.on("error",s),[2,new Promise((function(e,t){i.connect((function(n,r,a){if(n)return t(n);a(),e(i)}))}))]}))}))},e.prototype.closePool=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,Promise.all(this.connectedQueryRunners.map((function(e){return e.release()})))];case 1:return t.sent(),[2,new Promise((function(t,n){e.end((function(e){return e?n(e):t()}))}))]}}))}))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(n,r){var i=e.call(this)||this;return i.name="DriverPackageNotInstalledError",Object.setPrototypeOf(i,t.prototype),i.message=n+" package has not been found installed. Try to install it: npm install "+r+" --save",i}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0),i=n(6),a=n(3),o=n(7),s=n(16),u=n(21),c=function(){function e(e){this.length="",this.isPrimary=!1,this.isGenerated=!1,this.isNullable=!1,this.isSelect=!0,this.isInsert=!0,this.isUpdate=!0,this.comment="",this.zerofill=!1,this.unsigned=!1,this.isArray=!1,this.isVirtual=!1,this.isDiscriminator=!1,this.isTreeLevel=!1,this.isCreateDate=!1,this.isUpdateDate=!1,this.isDeleteDate=!1,this.isVersion=!1,this.isObjectId=!1,this.isNestedSetLeft=!1,this.isNestedSetRight=!1,this.isMaterializedPath=!1,this.entityMetadata=e.entityMetadata,this.embeddedMetadata=e.embeddedMetadata,this.referencedColumn=e.referencedColumn,e.args.target&&(this.target=e.args.target),e.args.propertyName&&(this.propertyName=e.args.propertyName),e.args.options.name&&(this.givenDatabaseName=e.args.options.name),e.args.options.type&&(this.type=e.args.options.type),e.args.options.length&&(this.length=e.args.options.length?e.args.options.length.toString():""),e.args.options.width&&(this.width=e.args.options.width),e.args.options.charset&&(this.charset=e.args.options.charset),e.args.options.collation&&(this.collation=e.args.options.collation),e.args.options.primary&&(this.isPrimary=e.args.options.primary),null===e.args.options.default&&(this.isNullable=!0),void 0!==e.args.options.nullable&&(this.isNullable=e.args.options.nullable),void 0!==e.args.options.select&&(this.isSelect=e.args.options.select),void 0!==e.args.options.insert&&(this.isInsert=e.args.options.insert),void 0!==e.args.options.update&&(this.isUpdate=e.args.options.update),void 0!==e.args.options.readonly&&(this.isUpdate=!e.args.options.readonly),e.args.options.comment&&(this.comment=e.args.options.comment),void 0!==e.args.options.default&&(this.default=e.args.options.default),e.args.options.onUpdate&&(this.onUpdate=e.args.options.onUpdate),null!==e.args.options.scale&&void 0!==e.args.options.scale&&(this.scale=e.args.options.scale),e.args.options.zerofill&&(this.zerofill=e.args.options.zerofill,this.unsigned=!0),e.args.options.unsigned&&(this.unsigned=e.args.options.unsigned),void 0!==e.args.options.precision&&(this.precision=e.args.options.precision),e.args.options.enum&&(e.args.options.enum instanceof Object&&!Array.isArray(e.args.options.enum)?this.enum=Object.keys(e.args.options.enum).filter((function(e){return isNaN(+e)})).map((function(t){return e.args.options.enum[t]})):this.enum=e.args.options.enum),e.args.options.enumName&&(this.enumName=e.args.options.enumName),e.args.options.asExpression&&(this.asExpression=e.args.options.asExpression,this.generatedType=e.args.options.generatedType?e.args.options.generatedType:"VIRTUAL"),e.args.options.hstoreType&&(this.hstoreType=e.args.options.hstoreType),e.args.options.array&&(this.isArray=e.args.options.array),e.args.mode&&(this.isVirtual="virtual"===e.args.mode,this.isTreeLevel="treeLevel"===e.args.mode,this.isCreateDate="createDate"===e.args.mode,this.isUpdateDate="updateDate"===e.args.mode,this.isDeleteDate="deleteDate"===e.args.mode,this.isVersion="version"===e.args.mode,this.isObjectId="objectId"===e.args.mode),e.args.options.transformer&&(this.transformer=e.args.options.transformer),e.args.options.spatialFeatureType&&(this.spatialFeatureType=e.args.options.spatialFeatureType),void 0!==e.args.options.srid&&(this.srid=e.args.options.srid),this.isTreeLevel&&(this.type=e.connection.driver.mappedDataTypes.treeLevel),this.isCreateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.createDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.createDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.createDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.createDatePrecision)),this.isUpdateDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.updateDate),this.default||(this.default=function(){return e.connection.driver.mappedDataTypes.updateDateDefault}),void 0===this.precision&&e.connection.driver.mappedDataTypes.updateDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.updateDatePrecision)),this.isDeleteDate&&(this.type||(this.type=e.connection.driver.mappedDataTypes.deleteDate),this.isNullable||(this.isNullable=e.connection.driver.mappedDataTypes.deleteDateNullable),void 0===this.precision&&e.connection.driver.mappedDataTypes.deleteDatePrecision&&(this.precision=e.connection.driver.mappedDataTypes.deleteDatePrecision)),this.isVersion&&(this.type=e.connection.driver.mappedDataTypes.version),e.closureType&&(this.closureType=e.closureType),e.nestedSetLeft&&(this.isNestedSetLeft=e.nestedSetLeft),e.nestedSetRight&&(this.isNestedSetRight=e.nestedSetRight),e.materializedPath&&(this.isMaterializedPath=e.materializedPath)}return e.prototype.createValueMap=function(e,t){var n,i=this;if(void 0===t&&(t=!1),this.embeddedMetadata){return function n(r,a){var o=r.shift();return o?(a[o]={},n(r,a[o]),a):("increment"!==i.generationStrategy&&"rowid"!==i.generationStrategy||"bigint"!==i.type||(e=String(e)),a[t?i.databaseName:i.propertyName]=e,a)}(r.f(this.embeddedMetadata.parentPropertyNames),{})}return"increment"!==this.generationStrategy&&"rowid"!==this.generationStrategy||"bigint"!==this.type||(e=String(e)),(n={})[t?this.databaseName:this.propertyName]=e,n},e.prototype.getEntityValueMap=function(e,t){var n,a,o=this;if(this.embeddedMetadata){return function e(t,n,r){var i=t.shift();if(void 0===n)return r;if(i){var a={};return e(t,n[i],a),Object.keys(a).length>0&&(r[i]=a),r}return void 0!==n[o.propertyName]&&(r[o.propertyName]=n[o.propertyName]),r}(r.f(this.embeddedMetadata.parentPropertyNames),e,s={}),Object.keys(s).length>0?s:void 0}if(this.relationMetadata&&e[this.propertyName]&&e[this.propertyName]instanceof Object){var s=this.relationMetadata.joinColumns.reduce((function(t,n){var r=n.referencedColumn.getEntityValueMap(e[o.propertyName]);return void 0===r?t:i.a.mergeDeep(t,r)}),{});return Object.keys(s).length>0?((n={})[this.propertyName]=s,n):void 0}return void 0!==e[this.propertyName]?((a={})[this.propertyName]=e[this.propertyName],a):void 0},e.prototype.getEntityValue=function(e,t){if(void 0===t&&(t=!1),void 0!==e&&null!==e){var n=void 0;if(this.embeddedMetadata){var i=function e(t,n){var r=t.shift();return r&&n?e(t,n[r]):n}(r.f(this.embeddedMetadata.parentPropertyNames),e);if(i)if(this.relationMetadata&&this.referencedColumn)n=(a=this.relationMetadata.getEntityValue(i))&&a instanceof Object&&!(a instanceof s.a)?this.referencedColumn.getEntityValue(o.a.extractValue(a)):i[this.propertyName]&&i[this.propertyName]instanceof Object&&!(i[this.propertyName]instanceof s.a)?this.referencedColumn.getEntityValue(o.a.extractValue(i[this.propertyName])):o.a.extractValue(i[this.propertyName]);else n=this.referencedColumn?this.referencedColumn.getEntityValue(o.a.extractValue(i[this.propertyName])):o.a.extractValue(i[this.propertyName])}else{var a;if(this.relationMetadata&&this.referencedColumn)n=!((a=this.relationMetadata.getEntityValue(e))&&a instanceof Object)||a instanceof s.a||a instanceof Function?!(e[this.propertyName]&&e[this.propertyName]instanceof Object)||e[this.propertyName]instanceof s.a||e[this.propertyName]instanceof Function?e[this.propertyName]:this.referencedColumn.getEntityValue(o.a.extractValue(e[this.propertyName])):this.referencedColumn.getEntityValue(o.a.extractValue(a));else n=this.referencedColumn?this.referencedColumn.getEntityValue(o.a.extractValue(e[this.propertyName])):e[this.propertyName]}return t&&this.transformer&&(n=u.a.transformTo(this.transformer,n)),n}},e.prototype.setEntityValue=function(e,t){var n=this;if(this.embeddedMetadata){return function e(r,i){var a=r.shift();return a?(i[a.propertyName]||(i[a.propertyName]=a.create()),e(r,i[a.propertyName]),i):(i[n.propertyName]=t,i)}(r.f(this.embeddedMetadata.embeddedMetadataTree),e)}e[this.propertyName]=t},e.prototype.build=function(e){return this.propertyPath=this.buildPropertyPath(),this.propertyAliasName=this.propertyPath.replace(".","_"),this.databaseName=this.buildDatabaseName(e),this.databasePath=this.buildDatabasePath(),this.databaseNameWithoutPrefixes=e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,[]),this},e.prototype.buildPropertyPath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.propertyName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.propertyName!==this.propertyName&&(e+="."+this.referencedColumn.propertyName),e},e.prototype.buildDatabasePath=function(){var e="";return this.embeddedMetadata&&this.embeddedMetadata.parentPropertyNames.length&&(e=this.embeddedMetadata.parentPropertyNames.join(".")+"."),e+=this.databaseName,!this.entityMetadata.isJunction&&this.isVirtual&&this.referencedColumn&&this.referencedColumn.databaseName!==this.databaseName&&(e+="."+this.referencedColumn.databaseName),e},e.prototype.buildDatabaseName=function(e){var t=this.embeddedMetadata?this.embeddedMetadata.parentPrefixes:[];return e.driver instanceof a.a&&(t=[]),e.namingStrategy.columnName(this.propertyName,this.givenDatabaseName,t)},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){this.count=0,this.promises=[]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var r=n(0),i=n(3),a=n(24),o=n(9),s=function(e){function t(n,r){var i=e.call(this)||this;i.name="CannotCreateEntityIdMapError",Object.setPrototypeOf(i,t.prototype);var a=n.primaryColumns.reduce((function(e,t,n){return t.setEntityValue(e,n+1),e}),{});return i.message='Cannot use given entity id "'+r+'" because "'+n.targetName+'" contains multiple primary columns, you must provide object in following form: '+JSON.stringify(a)+" as an id.",i}return r.c(t,e),t}(Error),u=n(6),c=n(38),l=function(){function e(e){this.childEntityMetadatas=[],this.inheritanceTree=[],this.tableType="regular",this.withoutRowid=!1,this.synchronize=!0,this.hasNonNullableRelations=!1,this.isJunction=!1,this.isClosureJunction=!1,this.hasMultiplePrimaryKeys=!1,this.hasUUIDGeneratedColumns=!1,this.ownColumns=[],this.columns=[],this.ancestorColumns=[],this.descendantColumns=[],this.nonVirtualColumns=[],this.ownerColumns=[],this.inverseColumns=[],this.generatedColumns=[],this.primaryColumns=[],this.ownRelations=[],this.relations=[],this.eagerRelations=[],this.lazyRelations=[],this.oneToOneRelations=[],this.ownerOneToOneRelations=[],this.oneToManyRelations=[],this.manyToOneRelations=[],this.manyToManyRelations=[],this.ownerManyToManyRelations=[],this.relationsWithJoinColumns=[],this.relationIds=[],this.relationCounts=[],this.foreignKeys=[],this.embeddeds=[],this.allEmbeddeds=[],this.ownIndices=[],this.indices=[],this.uniques=[],this.ownUniques=[],this.checks=[],this.exclusions=[],this.ownListeners=[],this.listeners=[],this.afterLoadListeners=[],this.beforeInsertListeners=[],this.afterInsertListeners=[],this.beforeUpdateListeners=[],this.afterUpdateListeners=[],this.beforeRemoveListeners=[],this.afterRemoveListeners=[],this.connection=e.connection,this.inheritanceTree=e.inheritanceTree||[],this.inheritancePattern=e.inheritancePattern,this.treeType=e.tableTree?e.tableTree.type:void 0,this.parentClosureEntityMetadata=e.parentClosureEntityMetadata,this.tableMetadataArgs=e.args,this.target=this.tableMetadataArgs.target,this.tableType=this.tableMetadataArgs.type,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=this.tableMetadataArgs.withoutRowid}return e.prototype.create=function(e){var t,n=this;if(this.target instanceof Function)return t=new this.target,this.lazyRelations.forEach((function(r){return n.connection.relationLoader.enableLazyLoad(r,t,e)})),t;var r={};return this.lazyRelations.forEach((function(t){return n.connection.relationLoader.enableLazyLoad(t,r,e)})),r},e.prototype.hasId=function(e){return!!e&&this.primaryColumns.every((function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n&&""!==n}))},e.prototype.hasAllPrimaryKeys=function(e){return this.primaryColumns.every((function(t){var n=t.getEntityValue(e);return null!==n&&void 0!==n}))},e.prototype.ensureEntityIdMap=function(e){if(e instanceof Object)return e;if(this.hasMultiplePrimaryKeys)throw new s(this,e);return this.primaryColumns[0].createValueMap(e)},e.prototype.getEntityIdMap=function(t){if(t)return e.getValueMap(t,this.primaryColumns,{skipNulls:!0})},e.prototype.getEntityIdMixedMap=function(e){if(!e)return e;var t=this.getEntityIdMap(e);return this.hasMultiplePrimaryKeys?t:t?this.primaryColumns[0].getEntityValue(t):t},e.prototype.compareEntities=function(e,t){var n=this.getEntityIdMap(e);if(!n)return!1;var r=this.getEntityIdMap(t);return!!r&&u.a.compareIds(n,r)},e.prototype.findColumnWithPropertyName=function(e){return this.columns.find((function(t){return t.propertyName===e}))},e.prototype.findColumnWithDatabaseName=function(e){return this.columns.find((function(t){return t.databaseName===e}))},e.prototype.findColumnWithPropertyPath=function(e){var t=this.columns.find((function(t){return t.propertyPath===e}));if(t)return t;var n=this.relations.find((function(t){return t.propertyPath===e}));return n&&1===n.joinColumns.length?n.joinColumns[0]:void 0},e.prototype.findColumnsWithPropertyPath=function(e){var t=this.columns.find((function(t){return t.propertyPath===e}));if(t)return[t];var n=this.relations.find((function(t){return t.propertyPath===e}));return n&&n.joinColumns?n.joinColumns:[]},e.prototype.findRelationWithPropertyPath=function(e){return this.relations.find((function(t){return t.propertyPath===e}))},e.prototype.hasEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.some((function(t){return t.propertyPath===e}))},e.prototype.findEmbeddedWithPropertyPath=function(e){return this.allEmbeddeds.find((function(t){return t.propertyPath===e}))},e.prototype.extractRelationValuesFromEntity=function(e,t){var n=[];return t.forEach((function(t){var r=t.getEntityValue(e);Array.isArray(r)?r.forEach((function(e){return n.push([t,e,t.inverseEntityMetadata])})):r&&n.push([t,r,t.inverseEntityMetadata])})),n},e.createPropertyPath=function(e,t,n){var i=this;void 0===n&&(n="");var a=[];return Object.keys(t).forEach((function(o){var s=n?n+"."+o:o;if(e.hasEmbeddedWithPropertyPath(s)){var u=i.createPropertyPath(e,t[o],s);a.push.apply(a,r.f(u))}else{var c=n?n+"."+o:o;a.push(c)}})),a},e.difference=function(e,t){return e.filter((function(e){return!t.find((function(t){return u.a.compareIds(e,t)}))}))},e.getValueMap=function(e,t,n){return t.reduce((function(t,r){var i=r.getEntityValueMap(e,n);if(void 0!==t&&null!==i&&void 0!==i)return r.isObjectId?Object.assign(t,i):u.a.mergeDeep(t,i)}),{})},e.prototype.build=function(){var e=this.connection.namingStrategy,t=this.connection.options.entityPrefix;this.engine=this.tableMetadataArgs.engine,this.database="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.database:this.tableMetadataArgs.database,this.tableMetadataArgs.schema?this.schema=this.tableMetadataArgs.schema:"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.schema=this.parentEntityMetadata.schema:this.schema=this.connection.options.schema,this.givenTableName="entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.parentEntityMetadata.givenTableName:this.tableMetadataArgs.name,this.synchronize=!1!==this.tableMetadataArgs.synchronize,this.targetName=this.tableMetadataArgs.target instanceof Function?this.tableMetadataArgs.target.name:this.tableMetadataArgs.target,"closure-junction"===this.tableMetadataArgs.type?this.tableNameWithoutPrefix=e.closureJunctionTableName(this.givenTableName):"entity-child"===this.tableMetadataArgs.type&&this.parentEntityMetadata?this.tableNameWithoutPrefix=e.tableName(this.parentEntityMetadata.targetName,this.parentEntityMetadata.givenTableName):(this.tableNameWithoutPrefix=e.tableName(this.targetName,this.givenTableName),this.connection.driver.maxAliasLength&&this.connection.driver.maxAliasLength>0&&this.tableNameWithoutPrefix.length>this.connection.driver.maxAliasLength&&(this.tableNameWithoutPrefix=Object(c.c)(this.tableNameWithoutPrefix,{separator:"_",segmentLength:3}))),this.tableName=t?e.prefixTableName(t,this.tableNameWithoutPrefix):this.tableNameWithoutPrefix,this.target=this.target?this.target:this.tableName,this.name=this.targetName?this.targetName:this.tableName,this.expression=this.tableMetadataArgs.expression,this.withoutRowid=!0===this.tableMetadataArgs.withoutRowid,this.tablePath=this.buildTablePath(),this.schemaPath=this.buildSchemaPath(),this.orderBy=this.tableMetadataArgs.orderBy instanceof Function?this.tableMetadataArgs.orderBy(this.propertiesMap):this.tableMetadataArgs.orderBy,this.isJunction="closure-junction"===this.tableMetadataArgs.type||"junction"===this.tableMetadataArgs.type,this.isClosureJunction="closure-junction"===this.tableMetadataArgs.type},e.prototype.registerColumn=function(e){-1===this.ownColumns.indexOf(e)&&(this.ownColumns.push(e),this.columns=this.embeddeds.reduce((function(e,t){return e.concat(t.columnsFromTree)}),this.ownColumns),this.primaryColumns=this.columns.filter((function(e){return e.isPrimary})),this.hasMultiplePrimaryKeys=this.primaryColumns.length>1,this.hasUUIDGeneratedColumns=this.columns.filter((function(e){return e.isGenerated||"uuid"===e.generationStrategy})).length>0,this.propertiesMap=this.createPropertiesMap(),this.childEntityMetadatas&&this.childEntityMetadatas.forEach((function(t){return t.registerColumn(e)})))},e.prototype.createPropertiesMap=function(){var e={};return this.columns.forEach((function(t){return u.a.mergeDeep(e,t.createValueMap(t.propertyPath))})),this.relations.forEach((function(t){return u.a.mergeDeep(e,t.createValueMap(t.propertyPath))})),e},e.prototype.buildTablePath=function(){var e=this.tableName;return this.schema&&(this.connection.driver instanceof i.f||this.connection.driver instanceof o.a||this.connection.driver instanceof a.a)&&(e=this.schema+"."+e),!this.database||this.connection.driver instanceof i.f||(e=!this.schema&&this.connection.driver instanceof o.a?this.database+".."+e:this.database+"."+e),e},e.prototype.buildSchemaPath=function(){if(this.schema)return!this.database||this.connection.driver instanceof i.f?this.schema:this.database+"."+this.schema},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name="DriverOptionNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Driver option ("+n+") is not set. Please set it to perform connection to the database.",r}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(0),i=n(26),a=function(){function e(e){i.a.assign(this,e||{})}return Object.defineProperty(e.prototype,"target",{get:function(){return this.metadata.target},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"hasMetadata",{get:function(){return!!this._metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!this._metadata)throw new Error('Cannot get entity metadata for the given alias "'+this.name+'"');return this._metadata},set:function(e){this._metadata=e},enumerable:!0,configurable:!0}),e}(),o=n(65),s=n(56),u=n(57),c=function(){function e(e){this.connection=e,this.queryEntity=!1,this.aliases=[],this.queryType="select",this.selects=[],this.selectDistinct=!1,this.selectDistinctOn=[],this.extraReturningColumns=[],this.onConflict="",this.onIgnore=!1,this.joinAttributes=[],this.relationIdAttributes=[],this.relationCountAttributes=[],this.wheres=[],this.havings=[],this.orderBys={},this.groupBys=[],this.withDeleted=!1,this.parameters={},this.disableEscaping=!0,this.enableRelationIdValues=!1,this.extraAppendedAndWhereCondition="",this.subQuery=!1,this.aliasNamePrefixingEnabled=!0,this.cache=!1,this.options=[],this.insertColumns=[],this.whereEntities=[],this.updateEntity=!0,this.callListeners=!0,this.useTransaction=!1,this.nativeParameters={}}return Object.defineProperty(e.prototype,"allOrderBys",{get:function(){var e=this;if(!Object.keys(this.orderBys).length&&this.mainAlias.hasMetadata&&-1===this.options.indexOf("disable-global-order")){var t=this.mainAlias.metadata.orderBy||{};return Object.keys(t).reduce((function(n,r){return n[e.mainAlias.name+"."+r]=t[r],n}),{})}return this.orderBys},enumerable:!0,configurable:!0}),e.prototype.setMainAlias=function(e){return this.mainAlias=e,e},e.prototype.createAlias=function(e){var t=e.name;!t&&e.tablePath&&(t=e.tablePath),!t&&e.target instanceof Function&&(t=e.target.name),t||"string"!==typeof e.target||(t=e.target);var n=new a;return n.type=e.type,t&&(n.name=t),e.metadata&&(n.metadata=e.metadata),e.target&&!n.hasMetadata&&(n.metadata=this.connection.getMetadata(e.target)),e.tablePath&&(n.tablePath=e.tablePath),e.subQuery&&(n.subQuery=e.subQuery),this.aliases.push(n),n},e.prototype.findAliasByName=function(e){var t=this.aliases.find((function(t){return t.name===e}));if(!t)throw new Error('"'+e+'" alias was not found. Maybe you forgot to join it?');return t},e.prototype.findColumnByAliasExpression=function(e){var t=r.e(e.split("."),2),n=t[0],i=t[1];return this.findAliasByName(n).metadata.findColumnWithPropertyName(i)},Object.defineProperty(e.prototype,"relationMetadata",{get:function(){if(!this.mainAlias)throw new Error("Entity to work with is not specified!");var e=this.mainAlias.metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation "+this.relationPropertyPath+" was not found in entity "+this.mainAlias.name);return e},enumerable:!0,configurable:!0}),e.prototype.clone=function(){var t=this,n=new e(this.connection);return n.queryType=this.queryType,n.selects=this.selects.map((function(e){return e})),n.selectDistinct=this.selectDistinct,n.selectDistinctOn=this.selectDistinctOn,this.aliases.forEach((function(e){return n.aliases.push(new a(e))})),n.mainAlias=this.mainAlias,n.valuesSet=this.valuesSet,n.returning=this.returning,n.onConflict=this.onConflict,n.onIgnore=this.onIgnore,n.onUpdate=this.onUpdate,n.joinAttributes=this.joinAttributes.map((function(e){return new o.a(t.connection,t,e)})),n.relationIdAttributes=this.relationIdAttributes.map((function(e){return new s.a(t,e)})),n.relationCountAttributes=this.relationCountAttributes.map((function(e){return new u.a(t,e)})),n.wheres=this.wheres.map((function(e){return r.a({},e)})),n.havings=this.havings.map((function(e){return r.a({},e)})),n.orderBys=Object.assign({},this.orderBys),n.groupBys=this.groupBys.map((function(e){return e})),n.limit=this.limit,n.offset=this.offset,n.skip=this.skip,n.take=this.take,n.lockMode=this.lockMode,n.lockVersion=this.lockVersion,n.withDeleted=this.withDeleted,n.parameters=Object.assign({},this.parameters),n.disableEscaping=this.disableEscaping,n.enableRelationIdValues=this.enableRelationIdValues,n.extraAppendedAndWhereCondition=this.extraAppendedAndWhereCondition,n.subQuery=this.subQuery,n.aliasNamePrefixingEnabled=this.aliasNamePrefixingEnabled,n.cache=this.cache,n.cacheId=this.cacheId,n.cacheDuration=this.cacheDuration,n.relationPropertyPath=this.relationPropertyPath,n.of=this.of,n.insertColumns=this.insertColumns,n.whereEntities=this.whereEntities,n.updateEntity=this.updateEntity,n.callListeners=this.callListeners,n.useTransaction=this.useTransaction,n.nativeParameters=Object.assign({},this.nativeParameters),n},e}(),l=n(62),h=n(33),p=n(37),f=n(9),d=n(12),m=n(14),y=n(16),v=n(63),g=n(66),b=function(){function e(t,n){t instanceof e?(this.connection=t.connection,this.queryRunner=t.queryRunner,this.expressionMap=t.expressionMap.clone()):(this.connection=t,this.queryRunner=n,this.expressionMap=new c(this.connection))}return Object.defineProperty(e.prototype,"alias",{get:function(){if(!this.expressionMap.mainAlias)throw new Error("Main alias is not set");return this.expressionMap.mainAlias.name},enumerable:!0,configurable:!0}),e.prototype.select=function(e,t){this.expressionMap.queryType="select",Array.isArray(e)?this.expressionMap.selects=e.map((function(e){return{selection:e}})):e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);var r=n(54).SelectQueryBuilder;return this instanceof r?this:new r(this)},e.prototype.insert=function(){this.expressionMap.queryType="insert";var e=n(72).InsertQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.update=function(e,t){var r=t||e;if((e=e instanceof m.a?e.options.name:e)instanceof Function||"string"===typeof e){var i=this.createFromAlias(e);this.expressionMap.setMainAlias(i)}this.expressionMap.queryType="update",this.expressionMap.valuesSet=r;var a=n(69).UpdateQueryBuilder;return this instanceof a?this:new a(this)},e.prototype.delete=function(){this.expressionMap.queryType="delete";var e=n(70).DeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.softDelete=function(){this.expressionMap.queryType="soft-delete";var e=n(78).SoftDeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.restore=function(){this.expressionMap.queryType="restore";var e=n(78).SoftDeleteQueryBuilder;return this instanceof e?this:new e(this)},e.prototype.relation=function(e,t){var r=2===arguments.length?e:void 0,i=2===arguments.length?t:e;if(this.expressionMap.queryType="relation",this.expressionMap.relationPropertyPath=i,r){var a=this.createFromAlias(r);this.expressionMap.setMainAlias(a)}var o=n(71).RelationQueryBuilder;return this instanceof o?this:new o(this)},e.prototype.hasRelation=function(e,t){var n=this.connection.getMetadata(e);return(Array.isArray(t)?t:[t]).every((function(e){return!!n.findRelationWithPropertyPath(e)}))},e.prototype.setParameter=function(e,t){return this.expressionMap.parameters[e]=t,this},e.prototype.setParameters=function(e){var t=this;return Object.keys(e).forEach((function(t){if(e[t]instanceof Function)throw new Error("Function parameter isn't supported in the parameters. Please check \""+t+'" parameter.')})),this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setParameters(e),Object.keys(e).forEach((function(n){return t.setParameter(n,e[n])})),this},e.prototype.setNativeParameters=function(e){var t=this;return this.expressionMap.parentQueryBuilder&&this.expressionMap.parentQueryBuilder.setNativeParameters(e),Object.keys(e).forEach((function(n){t.expressionMap.nativeParameters[n]=e[n]})),this},e.prototype.getParameters=function(){var e=Object.assign({},this.expressionMap.parameters);if(this.expressionMap.mainAlias&&this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if(t.discriminatorColumn&&t.parentEntityMetadata){var n=t.childEntityMetadatas.filter((function(e){return e.discriminatorColumn})).map((function(e){return e.discriminatorValue}));n.push(t.discriminatorValue),e.discriminatorColumnValues=n}}return e},e.prototype.printSql=function(){var e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1];return this.connection.logger.logQuery(t,n),this},e.prototype.getSql=function(){return this.getQueryAndParameters()[0]},e.prototype.getQueryAndParameters=function(){var e=this.getQuery(),t=this.getParameters();return this.connection.driver.escapeQueryWithParameters(e,t,this.expressionMap.nativeParameters)},e.prototype.execute=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i;return r.d(this,(function(a){switch(a.label){case 0:e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a.label=1;case 1:return a.trys.push([1,,3,8]),[4,i.query(t,n)];case 2:return[2,a.sent()];case 3:return i===this.queryRunner?[3,5]:[4,i.release()];case 4:a.sent(),a.label=5;case 5:return this.connection.driver instanceof p.a?[4,this.connection.driver.autoSave()]:[3,7];case 6:a.sent(),a.label=7;case 7:return[7];case 8:return[2]}}))}))},e.prototype.createQueryBuilder=function(){return new this.constructor(this.connection,this.queryRunner)},e.prototype.clone=function(){return new this.constructor(this)},e.prototype.disableEscaping=function(){return this.expressionMap.disableEscaping=!1,this},e.prototype.escape=function(e){return this.expressionMap.disableEscaping?this.connection.driver.escape(e):e},e.prototype.setQueryRunner=function(e){return this.queryRunner=e,this},e.prototype.callListeners=function(e){return this.expressionMap.callListeners=e,this},e.prototype.useTransaction=function(e){return this.expressionMap.useTransaction=e,this},e.prototype.getTableName=function(e){var t=this;return e.split(".").map((function(e){return""===e?e:t.escape(e)})).join(".")},e.prototype.getMainTableName=function(){if(!this.expressionMap.mainAlias)throw new Error('Entity where values should be inserted is not specified. Call "qb.into(entity)" method to specify it.');return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.tablePath:this.expressionMap.mainAlias.tablePath},e.prototype.createFromAlias=function(e,t){if(this.connection.hasMetadata(e)){var n=this.connection.getMetadata(e);return this.expressionMap.createAlias({type:"from",name:t,metadata:this.connection.getMetadata(e),tablePath:n.tablePath})}var r="";if(e instanceof Function){var i=e(this.subQuery());this.setParameters(i.getParameters()),r=i.getQuery()}else r=e;var a=e instanceof Function||"("===e.substr(0,1)&&")"===e.substr(-1);return this.expressionMap.createAlias({type:"from",name:t,tablePath:!1===a?e:void 0,subQuery:!0===a?r:void 0})},e.prototype.replacePropertyNames=function(e){var t=this;return this.expressionMap.aliases.forEach((function(n){if(n.hasMetadata){var i=t.expressionMap.aliasNamePrefixingEnabled?n.name+"\\.":"",a=t.expressionMap.aliasNamePrefixingEnabled?t.escape(n.name)+".":"";n.metadata.columns.forEach((function(n){var r="([ =(]|^.{0})"+i+n.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(r,"gm"),"$1"+a+t.escape(n.databaseName)+"$2");var o="([ =(]|^.{0})"+i+n.propertyName+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+a+t.escape(n.databaseName)+"$2")})),n.metadata.relations.forEach((function(n){if(r.f(n.joinColumns,n.inverseJoinColumns).forEach((function(r){var o="([ =(]|^.{0})"+i+n.propertyPath+"\\."+r.referencedColumn.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+a+t.escape(r.databaseName)+"$2")})),n.joinColumns.length>0){var o="([ =(]|^.{0})"+i+n.propertyPath+"([ =),]|.{0}$)";e=e.replace(new RegExp(o,"gm"),"$1"+a+t.escape(n.joinColumns[0].databaseName)+"$2")}}))}})),e},e.prototype.createWhereExpression=function(){var e=this.createWhereExpressionString();if(this.expressionMap.mainAlias.hasMetadata){var t=this.expressionMap.mainAlias.metadata;if("select"===this.expressionMap.queryType&&!this.expressionMap.withDeleted&&t.deleteDateColumn){var n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.deleteDateColumn.propertyName:t.deleteDateColumn.propertyName,r=this.replacePropertyNames(n)+" IS NULL";e=(e.length?"("+e+") AND":"")+" "+r}if(t.discriminatorColumn&&t.parentEntityMetadata){n=this.expressionMap.aliasNamePrefixingEnabled?this.expressionMap.mainAlias.name+"."+t.discriminatorColumn.databaseName:t.discriminatorColumn.databaseName,r=this.replacePropertyNames(n)+" IN (:...discriminatorColumnValues)";return" WHERE "+(e.length?"("+e+") AND":"")+" "+r}}return e.length?this.expressionMap.extraAppendedAndWhereCondition?" WHERE ("+e+") AND "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):" WHERE "+e:this.expressionMap.extraAppendedAndWhereCondition?" WHERE "+this.replacePropertyNames(this.expressionMap.extraAppendedAndWhereCondition):""},e.prototype.createReturningExpression=function(){var e=this,t=this.getReturningColumns(),n=this.connection.driver;if("string"!==typeof this.expressionMap.returning&&this.expressionMap.extraReturningColumns.length>0&&n.isReturningSqlSupported()&&t.push.apply(t,r.f(this.expressionMap.extraReturningColumns.filter((function(e){return-1===t.indexOf(e)})))),t.length){var i=t.map((function(t){var r=e.escape(t.databaseName);return n instanceof f.a?"insert"===e.expressionMap.queryType||"update"===e.expressionMap.queryType||"soft-delete"===e.expressionMap.queryType||"restore"===e.expressionMap.queryType?"INSERTED."+r:e.escape(e.getMainTableName())+"."+r:r})).join(", ");return n instanceof d.a&&(i+=" INTO "+t.map((function(t){var r="output_"+t.databaseName;return e.expressionMap.nativeParameters[r]={type:n.columnTypeToNativeParameter(t.type),dir:n.oracle.BIND_OUT},e.connection.driver.createParameter(r,Object.keys(e.expressionMap.nativeParameters).length)})).join(", ")),n instanceof f.a&&("insert"!==this.expressionMap.queryType&&"update"!==this.expressionMap.queryType||(i+=" INTO @OutputTable")),i}return"string"===typeof this.expressionMap.returning?this.expressionMap.returning:""},e.prototype.getReturningColumns=function(){var e=this,t=[];return Array.isArray(this.expressionMap.returning)&&this.expressionMap.returning.forEach((function(n){e.expressionMap.mainAlias.hasMetadata&&t.push.apply(t,r.f(e.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(n)))})),t},e.prototype.createWhereExpressionString=function(){var e=this;return this.expressionMap.wheres.map((function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}})).join(" ")},e.prototype.createWhereIdsExpression=function(e){var t,n=this,r=this.expressionMap.mainAlias.metadata,i=(Array.isArray(e)?e:[e]).map((function(e){return r.ensureEntityIdMap(e)}));if(!r.hasMultiplePrimaryKeys&&0===r.embeddeds.length){var a=r.primaryColumns[0];if(!a.transformer)return this.computeWhereParameter(((t={})[a.propertyName]=Object(v.a)(i.map((function(e){return a.getEntityValue(e,!1)}))),t))}var o=this.expressionMap.aliasNamePrefixingEnabled?this.escape(this.expressionMap.mainAlias.name)+".":"",s=Object.keys(this.expressionMap.nativeParameters).length,u=i.map((function(e,t){var i=[];return r.primaryColumns.forEach((function(r,a){var u="id_"+t+"_"+a;i.push(o+n.escape(r.databaseName)+" = "+n.connection.driver.createParameter(u,s)),n.expressionMap.nativeParameters[u]=r.getEntityValue(e,!0),s++})),i.join(" AND ")}));return u.length>1?"("+u.map((function(e){return"("+e+")"})).join(" OR ")+")":u[0]},e.prototype.computeWhereParameter=function(e){var t=this;if("string"===typeof e)return e;if(e instanceof l.a){var n=this.createQueryBuilder();e.whereFactory(n);var r=n.createWhereExpressionString();return this.setParameters(n.getParameters()),r?"("+r+")":""}if(e instanceof Function)return e(this);if(e instanceof Object){var i=Array.isArray(e)?e:[e],a=void 0,o=Object.keys(this.expressionMap.nativeParameters).length;return(a=this.expressionMap.mainAlias.hasMetadata?i.map((function(e,n){return h.a.createPropertyPath(t.expressionMap.mainAlias.metadata,e).map((function(r,i){var a=t.expressionMap.mainAlias.metadata.findColumnsWithPropertyPath(r);if(!a.length)throw new g.a(r);return a.map((function(a,s){var u=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:a.propertyPath,c=a.getEntityValue(e,!0),l="where_"+n+"_"+i+"_"+s,h=Object.keys(t.expressionMap.nativeParameters).filter((function(e){return e.startsWith(l)})).length;if(null===c)return u+" IS NULL";if(c instanceof y.a){var p=[];if(c.useParameter)(c.multipleParameters?c.value:[c.value]).forEach((function(e,n){t.expressionMap.nativeParameters[l+(h+n)]=e,o++,p.push(t.connection.driver.createParameter(l+(h+n),o-1))}));return c.toSql(t.connection,u,p)}return t.expressionMap.nativeParameters[l]=c,o++,u+" = "+t.connection.driver.createParameter(l,o-1)})).filter((function(e){return!!e})).join(" AND ")})).filter((function(e){return!!e})).join(" AND ")})):i.map((function(e,n){return Object.keys(e).map((function(r,i){var a=e[r],o=t.expressionMap.aliasNamePrefixingEnabled?t.alias+"."+r:r;if(null===a)return o+" IS NULL";var s="where_"+n+"_"+i;return t.expressionMap.nativeParameters[s]=a,i++,o+" = "+t.connection.driver.createParameter(s,i-1)})).join(" AND ")}))).length>1?a.map((function(e){return"("+e+")"})).join(" OR "):a.join("")}return""},e.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("master")},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="TransactionAlreadyStartedError",Object.setPrototypeOf(n,t.prototype),n.message="Transaction already started for the given connection, commit current transaction before starting a new one.",n}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return l}));var r=n(0),i=n(19),a=n(85),o=n(30),s=n(34),u=n(4),c=n(6),l=function(t){function n(e){var n=t.call(this,e)||this;if(n.options.autoSave&&!n.options.location&&!n.options.autoSaveCallback)throw new s.a("location or autoSaveCallback");return n.loadDependencies(),n}return r.c(n,t),n.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:return e=this,[4,this.createDatabaseConnection()];case 1:return e.databaseConnection=t.sent(),[2]}}))}))},n.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){try{e.queryRunner=void 0,e.databaseConnection.close(),t()}catch(r){n(r)}}))]}))}))},n.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.load=function(e,t){return void 0===t&&(t=!0),r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:if("string"!==typeof e)return[3,8];if("node"!==u.a.type)return[3,1];if(u.a.fileExist(e))return n=u.a.readFileSync(e),[2,this.createDatabaseConnectionWithImport(n)];if(t)throw new Error("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 1:return i=null,this.options.useLocalForage?window.localforage?[4,window.localforage.getItem(e)]:[3,3]:[3,5];case 2:return i=r.sent(),[3,4];case 3:throw new Error("localforage is not defined - please import localforage.js into your site");case 4:return[3,6];case 5:i=u.a.getGlobalVariable().localStorage.getItem(e),r.label=6;case 6:if(null!=i)return[2,this.createDatabaseConnectionWithImport(JSON.parse(i))];if(t)throw new Error("File "+e+" does not exist");return[2,this.createDatabaseConnectionWithImport()];case 7:return[3,9];case 8:return[2,this.createDatabaseConnectionWithImport(e)];case 9:return[2]}}))}))},n.prototype.save=function(t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:if(!t&&!this.options.location)throw new Error("No location is set, specify a location parameter or add the location option to your configuration");if(n="",t?n=t:this.options.location&&(n=this.options.location),"node"!==u.a.type)return[3,5];r.label=1;case 1:return r.trys.push([1,3,,4]),i=e.from(this.databaseConnection.export()),[4,u.a.writeFile(n,i)];case 2:return r.sent(),[3,4];case 3:throw a=r.sent(),new Error("Could not save database, error: "+a);case 4:return[3,10];case 5:return o=this.databaseConnection.export(),s=[].slice.call(o),this.options.useLocalForage?window.localforage?[4,window.localforage.setItem(n,JSON.stringify(s))]:[3,7]:[3,9];case 6:return r.sent(),[3,8];case 7:throw new Error("localforage is not defined - please import localforage.js into your site");case 8:return[3,10];case 9:u.a.getGlobalVariable().localStorage.setItem(n,JSON.stringify(s)),r.label=10;case 10:return[2]}}))}))},n.prototype.autoSave=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return this.options.autoSave?this.options.autoSaveCallback?[4,this.options.autoSaveCallback(this.export())]:[3,2]:[3,4];case 1:return e.sent(),[3,4];case 2:return[4,this.save()];case 3:e.sent(),e.label=4;case 4:return[2]}}))}))},n.prototype.export=function(){return this.databaseConnection.export()},n.prototype.createGeneratedMap=function(e,t){var n=this,r=e.generatedColumns.reduce((function(e,t){if(t.isPrimary&&"increment"===t.generationStrategy){var r="SELECT last_insert_rowid()";try{var i=n.databaseConnection.exec(r);return n.connection.logger.logQuery(r),c.a.mergeDeep(e,t.createValueMap(i[0].values[0][0]))}catch(a){n.connection.logger.logQueryError(a,r,[])}}return e}),{});return Object.keys(r).length>0?r:void 0},n.prototype.createDatabaseConnection=function(){return this.options.location?this.load(this.options.location,!1):this.createDatabaseConnectionWithImport(this.options.database)},n.prototype.createDatabaseConnectionWithImport=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return"function"===typeof this.sqlite.Database?(n=this.sqlite,[3,3]):[3,1];case 1:return[4,this.sqlite(this.options.sqlJsConfig)];case 2:n=r.sent(),r.label=3;case 3:return t=n,e&&e.length>0?this.databaseConnection=new t.Database(e):this.databaseConnection=new t.Database,[2,new Promise((function(e,t){try{i.databaseConnection.exec("PRAGMA foreign_keys = ON;"),e(i.databaseConnection)}catch(n){t(n)}}))]}}))}))},n.prototype.loadDependencies=function(){if("browser"===u.a.type)this.sqlite=window.SQL;else try{this.sqlite=u.a.load("sql.js")}catch(e){throw new o.a("sql.js","sql.js")}},n}(i.a)}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return c}));var r=n(80),i=n.n(r);function a(e,t){return void 0===t&&(t=!1),e.replace(/^([A-Z])|[\s-_](\w)/g,(function(e,n,r,i){return!0===t&&0===i?n:r?r.toUpperCase():n.toLowerCase()}))}function o(e){return e.replace(/(?:([a-z])([A-Z]))|(?:((?!^)[A-Z])([a-z]))/g,"$1_$3$2$4").toLowerCase()}function s(e){return e.replace(/\w\S*/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}function u(e,t){void 0===t&&(t={});var n=t.segmentLength,r=void 0===n?4:n,i=t.separator,a=void 0===i?"__":i,o=t.termLength,s=void 0===o?2:o;return e.split(a).reduce((function(e,t){var n=t.replace(/([a-z\xE0-\xFF])([A-Z\xC0-\xDF])/g,"$1 $2").split(" "),i=n.length>1?s:r,a=n.map((function(e){return e.substr(0,i)})).join("");return e.push(a),e}),[]).join(a)}function c(e,t){void 0===t&&(t={});var n=i()("sha256");n.update(e,"utf8");var r=n.digest("hex");return t.length?r.slice(0,t.length):r}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(){function e(){}return e.isAliasProperty=function(e){if("string"!==typeof e||-1===e.indexOf("."))return!1;var t=r.e(e.split("."),2),n=t[0],i=t[1];return!(!n||!i)&&(-1===e.indexOf("(")&&-1===e.indexOf(")"))},e}()},function(e,t,n){"use strict";(function(e){var r=n(97),i=n(98),a=n(99);function o(){return u.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function s(e,t){if(o()<t)throw new RangeError("Invalid typed array length");return u.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=u.prototype:(null===e&&(e=new u(t)),e.length=t),e}function u(e,t,n){if(!u.TYPED_ARRAY_SUPPORT&&!(this instanceof u))return new u(e,t,n);if("number"===typeof e){if("string"===typeof t)throw new Error("If encoding is specified then the first argument must be a string");return h(this,e)}return c(this,e,t,n)}function c(e,t,n,r){if("number"===typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!==typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);u.TYPED_ARRAY_SUPPORT?(e=t).__proto__=u.prototype:e=p(e,t);return e}(e,t,n,r):"string"===typeof t?function(e,t,n){"string"===typeof n&&""!==n||(n="utf8");if(!u.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|d(t,n),i=(e=s(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(u.isBuffer(t)){var n=0|f(t.length);return 0===(e=s(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!==typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!==typeof t.length||(r=t.length)!==r?s(e,0):p(e,t);if("Buffer"===t.type&&a(t.data))return p(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function h(e,t){if(l(t),e=s(e,t<0?0:0|f(t)),!u.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function p(e,t){var n=t.length<0?0:0|f(t.length);e=s(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function f(e){if(e>=o())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o().toString(16)+" bytes");return 0|e}function d(e,t){if(u.isBuffer(e))return e.length;if("undefined"!==typeof ArrayBuffer&&"function"===typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!==typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return k(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return F(e).length;default:if(r)return k(e).length;t=(""+t).toLowerCase(),r=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return O(this,t,n);case"utf8":case"utf-8":return S(this,t,n);case"ascii":return R(this,t,n);case"latin1":case"binary":return M(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function v(e,t,n,r,i){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:g(e,t,n,r,i);if("number"===typeof t)return t&=255,u.TYPED_ARRAY_SUPPORT&&"function"===typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):g(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function g(e,t,n,r,i){var a,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(i){var l=-1;for(a=n;a<s;a++)if(c(e,a)===c(t,-1===l?0:a-l)){if(-1===l&&(l=a),a-l+1===u)return l*o}else-1!==l&&(a-=a-l),l=-1}else for(n+u>s&&(n=s-u),a=n;a>=0;a--){for(var h=!0,p=0;p<u;p++)if(c(e,a+p)!==c(t,p)){h=!1;break}if(h)return a}return-1}function b(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var a=t.length;if(a%2!==0)throw new TypeError("Invalid hex string");r>a/2&&(r=a/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(isNaN(s))return o;e[n+o]=s}return o}function E(e,t,n,r){return V(k(t,e.length-n),e,n,r)}function T(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function N(e,t,n,r){return T(e,t,n,r)}function w(e,t,n,r){return V(F(t),e,n,r)}function A(e,t,n,r){return V(function(e,t){for(var n,r,i,a=[],o=0;o<e.length&&!((t-=2)<0);++o)n=e.charCodeAt(o),r=n>>8,i=n%256,a.push(i),a.push(r);return a}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function S(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var a,o,s,u,c=e[i],l=null,h=c>239?4:c>223?3:c>191?2:1;if(i+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128===(192&(a=e[i+1]))&&(u=(31&c)<<6|63&a)>127&&(l=u);break;case 3:a=e[i+1],o=e[i+2],128===(192&a)&&128===(192&o)&&(u=(15&c)<<12|(63&a)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:a=e[i+1],o=e[i+2],s=e[i+3],128===(192&a)&&128===(192&o)&&128===(192&s)&&(u=(15&c)<<18|(63&a)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),i+=h}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=u,t.SlowBuffer=function(e){+e!=e&&(e=0);return u.alloc(+e)},t.INSPECT_MAX_BYTES=50,u.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"===typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}(),t.kMaxLength=o(),u.poolSize=8192,u._augment=function(e){return e.__proto__=u.prototype,e},u.from=function(e,t,n){return c(null,e,t,n)},u.TYPED_ARRAY_SUPPORT&&(u.prototype.__proto__=Uint8Array.prototype,u.__proto__=Uint8Array,"undefined"!==typeof Symbol&&Symbol.species&&u[Symbol.species]===u&&Object.defineProperty(u,Symbol.species,{value:null,configurable:!0})),u.alloc=function(e,t,n){return function(e,t,n,r){return l(t),t<=0?s(e,t):void 0!==n?"string"===typeof r?s(e,t).fill(n,r):s(e,t).fill(n):s(e,t)}(null,e,t,n)},u.allocUnsafe=function(e){return h(null,e)},u.allocUnsafeSlow=function(e){return h(null,e)},u.isBuffer=function(e){return!(null==e||!e._isBuffer)},u.compare=function(e,t){if(!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,a=Math.min(n,r);i<a;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!a(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var o=e[n];if(!u.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(r,i),i+=o.length}return r},u.byteLength=d,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},u.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):m.apply(this,arguments)},u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},u.prototype.compare=function(e,t,n,r,i){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var a=(i>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(a,o),c=this.slice(r,i),l=e.slice(t,n),h=0;h<s;++h)if(c[h]!==l[h]){a=c[h],o=l[h];break}return a<o?-1:o<a?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return v(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return v(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var a=!1;;)switch(r){case"hex":return b(this,e,t,n);case"utf8":case"utf-8":return E(this,e,t,n);case"ascii":return T(this,e,t,n);case"latin1":case"binary":return N(this,e,t,n);case"base64":return w(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A(this,e,t,n);default:if(a)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),a=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function R(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function M(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function O(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",a=t;a<n;++a)i+=B(e[a]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",a=0;a<r.length;a+=2)i+=String.fromCharCode(r[a]+256*r[a+1]);return i}function x(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function I(e,t,n,r,i,a){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<a)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function _(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,a=Math.min(e.length-n,2);i<a;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,a=Math.min(e.length-n,4);i<a;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function D(e,t,n,r,i,a){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function q(e,t,n,r,a){return a||D(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,a){return a||D(e,0,n,8),i.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),u.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=u.prototype;else{var i=t-e;n=new u(i,void 0);for(var a=0;a<i;++a)n[a]=this[a+e]}return n},u.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r},u.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},u.prototype.readUInt8=function(e,t){return t||x(e,1,this.length),this[e]},u.prototype.readUInt16LE=function(e,t){return t||x(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUInt16BE=function(e,t){return t||x(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUInt32LE=function(e,t){return t||x(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUInt32BE=function(e,t){return t||x(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=this[e],i=1,a=0;++a<t&&(i*=256);)r+=this[e+a]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||x(e,t,this.length);for(var r=t,i=1,a=this[e+--r];r>0&&(i*=256);)a+=this[e+--r]*i;return a>=(i*=128)&&(a-=Math.pow(2,8*t)),a},u.prototype.readInt8=function(e,t){return t||x(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){t||x(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){t||x(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return t||x(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return t||x(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return t||x(e,4,this.length),i.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return t||x(e,4,this.length),i.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return t||x(e,8,this.length),i.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return t||x(e,8,this.length),i.read(this,e,!1,52,8)},u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||I(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,a=0;for(this[t]=255&e;++a<n&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||I(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,a=1;for(this[t+i]=255&e;--i>=0&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,255,0),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):_(this,e,t,!0),t+2},u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,65535,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):_(this,e,t,!1),t+2},u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,4294967295,0),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var a=0,o=1,s=0;for(this[t]=255&e;++a<n&&(o*=256);)e<0&&0===s&&0!==this[t+a-1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);I(this,e,t,n,i-1,-i)}var a=n-1,o=1,s=0;for(this[t+a]=255&e;--a>=0&&(o*=256);)e<0&&0===s&&0!==this[t+a+1]&&(s=1),this[t+a]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,1,127,-128),u.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):_(this,e,t,!0),t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,2,32767,-32768),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):_(this,e,t,!1),t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),u.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||I(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),u.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},u.prototype.writeFloatLE=function(e,t,n){return q(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return q(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,a=r-n;if(this===e&&n<t&&t<r)for(i=a-1;i>=0;--i)e[i+t]=this[i+n];else if(a<1e3||!u.TYPED_ARRAY_SUPPORT)for(i=0;i<a;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+a),t);return a},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"===typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var a;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(a=t;a<n;++a)this[a]=e;else{var o=u.isBuffer(e)?e:k(new u(e,r).toString()),s=o.length;for(a=0;a<n-t;++a)this[a+t]=o[a%s]}return this};var U=/[^+\/0-9A-Za-z-_]/g;function B(e){return e<16?"0"+e.toString(16):e.toString(16)}function k(e,t){var n;t=t||1/0;for(var r=e.length,i=null,a=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&a.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&a.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&a.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&a.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;a.push(n)}else if(n<2048){if((t-=2)<0)break;a.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;a.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;a.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return a}function F(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(U,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(61))},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(0),i=n(29),a=n(2),o=n(8),s=n(15),u=n(13),c=n(7),l=n(59),h=n(3),p=n(10),f=n(22),d=n(47),m=n(18),y=n(11),v=function(){function e(e){this.connection=e}return e.prototype.build=function(){return r.b(this,void 0,void 0,(function(){var e,t;return r.d(this,(function(n){switch(n.label){case 0:return this.queryRunner=this.connection.createQueryRunner("master"),this.connection.driver instanceof i.a?[3,2]:[4,this.queryRunner.startTransaction()];case 1:n.sent(),n.label=2;case 2:return n.trys.push([2,12,18,20]),e=this.entityToSyncMetadatas.map((function(e){return e.tablePath})),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,4];case 3:n.sent(),n.label=4;case 4:return[4,this.queryRunner.getTables(e)];case 5:return n.sent(),[4,this.queryRunner.getViews([])];case 6:return n.sent(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 7:return n.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,9];case 8:n.sent(),n.label=9;case 9:return this.connection.driver instanceof i.a?[3,11]:[4,this.queryRunner.commitTransaction()];case 10:n.sent(),n.label=11;case 11:return[3,20];case 12:t=n.sent(),n.label=13;case 13:return n.trys.push([13,16,,17]),this.connection.driver instanceof i.a?[3,15]:[4,this.queryRunner.rollbackTransaction()];case 14:n.sent(),n.label=15;case 15:return[3,17];case 16:return n.sent(),[3,17];case 17:throw t;case 18:return[4,this.queryRunner.release()];case 19:return n.sent(),[7];case 20:return[2]}}))}))},e.prototype.log=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:this.queryRunner=this.connection.createQueryRunner("master"),t.label=1;case 1:return t.trys.push([1,,9,11]),e=this.entityToSyncMetadatas.map((function(e){return e.tablePath})),this.viewEntityToSyncMetadatas.length>0?[4,this.createTypeormMetadataTable()]:[3,3];case 2:t.sent(),t.label=3;case 3:return[4,this.queryRunner.getTables(e)];case 4:return t.sent(),[4,this.queryRunner.getViews([])];case 5:return t.sent(),this.queryRunner.enableSqlMemory(),[4,this.executeSchemaSyncOperationsInProperOrder()];case 6:return t.sent(),this.connection.queryResultCache?[4,this.connection.queryResultCache.synchronize(this.queryRunner)]:[3,8];case 7:t.sent(),t.label=8;case 8:return[2,this.queryRunner.getMemorySql()];case 9:return this.queryRunner.disableSqlMemory(),[4,this.queryRunner.release()];case 10:return t.sent(),[7];case 11:return[2]}}))}))},Object.defineProperty(e.prototype,"entityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter((function(e){return e.synchronize&&"entity-child"!==e.tableType&&"view"!==e.tableType}))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewEntityToSyncMetadatas",{get:function(){return this.connection.entityMetadatas.filter((function(e){return"view"===e.tableType&&e.synchronize}))},enumerable:!0,configurable:!0}),e.prototype.executeSchemaSyncOperationsInProperOrder=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.dropOldViews()];case 1:return e.sent(),[4,this.dropOldForeignKeys()];case 2:return e.sent(),[4,this.dropOldIndices()];case 3:return e.sent(),[4,this.dropOldChecks()];case 4:return e.sent(),[4,this.dropOldExclusions()];case 5:return e.sent(),[4,this.dropCompositeUniqueConstraints()];case 6:return e.sent(),[4,this.renameColumns()];case 7:return e.sent(),[4,this.createNewTables()];case 8:return e.sent(),[4,this.dropRemovedColumns()];case 9:return e.sent(),[4,this.addNewColumns()];case 10:return e.sent(),[4,this.updatePrimaryKeys()];case 11:return e.sent(),[4,this.updateExistColumns()];case 12:return e.sent(),[4,this.createNewIndices()];case 13:return e.sent(),[4,this.createNewChecks()];case 14:return e.sent(),[4,this.createNewExclusions()];case 15:return e.sent(),[4,this.createCompositeUniqueConstraints()];case 16:return e.sent(),[4,this.createForeignKeys()];case 17:return e.sent(),[4,this.createViews()];case 18:return e.sent(),[2]}}))}))},e.prototype.dropOldForeignKeys=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=e.foreignKeys.filter((function(e){var n=t.foreignKeys.find((function(t){return g(e,t)}));return!n||n.onDelete&&n.onDelete!==e.onDelete||n.onUpdate&&n.onUpdate!==e.onUpdate}))).length?[2]:(this.connection.logger.logSchemaBuild("dropping old foreign keys of "+e.name+": "+n.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropForeignKeys(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.renameTables=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){return r.d(this,(function(e){return[2]}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.renameColumns=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a,o=this;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?t.columns.length!==e.columns.length||0===(n=t.columns.filter((function(t){return!e.columns.find((function(e){return e.name===t.databaseName&&e.type===o.connection.driver.normalizeType(t)&&e.isNullable===t.isNullable&&e.isUnique===o.connection.driver.normalizeIsUnique(t)}))}))).length||n.length>1||0===(i=e.columns.filter((function(e){return!t.columns.find((function(t){return t.databaseName===e.name&&o.connection.driver.normalizeType(t)===e.type&&t.isNullable===e.isNullable&&o.connection.driver.normalizeIsUnique(t)===e.isUnique}))}))).length||i.length>1?[2]:((a=i[0].clone()).name=n[0].databaseName,this.connection.logger.logSchemaBuild('renaming column "'+i[0].name+'" in to "'+a.name+'"'),[4,this.queryRunner.renameColumn(e,i[0],a)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropOldIndices=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n,i=this;return r.d(this,(function(a){switch(a.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?(n=e.indices.filter((function(e){var n=t.indices.find((function(t){return t.name===e.name}));return!n||!1!==n.synchronize&&(n.isUnique!==e.isUnique||(n.isSpatial!==e.isSpatial||(n.isFulltext!==e.isFulltext||(n.columns.length!==e.columnNames.length||!n.columns.every((function(t){return-1!==e.columnNames.indexOf(t.databaseName)}))))))})).map((function(t){return r.b(i,void 0,void 0,(function(){return r.d(this,(function(n){switch(n.label){case 0:return this.connection.logger.logSchemaBuild('dropping an index: "'+t.name+'" from table '+e.name),[4,this.queryRunner.dropIndex(e,t)];case 1:return n.sent(),[2]}}))}))})),[4,Promise.all(n)]):[2];case 1:return a.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropOldChecks=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof h.e||this.connection.driver instanceof y.a?[2]:[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=e.checks.filter((function(e){return!t.checks.find((function(t){return t.name===e.name}))}))).length?[2]:(this.connection.logger.logSchemaBuild("dropping old check constraint: "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+e.name+'"'),[4,this.queryRunner.dropCheckConstraints(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropCompositeUniqueConstraints=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=e.uniques.filter((function(e){return e.columnNames.length>1&&!t.uniques.find((function(t){return t.name===e.name}))}))).length?[2]:(this.connection.logger.logSchemaBuild("dropping old unique constraint: "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+e.name+'"'),[4,this.queryRunner.dropUniqueConstraints(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropOldExclusions=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof h.f?[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=e.exclusions.filter((function(e){return!t.exclusions.find((function(t){return t.name===e.name}))}))).length?[2]:(this.connection.logger.logSchemaBuild("dropping old exclusion constraint: "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' from table "'+e.name+'"'),[4,this.queryRunner.dropExclusionConstraints(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))]:[2];case 1:return t.sent(),[2]}}))}))},e.prototype.createNewTables=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n=this;return r.d(this,(function(r){switch(r.label){case 0:return this.queryRunner.loadedTables.find((function(e){var r=t.database&&t.database!==n.connection.driver.database?t.database:void 0,i=t.schema||n.connection.driver.options.schema,a=n.connection.driver.buildTableName(t.tableName,i,r);return e.name===a}))?[2]:(this.connection.logger.logSchemaBuild("creating a new table: "+t.tablePath),e=a.a.create(t,this.connection.driver),[4,this.queryRunner.createTable(e,!1,!1)]);case 1:return r.sent(),this.queryRunner.loadedTables.push(e),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.createViews=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.viewEntityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n=this;return r.d(this,(function(r){switch(r.label){case 0:return this.queryRunner.loadedViews.find((function(e){var r=t.database&&t.database!==n.connection.driver.database?t.database:void 0,i=t.schema||n.connection.driver.options.schema,a=n.connection.driver.buildTableName(t.tableName,i,r),o="string"===typeof e.expression?e.expression.trim():e.expression(n.connection).getQuery(),s="string"===typeof t.expression?t.expression.trim():t.expression(n.connection).getQuery();return e.name===a&&o===s}))?[2]:(this.connection.logger.logSchemaBuild("creating a new view: "+t.tablePath),e=m.a.create(t,this.connection.driver),[4,this.queryRunner.createView(e)]);case 1:return r.sent(),this.queryRunner.loadedViews.push(e),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropOldViews=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.queryRunner.loadedViews,(function(t){return r.b(e,void 0,void 0,(function(){var e=this;return r.d(this,(function(n){switch(n.label){case 0:return this.viewEntityToSyncMetadatas.find((function(n){var r=n.database&&n.database!==e.connection.driver.database?n.database:void 0,i=n.schema||e.connection.driver.options.schema,a=e.connection.driver.buildTableName(n.tableName,i,r),o="string"===typeof t.expression?t.expression.trim():t.expression(e.connection).getQuery(),s="string"===typeof n.expression?n.expression.trim():n.expression(e.connection).getQuery();return t.name===a&&o===s}))?[2]:(this.connection.logger.logSchemaBuild("dropping an old view: "+t.name),[4,this.queryRunner.dropView(t)]);case 1:return n.sent(),this.queryRunner.loadedViews.splice(this.queryRunner.loadedViews.indexOf(t),1),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropRemovedColumns=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=e.columns.filter((function(e){return!t.columns.find((function(t){return t.databaseName===e.name}))}))).length?[2]:(this.connection.logger.logSchemaBuild("columns dropped in "+e.name+": "+n.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropColumns(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.addNewColumns=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=t.columns.filter((function(t){return!e.columns.find((function(e){return e.name===t.databaseName}))}))).length?[2]:(i=this.metadataColumnsToTableColumnOptions(n),0===(a=i.map((function(e){return new o.a(e)}))).length?[2]:(this.connection.logger.logSchemaBuild("new columns added: "+n.map((function(e){return e.databaseName})).join(", ")),[4,this.queryRunner.addColumns(e,a)])):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.updatePrimaryKeys=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a=this;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?(n=t.columns.filter((function(e){return e.isPrimary})),e.columns.filter((function(e){return e.isPrimary})).length!==n.length&&n.length>1?(i=n.map((function(e){return new o.a(l.a.createTableColumnOptions(e,a.connection.driver))})),[4,this.queryRunner.updatePrimaryKeys(e,i)]):[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.updateExistColumns=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n,i,a=this;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=this.connection.driver.findChangedColumns(e.columns,t.columns)).length?[2]:[4,c.a.runInSequence(n,(function(e){return a.dropColumnReferencedForeignKeys(t.tablePath,e.databaseName)}))]:[2];case 1:return r.sent(),[4,c.a.runInSequence(n,(function(e){return a.dropColumnCompositeIndices(t.tablePath,e.databaseName)}))];case 2:return r.sent(),this.connection.driver instanceof h.e||this.connection.driver instanceof y.a?[3,4]:[4,c.a.runInSequence(n,(function(e){return a.dropColumnCompositeUniques(t.tablePath,e.databaseName)}))];case 3:r.sent(),r.label=4;case 4:return 0===(i=n.map((function(t){var n=e.columns.find((function(e){return e.name===t.databaseName})),r=l.a.createTableColumnOptions(t,a.connection.driver);return{oldColumn:n,newColumn:new o.a(r)}}))).length?[2]:(this.connection.logger.logSchemaBuild('columns changed in "'+e.name+'". updating: '+n.map((function(e){return e.databaseName})).join(", ")),[4,this.queryRunner.changeColumns(e,i)]);case 5:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.createNewIndices=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=t.indices.filter((function(t){return!e.indices.find((function(e){return e.name===t.name}))&&!0===t.synchronize})).map((function(e){return u.a.create(e)}))).length?[2]:(this.connection.logger.logSchemaBuild("adding new indices "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createIndices(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.createNewChecks=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof h.e||this.connection.driver instanceof y.a?[2]:[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=t.checks.filter((function(t){return!e.checks.find((function(e){return e.name===t.name}))})).map((function(e){return f.a.create(e)}))).length?[2]:(this.connection.logger.logSchemaBuild("adding new check constraints: "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createCheckConstraints(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.createCompositeUniqueConstraints=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=t.uniques.filter((function(t){return t.columns.length>1&&!e.uniques.find((function(e){return e.name===t.name}))})).map((function(e){return p.a.create(e)}))).length?[2]:(this.connection.logger.logSchemaBuild("adding new unique constraints: "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createUniqueConstraints(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.createNewExclusions=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return this.connection.driver instanceof h.f?[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=t.exclusions.filter((function(t){return!e.exclusions.find((function(e){return e.name===t.name}))})).map((function(e){return d.a.create(e)}))).length?[2]:(this.connection.logger.logSchemaBuild("adding new exclusion constraints: "+n.map((function(e){return'"'+e.name+'"'})).join(", ")+' in table "'+e.name+'"'),[4,this.queryRunner.createExclusionConstraints(e,n)]):[2];case 1:return r.sent(),[2]}}))}))}))]:[2];case 1:return t.sent(),[2]}}))}))},e.prototype.createForeignKeys=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,c.a.runInSequence(this.entityToSyncMetadatas,(function(t){return r.b(e,void 0,void 0,(function(){var e,n,i;return r.d(this,(function(r){switch(r.label){case 0:return(e=this.queryRunner.loadedTables.find((function(e){return e.name===t.tablePath})))?0===(n=t.foreignKeys.filter((function(t){return!e.foreignKeys.find((function(e){return g(e,t)}))}))).length?[2]:(i=n.map((function(e){return s.a.create(e)})),this.connection.logger.logSchemaBuild("creating a foreign keys: "+n.map((function(e){return e.name})).join(", ")+' on table "'+e.name+'"'),[4,this.queryRunner.createForeignKeys(e,i)]):[2];case 1:return r.sent(),[2]}}))}))}))];case 1:return t.sent(),[2]}}))}))},e.prototype.dropColumnReferencedForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return t.name===e})))?(i=[],(a=n.foreignKeys.find((function(e){return-1!==e.columnNames.indexOf(t)})))&&((o=n.clone()).foreignKeys=[a],i.push(o),n.removeForeignKey(a)),this.queryRunner.loadedTables.forEach((function(n){var r=n.foreignKeys.filter((function(n){return n.referencedTableName===e&&-1!==n.referencedColumnNames.indexOf(t)}));if(r.length>0){var a=n.clone();a.foreignKeys=r,i.push(a),r.forEach((function(e){return n.removeForeignKey(e)}))}})),i.length>0?[4,c.a.runInSequence(i,(function(e){return s.connection.logger.logSchemaBuild("dropping related foreign keys of "+e.name+": "+e.foreignKeys.map((function(e){return e.name})).join(", ")),s.queryRunner.dropForeignKeys(e,e.foreignKeys)}))]:[3,2]):[2];case 1:r.sent(),r.label=2;case 2:return[2]}}))}))},e.prototype.dropColumnCompositeIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return t.name===e})))?0===(i=n.indices.filter((function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)}))).length?[2]:(this.connection.logger.logSchemaBuild('dropping related indices of "'+e+'"."'+t+'": '+i.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropIndices(n,i)]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.dropColumnCompositeUniques=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return(n=this.queryRunner.loadedTables.find((function(t){return t.name===e})))?0===(i=n.uniques.filter((function(e){return e.columnNames.length>1&&-1!==e.columnNames.indexOf(t)}))).length?[2]:(this.connection.logger.logSchemaBuild('dropping related unique constraints of "'+e+'"."'+t+'": '+i.map((function(e){return e.name})).join(", ")),[4,this.queryRunner.dropUniqueConstraints(n,i)]):[2];case 1:return r.sent(),[2]}}))}))},e.prototype.metadataColumnsToTableColumnOptions=function(e){var t=this;return e.map((function(e){return l.a.createTableColumnOptions(e,t.connection.driver)}))},e.prototype.createTypeormMetadataTable=function(){return r.b(this,void 0,void 0,(function(){var e,t;return r.d(this,(function(n){switch(n.label){case 0:return e=this.connection.driver.options,t=this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database),[4,this.queryRunner.createTable(new a.a({name:t,columns:[{name:"type",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataType}),isNullable:!1},{name:"database",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataDatabase}),isNullable:!0},{name:"schema",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataSchema}),isNullable:!0},{name:"table",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataTable}),isNullable:!0},{name:"name",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataName}),isNullable:!0},{name:"value",type:this.connection.driver.normalizeType({type:this.connection.driver.mappedDataTypes.metadataValue}),isNullable:!0}]}),!0)];case 1:return n.sent(),[2]}}))}))},e}();function g(e,t){return e.name===t.name&&e.referencedTableName===t.referencedTablePath}},function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var r=n(0),i=n(36),a=n(27),o=n(8),s=n(31),u=n(2),c=n(13),l=n(15),h=n(18),p=n(1),f=n(10),d=n(43),m=n(6),y=n(22),v=function(e){function t(){return e.call(this)||this}return r.c(t,e),t.prototype.connect=function(){return Promise.resolve(this.driver.databaseConnection)},t.prototype.release=function(){return this.loadedTables=[],this.clearSqlMemory(),Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:if(this.isTransactionActive)throw new i.a;if(this.isTransactionActive=!0,!e)return[3,4];if("READ UNCOMMITTED"!==e&&"SERIALIZABLE"!==e)throw new Error("SQLite only supports SERIALIZABLE and READ UNCOMMITTED isolation");return"READ UNCOMMITTED"!==e?[3,2]:[4,this.query("PRAGMA read_uncommitted = true")];case 1:return t.sent(),[3,4];case 2:return[4,this.query("PRAGMA read_uncommitted = false")];case 3:t.sent(),t.label=4;case 4:return[4,this.query("BEGIN TRANSACTION")];case 5:return t.sent(),[2]}}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by sqlite driver.")},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve(!1)]}))}))},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("This driver does not support table schemas")}))}))},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof u.a?e.name:e,n='SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" = \''+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=e instanceof u.a?e.name:e,i='PRAGMA table_info("'+n+'")',[4,this.query(i)];case 1:return[2,!!r.sent().find((function(e){return e.name===t}))]}}))}))},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return a=[],o=[],t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a.push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s,c,l,h=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof u.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,c=[],l=[],i&&o.indices.forEach((function(e){c.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))})),c.push(this.dropTableSql(o,t)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof h.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,c=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).name=t,o=new p.a('ALTER TABLE "'+n.name+'" RENAME TO "'+t+'"'),s=new p.a('ALTER TABLE "'+t+'" RENAME TO "'+n.name+'"'),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.name=a.name,a.uniques.forEach((function(e){e.name=c.connection.namingStrategy.uniqueConstraintName(a,e.columnNames)})),a.foreignKeys.forEach((function(e){e.name=c.connection.namingStrategy.foreignKeyName(a,e.columnNames,e.referencedTableName,e.referencedColumnNames)})),a.indices.forEach((function(e){e.name=c.connection.namingStrategy.indexName(a,e.columnNames,e.where)})),[4,this.recreateTable(a,n)];case 5:return r.sent(),[2]}}))}))},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,[2,this.addColumns(n,[t])]}}))}))},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addColumn(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,s,c;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.a?c=n:(c=s.clone()).name=n,[2,this.changeColumn(i,s,c)]}}))}))},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(s=t instanceof o.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return[4,this.changeColumns(i,[{oldColumn:s,newColumn:n}])];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){e.newColumn.name!==e.oldColumn.name&&(a.findColumnUniques(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.uniqueConstraintName(a,t.columnNames)})),a.findColumnForeignKeys(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.foreignKeyName(a,t.columnNames,t.referencedTableName,t.referencedColumnNames)})),a.findColumnIndices(e.oldColumn).forEach((function(t){t.columnNames.splice(t.columnNames.indexOf(e.oldColumn.name),1),t.columnNames.push(e.newColumn.name),t.name=o.connection.namingStrategy.indexName(a,t.columnNames,t.where)})));var t=a.columns.find((function(t){return t.name===e.oldColumn.name}));t&&(a.columns[a.columns.indexOf(t)]=e.newColumn)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return[4,this.dropColumns(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){a.removeColumn(e),a.findColumnUniques(e).forEach((function(e){return a.removeUniqueConstraint(e)})),a.findColumnIndices(e).forEach((function(e){return a.removeIndex(e)})),a.findColumnForeignKeys(e).forEach((function(e){return a.removeForeignKey(e)}))})),[4,this.recreateTable(a,n)];case 4:return r.sent(),t.forEach((function(e){n.removeColumn(e),n.findColumnUniques(e).forEach((function(e){return n.removeUniqueConstraint(e)})),n.findColumnIndices(e).forEach((function(e){return n.removeIndex(e)})),n.findColumnForeignKeys(e).forEach((function(e){return n.removeForeignKey(e)}))})),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return(a=(n=i).clone()).columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),n.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,Promise.resolve()];case 1:return e.sent(),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return(i=(t=n).clone()).primaryColumns.forEach((function(e){e.isPrimary=!1})),[4,this.recreateTable(i,t)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(n){switch(n.label){case 0:return[4,this.createUniqueConstraints(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addUniqueConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.uniques.find((function(e){return e.name===t}))))throw new Error("Supplied unique constraint was not found in table "+n.name);return[4,this.dropUniqueConstraints(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeUniqueConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(n){switch(n.label){case 0:return[4,this.createCheckConstraints(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addCheckConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof y.a?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return[4,this.dropCheckConstraints(n,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeCheckConstraint(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Sqlite does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(n){switch(n.label){case 0:return[4,this.createForeignKeys(e,[t])];case 1:return n.sent(),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.addForeignKey(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.a?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return[4,this.dropForeignKeys(e,[a])];case 4:return r.sent(),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),t.forEach((function(e){return a.removeForeignKey(e)})),[4,this.recreateTable(a,n)];case 4:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof u.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query('DELETE FROM "'+e+'"')];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.query("PRAGMA foreign_keys = OFF;")];case 1:return r.sent(),[4,this.startTransaction()];case 2:r.sent(),r.label=3;case 3:return r.trys.push([3,9,14,16]),"SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'",[4,this.query("SELECT 'DROP VIEW \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'view'")];case 4:return e=r.sent(),[4,Promise.all(e.map((function(e){return i.query(e.query)})))];case 5:return r.sent(),"SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'",[4,this.query("SELECT 'DROP TABLE \"' || name || '\";' as query FROM \"sqlite_master\" WHERE \"type\" = 'table' AND \"name\" != 'sqlite_sequence'")];case 6:return t=r.sent(),[4,Promise.all(t.map((function(e){return i.query(e.query)})))];case 7:return r.sent(),[4,this.commitTransaction()];case 8:return r.sent(),[3,16];case 9:n=r.sent(),r.label=10;case 10:return r.trys.push([10,12,,13]),[4,this.rollbackTransaction()];case 11:return r.sent(),[3,13];case 12:return r.sent(),[3,13];case 13:throw n;case 14:return[4,this.query("PRAGMA foreign_keys = ON;")];case 15:return r.sent(),[7];case 16:return[2]}}))}))},t.prototype.loadViews=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(t=e.map((function(e){return"'"+e+"'"})).join(", "),n='SELECT "t".* FROM "'+this.getTypeormMetadataTableName()+'" "t" INNER JOIN "sqlite_master" s ON "s"."name" = "t"."name" AND "s"."type" = \'view\' WHERE "t"."type" = \'VIEW\'',t.length>0&&(n+=' AND "t"."name" IN ('+t+")"),[4,this.query(n)]):[2,Promise.resolve([])];case 2:return[2,r.sent().map((function(e){var t=new h.a;return t.name=e.name,t.expression=e.value,t}))]}}))}))},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a=this;return r.d(this,(function(s){switch(s.label){case 0:return e&&e.length?(t=e.map((function(e){return"'"+e+"'"})).join(", "),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'table\' AND "name" IN ('+t+")")]):[2,[]];case 1:return n=s.sent(),[4,this.query('SELECT * FROM "sqlite_master" WHERE "type" = \'index\' AND "tbl_name" IN ('+t+")")];case 2:return i=s.sent(),n&&n.length?[2,Promise.all(n.map((function(e){return r.b(a,void 0,void 0,(function(){var t,n,a,s,h,p,d,v,g,b,E,T,N,w,A,C,S,R,M=this;return r.d(this,(function(O){switch(O.label){case 0:return t=new u.a({name:e.name}),n=e.sql,[4,Promise.all([this.query('PRAGMA table_info("'+e.name+'")'),this.query('PRAGMA index_list("'+e.name+'")'),this.query('PRAGMA foreign_key_list("'+e.name+'")')])];case 1:return a=r.e.apply(void 0,[O.sent(),3]),s=a[0],h=a[1],p=a[2],d=void 0,v=e.sql,-1!==(g=v.toUpperCase().indexOf("AUTOINCREMENT"))&&(d=v.substr(0,g),b=d.lastIndexOf(","),E=d.lastIndexOf("("),-1!==b?d=(d=(d=d.substr(b)).substr(0,d.lastIndexOf('"'))).substr(d.indexOf('"')+1):-1!==E&&(d=(d=(d=d.substr(E)).substr(0,d.lastIndexOf('"'))).substr(d.indexOf('"')+1))),t.columns=s.map((function(e){var t=new o.a;if(t.name=e.name,t.type=e.type.toLowerCase(),t.default=null!==e.dflt_value&&void 0!==e.dflt_value?e.dflt_value:void 0,t.isNullable=0===e.notnull,t.isPrimary=e.pk>0,t.comment="",t.isGenerated=d===e.name,t.isGenerated&&(t.generationStrategy="increment"),"varchar"===t.type){var r=n.match(new RegExp('"('+t.name+")\" varchar CHECK\\s*\\(\\s*\\1\\s+IN\\s*\\(('[^']+'(?:\\s*,\\s*'[^']+')+)\\s*\\)\\s*\\)"));r&&(t.type="simple-enum",t.enum=r[2].substr(1,r[2].length-2).split("','"))}var i=t.type.indexOf("(");if(-1!==i){var a=t.type.substr(0,i);if(M.driver.withLengthColumnTypes.find((function(e){return e===a}))){var s=parseInt(t.type.substring(i+1,t.type.length-1));s&&(t.length=s.toString(),t.type=a)}}return t})),T=m.a.uniq(p,(function(e){return e.id})),t.foreignKeys=T.map((function(e){var n=p.filter((function(t){return t.id===e.id&&t.table===e.table})),r=n.map((function(e){return e.from})),i=n.map((function(e){return e.to})),a=M.connection.namingStrategy.foreignKeyName(t,r,e.referencedTableName,e.referencedColumnNames);return new l.a({name:a,columnNames:r,referencedTableName:e.table,referencedColumnNames:i,onDelete:e.on_delete,onUpdate:e.on_update})})),N=h.filter((function(e){return"u"===e.origin})).map((function(e){return e.name})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return r.b(M,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return n=h.find((function(t){return t.name===e})),[4,this.query('PRAGMA index_info("'+n.name+'")')];case 1:return i=r.sent(),1===(a=i.sort((function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)})).map((function(e){return e.name}))).length&&(o=t.columns.find((function(e){return!!a.find((function(t){return t===e.name}))})))&&(o.isUnique=!0),[2,new f.a({name:this.connection.namingStrategy.uniqueConstraintName(t,a),columnNames:a})]}}))}))})),w=t,[4,Promise.all(N)];case 2:for(w.uniques=O.sent(),C=/CONSTRAINT "([^"]*)" CHECK (\(.*?\))([,]|[)]$)/g;null!==(A=C.exec(n));)t.checks.push(new y.a({name:A[1],expression:A[2]}));return S=h.filter((function(e){return"c"===e.origin})).map((function(e){return e.name})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return r.b(M,void 0,void 0,(function(){var n,a,o,s,u,l;return r.d(this,(function(r){switch(r.label){case 0:return n=i.find((function(t){return t.name===e})),a=/WHERE (.*)/.exec(n.sql),o=h.find((function(t){return t.name===e})),[4,this.query('PRAGMA index_info("'+o.name+'")')];case 1:return s=r.sent(),u=s.sort((function(e,t){return parseInt(e.seqno)-parseInt(t.seqno)})).map((function(e){return e.name})),l="1"===o.unique||1===o.unique,[2,new c.a({table:t,name:o.name,columnNames:u,isUnique:l,where:a?a[1]:void 0})]}}))}))})),[4,Promise.all(S)];case 3:return R=O.sent(),t.indices=R.filter((function(e){return!!e})),[2,t]}}))}))})))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.filter((function(e){return e.isPrimary})),i=r.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})),a=r.length>1;if(a&&i)throw new Error("Sqlite does not support AUTOINCREMENT on composite primary key");var o=e.columns.map((function(e){return n.buildCreateColumnSql(e,a)})).join(", "),s='CREATE TABLE "'+e.name+'" ('+o;(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new f.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0)&&(s+=", "+e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", "));e.checks.length>0&&(s+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", "));e.foreignKeys.length>0&&t&&(s+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a})).join(", "));r.length>1&&(s+=", PRIMARY KEY ("+r.map((function(e){return'"'+e.name+'"'})).join(", ")+")");s+=")";var u=this.connection.entityMetadatas.find((function(t){return t.tableName===e.name}));return u&&u.withoutRowid&&(s+=" WITHOUT ROWID"),new p.a(s)},t.prototype.dropTableSql=function(e,t){var n=e instanceof u.a?e.name:e,r=t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"';return new p.a(r)},t.prototype.createViewSql=function(e){return"string"===typeof e.expression?new p.a('CREATE VIEW "'+e.name+'" AS '+e.expression):new p.a('CREATE VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t="string"===typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=r.e(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new p.a(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof h.a?e.name:e;return new p.a('DROP VIEW "'+t+'"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof h.a?e.name:e,n=this.connection.createQueryBuilder(),i=r.e(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape("type")+" = 'VIEW'").andWhere(n.escape("name")+" = :name",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new p.a(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new p.a("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e){var t=e instanceof c.a?e.name:e;return new p.a('DROP INDEX "'+t+'"')},t.prototype.buildCreateColumnSql=function(e,t){var n='"'+e.name+'"';return e instanceof s.a?n+=" "+this.driver.normalizeType(e):n+=" "+this.connection.driver.createFullType(e),e.enum&&(n+=" CHECK( "+e.name+" IN ("+e.enum.map((function(e){return"'"+e+"'"})).join(",")+") )"),e.isPrimary&&!t&&(n+=" PRIMARY KEY"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(n+=" AUTOINCREMENT"),e.collation&&(n+=" COLLATE "+e.collation),!0!==e.isNullable&&(n+=" NOT NULL"),void 0!==e.default&&null!==e.default&&(n+=" DEFAULT ("+e.default+")"),n},t.prototype.recreateTable=function(e,t,n){return void 0===n&&(n=!0),r.b(this,void 0,void 0,(function(){var i,a,o,s,u=this;return r.d(this,(function(r){switch(r.label){case 0:return i=[],a=[],t.indices.forEach((function(e){i.push(u.dropIndexSql(e)),a.push(u.createIndexSql(t,e))})),e.name="temporary_"+e.name,i.push(this.createTableSql(e,!0)),a.push(this.dropTableSql(e)),n&&(o=e.columns.map((function(e){return'"'+e.name+'"'})).join(", "),s=t.columns.map((function(e){return'"'+e.name+'"'})).join(", "),t.columns.length<e.columns.length?o=e.columns.filter((function(e){return t.columns.find((function(t){return t.name===e.name}))})).map((function(e){return'"'+e.name+'"'})).join(", "):t.columns.length>e.columns.length&&(s=t.columns.filter((function(t){return e.columns.find((function(e){return e.name===t.name}))})).map((function(e){return'"'+e.name+'"'})).join(", ")),i.push(new p.a('INSERT INTO "'+e.name+'"('+o+") SELECT "+s+' FROM "'+t.name+'"')),a.push(new p.a('INSERT INTO "'+t.name+'"('+s+") SELECT "+o+' FROM "'+e.name+'"'))),i.push(this.dropTableSql(t)),a.push(this.createTableSql(t,!0)),i.push(new p.a('ALTER TABLE "'+e.name+'" RENAME TO "'+t.name+'"')),a.push(new p.a('ALTER TABLE "'+t.name+'" RENAME TO "'+e.name+'"')),e.name=t.name,e.indices.forEach((function(t){t.name||(t.name=u.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),i.push(u.createIndexSql(e,t)),a.push(u.dropIndexSql(t))})),[4,this.executeQueries(i,a)];case 1:return r.sent(),this.replaceCachedTable(t,e),[2]}}))}))},t}(d.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n(0),i=n(1),a=function(){this.upQueries=[],this.downQueries=[]},o=n(7),s=function(){function e(){this.isReleased=!1,this.isTransactionActive=!1,this.data={},this.loadedTables=[],this.loadedViews=[],this.sqlMemoryMode=!1,this.sqlInMemory=new a}return e.prototype.getTable=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadTables([e])];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables.length>0?this.loadedTables[0]:void 0]}}))}))},e.prototype.getTables=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadTables(e)];case 1:return t.loadedTables=n.sent(),[2,this.loadedTables]}}))}))},e.prototype.getView=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadViews([e])];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews.length>0?this.loadedViews[0]:void 0]}}))}))},e.prototype.getViews=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return t=this,[4,this.loadViews(e)];case 1:return t.loadedViews=n.sent(),[2,this.loadedViews]}}))}))},e.prototype.enableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!0},e.prototype.disableSqlMemory=function(){this.sqlInMemory=new a,this.sqlMemoryMode=!1},e.prototype.clearSqlMemory=function(){this.sqlInMemory=new a},e.prototype.getMemorySql=function(){return this.sqlInMemory},e.prototype.executeMemoryUpSql=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,o.a.runInSequence(this.sqlInMemory.upQueries,(function(t){return e.query(t.query,t.parameters)}))];case 1:return t.sent(),[2]}}))}))},e.prototype.executeMemoryDownSql=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){switch(t.label){case 0:return[4,o.a.runInSequence(this.sqlInMemory.downQueries.reverse(),(function(t){return e.query(t.query,t.parameters)}))];case 1:return t.sent(),[2]}}))}))},e.prototype.getCachedView=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return(t=this.loadedViews.find((function(t){return t.name===e})))?[2,t]:[4,this.loadViews([e])];case 1:if((n=r.sent()).length>0)return this.loadedViews.push(n[0]),[2,n[0]];throw new Error('View "'+e+'" does not exist.')}}))}))},e.prototype.getCachedTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return(t=this.loadedTables.find((function(t){return t.name===e})))?[2,t]:[4,this.loadTables([e])];case 1:if((n=r.sent()).length>0)return this.loadedTables.push(n[0]),[2,n[0]];throw new Error('Table "'+e+'" does not exist.')}}))}))},e.prototype.replaceCachedTable=function(e,t){var n=this.loadedTables.find((function(t){return t.name===e.name}));n&&(n.name=t.name,n.columns=t.columns,n.indices=t.indices,n.foreignKeys=t.foreignKeys,n.uniques=t.uniques,n.checks=t.checks,n.justCreated=t.justCreated,n.engine=t.engine)},e.prototype.getTypeormMetadataTableName=function(){var e=this.connection.driver.options;return this.connection.driver.buildTableName("typeorm_metadata",e.schema,e.database)},e.prototype.isColumnChanged=function(e,t,n,r){return e.charset!==t.charset||e.collation!==t.collation||e.precision!==t.precision||e.scale!==t.scale||e.width!==t.width||e.zerofill!==t.zerofill||e.unsigned!==t.unsigned||e.asExpression!==t.asExpression||n&&e.default!==t.default||e.onUpdate!==t.onUpdate||e.isNullable!==t.isNullable||r&&e.comment!==t.comment||e.enum!==t.enum},e.prototype.isDefaultColumnLength=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.length)return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].length)&&this.connection.driver.dataTypeDefaults[t.type].length.toString()===n.toString()},e.prototype.isDefaultColumnWidth=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&r.width)return!1}return!!(this.connection.driver.dataTypeDefaults&&this.connection.driver.dataTypeDefaults[t.type]&&this.connection.driver.dataTypeDefaults[t.type].width)&&this.connection.driver.dataTypeDefaults[t.type].width===n},e.prototype.isDefaultColumnPrecision=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.precision&&void 0!==r.precision)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].precision||void 0===this.connection.driver.dataTypeDefaults[t.type].precision)&&this.connection.driver.dataTypeDefaults[t.type].precision===n},e.prototype.isDefaultColumnScale=function(e,t,n){if(this.connection.hasMetadata(e.name)){var r=this.connection.getMetadata(e.name).findColumnWithDatabaseName(t.name);if(r&&null!==r.scale&&void 0!==r.scale)return!1}return!(!this.connection.driver.dataTypeDefaults||!this.connection.driver.dataTypeDefaults[t.type]||null===this.connection.driver.dataTypeDefaults[t.type].scale||void 0===this.connection.driver.dataTypeDefaults[t.type].scale)&&this.connection.driver.dataTypeDefaults[t.type].scale===n},e.prototype.executeQueries=function(e,t){return r.b(this,void 0,void 0,(function(){var n,a,s=this;return r.d(this,(function(u){switch(u.label){case 0:return e instanceof i.a&&(e=[e]),t instanceof i.a&&(t=[t]),(n=this.sqlInMemory.upQueries).push.apply(n,r.f(e)),(a=this.sqlInMemory.downQueries).push.apply(a,r.f(t)),!0===this.sqlMemoryMode?[2,Promise.resolve()]:[4,o.a.runInSequence(e,(function(e){return s.query(e.query,e.parameters)}))];case 1:return u.sent(),[2]}}))}))},e}()},function(e,t,n){"use strict";e.exports=n(109)},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.sha1=function(e){var t,n,r,i,a,o,s,u,c,l=function(e,t){return e<<t|e>>>32-t},h=function(e){var t,n="";for(t=7;t>=0;t--)n+=(e>>>4*t&15).toString(16);return n},p=new Array(80),f=1732584193,d=4023233417,m=2562383102,y=271733878,v=3285377520,g=(e=encodeURIComponent(e)).length,b=[];for(n=0;n<g-3;n+=4)r=e.charCodeAt(n)<<24|e.charCodeAt(n+1)<<16|e.charCodeAt(n+2)<<8|e.charCodeAt(n+3),b.push(r);switch(g%4){case 0:n=2147483648;break;case 1:n=e.charCodeAt(g-1)<<24|8388608;break;case 2:n=e.charCodeAt(g-2)<<24|e.charCodeAt(g-1)<<16|32768;break;case 3:n=e.charCodeAt(g-3)<<24|e.charCodeAt(g-2)<<16|e.charCodeAt(g-1)<<8|128}for(b.push(n);b.length%16!==14;)b.push(0);for(b.push(g>>>29),b.push(g<<3&4294967295),t=0;t<b.length;t+=16){for(n=0;n<16;n++)p[n]=b[t+n];for(n=16;n<=79;n++)p[n]=l(p[n-3]^p[n-8]^p[n-14]^p[n-16],1);for(i=f,a=d,o=m,s=y,u=v,n=0;n<=19;n++)c=l(i,5)+(a&o|~a&s)+u+p[n]+1518500249&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=20;n<=39;n++)c=l(i,5)+(a^o^s)+u+p[n]+1859775393&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=40;n<=59;n++)c=l(i,5)+(a&o|a&s|o&s)+u+p[n]+2400959708&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;for(n=60;n<=79;n++)c=l(i,5)+(a^o^s)+u+p[n]+3395469782&4294967295,u=s,s=o,o=l(a,30),a=i,i=c;f=f+i&4294967295,d=d+a&4294967295,m=m+o&4294967295,y=y+s&4294967295,v=v+u&4294967295}return(c=h(f)+h(d)+h(m)+h(y)+h(v)).toLowerCase()},e.uuid4=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)}))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){this.options=e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(e){this.name=e.name,this.expression=e.expression}return e.prototype.clone=function(){return new e({name:this.name,expression:this.expression})},e.create=function(t){return new e({name:t.name,expression:t.expression})},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="ReturningStatementNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="OUTPUT or RETURNING clause only supported by Microsoft SQL Server or PostgreSQL databases.",n}return r.c(t,e),t}(Error)},function(e,t,n){var r=n(40),i=r.Buffer;function a(e,t){for(var n in e)t[n]=e[n]}function o(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(a(r,t),t.Buffer=o),a(i,o),o.from=function(e,t,n){if("number"===typeof e)throw new TypeError("Argument must not be a number");return i(e,t,n)},o.alloc=function(e,t,n){if("number"!==typeof e)throw new TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"===typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},o.allocUnsafe=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return i(e)},o.allocUnsafeSlow=function(e){if("number"!==typeof e)throw new TypeError("Argument must be a number");return r.SlowBuffer(e)}},function(e,t){"function"===typeof Object.create?e.exports=function(e,t){t&&(e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}))}:e.exports=function(e,t){if(t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}}},function(e,t,n){var r=n(49).Buffer;function i(e,t){this._block=r.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}i.prototype.update=function(e,t){"string"===typeof e&&(t=t||"utf8",e=r.from(e,t));for(var n=this._block,i=this._blockSize,a=e.length,o=this._len,s=0;s<a;){for(var u=o%i,c=Math.min(a-s,i-u),l=0;l<c;l++)n[u+l]=e[s+l];s+=c,(o+=c)%i===0&&this._update(n)}return this._len+=a,this},i.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var n=8*this._len;if(n<=4294967295)this._block.writeUInt32BE(n,this._blockSize-4);else{var r=(4294967295&n)>>>0,i=(n-r)/4294967296;this._block.writeUInt32BE(i,this._blockSize-8),this._block.writeUInt32BE(r,this._blockSize-4)}this._update(this._block);var a=this._hash();return e?a.toString(e):a},i.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=i},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){this.identifiers=[],this.generatedMaps=[]}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){this.generatedMaps=[]}},function(e,t,n){"use strict";n.r(t),n.d(t,"SelectQueryBuilder",(function(){return M}));var r=n(0),i=n(24),a=n(90),o=n(9),s=function(e){function t(){var n=e.call(this)||this;return n.name="PessimisticLockTransactionRequiredError",Object.setPrototypeOf(n,t.prototype),n.message="An open transaction is required for pessimistic lock.",n}return r.c(t,e),t}(Error),u=function(e){function t(n){var r=e.call(this)||this;return r.name="NoVersionOrUpdateDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message="Entity "+n+" does not have version or update date columns.",r}return r.c(t,e),t}(Error),c=function(e){function t(n,r,i){var a=e.call(this)||this;return a.name="OptimisticLockVersionMismatchError",Object.setPrototypeOf(a,t.prototype),a.message="The optimistic lock on entity "+n+" failed, version "+r+" was expected, but is actually "+i+".",a}return r.c(t,e),t}(Error),l=function(e){function t(){var n=e.call(this)||this;return n.name="OptimisticLockCanNotBeUsedError",Object.setPrototypeOf(n,t.prototype),n.message="The optimistic lock can be used only with getOne() method.",n}return r.c(t,e),t}(Error),h=n(65),p=n(56),f=n(57),d=n(20),m=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationIdAttributes=n}return e.prototype.load=function(e){return r.b(this,void 0,void 0,(function(){var t,n=this;return r.d(this,(function(i){return t=this.relationIdAttributes.map((function(t){return r.b(n,void 0,void 0,(function(){var n,i,a,o,s,u,c,l,h,p,f,m,y,v,g,b,E,T,N,w,A,C=this;return r.d(this,(function(S){switch(S.label){case 0:if(!t.relation.isManyToOne&&!t.relation.isOneToOneOwner)return[3,1];if(t.queryBuilderFactory)throw new Error("Additional condition can not be used with ManyToOne or OneToOne owner relations.");return A=e.map((function(e){var n={};return t.relation.joinColumns.forEach((function(r){n[r.databaseName]=C.connection.driver.prepareHydratedValue(e[d.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.databaseName)],r.referencedColumn)})),t.relation.entityMetadata.primaryColumns.forEach((function(r){n[r.databaseName]=C.connection.driver.prepareHydratedValue(e[d.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.databaseName)],r)})),n})),[2,{relationIdAttribute:t,results:A}];case 1:return t.relation.isOneToMany||t.relation.isOneToOneNotOwner?(n=t.relation,i=n.isOwning?n.joinColumns:n.inverseRelation.joinColumns,a=n.inverseEntityMetadata.target,o=n.inverseEntityMetadata.tableName,s=t.alias||o,u={},(N=e.map((function(e,n){return i.map((function(r){var i=r.databaseName+n;return u[i]=e[d.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],s+"."+r.propertyPath+" = :"+i})).join(" AND ")})).map((function(e){return"("+e+")"})).join(" OR "))?(c=this.connection.createQueryBuilder(this.queryRunner),i.forEach((function(e){c.addSelect(s+"."+e.propertyPath,e.databaseName)})),n.inverseRelation.entityMetadata.primaryColumns.forEach((function(e){c.addSelect(s+"."+e.propertyPath,e.databaseName)})),c.from(a,s).where("("+N+")").setParameters(u),t.queryBuilderFactory&&t.queryBuilderFactory(c),[4,c.getRawMany()]):[2,{relationIdAttribute:t,results:[]}]):[3,3];case 2:return(A=S.sent()).forEach((function(e){i.forEach((function(t){e[t.databaseName]=C.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)})),n.inverseRelation.entityMetadata.primaryColumns.forEach((function(t){e[t.databaseName]=C.connection.driver.prepareHydratedValue(e[t.databaseName],t)}))})),[2,{relationIdAttribute:t,results:A}];case 3:return l=t.relation,h=l.isOwning?l.joinColumns:l.inverseRelation.inverseJoinColumns,p=l.isOwning?l.inverseJoinColumns:l.inverseRelation.joinColumns,f=t.junctionAlias,m=t.joinInverseSideMetadata.tableName,y=t.alias||m,v=l.isOwning?l.junctionEntityMetadata.tableName:l.inverseRelation.junctionEntityMetadata.tableName,0===(g=e.map((function(e){return h.reduce((function(n,r){return n[r.propertyPath]=e[d.a.buildColumnAlias(C.connection.driver,t.parentAlias,r.referencedColumn.databaseName)],n}),{})}))).length?[2,{relationIdAttribute:t,results:[]}]:(b={},E=g.map((function(e,t){return Object.keys(e).map((function(n){var r=n+t;return b[r]=e[n],f+"."+n+" = :"+r})).join(" AND ")})),T=p.map((function(e){return f+"."+e.propertyPath+" = "+y+"."+e.referencedColumn.propertyPath})).join(" AND "),N=E.map((function(e){return"("+e+" AND "+T+")"})).join(" OR "),w=this.connection.createQueryBuilder(this.queryRunner),p.forEach((function(e){w.addSelect(f+"."+e.propertyPath,e.databaseName).addOrderBy(f+"."+e.propertyPath)})),h.forEach((function(e){w.addSelect(f+"."+e.propertyPath,e.databaseName).addOrderBy(f+"."+e.propertyPath)})),w.from(m,y).innerJoin(v,f,N).setParameters(b),t.queryBuilderFactory&&t.queryBuilderFactory(w),[4,w.getRawMany()]);case 4:return(A=S.sent()).forEach((function(e){r.f(h,p).forEach((function(t){e[t.databaseName]=C.connection.driver.prepareHydratedValue(e[t.databaseName],t.referencedColumn)}))})),[2,{relationIdAttribute:t,results:A}]}}))}))})),[2,Promise.all(t)]}))}))},e}(),y=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationIds.forEach((function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationIdAttributes.push(n)})),this.expressionMap.joinAttributes.forEach((function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationIds.forEach((function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationIdAttributes.push(r)}))}))},e.prototype.metadataToAttribute=function(e,t){return new p.a(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),v=function(){function e(e,t,n){this.connection=e,this.queryRunner=t,this.relationCountAttributes=n}return e.prototype.load=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i=this;return r.d(this,(function(a){return t=function(e,t,n){return n.indexOf(e)===t},n=this.relationCountAttributes.map((function(n){return r.b(i,void 0,void 0,(function(){var i,a,o,s,u,c,l,h,p,f,d,m,y,v,g,b,E,T;return r.d(this,(function(r){switch(r.label){case 0:return n.relation.isOneToMany?(i=n.relation,a=i.inverseRelation,o=a.joinColumns[0].referencedColumn.propertyName,s=i.inverseEntityMetadata.target,y=i.inverseEntityMetadata.tableName,v=n.alias||y,u=a.propertyName,0===(d=(d=e.map((function(e){return e[n.parentAlias+"_"+o]})).filter((function(e){return!!e}))).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:((E=this.connection.createQueryBuilder(this.queryRunner)).select(v+"."+u,"parentId").addSelect("COUNT(*)","cnt").from(s,v).where(v+"."+u+" IN (:...ids)").addGroupBy(v+"."+u).setParameter("ids",d),n.queryBuilderFactory&&n.queryBuilderFactory(E),c={relationCountAttribute:n},[4,E.getRawMany()])):[3,2];case 1:return[2,(c.results=r.sent(),c)];case 2:return h=void 0,p=void 0,f=void 0,n.relation.isOwning?(l=n.relation.joinColumns[0].referencedColumn.databaseName,h=n.relation.inverseJoinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[0],f=n.relation.junctionEntityMetadata.columns[1]):(l=n.relation.inverseRelation.inverseJoinColumns[0].referencedColumn.databaseName,h=n.relation.inverseRelation.joinColumns[0].referencedColumn.databaseName,p=n.relation.junctionEntityMetadata.columns[1],f=n.relation.junctionEntityMetadata.columns[0]),0===(d=(d=e.map((function(e){return e[n.parentAlias+"_"+l]})).filter((function(e){return!!e}))).filter(t)).length?[2,{relationCountAttribute:n,results:[]}]:(m=n.junctionAlias,y=n.joinInverseSideMetadata.tableName,v=n.alias||y,g=n.relation.junctionEntityMetadata.tableName,b=m+"."+p.propertyName+" IN ("+d.map((function(e){return isNaN(e)?"'"+e+"'":e}))+") AND "+m+"."+f.propertyName+" = "+v+"."+h,(E=this.connection.createQueryBuilder(this.queryRunner)).select(m+"."+p.propertyName,"parentId").addSelect("COUNT("+E.escape(v)+"."+E.escape(h)+")","cnt").from(y,v).innerJoin(g,m,b).addGroupBy(m+"."+p.propertyName),n.queryBuilderFactory&&n.queryBuilderFactory(E),T={relationCountAttribute:n},[4,E.getRawMany()]);case 3:return[2,(T.results=r.sent(),T)]}}))}))})),[2,Promise.all(n)]}))}))},e}(),g=function(){function e(e){this.expressionMap=e}return e.prototype.transform=function(){var e=this;this.expressionMap.mainAlias&&this.expressionMap.mainAlias.metadata.relationCounts.forEach((function(t){var n=e.metadataToAttribute(e.expressionMap.mainAlias.name,t);e.expressionMap.relationCountAttributes.push(n)})),this.expressionMap.joinAttributes.forEach((function(t){t.metadata&&!t.metadata.isJunction&&t.metadata.relationCounts.forEach((function(n){var r=e.metadataToAttribute(t.alias.name,n);e.expressionMap.relationCountAttributes.push(r)}))}))},e.prototype.metadataToAttribute=function(e,t){return new f.a(this.expressionMap,{relationName:e+"."+t.relation.propertyName,mapToProperty:e+"."+t.propertyName,alias:t.alias,queryBuilderFactory:t.queryBuilderFactory})},e}(),b=n(35),E=function(e){function t(){var n=e.call(this)||this;return n.name="LockNotSupportedOnGivenDriverError",Object.setPrototypeOf(n,t.prototype),n.message="Locking not supported on given driver.",n}return r.c(t,e),t}(Error),T=n(3),N=n(12),w=n(19),A=function(e){function t(){var n=e.call(this)||this;return n.name="OffsetWithoutLimitNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="RDBMS does not support OFFSET without LIMIT in SELECT statements. You must use limit in conjunction with offset function (or take in conjunction with skip function if you are using pagination).",n}return r.c(t,e),t}(Error),C=n(32),S=n(26),R=n(11),M=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.getQuery=function(){var e=this.createSelectExpression();return e+=this.createJoinExpression(),e+=this.createWhereExpression(),e+=this.createGroupByExpression(),e+=this.createHavingExpression(),e+=this.createOrderByExpression(),e+=this.createLimitOffsetExpression(),e=(e+=this.createLockExpression()).trim(),this.expressionMap.subQuery&&(e="("+e+")"),e},t.prototype.subQuery=function(){var e=this.createQueryBuilder();return e.expressionMap.subQuery=!0,e.expressionMap.parentQueryBuilder=this,e},t.prototype.select=function(e,t){if(this.expressionMap.queryType="select",Array.isArray(e))this.expressionMap.selects=e.map((function(e){return{selection:e}}));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&(this.expressionMap.selects=[{selection:e,aliasName:t}]);return this},t.prototype.addSelect=function(e,t){if(!e)return this;if(Array.isArray(e))this.expressionMap.selects=this.expressionMap.selects.concat(e.map((function(e){return{selection:e}})));else if(e instanceof Function){var n=e(this.subQuery());this.setParameters(n.getParameters()),this.expressionMap.selects.push({selection:n.getQuery(),aliasName:t})}else e&&this.expressionMap.selects.push({selection:e,aliasName:t});return this},t.prototype.distinct=function(e){return void 0===e&&(e=!0),this.expressionMap.selectDistinct=e,this},t.prototype.distinctOn=function(e){return this.expressionMap.selectDistinctOn=e,this},t.prototype.from=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.addFrom=function(e,t){var n=this.createFromAlias(e,t);return this.expressionMap.mainAlias||this.expressionMap.setMainAlias(n),this},t.prototype.innerJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("INNER",e,t,n,r),this},t.prototype.leftJoin=function(e,t,n,r){return void 0===n&&(n=""),this.join("LEFT",e,t,n,r),this},t.prototype.innerJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.innerJoin(e,t,n,r),this},t.prototype.leftJoinAndSelect=function(e,t,n,r){return void 0===n&&(n=""),this.addSelect(t),this.leftJoin(e,t,n,r),this},t.prototype.innerJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!0),this},t.prototype.innerJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("INNER",t,n,r,i,e,!1),this},t.prototype.leftJoinAndMapMany=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!0),this},t.prototype.leftJoinAndMapOne=function(e,t,n,r,i){return void 0===r&&(r=""),this.addSelect(n),this.join("LEFT",t,n,r,i,e,!1),this},t.prototype.loadRelationIdAndMap=function(e,t,n,r){var i=new p.a(this.expressionMap);return i.mapToProperty=e,i.relationName=t,"string"===typeof n&&(i.alias=n),n instanceof Object&&n.disableMixedMap&&(i.disableMixedMap=!0),i.queryBuilderFactory=r,this.expressionMap.relationIdAttributes.push(i),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadRelationCountAndMap=function(e,t,n,r){var i=new f.a(this.expressionMap);return i.mapToProperty=e,i.relationName=t,i.alias=n,i.queryBuilderFactory=r,this.expressionMap.relationCountAttributes.push(i),this.expressionMap.createAlias({type:"other",name:i.junctionAlias}),i.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"other",name:i.junctionAlias,metadata:i.relation.junctionEntityMetadata}),this},t.prototype.loadAllRelationIds=function(e){var t=this;return this.expressionMap.mainAlias.metadata.relations.forEach((function(n){void 0!==e&&void 0!==e.relations&&-1===e.relations.indexOf(n.propertyPath)||t.loadRelationIdAndMap(t.expressionMap.mainAlias.name+"."+n.propertyPath,t.expressionMap.mainAlias.name+"."+n.propertyPath,e)})),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.having=function(e,t){return this.expressionMap.havings.push({type:"simple",condition:e}),t&&this.setParameters(t),this},t.prototype.andHaving=function(e,t){return this.expressionMap.havings.push({type:"and",condition:e}),t&&this.setParameters(t),this},t.prototype.orHaving=function(e,t){return this.expressionMap.havings.push({type:"or",condition:e}),t&&this.setParameters(t),this},t.prototype.groupBy=function(e){return this.expressionMap.groupBys=e?[e]:[],this},t.prototype.addGroupBy=function(e){return this.expressionMap.groupBys.push(e),this},t.prototype.orderBy=function(e,t,n){var r,i;if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){if(void 0===t&&(t="ASC"),void 0!==t&&"ASC"!==t&&"DESC"!==t)throw new Error('SelectQueryBuilder.addOrderBy "order" can accept only "ASC" and "DESC" values.');if(void 0!==n&&"NULLS FIRST"!==n&&"NULLS LAST"!==n)throw new Error('SelectQueryBuilder.addOrderBy "nulls" can accept only "NULLS FIRST" and "NULLS LAST" values.');return this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){if(this.expressionMap.limit=this.normalizeNumber(e),void 0!==this.expressionMap.limit&&isNaN(this.expressionMap.limit))throw new Error('Provided "limit" value is not a number. Please provide a numeric value.');return this},t.prototype.offset=function(e){if(this.expressionMap.offset=this.normalizeNumber(e),void 0!==this.expressionMap.offset&&isNaN(this.expressionMap.offset))throw new Error('Provided "offset" value is not a number. Please provide a numeric value.');return this},t.prototype.take=function(e){if(this.expressionMap.take=this.normalizeNumber(e),void 0!==this.expressionMap.take&&isNaN(this.expressionMap.take))throw new Error('Provided "take" value is not a number. Please provide a numeric value.');return this},t.prototype.skip=function(e){if(this.expressionMap.skip=this.normalizeNumber(e),void 0!==this.expressionMap.skip&&isNaN(this.expressionMap.skip))throw new Error('Provided "skip" value is not a number. Please provide a numeric value.');return this},t.prototype.setLock=function(e,t){return this.expressionMap.lockMode=e,this.expressionMap.lockVersion=t,this},t.prototype.withDeleted=function(){return this.expressionMap.withDeleted=!0,this},t.prototype.getRawOne=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.getRawMany()];case 1:return[2,e.sent()[0]]}}))}))},t.prototype.getRawMany=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i;return r.d(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new l;this.expressionMap.queryEntity=!1,e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return[4,this.loadRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getRawAndEntities=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i;return r.d(this,(function(r){switch(r.label){case 0:e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getOne=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.getRawAndEntities()];case 1:if(e=r.sent(),(t=e.entities[0])&&"optimistic"===this.expressionMap.lockMode&&this.expressionMap.lockVersion)if(n=this.expressionMap.mainAlias.metadata,this.expressionMap.lockVersion instanceof Date){if((i=n.updateDateColumn.getEntityValue(t)).getTime()!==this.expressionMap.lockVersion.getTime())throw new c(n.name,this.expressionMap.lockVersion,i)}else if((i=n.versionColumn.getEntityValue(t))!==this.expressionMap.lockVersion)throw new c(n.name,this.expressionMap.lockVersion,i);return[2,t]}}))}))},t.prototype.getMany=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new l;return[4,this.getRawAndEntities()];case 1:return[2,e.sent().entities]}}))}))},t.prototype.getCount=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i;return r.d(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new l;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,7,12,15]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 4:return n=r.sent(),t?[4,e.commitTransaction()]:[3,6];case 5:r.sent(),r.label=6;case 6:return[2,n];case 7:if(i=r.sent(),!t)return[3,11];r.label=8;case 8:return r.trys.push([8,10,,11]),[4,e.rollbackTransaction()];case 9:return r.sent(),[3,11];case 10:return r.sent(),[3,11];case 11:throw i;case 12:return e===this.queryRunner?[3,14]:[4,e.release()];case 13:r.sent(),r.label=14;case 14:return[7];case 15:return[2]}}))}))},t.prototype.getManyAndCount=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:if("optimistic"===this.expressionMap.lockMode)throw new l;e=this.obtainQueryRunner(),t=!1,r.label=1;case 1:return r.trys.push([1,8,13,16]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:r.sent(),t=!0,r.label=3;case 3:return this.expressionMap.queryEntity=!0,[4,this.executeEntitiesAndRawResults(e)];case 4:return n=r.sent(),this.expressionMap.queryEntity=!1,[4,this.executeCountQuery(e)];case 5:return i=r.sent(),a=[n.entities,i],t?[4,e.commitTransaction()]:[3,7];case 6:r.sent(),r.label=7;case 7:return[2,a];case 8:if(o=r.sent(),!t)return[3,12];r.label=9;case 9:return r.trys.push([9,11,,12]),[4,e.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw o;case 13:return e===this.queryRunner?[3,15]:[4,e.release()];case 14:r.sent(),r.label=15;case 15:return[7];case 16:return[2]}}))}))},t.prototype.stream=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,s,u,c=this;return r.d(this,(function(l){switch(l.label){case 0:this.expressionMap.queryEntity=!1,e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1],i=this.obtainQueryRunner(),a=!1,l.label=1;case 1:return l.trys.push([1,6,11,14]),!0!==this.expressionMap.useTransaction||!1!==i.isTransactionActive?[3,3]:[4,i.startTransaction()];case 2:l.sent(),a=!0,l.label=3;case 3:return o=function(){if(i!==c.queryRunner)return i.release()},s=i.stream(t,n,o,o),a?[4,i.commitTransaction()]:[3,5];case 4:l.sent(),l.label=5;case 5:return[2,s];case 6:if(u=l.sent(),!a)return[3,10];l.label=7;case 7:return l.trys.push([7,9,,10]),[4,i.rollbackTransaction()];case 8:return l.sent(),[3,10];case 9:return l.sent(),[3,10];case 10:throw u;case 11:return i===this.queryRunner?[3,13]:[4,i.release()];case 12:l.sent(),l.label=13;case 13:return[7];case 14:return[2]}}))}))},t.prototype.cache=function(e,t){return"boolean"===typeof e?this.expressionMap.cache=e:"number"===typeof e?(this.expressionMap.cache=!0,this.expressionMap.cacheDuration=e):"string"!==typeof e&&"number"!==typeof e||(this.expressionMap.cache=!0,this.expressionMap.cacheId=e),t&&(this.expressionMap.cacheDuration=t),this},t.prototype.setOption=function(e){return this.expressionMap.options.push(e),this},t.prototype.join=function(e,t,n,r,i,a,o){this.setParameters(i||{});var s=new h.a(this.connection,this.expressionMap);if(s.direction=e,s.mapToProperty=a,s.isMappingMany=o,s.entityOrProperty=t,s.condition=r,this.expressionMap.joinAttributes.push(s),s.metadata)s.alias=this.expressionMap.createAlias({type:"join",name:n,metadata:s.metadata}),s.relation&&s.relation.junctionEntityMetadata&&this.expressionMap.createAlias({type:"join",name:s.junctionAlias,metadata:s.relation.junctionEntityMetadata});else{var u="";if(t instanceof Function){var c=t(this.subQuery());this.setParameters(c.getParameters()),u=c.getQuery()}else u=t;var l=t instanceof Function||"("===t.substr(0,1)&&")"===t.substr(-1);s.alias=this.expressionMap.createAlias({type:"join",name:n,tablePath:!1===l?t:void 0,subQuery:!0===l?u:void 0})}},t.prototype.createSelectExpression=function(){var e=this;if(!this.expressionMap.mainAlias)throw new Error("Cannot build query because main alias is not set (call qb#from method)");var t=[],n=[];if(this.expressionMap.mainAlias.hasMetadata){var i=this.expressionMap.mainAlias.metadata;t.push.apply(t,r.f(this.buildEscapedEntityColumnSelects(this.expressionMap.mainAlias.name,i))),n.push.apply(n,r.f(this.findEntityColumnSelects(this.expressionMap.mainAlias.name,i)))}this.expressionMap.joinAttributes.forEach((function(i){if(i.metadata)t.push.apply(t,r.f(e.buildEscapedEntityColumnSelects(i.alias.name,i.metadata))),n.push.apply(n,r.f(e.findEntityColumnSelects(i.alias.name,i.metadata)));else if(e.expressionMap.selects.some((function(e){return e.selection===i.alias.name}))){t.push({selection:e.escape(i.alias.name)+".*"});var a=e.expressionMap.selects.find((function(e){return e.selection===i.alias.name}));n.push(a)}})),this.expressionMap.selects.filter((function(e){return-1===n.indexOf(e)})).forEach((function(n){return t.push({selection:e.replacePropertyNames(n.selection),aliasName:n.aliasName})})),0===t.length&&t.push({selection:"*"});var a="";if(this.connection.driver instanceof o.a)switch(this.expressionMap.lockMode){case"pessimistic_read":a=" WITH (HOLDLOCK, ROWLOCK)";break;case"pessimistic_write":a=" WITH (UPDLOCK, ROWLOCK)";break;case"dirty_read":a=" WITH (NOLOCK)"}var s=this.expressionMap.aliases.filter((function(e){return"from"===e.type&&(e.tablePath||e.subQuery)})).map((function(t){return t.subQuery?t.subQuery+" "+e.escape(t.name):e.getTableName(t.tablePath)+" "+e.escape(t.name)}));return this.createSelectDistinctExpression()+t.map((function(t){return t.selection+(t.aliasName?" AS "+e.escape(t.aliasName):"")})).join(", ")+" FROM "+s.join(", ")+a},t.prototype.createSelectDistinctExpression=function(){var e=this,t=this.expressionMap,n=t.selectDistinct,r=t.selectDistinctOn,i="SELECT ";this.connection.driver instanceof T.f&&r.length>0?i="SELECT DISTINCT ON ("+r.map((function(t){return e.replacePropertyNames(t)})).join(", ")+") ":n&&(i="SELECT DISTINCT ");return i},t.prototype.createJoinExpression=function(){var e=this;return this.expressionMap.joinAttributes.map((function(t){var n=t.relation,r=t.tablePath,i=t.alias.name,a=t.condition?" AND ("+t.condition+")":"",o=t.parentAlias;if(!o||!n){var s=t.alias.subQuery?t.alias.subQuery:e.getTableName(r);return" "+t.direction+" JOIN "+s+" "+e.escape(i)+(t.condition?" ON "+e.replacePropertyNames(t.condition):"")}if(n.isManyToOne||n.isOneToOneOwner){var u=n.joinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+o+"."+n.propertyPath+"."+e.referencedColumn.propertyPath})).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}if(n.isOneToMany||n.isOneToOneNotOwner){u=n.inverseRelation.joinColumns.map((function(e){return i+"."+n.inverseRelation.propertyPath+"."+e.referencedColumn.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND ");return" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(u+a)}var c=n.junctionEntityMetadata.tablePath,l=t.junctionAlias,h="",p="";return n.isOwning?(h=n.joinColumns.map((function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND "),p=n.inverseJoinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath})).join(" AND ")):(h=n.inverseRelation.inverseJoinColumns.map((function(e){return l+"."+e.propertyPath+"="+o+"."+e.referencedColumn.propertyPath})).join(" AND "),p=n.inverseRelation.joinColumns.map((function(e){return i+"."+e.referencedColumn.propertyPath+"="+l+"."+e.propertyPath})).join(" AND "))," "+t.direction+" JOIN "+e.getTableName(c)+" "+e.escape(l)+" ON "+e.replacePropertyNames(h)+" "+t.direction+" JOIN "+e.getTableName(r)+" "+e.escape(i)+" ON "+e.replacePropertyNames(p+a)})).join(" ")},t.prototype.createGroupByExpression=function(){return this.expressionMap.groupBys&&this.expressionMap.groupBys.length?" GROUP BY "+this.replacePropertyNames(this.expressionMap.groupBys.join(", ")):""},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.allOrderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"===typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitOffsetExpression=function(){var e=this.expressionMap.offset,t=this.expressionMap.limit;if(e||t||0!==this.expressionMap.joinAttributes.length||(e=this.expressionMap.skip,t=this.expressionMap.take),this.connection.driver instanceof o.a){var n="";if((t||e)&&Object.keys(this.expressionMap.allOrderBys).length<=0&&(n=" ORDER BY (SELECT NULL)"),t&&e)return n+" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return n+" OFFSET 0 ROWS FETCH NEXT "+t+" ROWS ONLY";if(e)return n+" OFFSET "+e+" ROWS"}else if(this.connection.driver instanceof T.e||this.connection.driver instanceof R.a||this.connection.driver instanceof i.a){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)throw new A}else if(this.connection.driver instanceof w.a){if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" LIMIT -1 OFFSET "+e}else if(this.connection.driver instanceof N.a){if(t&&e)return" OFFSET "+e+" ROWS FETCH NEXT "+t+" ROWS ONLY";if(t)return" FETCH NEXT "+t+" ROWS ONLY";if(e)return" OFFSET "+e+" ROWS"}else{if(t&&e)return" LIMIT "+t+" OFFSET "+e;if(t)return" LIMIT "+t;if(e)return" OFFSET "+e}return""},t.prototype.createLockExpression=function(){var e=this.connection.driver;switch(this.expressionMap.lockMode){case"pessimistic_read":if(e instanceof T.e||e instanceof R.a)return" LOCK IN SHARE MODE";if(e instanceof T.f)return" FOR SHARE";if(e instanceof N.a)return" FOR UPDATE";if(e instanceof o.a)return"";throw new E;case"pessimistic_write":if(e instanceof T.e||e instanceof R.a||e instanceof T.f||e instanceof N.a)return" FOR UPDATE";if(e instanceof o.a)return"";throw new E;case"pessimistic_partial_write":if(e instanceof T.f)return" FOR UPDATE SKIP LOCKED";throw new E;case"pessimistic_write_or_fail":if(e instanceof T.f)return" FOR UPDATE NOWAIT";throw new E;case"for_no_key_update":if(e instanceof T.f)return" FOR NO KEY UPDATE";throw new E;default:return""}},t.prototype.createHavingExpression=function(){var e=this;if(!this.expressionMap.havings||!this.expressionMap.havings.length)return"";var t=this.expressionMap.havings.map((function(t,n){switch(t.type){case"and":return(n>0?"AND ":"")+e.replacePropertyNames(t.condition);case"or":return(n>0?"OR ":"")+e.replacePropertyNames(t.condition);default:return e.replacePropertyNames(t.condition)}})).join(" ");return t.length?" HAVING "+t:""},t.prototype.buildEscapedEntityColumnSelects=function(e,t){var n=this,i=this.expressionMap.selects.some((function(t){return t.selection===e})),a=[];if(i&&a.push.apply(a,r.f(t.columns.filter((function(e){return!0===e.isSelect})))),a.push.apply(a,r.f(t.columns.filter((function(t){return n.expressionMap.selects.some((function(n){return n.selection===e+"."+t.propertyPath}))})))),0===a.length)return[];var s=this.expressionMap.queryEntity?t.primaryColumns.filter((function(e){return-1===a.indexOf(e)})):[];return r.f(a,s).map((function(t){var r=n.expressionMap.selects.find((function(n){return n.selection===e+"."+t.propertyPath})),a=n.escape(e)+"."+n.escape(t.databaseName);if(-1!==n.connection.driver.spatialTypes.indexOf(t.type)){if(n.connection.driver instanceof T.e||n.connection.driver instanceof R.a)a=(n.connection.driver.options.legacySpatialSupport?"AsText":"ST_AsText")+"("+a+")";n.connection.driver instanceof T.f&&(a="ST_AsGeoJSON("+a+")::json"),n.connection.driver instanceof o.a&&(a+=".ToString()")}return{selection:a,aliasName:r&&r.aliasName?r.aliasName:d.a.buildColumnAlias(n.connection.driver,e,t.databaseName),virtual:r?!0===r.virtual:!i}}))},t.prototype.findEntityColumnSelects=function(e,t){var n=this.expressionMap.selects.find((function(t){return t.selection===e}));return n?[n]:this.expressionMap.selects.filter((function(n){return t.columns.some((function(t){return n.selection===e+"."+t.propertyPath}))}))},t.prototype.executeCountQuery=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return t=this.expressionMap.mainAlias.name,n=this.expressionMap.mainAlias.metadata,i=this.escape(t),a="",a=n.hasMultiplePrimaryKeys?this.connection.driver instanceof w.a?"COUNT(DISTINCT("+n.primaryColumns.map((function(e,t){var n=s.escape(e.databaseName);return i+"."+n})).join(" || ")+')) as "cnt"':"COUNT(DISTINCT(CONCAT("+n.primaryColumns.map((function(e,t){var n=s.escape(e.databaseName);return i+"."+n})).join(", ")+'))) as "cnt"':"COUNT(DISTINCT("+n.primaryColumns.map((function(e,t){var n=s.escape(e.databaseName);return i+"."+n})).join(", ")+')) as "cnt"',[4,this.clone().orderBy().groupBy().offset(void 0).limit(void 0).skip(void 0).take(void 0).select(a).setOption("disable-global-order").loadRawResults(e)];case 1:return(o=r.sent())&&o[0]&&o[0].cnt?[2,parseInt(o[0].cnt)]:[2,0]}}))}))},t.prototype.executeEntitiesAndRawResults=function(e){return r.b(this,void 0,void 0,(function(){var n,i,o,c,l,h,p,f,b,E,T,N,w,A,S,R,M,O,P=this;return r.d(this,(function(x){switch(x.label){case 0:if(!this.expressionMap.mainAlias)throw new Error('Alias is not set. Use "from" method to set an alias.');if(("pessimistic_read"===this.expressionMap.lockMode||"pessimistic_write"===this.expressionMap.lockMode||"pessimistic_partial_write"===this.expressionMap.lockMode||"pessimistic_write_or_fail"===this.expressionMap.lockMode||"for_no_key_update"===this.expressionMap.lockMode)&&!e.isTransactionActive)throw new s;if("optimistic"===this.expressionMap.lockMode&&!(n=this.expressionMap.mainAlias.metadata).versionColumn&&!n.updateDateColumn)throw new u(n.name);return i=new m(this.connection,e,this.expressionMap.relationIdAttributes),o=new v(this.connection,e,this.expressionMap.relationCountAttributes),new y(this.expressionMap).transform(),new g(this.expressionMap).transform(),c=[],l=[],(this.expressionMap.skip||this.expressionMap.take)&&this.expressionMap.joinAttributes.length>0?(h=r.e(this.createOrderByCombinedWithSelectExpression("distinctAlias"),2),p=h[0],f=h[1],b=this.expressionMap.mainAlias.metadata,E=this.expressionMap.mainAlias.name,T=b.primaryColumns.map((function(e){var t=P.escape("distinctAlias"),n=P.escape(d.a.buildColumnAlias(P.connection.driver,E,e.databaseName));return f[n]||(f[n]="ASC"),t+"."+n+' as "ids_'+d.a.buildColumnAlias(P.connection.driver,E,e.databaseName)+'"'})),[4,new t(this.connection,e).select("DISTINCT "+T.join(", ")).addSelect(p).from("("+this.clone().orderBy().getQuery()+")","distinctAlias").offset(this.expressionMap.skip).limit(this.expressionMap.take).orderBy(f).cache(this.expressionMap.cache?this.expressionMap.cache:this.expressionMap.cacheId,this.expressionMap.cacheDuration).setParameters(this.getParameters()).setNativeParameters(this.expressionMap.nativeParameters).getRawMany()]):[3,4];case 1:return(c=x.sent()).length>0?(N="",w={},b.hasMultiplePrimaryKeys?N=c.map((function(e,t){return b.primaryColumns.map((function(n){var r="orm_distinct_ids_"+t+"_"+n.databaseName;return w[r]=e["ids_"+E+"_"+n.databaseName],E+"."+n.propertyPath+"=:"+r})).join(" AND ")})).join(" OR "):(A=c.map((function(e){return e["ids_"+d.a.buildColumnAlias(P.connection.driver,E,b.primaryColumns[0].databaseName)]})),A.every((function(e){return"number"===typeof e}))?N=E+"."+b.primaryColumns[0].propertyPath+" IN ("+A.join(", ")+")":(w.orm_distinct_ids=A,N=E+"."+b.primaryColumns[0].propertyPath+" IN (:...orm_distinct_ids)")),[4,this.clone().mergeExpressionMap({extraAppendedAndWhereCondition:N}).setParameters(w).loadRawResults(e)]):[3,3];case 2:c=x.sent(),x.label=3;case 3:return[3,6];case 4:return[4,this.loadRawResults(e)];case 5:c=x.sent(),x.label=6;case 6:return c.length>0?[4,i.load(c)]:[3,10];case 7:return S=x.sent(),[4,o.load(c)];case 8:return R=x.sent(),M=new a.a(this.expressionMap,this.connection.driver,S,R,this.queryRunner),l=M.transform(c,this.expressionMap.mainAlias),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(O=new C.a,e.broadcaster.broadcastLoadEventsForAll(O,this.expressionMap.mainAlias.metadata,l),O.promises.length>0?[4,Promise.all(O.promises)]:[3,10]):[3,10];case 9:x.sent(),x.label=10;case 10:return[2,{raw:c,entities:l}]}}))}))},t.prototype.createOrderByCombinedWithSelectExpression=function(e){var t=this,n=this.expressionMap.allOrderBys,i=Object.keys(n).map((function(n){if(-1!==n.indexOf(".")){var i=r.e(n.split("."),2),a=i[0],o=i[1],s=t.expressionMap.findAliasByName(a).metadata.findColumnWithPropertyName(o);return t.escape(e)+"."+t.escape(d.a.buildColumnAlias(t.connection.driver,a,s.databaseName))}return t.expressionMap.selects.find((function(e){return e.selection===n||e.aliasName===n}))?t.escape(e)+"."+n:""})).join(", "),a={};return Object.keys(n).forEach((function(i){if(-1!==i.indexOf(".")){var o=r.e(i.split("."),2),s=o[0],u=o[1],c=t.expressionMap.findAliasByName(s).metadata.findColumnWithPropertyName(u);a[t.escape(e)+"."+t.escape(d.a.buildColumnAlias(t.connection.driver,s,c.databaseName))]=n[i]}else t.expressionMap.selects.find((function(e){return e.selection===i||e.aliasName===i}))?a[t.escape(e)+"."+i]=n[i]:a[i]=n[i]})),[i,a]},t.prototype.loadRawResults=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u;return r.d(this,(function(c){switch(c.label){case 0:return t=r.e(this.getQueryAndParameters(),2),n=t[0],i=t[1],a=n+" -- PARAMETERS: "+JSON.stringify(i),o="object"===typeof this.connection.options.cache?this.connection.options.cache:{},s=void 0,this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.getFromCache({identifier:this.expressionMap.cacheId,query:a,duration:this.expressionMap.cacheDuration||o.duration||1e3},e)]:[3,2];case 1:if((s=c.sent())&&!this.connection.queryResultCache.isExpired(s))return[2,JSON.parse(s.result)];c.label=2;case 2:return[4,e.query(n,i)];case 3:return u=c.sent(),this.connection.queryResultCache&&(this.expressionMap.cache||o.alwaysEnabled)?[4,this.connection.queryResultCache.storeInCache({identifier:this.expressionMap.cacheId,query:a,time:(new Date).getTime(),duration:this.expressionMap.cacheDuration||o.duration||1e3,result:JSON.stringify(u)},s,e)]:[3,5];case 4:c.sent(),c.label=5;case 5:return[2,u]}}))}))},t.prototype.mergeExpressionMap=function(e){return S.a.assign(this.expressionMap,e),this},t.prototype.normalizeNumber=function(e){return"number"===typeof e||void 0===e||null===e?e:Number(e)},t.prototype.obtainQueryRunner=function(){return this.queryRunner||this.connection.createQueryRunner("slave")},t}(b.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name="ConnectionIsNotSetError",Object.setPrototypeOf(r,t.prototype),r.message="Connection with "+n+" database is not established. Check connection configuration.",r}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0),i=n(39),a=n(26),o=function(){function e(e,t){this.queryExpressionMap=e,this.disableMixedMap=!1,a.a.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(0,this.relationName.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.substr(this.relationName.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");var e=this.queryExpressionMap.findAliasByName(this.parentAlias).metadata.findRelationWithPropertyPath(this.relationPropertyPath);if(!e)throw new Error("Relation with property path "+this.relationPropertyPath+" in entity was not found.");return e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=r.e(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rid"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionMetadata",{get:function(){return this.relation.junctionEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){return this.mapToProperty.substr(0,this.mapToProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyPath",{get:function(){return this.mapToProperty.substr(this.mapToProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0),i=n(39),a=n(26),o=function(){function e(e,t){this.expressionMap=e,a.a.assign(this,t||{})}return Object.defineProperty(e.prototype,"joinInverseSideMetadata",{get:function(){return this.relation.inverseEntityMetadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value must be a string representation of alias property");return this.relationName.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationProperty",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");return this.relationName.split(".")[1]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){var e=r.e(this.relationName.split("."),2);return e[0]+"_"+e[1]+"_rc"},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=r.e(this.relationName.split("."),2),t=e[0],n=e[1],a=this.expressionMap.findAliasByName(t).metadata.findRelationWithPropertyPath(n);if(!a)throw new Error("Relation with property path "+n+" in entity was not found.");return a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){if(!i.a.isAliasProperty(this.relationName))throw new Error("Given value is a string representation of alias property");var e=this.relationName.split(".")[0];return this.expressionMap.findAliasByName(e).metadata},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0),i=n(6),a=n(12),o=function(){function e(e,t){this.queryRunner=e,this.expressionMap=t}return e.prototype.update=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(o){switch(o.label){case 0:return n=this.expressionMap.mainAlias.metadata,[4,Promise.all(t.map((function(t,o){return r.b(i,void 0,void 0,(function(){var i,s,u,c,l=this;return r.d(this,(function(r){switch(r.label){case 0:return this.queryRunner.connection.driver.isReturningSqlSupported()?(this.queryRunner.connection.driver instanceof a.a&&Array.isArray(e.raw)&&this.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((function(e,t,n){return e[l.expressionMap.extraReturningColumns[n].databaseName]=t[0],e}),{})),i=Array.isArray(e.raw)?e.raw[o]:e.raw,(s=this.queryRunner.connection.driver.createGeneratedMap(n,i))&&(this.queryRunner.manager.merge(n.target,t,s),e.generatedMaps.push(s)),[3,3]):[3,1];case 1:if(!(this.getUpdationReturningColumns().length>0))return[3,3];if(!(u=this.expressionMap.mainAlias.metadata.getEntityIdMap(t)))throw new Error("Cannot update entity because entity id is not set in the entity.");return[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((function(e){return n.targetName+"."+e.propertyPath}))).addSelect(this.getUpdationReturningColumns().map((function(e){return n.targetName+"."+e.propertyPath}))).from(n.target,n.targetName).where(u).setOption("create-pojo").getOne()];case 2:(c=r.sent())&&(this.queryRunner.manager.merge(n.target,t,c),e.generatedMaps.push(c)),r.label=3;case 3:return[2]}}))}))})))];case 1:return o.sent(),[2]}}))}))},e.prototype.insert=function(e,t){return r.b(this,void 0,void 0,(function(){var n,o,s,u=this;return r.d(this,(function(c){switch(c.label){case 0:return n=this.expressionMap.mainAlias.metadata,o=this.getInsertionReturningColumns(),s=t.map((function(t,r){u.queryRunner.connection.driver instanceof a.a&&Array.isArray(e.raw)&&u.expressionMap.extraReturningColumns.length>0&&(e.raw=e.raw.reduce((function(e,t,n){return e[u.expressionMap.extraReturningColumns[n].databaseName]=t[0],e}),{}));var o=Array.isArray(e.raw)?e.raw[r]:e.raw,s=u.queryRunner.connection.driver.createGeneratedMap(n,o)||{};return!1===u.queryRunner.connection.driver.isUUIDGenerationSupported()&&n.generatedColumns.forEach((function(e){if("uuid"===e.generationStrategy){var n=e.getEntityValue(t);n||(n=u.expressionMap.nativeParameters["uuid_"+e.databaseName+r]),i.a.mergeDeep(s,e.createValueMap(n))}})),u.queryRunner.manager.merge(n.target,t,s),s})),!1===this.queryRunner.connection.driver.isReturningSqlSupported()&&o.length>0?[4,Promise.all(t.map((function(e,t){return r.b(u,void 0,void 0,(function(){var i,a;return r.d(this,(function(r){switch(r.label){case 0:return i=n.getEntityIdMap(e),[4,this.queryRunner.manager.createQueryBuilder().select(n.primaryColumns.map((function(e){return n.targetName+"."+e.propertyPath}))).addSelect(o.map((function(e){return n.targetName+"."+e.propertyPath}))).from(n.target,n.targetName).where(i).setOption("create-pojo").getOne()];case 1:return a=r.sent(),this.queryRunner.manager.merge(n.target,s[t],a),[2]}}))}))})))]:[3,2];case 1:c.sent(),c.label=2;case 2:return t.forEach((function(t,r){var i=n.getEntityIdMap(t);e.identifiers.push(i),e.generatedMaps.push(s[r]),u.queryRunner.manager.merge(u.expressionMap.mainAlias.metadata.target,t,s[r],s[r])})),[2]}}))}))},e.prototype.getInsertionReturningColumns=function(){var e=this.queryRunner.connection.driver.isReturningSqlSupported();return this.expressionMap.mainAlias.metadata.columns.filter((function(t){return void 0!==t.default||e&&t.isGenerated||t.isCreateDate||t.isUpdateDate||t.isDeleteDate||t.isVersion}))},e.prototype.getUpdationReturningColumns=function(){return this.expressionMap.mainAlias.metadata.columns.filter((function(e){return e.isUpdateDate||e.isVersion}))},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){function e(){}return e.createTableColumnOptions=function(e,t){return{name:e.databaseName,length:e.length,width:e.width,charset:e.charset,collation:e.collation,precision:e.precision,scale:e.scale,zerofill:e.zerofill,unsigned:e.unsigned,asExpression:e.asExpression,generatedType:e.generatedType,default:t.normalizeDefault(e),onUpdate:e.onUpdate,comment:e.comment,isGenerated:e.isGenerated,generationStrategy:e.generationStrategy,isNullable:e.isNullable,type:t.normalizeType(e),isPrimary:e.isPrimary,isUnique:t.normalizeIsUnique(e),isArray:e.isArray||!1,enum:e.enum?e.enum.map((function(e){return e+""})):e.enum,enumName:e.enumName,spatialFeatureType:e.spatialFeatureType,srid:e.srid}},e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="UpdateValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform update query because update values are not defined. Call "qb.set(...)" method to specify updated values.',n}return r.c(t,e),t}(Error)},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(r){"object"===typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(e){this.whereFactory=e}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(16);function i(e){return new r.a("in",e,!0,!0)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var r=function(){}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(0),i=n(39),a=n(26),o=function(){function e(e,t,n){this.connection=e,this.queryExpressionMap=t,this.isSelectedEvaluated=!1,this.relationEvaluated=!1,a.a.assign(this,n||{})}return Object.defineProperty(e.prototype,"isMany",{get:function(){return void 0!==this.isMappingMany?this.isMappingMany:!!this.relation&&(this.relation.isManyToMany||this.relation.isOneToMany)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"isSelected",{get:function(){var e=this;if(!this.isSelectedEvaluated){this.isSelectedCache=function(){var t,n,i=function(t){return t.selection===e.alias.name||e.metadata&&e.metadata.columns.find((function(n){return t.selection===e.alias.name+"."+n.propertyPath}))?{value:!0}:void 0};try{for(var a=r.g(e.queryExpressionMap.selects),o=a.next();!o.done;o=a.next()){var s=i(o.value);if("object"===typeof s)return s.value}}catch(u){t={error:u}}finally{try{o&&!o.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1}(),this.isSelectedEvaluated=!0}return this.isSelectedCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"tablePath",{get:function(){return this.metadata?this.metadata.tablePath:this.entityOrProperty},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parentAlias",{get:function(){if(i.a.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(0,this.entityOrProperty.indexOf("."))},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relationPropertyPath",{get:function(){if(i.a.isAliasProperty(this.entityOrProperty))return this.entityOrProperty.substr(this.entityOrProperty.indexOf(".")+1)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"relation",{get:function(){var e=this;if(!this.relationEvaluated){this.relationCache=function(){if(i.a.isAliasProperty(e.entityOrProperty)){var t=e.queryExpressionMap.findAliasByName(e.parentAlias),n=t.metadata.findRelationWithPropertyPath(e.relationPropertyPath);if(n)return n;if(t.metadata.parentEntityMetadata&&(n=t.metadata.parentEntityMetadata.findRelationWithPropertyPath(e.relationPropertyPath)))return n;throw new Error("Relation with property path "+e.relationPropertyPath+" in entity was not found.")}}.bind(this)(),this.relationEvaluated=!0}return this.relationCache},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"metadata",{get:function(){return this.relation?this.relation.inverseEntityMetadata:this.connection.hasMetadata(this.entityOrProperty)?this.connection.getMetadata(this.entityOrProperty):void 0},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"junctionAlias",{get:function(){if(!this.relation)throw new Error("Cannot get junction table for join without relation.");return this.relation.isOwning?this.parentAlias+"_"+this.alias.name:this.alias.name+"_"+this.parentAlias},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyParentAlias",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[0]},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"mapToPropertyPropertyName",{get:function(){if(this.mapToProperty)return this.mapToProperty.split(".")[1]},enumerable:!0,configurable:!0}),e}()},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(n){var r=e.call(this)||this;return r.name="EntityColumnNotFound",Object.setPrototypeOf(r,t.prototype),r.message='No entity column "'+n+'" was found.',r}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(0),i=function(e){function t(){var n=e.call(this)||this;return n.name="LimitOnUpdateNotSupportedError",Object.setPrototypeOf(n,t.prototype),n.message="Your database does not support LIMIT on UPDATE statements.",n}return r.c(t,e),t}(Error)},function(e,t,n){"use strict";var r=n(103),i=n(105);function a(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}t.parse=b,t.resolve=function(e,t){return b(e,!1,!0).resolve(t)},t.resolveObject=function(e,t){return e?b(e,!1,!0).resolveObject(t):t},t.format=function(e){i.isString(e)&&(e=b(e));return e instanceof a?e.format():a.prototype.format.call(e)},t.Url=a;var o=/^([a-z0-9.+-]+:)/i,s=/:[0-9]*$/,u=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,c=["{","}","|","\\","^","`"].concat(["<",">",'"',"`"," ","\r","\n","\t"]),l=["'"].concat(c),h=["%","/","?",";","#"].concat(l),p=["/","?","#"],f=/^[+a-z0-9A-Z_-]{0,63}$/,d=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,m={javascript:!0,"javascript:":!0},y={javascript:!0,"javascript:":!0},v={http:!0,https:!0,ftp:!0,gopher:!0,file:!0,"http:":!0,"https:":!0,"ftp:":!0,"gopher:":!0,"file:":!0},g=n(106);function b(e,t,n){if(e&&i.isObject(e)&&e instanceof a)return e;var r=new a;return r.parse(e,t,n),r}a.prototype.parse=function(e,t,n){if(!i.isString(e))throw new TypeError("Parameter 'url' must be a string, not "+typeof e);var a=e.indexOf("?"),s=-1!==a&&a<e.indexOf("#")?"?":"#",c=e.split(s);c[0]=c[0].replace(/\\/g,"/");var b=e=c.join(s);if(b=b.trim(),!n&&1===e.split("#").length){var E=u.exec(b);if(E)return this.path=b,this.href=b,this.pathname=E[1],E[2]?(this.search=E[2],this.query=t?g.parse(this.search.substr(1)):this.search.substr(1)):t&&(this.search="",this.query={}),this}var T=o.exec(b);if(T){var N=(T=T[0]).toLowerCase();this.protocol=N,b=b.substr(T.length)}if(n||T||b.match(/^\/\/[^@\/]+@[^@\/]+/)){var w="//"===b.substr(0,2);!w||T&&y[T]||(b=b.substr(2),this.slashes=!0)}if(!y[T]&&(w||T&&!v[T])){for(var A,C,S=-1,R=0;R<p.length;R++){-1!==(M=b.indexOf(p[R]))&&(-1===S||M<S)&&(S=M)}-1!==(C=-1===S?b.lastIndexOf("@"):b.lastIndexOf("@",S))&&(A=b.slice(0,C),b=b.slice(C+1),this.auth=decodeURIComponent(A)),S=-1;for(R=0;R<h.length;R++){var M;-1!==(M=b.indexOf(h[R]))&&(-1===S||M<S)&&(S=M)}-1===S&&(S=b.length),this.host=b.slice(0,S),b=b.slice(S),this.parseHost(),this.hostname=this.hostname||"";var O="["===this.hostname[0]&&"]"===this.hostname[this.hostname.length-1];if(!O)for(var P=this.hostname.split(/\./),x=(R=0,P.length);R<x;R++){var I=P[R];if(I&&!I.match(f)){for(var _="",L=0,D=I.length;L<D;L++)I.charCodeAt(L)>127?_+="x":_+=I[L];if(!_.match(f)){var q=P.slice(0,R),j=P.slice(R+1),U=I.match(d);U&&(q.push(U[1]),j.unshift(U[2])),j.length&&(b="/"+j.join(".")+b),this.hostname=q.join(".");break}}}this.hostname.length>255?this.hostname="":this.hostname=this.hostname.toLowerCase(),O||(this.hostname=r.toASCII(this.hostname));var B=this.port?":"+this.port:"",k=this.hostname||"";this.host=k+B,this.href+=this.host,O&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),"/"!==b[0]&&(b="/"+b))}if(!m[N])for(R=0,x=l.length;R<x;R++){var F=l[R];if(-1!==b.indexOf(F)){var V=encodeURIComponent(F);V===F&&(V=escape(F)),b=b.split(F).join(V)}}var Q=b.indexOf("#");-1!==Q&&(this.hash=b.substr(Q),b=b.slice(0,Q));var K=b.indexOf("?");if(-1!==K?(this.search=b.substr(K),this.query=b.substr(K+1),t&&(this.query=g.parse(this.query)),b=b.slice(0,K)):t&&(this.search="",this.query={}),b&&(this.pathname=b),v[N]&&this.hostname&&!this.pathname&&(this.pathname="/"),this.pathname||this.search){B=this.pathname||"";var H=this.search||"";this.path=B+H}return this.href=this.format(),this},a.prototype.format=function(){var e=this.auth||"";e&&(e=(e=encodeURIComponent(e)).replace(/%3A/i,":"),e+="@");var t=this.protocol||"",n=this.pathname||"",r=this.hash||"",a=!1,o="";this.host?a=e+this.host:this.hostname&&(a=e+(-1===this.hostname.indexOf(":")?this.hostname:"["+this.hostname+"]"),this.port&&(a+=":"+this.port)),this.query&&i.isObject(this.query)&&Object.keys(this.query).length&&(o=g.stringify(this.query));var s=this.search||o&&"?"+o||"";return t&&":"!==t.substr(-1)&&(t+=":"),this.slashes||(!t||v[t])&&!1!==a?(a="//"+(a||""),n&&"/"!==n.charAt(0)&&(n="/"+n)):a||(a=""),r&&"#"!==r.charAt(0)&&(r="#"+r),s&&"?"!==s.charAt(0)&&(s="?"+s),t+a+(n=n.replace(/[?#]/g,(function(e){return encodeURIComponent(e)})))+(s=s.replace("#","%23"))+r},a.prototype.resolve=function(e){return this.resolveObject(b(e,!1,!0)).format()},a.prototype.resolveObject=function(e){if(i.isString(e)){var t=new a;t.parse(e,!1,!0),e=t}for(var n=new a,r=Object.keys(this),o=0;o<r.length;o++){var s=r[o];n[s]=this[s]}if(n.hash=e.hash,""===e.href)return n.href=n.format(),n;if(e.slashes&&!e.protocol){for(var u=Object.keys(e),c=0;c<u.length;c++){var l=u[c];"protocol"!==l&&(n[l]=e[l])}return v[n.protocol]&&n.hostname&&!n.pathname&&(n.path=n.pathname="/"),n.href=n.format(),n}if(e.protocol&&e.protocol!==n.protocol){if(!v[e.protocol]){for(var h=Object.keys(e),p=0;p<h.length;p++){var f=h[p];n[f]=e[f]}return n.href=n.format(),n}if(n.protocol=e.protocol,e.host||y[e.protocol])n.pathname=e.pathname;else{for(var d=(e.pathname||"").split("/");d.length&&!(e.host=d.shift()););e.host||(e.host=""),e.hostname||(e.hostname=""),""!==d[0]&&d.unshift(""),d.length<2&&d.unshift(""),n.pathname=d.join("/")}if(n.search=e.search,n.query=e.query,n.host=e.host||"",n.auth=e.auth,n.hostname=e.hostname||e.host,n.port=e.port,n.pathname||n.search){var m=n.pathname||"",g=n.search||"";n.path=m+g}return n.slashes=n.slashes||e.slashes,n.href=n.format(),n}var b=n.pathname&&"/"===n.pathname.charAt(0),E=e.host||e.pathname&&"/"===e.pathname.charAt(0),T=E||b||n.host&&e.pathname,N=T,w=n.pathname&&n.pathname.split("/")||[],A=(d=e.pathname&&e.pathname.split("/")||[],n.protocol&&!v[n.protocol]);if(A&&(n.hostname="",n.port=null,n.host&&(""===w[0]?w[0]=n.host:w.unshift(n.host)),n.host="",e.protocol&&(e.hostname=null,e.port=null,e.host&&(""===d[0]?d[0]=e.host:d.unshift(e.host)),e.host=null),T=T&&(""===d[0]||""===w[0])),E)n.host=e.host||""===e.host?e.host:n.host,n.hostname=e.hostname||""===e.hostname?e.hostname:n.hostname,n.search=e.search,n.query=e.query,w=d;else if(d.length)w||(w=[]),w.pop(),w=w.concat(d),n.search=e.search,n.query=e.query;else if(!i.isNullOrUndefined(e.search)){if(A)n.hostname=n.host=w.shift(),(O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=O.shift(),n.host=n.hostname=O.shift());return n.search=e.search,n.query=e.query,i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.href=n.format(),n}if(!w.length)return n.pathname=null,n.search?n.path="/"+n.search:n.path=null,n.href=n.format(),n;for(var C=w.slice(-1)[0],S=(n.host||e.host||w.length>1)&&("."===C||".."===C)||""===C,R=0,M=w.length;M>=0;M--)"."===(C=w[M])?w.splice(M,1):".."===C?(w.splice(M,1),R++):R&&(w.splice(M,1),R--);if(!T&&!N)for(;R--;R)w.unshift("..");!T||""===w[0]||w[0]&&"/"===w[0].charAt(0)||w.unshift(""),S&&"/"!==w.join("/").substr(-1)&&w.push("");var O,P=""===w[0]||w[0]&&"/"===w[0].charAt(0);A&&(n.hostname=n.host=P?"":w.length?w.shift():"",(O=!!(n.host&&n.host.indexOf("@")>0)&&n.host.split("@"))&&(n.auth=O.shift(),n.host=n.hostname=O.shift()));return(T=T||n.host&&w.length)&&!P&&w.unshift(""),w.length?n.pathname=w.join("/"):(n.pathname=null,n.path=null),i.isNull(n.pathname)&&i.isNull(n.search)||(n.path=(n.pathname?n.pathname:"")+(n.search?n.search:"")),n.auth=e.auth||n.auth,n.slashes=n.slashes||e.slashes,n.href=n.format(),n},a.prototype.parseHost=function(){var e=this.host,t=s.exec(e);t&&(":"!==(t=t[0])&&(this.port=t.substr(1)),e=e.substr(0,e.length-t.length)),e&&(this.hostname=e)}},function(e,t,n){"use strict";n.r(t),n.d(t,"UpdateQueryBuilder",(function(){return T}));var r=n(0),i=n(29),a=n(24),o=n(35),s=n(9),u=n(3),c=n(33),l=n(53),h=n(48),p=n(58),f=n(37),d=n(32),m=n(19),y=n(67),v=n(12),g=n(60),b=n(66),E=n(11),T=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return r.c(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,c,h,m,y,v,g,b;return r.d(this,(function(E){switch(E.label){case 0:e=this.obtainQueryRunner(),t=!1,E.label=1;case 1:return E.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:E.sent(),t=!0,E.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(g=new d.a,e.broadcaster.broadcastBeforeUpdateEvent(g,this.expressionMap.mainAlias.metadata,this.expressionMap.valuesSet),g.promises.length>0?[4,Promise.all(g.promises)]:[3,5]):[3,5];case 4:E.sent(),E.label=5;case 5:return n=null,i=null,a=new p.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=a.getUpdationReturningColumns(),this.expressionMap.extraReturningColumns.length>0&&this.connection.driver instanceof s.a&&(n=this.connection.driver.buildTableVariableDeclaration("@OutputTable",this.expressionMap.extraReturningColumns),i="SELECT * FROM @OutputTable")),o=r.e(this.getQueryAndParameters(),2),c=o[0],h=o[1],m=new l.a,y=[n,c,i],[4,e.query(y.filter((function(e){return null!=e})).join(";\n\n"),h)];case 6:return v=E.sent(),this.connection.driver instanceof u.f?(m.raw=v[0],m.affected=v[1]):this.connection.driver instanceof u.e?(m.raw=v,m.affected=v.affectedRows):m.raw=v,!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,a.update(m,this.expressionMap.whereEntities)]:[3,8];case 7:E.sent(),E.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(g=new d.a,e.broadcaster.broadcastAfterUpdateEvent(g,this.expressionMap.mainAlias.metadata),g.promises.length>0?[4,Promise.all(g.promises)]:[3,10]):[3,10];case 9:E.sent(),E.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:E.sent(),E.label=12;case 12:return[2,m];case 13:if(b=E.sent(),!t)return[3,17];E.label=14;case 14:return E.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return E.sent(),[3,17];case 16:return E.sent(),[3,17];case 17:throw b;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:E.sent(),E.label=20;case 20:return this.connection.driver instanceof f.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:E.sent(),E.label=22;case 22:return[7];case 23:return[2]}}))}))},t.prototype.set=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new h.a;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach((function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)})),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this,t=this.getValueSet(),n=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0,r=[],o=[],l={},h=this.connection.driver instanceof u.e||this.connection.driver instanceof E.a||this.connection.driver instanceof v.a||this.connection.driver instanceof m.a||this.connection.driver instanceof a.a?0:Object.keys(this.expressionMap.nativeParameters).length;if(n?(c.a.createPropertyPath(n,t).forEach((function(i){var c=n.findColumnsWithPropertyPath(i);if(c.length<=0)throw new b.a(i);c.forEach((function(n){if(n.isUpdate){o.push(n);var i="upd_"+n.databaseName,c=n.getEntityValue(t);if(n.referencedColumn&&c instanceof Object?c=n.referencedColumn.getEntityValue(c):c instanceof Function||(c=e.connection.driver.preparePersistentValue(c,n)),c instanceof Function)r.push(e.escape(n.databaseName)+" = "+c());else if(e.connection.driver instanceof a.a&&null===c)r.push(e.escape(n.databaseName)+" = NULL");else{e.connection.driver instanceof s.a&&(c=e.connection.driver.parametrizeValue(n,c)),e.connection.driver instanceof u.e||e.connection.driver instanceof E.a||e.connection.driver instanceof v.a||e.connection.driver instanceof m.a||e.connection.driver instanceof a.a?l[i]=c:e.expressionMap.nativeParameters[i]=c;var p=null;if((e.connection.driver instanceof u.e||e.connection.driver instanceof E.a)&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)){var f=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";p=null!=n.srid?f+"("+e.connection.driver.createParameter(i,h)+", "+n.srid+")":f+"("+e.connection.driver.createParameter(i,h)+")"}else p=e.connection.driver instanceof u.f&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?null!=n.srid?"ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(i,h)+"), "+n.srid+")::"+n.type:"ST_GeomFromGeoJSON("+e.connection.driver.createParameter(i,h)+")::"+n.type:e.connection.driver instanceof s.a&&-1!==e.connection.driver.spatialTypes.indexOf(n.type)?n.type+"::STGeomFromText("+e.connection.driver.createParameter(i,h)+", "+(n.srid||"0")+")":e.connection.driver.createParameter(i,h);r.push(e.escape(n.databaseName)+" = "+p),h++}}}))})),n.versionColumn&&-1===o.indexOf(n.versionColumn)&&r.push(this.escape(n.versionColumn.databaseName)+" = "+this.escape(n.versionColumn.databaseName)+" + 1"),n.updateDateColumn&&-1===o.indexOf(n.updateDateColumn)&&r.push(this.escape(n.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP")):Object.keys(t).map((function(n){var i=t[n];i instanceof Function?r.push(e.escape(n)+" = "+i()):e.connection.driver instanceof a.a&&null===i?r.push(e.escape(n)+" = NULL"):(e.connection.driver instanceof u.e||e.connection.driver instanceof E.a||e.connection.driver instanceof v.a||e.connection.driver instanceof m.a||e.connection.driver instanceof a.a?l[n]=i:e.expressionMap.nativeParameters[n]=i,r.push(e.escape(n)+" = "+e.connection.driver.createParameter(n,h)),h++)})),r.length<=0)throw new g.a;(this.connection.driver instanceof u.e||this.connection.driver instanceof E.a||this.connection.driver instanceof v.a||this.connection.driver instanceof m.a||this.connection.driver instanceof a.a)&&(this.expressionMap.nativeParameters=Object.assign(l,this.expressionMap.nativeParameters));var p=this.createWhereExpression(),f=this.createReturningExpression();return f&&(this.connection.driver instanceof u.f||this.connection.driver instanceof v.a||this.connection.driver instanceof i.a)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+p+" RETURNING "+f:f&&this.connection.driver instanceof s.a?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+" OUTPUT "+f+p:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+r.join(", ")+p},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"===typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof u.e||this.connection.driver instanceof E.a)return" LIMIT "+e;throw new y.a}return""},t.prototype.getValueSet=function(){if(this.expressionMap.valuesSet instanceof Object)return this.expressionMap.valuesSet;throw new g.a},t}(o.a)},function(e,t,n){"use strict";n.r(t),n.d(t,"DeleteQueryBuilder",(function(){return m}));var r=n(0),i=n(29),a=n(12),o=n(35),s=n(9),u=n(3),c=n(64),l=n(48),h=n(37),p=n(32),f=n(14),d=n(11),m=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return r.c(t,e),t.prototype.getQuery=function(){return this.createDeleteExpression().trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,o,l,f,m,y,v,g;return r.d(this,(function(b){switch(b.label){case 0:e=r.e(this.getQueryAndParameters(),2),t=e[0],n=e[1],o=this.obtainQueryRunner(),l=!1,b.label=1;case 1:return b.trys.push([1,11,16,21]),!0!==this.expressionMap.useTransaction||!1!==o.isTransactionActive?[3,3]:[4,o.startTransaction()];case 2:b.sent(),l=!0,b.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(v=new p.a,o.broadcaster.broadcastBeforeRemoveEvent(v,this.expressionMap.mainAlias.metadata),v.promises.length>0?[4,Promise.all(v.promises)]:[3,5]):[3,5];case 4:b.sent(),b.label=5;case 5:return f=new c.a,[4,o.query(t,n)];case 6:return m=b.sent(),(y=o.connection.driver)instanceof u.e||y instanceof d.a?(f.raw=m,f.affected=m.affectedRows):y instanceof s.a||y instanceof u.f||y instanceof i.a?(f.raw=m[0]?m[0]:null,f.affected="number"===typeof m[1]?m[1]:null):y instanceof a.a?f.affected=m:f.raw=m,!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(v=new p.a,o.broadcaster.broadcastAfterRemoveEvent(v,this.expressionMap.mainAlias.metadata),v.promises.length>0?[4,Promise.all(v.promises)]:[3,8]):[3,8];case 7:b.sent(),b.label=8;case 8:return l?[4,o.commitTransaction()]:[3,10];case 9:b.sent(),b.label=10;case 10:return[2,f];case 11:if(g=b.sent(),!l)return[3,15];b.label=12;case 12:return b.trys.push([12,14,,15]),[4,o.rollbackTransaction()];case 13:return b.sent(),[3,15];case 14:return b.sent(),[3,15];case 15:throw g;case 16:return o===this.queryRunner?[3,18]:[4,o.release()];case 17:b.sent(),b.label=18;case 18:return this.connection.driver instanceof h.a&&!o.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,20];case 19:b.sent(),b.label=20;case 20:return[7];case 21:return[2]}}))}))},t.prototype.from=function(e,t){e=e instanceof f.a?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new l.a;return this.expressionMap.returning=e,this},t.prototype.createDeleteExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createWhereExpression(),n=this.createReturningExpression();return n&&(this.connection.driver instanceof u.f||this.connection.driver instanceof i.a)?"DELETE FROM "+e+t+" RETURNING "+n:""!==n&&this.connection.driver instanceof s.a?"DELETE FROM "+e+" OUTPUT "+n+t:"DELETE FROM "+e+t},t}(o.a)},function(e,t,n){"use strict";n.r(t),n.d(t,"RelationQueryBuilder",(function(){return c}));var r=n(0),i=n(35),a=n(24),o=n(12),s=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.update=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,s,u,c,l,h,p,f,d,m,y,v=this;return r.d(this,(function(r){switch(r.label){case 0:return(t=this.expressionMap.relationMetadata).isManyToOne||t.isOneToOneOwner?(l=t.joinColumns.reduce((function(t,n){var r=e instanceof Object?n.referencedColumn.getEntityValue(e):e;return n.setEntityValue(t,r),t}),{}),!this.expressionMap.of||Array.isArray(this.expressionMap.of)&&!this.expressionMap.of.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.entityMetadata.target).set(l).whereInIds(this.expressionMap.of).execute()]):[3,2];case 1:return r.sent(),[3,10];case 2:return!t.isOneToOneNotOwner&&!t.isOneToMany||null!==e?[3,4]:(n={},t.inverseRelation.joinColumns.forEach((function(e){n[e.propertyName]=null})),p=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],i={},s=[],p.forEach((function(e,n){t.inverseRelation.joinColumns.map((function(t,r){var a="joinColumn_"+n+"_"+r;i[a]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,s.push(t.propertyPath+" = :"+a)}))})),(u=s.map((function(e){return"("+e+")"})).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(n).where(u).setParameters(i).execute()]:[2]);case 3:return r.sent(),[3,10];case 4:if(!t.isOneToOneNotOwner&&!t.isOneToMany)return[3,6];if(Array.isArray(this.expressionMap.of))throw new Error("You cannot update relations of multiple entities with the same related object. Provide a single entity into .of method.");return c=this.expressionMap.of,l=t.inverseRelation.joinColumns.reduce((function(e,t){var n=c instanceof Object?t.referencedColumn.getEntityValue(c):c;return t.setEntityValue(e,n),e}),{}),!e||Array.isArray(e)&&!e.length?[2]:[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(l).whereInIds(e).execute()];case 5:return r.sent(),[3,10];case 6:return h=t.junctionEntityMetadata,p=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],f=Array.isArray(e)?e:[e],d=t.isManyToManyOwner?p:f,m=t.isManyToManyOwner?f:p,y=[],d.forEach((function(e){m.forEach((function(t){var n={};h.ownerColumns.forEach((function(t){n[t.databaseName]=e instanceof Object?t.referencedColumn.getEntityValue(e):e})),h.inverseColumns.forEach((function(e){n[e.databaseName]=t instanceof Object?e.referencedColumn.getEntityValue(t):t})),y.push(n)}))})),y.length?this.queryBuilder.connection.driver instanceof o.a||this.queryBuilder.connection.driver instanceof a.a?[4,Promise.all(y.map((function(e){return v.queryBuilder.createQueryBuilder().insert().into(h.tableName).values(e).execute()})))]:[3,8]:[2];case 7:return r.sent(),[3,10];case 8:return[4,this.queryBuilder.createQueryBuilder().insert().into(h.tableName).values(y).execute()];case 9:r.sent(),r.label=10;case 10:return[2]}}))}))},e}(),u=function(){function e(e,t){this.queryBuilder=e,this.expressionMap=t}return e.prototype.remove=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l,h,p,f,d;return r.d(this,(function(m){switch(m.label){case 0:return(t=this.expressionMap.relationMetadata).isOneToMany?(u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],n=Array.isArray(e)?e:[e],i={},t.inverseRelation.joinColumns.forEach((function(e){i[e.propertyName]=null})),a={},o=[],u.forEach((function(e,i){o.push.apply(o,r.f(n.map((function(n,o){return r.f(t.inverseRelation.joinColumns.map((function(t,n){var r="joinColumn_"+i+"_"+o+"_"+n;return a[r]=e instanceof Object?t.referencedColumn.getEntityValue(e):e,t.propertyPath+" = :"+r})),t.inverseRelation.entityMetadata.primaryColumns.map((function(e,t){var r="primaryColumn_"+o+"_"+o+"_"+t;return a[r]=n instanceof Object?e.getEntityValue(n):n,e.propertyPath+" = :"+r}))).join(" AND ")}))))})),(d=o.map((function(e){return"("+e+")"})).join(" OR "))?[4,this.queryBuilder.createQueryBuilder().update(t.inverseEntityMetadata.target).set(i).where(d).setParameters(a).execute()]:[2]):[3,2];case 1:return m.sent(),[3,4];case 2:return s=t.junctionEntityMetadata,u=Array.isArray(this.expressionMap.of)?this.expressionMap.of:[this.expressionMap.of],c=Array.isArray(e)?e:[e],l=t.isManyToManyOwner?u:c,h=t.isManyToManyOwner?c:u,p={},f=[],l.forEach((function(e,t){f.push.apply(f,r.f(h.map((function(n,i){return r.f(s.ownerColumns.map((function(n,r){var a="firstValue_"+t+"_"+i+"_"+r;return p[a]=e instanceof Object?n.referencedColumn.getEntityValue(e):e,n.databaseName+" = :"+a})),s.inverseColumns.map((function(e,r){var a="secondValue_"+t+"_"+i+"_"+r;return p[a]=n instanceof Object?e.referencedColumn.getEntityValue(n):n,e.databaseName+" = :"+a}))).join(" AND ")}))))})),d=f.map((function(e){return"("+e+")"})).join(" OR "),[4,this.queryBuilder.createQueryBuilder().delete().from(s.tableName).where(d).setParameters(p).execute()];case 3:m.sent(),m.label=4;case 4:return[2]}}))}))},e}(),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.getQuery=function(){return""},t.prototype.of=function(e){return this.expressionMap.of=e,this},t.prototype.set=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToMany||t.isOneToMany)throw new Error('Set operation is only supported for many-to-one and one-to-one relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .add() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new s(this,this.expressionMap).update(e)]}))}))},t.prototype.add=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set() method instead.");if(t.joinColumns&&t.joinColumns.length>1&&(!(e instanceof Object)||Object.keys(e).length<t.joinColumns.length))throw new Error('Value to be set into the relation must be a map of relation ids, for example: .set({ firstName: "...", lastName: "..." })');return[2,new s(this,this.expressionMap).update(e)]}))}))},t.prototype.remove=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){if(Array.isArray(e)&&0===e.length)return[2];if(t=this.expressionMap.relationMetadata,!this.expressionMap.of)throw new Error("Entity whose relation needs to be set is not set. Use .of method to define whose relation you want to set.");if(t.isManyToOne||t.isOneToOne)throw new Error('Add operation is only supported for many-to-many and one-to-many relations. However given "'+t.propertyPath+'" has '+t.relationType+" relation. Use .set(null) method instead.");return[2,new u(this,this.expressionMap).remove(e)]}))}))},t.prototype.addAndRemove=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(n){switch(n.label){case 0:return[4,this.remove(t)];case 1:return n.sent(),[4,this.add(e)];case 2:return n.sent(),[2]}}))}))},t.prototype.loadOne=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,this.loadMany().then((function(e){return e[0]}))]}))}))},t.prototype.loadMany=function(){return r.b(this,void 0,void 0,(function(){var e,t;return r.d(this,(function(n){if(!((e=this.expressionMap.of)instanceof Object)){if((t=this.expressionMap.mainAlias.metadata).hasMultiplePrimaryKeys)throw new Error("Cannot load entity because only one primary key was specified, however entity contains multiple primary keys");e=t.primaryColumns[0].createValueMap(e)}return[2,this.connection.relationLoader.load(this.expressionMap.relationMetadata,e)]}))}))},t}(i.a)},function(e,t,n){"use strict";n.r(t),n.d(t,"InsertQueryBuilder",(function(){return E}));var r=n(0),i=n(29),a=n(24),o=n(35),s=n(9),u=n(3),c=n(45),l=n(52),h=n(48),p=function(e){function t(){var n=e.call(this)||this;return n.name="InsertValuesMissingError",Object.setPrototypeOf(n,t.prototype),n.message='Cannot perform insert query because values are not defined. Call "qb.values(...)" method to specify inserted values.',n}return r.c(t,e),t}(Error),f=n(58),d=n(19),m=n(37),y=n(32),v=n(46),g=n(12),b=n(11),E=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return r.c(t,e),t.prototype.getQuery=function(){return this.createInsertExpression().trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,u,c,h,p,d,v,g,b,E,T=this;return r.d(this,(function(N){switch(N.label){case 0:e=this.obtainQueryRunner(),t=!1,N.label=1;case 1:return N.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:N.sent(),t=!0,N.label=3;case 3:return n=this.getValueSets(),!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(i=new y.a,n.forEach((function(t){e.broadcaster.broadcastBeforeInsertEvent(i,T.expressionMap.mainAlias.metadata,t)})),i.promises.length>0?[4,Promise.all(i.promises)]:[3,5]):[3,5];case 4:N.sent(),N.label=5;case 5:return a=null,o=null,u=new f.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&(this.expressionMap.extraReturningColumns=u.getInsertionReturningColumns(),this.expressionMap.extraReturningColumns.length>0&&this.connection.driver instanceof s.a&&(a=this.connection.driver.buildTableVariableDeclaration("@OutputTable",this.expressionMap.extraReturningColumns),o="SELECT * FROM @OutputTable")),c=r.e(this.getQueryAndParameters(),2),h=c[0],p=c[1],d=new l.a,v=[a,h,o],g=d,[4,e.query(v.filter((function(e){return null!=e})).join(";\n\n"),p)];case 6:return g.raw=N.sent(),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata?[4,u.insert(d,n)]:[3,8];case 7:N.sent(),N.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(b=new y.a,n.forEach((function(t){e.broadcaster.broadcastAfterInsertEvent(b,T.expressionMap.mainAlias.metadata,t)})),b.promises.length>0?[4,Promise.all(b.promises)]:[3,10]):[3,10];case 9:N.sent(),N.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:N.sent(),N.label=12;case 12:return[2,d];case 13:if(E=N.sent(),!t)return[3,17];N.label=14;case 14:return N.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return N.sent(),[3,17];case 16:return N.sent(),[3,17];case 17:throw E;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:N.sent(),N.label=20;case 20:return this.connection.driver instanceof m.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:N.sent(),N.label=22;case 22:return[7];case 23:return[2]}}))}))},t.prototype.into=function(e,t){e=e instanceof v.a?e.options.name:e;var n=this.createFromAlias(e);return this.expressionMap.setMainAlias(n),this.expressionMap.insertColumns=t||[],this},t.prototype.values=function(e){return this.expressionMap.valuesSet=e,this},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new h.a;return this.expressionMap.returning=e,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.onConflict=function(e){return this.expressionMap.onConflict=e,this},t.prototype.orIgnore=function(e){return void 0===e&&(e=!0),this.expressionMap.onIgnore=e,this},t.prototype.orUpdate=function(e){return this.expressionMap.onUpdate={},e&&Array.isArray(e.conflict_target)&&(this.expressionMap.onUpdate.conflict=" ( "+e.conflict_target.join(", ")+" ) "),e&&"string"===typeof e.conflict_target&&(this.expressionMap.onUpdate.conflict=" ON CONSTRAINT "+e.conflict_target+" "),e&&Array.isArray(e.columns)&&(this.expressionMap.onUpdate.columns=e.columns.map((function(e){return e+" = :"+e})).join(", ")),e&&Array.isArray(e.overwrite)&&(this.connection.driver instanceof u.e||this.connection.driver instanceof b.a?this.expressionMap.onUpdate.overwrite=e.overwrite.map((function(e){return e+" = VALUES("+e+")"})).join(", "):(this.connection.driver instanceof u.f||this.connection.driver instanceof d.a||this.connection.driver instanceof i.a)&&(this.expressionMap.onUpdate.overwrite=e.overwrite.map((function(e){return e+" = EXCLUDED."+e})).join(", "))),this},t.prototype.createInsertExpression=function(){var e=this.getTableName(this.getMainTableName()),t=this.createValuesExpression(),n=this.createReturningExpression(),r=this.createColumnNamesExpression(),a="INSERT ";if((this.connection.driver instanceof u.e||this.connection.driver instanceof b.a)&&(a+=this.expressionMap.onIgnore?" IGNORE ":""),a+="INTO "+e,r?a+="("+r+")":!t&&(this.connection.driver instanceof u.e||this.connection.driver instanceof b.a)&&(a+="()"),n&&this.connection.driver instanceof s.a&&(a+=" OUTPUT "+n),t?a+=" VALUES "+t:this.connection.driver instanceof u.e||this.connection.driver instanceof b.a?a+=" VALUES ()":a+=" DEFAULT VALUES",this.connection.driver instanceof u.f||this.connection.driver instanceof d.a||this.connection.driver instanceof i.a){if(a+=this.expressionMap.onIgnore?" ON CONFLICT DO NOTHING ":"",a+=this.expressionMap.onConflict?" ON CONFLICT "+this.expressionMap.onConflict:"",this.expressionMap.onUpdate){var o=this.expressionMap.onUpdate,c=o.overwrite,l=o.columns,h=o.conflict;a+=l?" ON CONFLICT "+h+" DO UPDATE SET "+l:"",a+=c?" ON CONFLICT "+h+" DO UPDATE SET "+c:""}}else if((this.connection.driver instanceof u.e||this.connection.driver instanceof b.a)&&this.expressionMap.onUpdate){var p=this.expressionMap.onUpdate;c=p.overwrite;a+=(l=p.columns)?" ON DUPLICATE KEY UPDATE "+l:"",a+=c?" ON DUPLICATE KEY UPDATE "+c:""}return n&&(this.connection.driver instanceof u.f||this.connection.driver instanceof g.a||this.connection.driver instanceof i.a)&&(a+=" RETURNING "+n),a},t.prototype.getInsertedColumns=function(){var e=this;return this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata.columns.filter((function(t){return e.expressionMap.insertColumns.length?-1!==e.expressionMap.insertColumns.indexOf(t.propertyPath):!!t.isInsert&&(!t.isGenerated||"increment"!==t.generationStrategy||e.connection.driver instanceof g.a||e.connection.driver instanceof d.a||e.connection.driver instanceof u.e||e.connection.driver instanceof b.a)})):[]},t.prototype.createColumnNamesExpression=function(){var e=this,t=this.getInsertedColumns();if(t.length>0)return t.map((function(t){return e.escape(t.databaseName)})).join(", ");if(!this.expressionMap.mainAlias.hasMetadata&&!this.expressionMap.insertColumns.length){var n=this.getValueSets();if(1===n.length)return Object.keys(n[0]).map((function(t){return e.escape(t)})).join(", ")}return this.expressionMap.insertColumns.map((function(t){return e.escape(t)})).join(", ")},t.prototype.createValuesExpression=function(){var e=this,t=this.getValueSets(),n=this.getInsertedColumns();if(n.length>0){var r="",i=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach((function(o,l){n.forEach((function(h,p){0===p&&(r+="(");var f="i"+l+"_"+h.databaseName,m=h.getEntityValue(o);if(m instanceof Function||(m=e.connection.driver.preparePersistentValue(m,h)),h.isVersion&&void 0===m)r+="1";else if(h.isDiscriminator)e.expressionMap.nativeParameters["discriminator_value_"+i]=e.expressionMap.mainAlias.metadata.discriminatorValue,r+=e.connection.driver.createParameter("discriminator_value_"+i,i),i++;else if(h.isGenerated&&"uuid"===h.generationStrategy&&!e.connection.driver.isUUIDGenerationSupported()&&void 0===m){var y="uuid_"+h.databaseName+l;m=c.a.uuid4(),e.expressionMap.nativeParameters[y]=m,r+=e.connection.driver.createParameter(y,i),i++}else if(void 0===m)e.connection.driver instanceof d.a||e.connection.driver instanceof a.a?void 0!==h.default?r+=e.connection.driver.normalizeDefault(h):r+="NULL":r+="DEFAULT";else if(m instanceof Function)r+=m();else{if(e.connection.driver instanceof s.a&&(m=e.connection.driver.parametrizeValue(h,m)),e.expressionMap.nativeParameters[f]=m,(e.connection.driver instanceof u.e||e.connection.driver instanceof b.a)&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)){var v=e.connection.driver.options.legacySpatialSupport?"GeomFromText":"ST_GeomFromText";null!=h.srid?r+=v+"("+e.connection.driver.createParameter(f,i)+", "+h.srid+")":r+=v+"("+e.connection.driver.createParameter(f,i)+")"}else e.connection.driver instanceof u.f&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)?null!=h.srid?r+="ST_SetSRID(ST_GeomFromGeoJSON("+e.connection.driver.createParameter(f,i)+"), "+h.srid+")::"+h.type:r+="ST_GeomFromGeoJSON("+e.connection.driver.createParameter(f,i)+")::"+h.type:e.connection.driver instanceof s.a&&-1!==e.connection.driver.spatialTypes.indexOf(h.type)?r+=h.type+"::STGeomFromText("+e.connection.driver.createParameter(f,i)+", "+(h.srid||"0")+")":r+=e.connection.driver.createParameter(f,i);i++}p===n.length-1?l===t.length-1?r+=")":r+="), ":r+=", "}))})),"()"===r?"":r}var o="",l=Object.keys(this.expressionMap.nativeParameters).length;return t.forEach((function(n,r){Object.keys(n).forEach((function(i,s){0===s&&(o+="(");var u="i"+r+"_"+i,c=n[i];c instanceof Function?o+=c():void 0===c?e.connection.driver instanceof d.a||e.connection.driver instanceof a.a?o+="NULL":o+="DEFAULT":(e.expressionMap.nativeParameters[u]=c,o+=e.connection.driver.createParameter(u,l),l++),s===Object.keys(n).length-1?r===t.length-1?o+=")":o+="), ":o+=", "}))})),"()"===o?"":o},t.prototype.getValueSets=function(){if(Array.isArray(this.expressionMap.valuesSet)&&this.expressionMap.valuesSet.length>0)return this.expressionMap.valuesSet;if(this.expressionMap.valuesSet instanceof Object)return[this.expressionMap.valuesSet];throw new p},t}(o.a)},function(e,t,n){e.exports=n(94)},function(e,t,n){(function(e,t){var n;!function(n){!function(r){var i="object"===typeof t?t:"object"===typeof self?self:"object"===typeof this?this:Function("return this;")(),a=o(n);function o(e,t){return function(n,r){"function"!==typeof e[n]&&Object.defineProperty(e,n,{configurable:!0,writable:!0,value:r}),t&&t(n,r)}}"undefined"===typeof i.Reflect?i.Reflect=n:a=o(i.Reflect,a),function(t){var n=Object.prototype.hasOwnProperty,r="function"===typeof Symbol,i=r&&"undefined"!==typeof Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",a=r&&"undefined"!==typeof Symbol.iterator?Symbol.iterator:"@@iterator",o="function"===typeof Object.create,s={__proto__:[]}instanceof Array,u=!o&&!s,c={create:o?function(){return _(Object.create(null))}:s?function(){return _({__proto__:null})}:function(){return _({})},has:u?function(e,t){return n.call(e,t)}:function(e,t){return t in e},get:u?function(e,t){return n.call(e,t)?e[t]:void 0}:function(e,t){return e[t]}},l=Object.getPrototypeOf(Function),h="object"===typeof e&&Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})&&"true"===Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0}).REFLECT_METADATA_USE_MAP_POLYFILL,p=h||"function"!==typeof Map||"function"!==typeof Map.prototype.entries?function(){var e={},t=[],n=function(){function e(e,t,n){this._index=0,this._keys=e,this._values=t,this._selector=n}return e.prototype["@@iterator"]=function(){return this},e.prototype[a]=function(){return this},e.prototype.next=function(){var e=this._index;if(e>=0&&e<this._keys.length){var n=this._selector(this._keys[e],this._values[e]);return e+1>=this._keys.length?(this._index=-1,this._keys=t,this._values=t):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},e.prototype.throw=function(e){throw this._index>=0&&(this._index=-1,this._keys=t,this._values=t),e},e.prototype.return=function(e){return this._index>=0&&(this._index=-1,this._keys=t,this._values=t),{value:e,done:!0}},e}();return function(){function t(){this._keys=[],this._values=[],this._cacheKey=e,this._cacheIndex=-2}return Object.defineProperty(t.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),t.prototype.has=function(e){return this._find(e,!1)>=0},t.prototype.get=function(e){var t=this._find(e,!1);return t>=0?this._values[t]:void 0},t.prototype.set=function(e,t){var n=this._find(e,!0);return this._values[n]=t,this},t.prototype.delete=function(t){var n=this._find(t,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,t===this._cacheKey&&(this._cacheKey=e,this._cacheIndex=-2),!0}return!1},t.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=e,this._cacheIndex=-2},t.prototype.keys=function(){return new n(this._keys,this._values,r)},t.prototype.values=function(){return new n(this._keys,this._values,i)},t.prototype.entries=function(){return new n(this._keys,this._values,o)},t.prototype["@@iterator"]=function(){return this.entries()},t.prototype[a]=function(){return this.entries()},t.prototype._find=function(e,t){return this._cacheKey!==e&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=e)),this._cacheIndex<0&&t&&(this._cacheIndex=this._keys.length,this._keys.push(e),this._values.push(void 0)),this._cacheIndex},t}();function r(e,t){return e}function i(e,t){return t}function o(e,t){return[e,t]}}():Map,f=h||"function"!==typeof Set||"function"!==typeof Set.prototype.entries?function(){function e(){this._map=new p}return Object.defineProperty(e.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),e.prototype.has=function(e){return this._map.has(e)},e.prototype.add=function(e){return this._map.set(e,e),this},e.prototype.delete=function(e){return this._map.delete(e)},e.prototype.clear=function(){this._map.clear()},e.prototype.keys=function(){return this._map.keys()},e.prototype.values=function(){return this._map.values()},e.prototype.entries=function(){return this._map.entries()},e.prototype["@@iterator"]=function(){return this.keys()},e.prototype[a]=function(){return this.keys()},e}():Set,d=new(h||"function"!==typeof WeakMap?function(){var e=c.create(),t=r();return function(){function e(){this._key=r()}return e.prototype.has=function(e){var t=i(e,!1);return void 0!==t&&c.has(t,this._key)},e.prototype.get=function(e){var t=i(e,!1);return void 0!==t?c.get(t,this._key):void 0},e.prototype.set=function(e,t){return i(e,!0)[this._key]=t,this},e.prototype.delete=function(e){var t=i(e,!1);return void 0!==t&&delete t[this._key]},e.prototype.clear=function(){this._key=r()},e}();function r(){var t;do{t="@@WeakMap@@"+o()}while(c.has(e,t));return e[t]=!0,t}function i(e,r){if(!n.call(e,t)){if(!r)return;Object.defineProperty(e,t,{value:c.create()})}return e[t]}function a(e,t){for(var n=0;n<t;++n)e[n]=255*Math.random()|0;return e}function o(){var e,t=(e=16,"function"===typeof Uint8Array?"undefined"!==typeof crypto?crypto.getRandomValues(new Uint8Array(e)):"undefined"!==typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(e)):a(new Uint8Array(e),e):a(new Array(e),e));t[6]=79&t[6]|64,t[8]=191&t[8]|128;for(var n="",r=0;r<16;++r){var i=t[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}():WeakMap);function m(e,t,n){var r=d.get(e);if(T(r)){if(!n)return;r=new p,d.set(e,r)}var i=r.get(t);if(T(i)){if(!n)return;i=new p,r.set(t,i)}return i}function y(e,t,n){var r=m(t,n,!1);return!T(r)&&!!r.has(e)}function v(e,t,n){var r=m(t,n,!1);if(!T(r))return r.get(e)}function g(e,t,n,r){m(n,r,!0).set(e,t)}function b(e,t){var n=[],r=m(e,t,!1);if(T(r))return n;for(var i=function(e){var t=O(e,a);if(!R(t))throw new TypeError;var n=t.call(e);if(!w(n))throw new TypeError;return n}(r.keys()),o=0;;){var s=P(i);if(!s)return n.length=o,n;var u=s.value;try{n[o]=u}catch(c){try{x(i)}finally{throw c}}o++}}function E(e){if(null===e)return 1;switch(typeof e){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===e?1:6;default:return 6}}function T(e){return void 0===e}function N(e){return null===e}function w(e){return"object"===typeof e?null!==e:"function"===typeof e}function A(e,t){switch(E(e)){case 0:case 1:case 2:case 3:case 4:case 5:return e}var n=3===t?"string":5===t?"number":"default",r=O(e,i);if(void 0!==r){var a=r.call(e,n);if(w(a))throw new TypeError;return a}return function(e,t){if("string"===t){var n=e.toString;if(R(n))if(!w(i=n.call(e)))return i;if(R(r=e.valueOf))if(!w(i=r.call(e)))return i}else{var r;if(R(r=e.valueOf))if(!w(i=r.call(e)))return i;var i,a=e.toString;if(R(a))if(!w(i=a.call(e)))return i}throw new TypeError}(e,"default"===n?"number":n)}function C(e){var t=A(e,3);return"symbol"===typeof t?t:function(e){return""+e}(t)}function S(e){return Array.isArray?Array.isArray(e):e instanceof Object?e instanceof Array:"[object Array]"===Object.prototype.toString.call(e)}function R(e){return"function"===typeof e}function M(e){return"function"===typeof e}function O(e,t){var n=e[t];if(void 0!==n&&null!==n){if(!R(n))throw new TypeError;return n}}function P(e){var t=e.next();return!t.done&&t}function x(e){var t=e.return;t&&t.call(e)}function I(e){var t=Object.getPrototypeOf(e);if("function"!==typeof e||e===l)return t;if(t!==l)return t;var n=e.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return t;var i=r.constructor;return"function"!==typeof i||i===e?t:i}function _(e){return e.__=void 0,delete e.__,e}t("decorate",(function(e,t,n,r){if(T(n)){if(!S(e))throw new TypeError;if(!M(t))throw new TypeError;return function(e,t){for(var n=e.length-1;n>=0;--n){var r=(0,e[n])(t);if(!T(r)&&!N(r)){if(!M(r))throw new TypeError;t=r}}return t}(e,t)}if(!S(e))throw new TypeError;if(!w(t))throw new TypeError;if(!w(r)&&!T(r)&&!N(r))throw new TypeError;return N(r)&&(r=void 0),function(e,t,n,r){for(var i=e.length-1;i>=0;--i){var a=(0,e[i])(t,n,r);if(!T(a)&&!N(a)){if(!w(a))throw new TypeError;r=a}}return r}(e,t,n=C(n),r)})),t("metadata",(function(e,t){return function(n,r){if(!w(n))throw new TypeError;if(!T(r)&&!function(e){switch(E(e)){case 3:case 4:return!0;default:return!1}}(r))throw new TypeError;g(e,t,n,r)}})),t("defineMetadata",(function(e,t,n,r){if(!w(n))throw new TypeError;return T(r)||(r=C(r)),g(e,t,n,r)})),t("hasMetadata",(function(e,t,n){if(!w(t))throw new TypeError;return T(n)||(n=C(n)),function e(t,n,r){if(y(t,n,r))return!0;var i=I(n);return!N(i)&&e(t,i,r)}(e,t,n)})),t("hasOwnMetadata",(function(e,t,n){if(!w(t))throw new TypeError;return T(n)||(n=C(n)),y(e,t,n)})),t("getMetadata",(function(e,t,n){if(!w(t))throw new TypeError;return T(n)||(n=C(n)),function e(t,n,r){if(y(t,n,r))return v(t,n,r);var i=I(n);return N(i)?void 0:e(t,i,r)}(e,t,n)})),t("getOwnMetadata",(function(e,t,n){if(!w(t))throw new TypeError;return T(n)||(n=C(n)),v(e,t,n)})),t("getMetadataKeys",(function(e,t){if(!w(e))throw new TypeError;return T(t)||(t=C(t)),function e(t,n){var r=b(t,n),i=I(t);if(null===i)return r;var a=e(i,n);if(a.length<=0)return r;if(r.length<=0)return a;for(var o=new f,s=[],u=0,c=r;u<c.length;u++){var l=c[u];o.has(l)||(o.add(l),s.push(l))}for(var h=0,p=a;h<p.length;h++){l=p[h];o.has(l)||(o.add(l),s.push(l))}return s}(e,t)})),t("getOwnMetadataKeys",(function(e,t){if(!w(e))throw new TypeError;return T(t)||(t=C(t)),b(e,t)})),t("deleteMetadata",(function(e,t,n){if(!w(t))throw new TypeError;T(n)||(n=C(n));var r=m(t,n,!1);if(T(r))return!1;if(!r.delete(e))return!1;if(r.size>0)return!0;var i=d.get(t);return i.delete(n),i.size>0||d.delete(t),!0}))}(a)}()}(n||(n={}))}).call(this,n(95),n(61))},function(e,t,n){var r=n(50),i=n(51),a=n(49).Buffer,o=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],s=new Array(64);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function h(e){return(e>>>2|e<<30)^(e>>>13|e<<19)^(e>>>22|e<<10)}function p(e){return(e>>>6|e<<26)^(e>>>11|e<<21)^(e>>>25|e<<7)}function f(e){return(e>>>7|e<<25)^(e>>>18|e<<14)^e>>>3}r(u,i),u.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,d=0|this._f,m=0|this._g,y=0|this._h,v=0;v<16;++v)n[v]=e.readInt32BE(4*v);for(;v<64;++v)n[v]=0|(((t=n[v-2])>>>17|t<<15)^(t>>>19|t<<13)^t>>>10)+n[v-7]+f(n[v-15])+n[v-16];for(var g=0;g<64;++g){var b=y+p(u)+c(u,d,m)+o[g]+n[g]|0,E=h(r)+l(r,i,a)|0;y=m,m=d,d=u,u=s+b|0,s=a,a=i,i=r,r=b+E|0}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0,this._f=d+this._f|0,this._g=m+this._g|0,this._h=y+this._h|0},u.prototype._hash=function(){var e=a.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=u},function(e,t,n){var r=n(50),i=n(51),a=n(49).Buffer,o=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],s=new Array(160);function u(){this.init(),this._w=s,i.call(this,128,112)}function c(e,t,n){return n^e&(t^n)}function l(e,t,n){return e&t|n&(e|t)}function h(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function p(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function f(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^e>>>7}function d(e,t){return(e>>>1|t<<31)^(e>>>8|t<<24)^(e>>>7|t<<25)}function m(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^e>>>6}function y(e,t){return(e>>>19|t<<13)^(t>>>29|e<<3)^(e>>>6|t<<26)}function v(e,t){return e>>>0<t>>>0?1:0}r(u,i),u.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},u.prototype._update=function(e){for(var t=this._w,n=0|this._ah,r=0|this._bh,i=0|this._ch,a=0|this._dh,s=0|this._eh,u=0|this._fh,g=0|this._gh,b=0|this._hh,E=0|this._al,T=0|this._bl,N=0|this._cl,w=0|this._dl,A=0|this._el,C=0|this._fl,S=0|this._gl,R=0|this._hl,M=0;M<32;M+=2)t[M]=e.readInt32BE(4*M),t[M+1]=e.readInt32BE(4*M+4);for(;M<160;M+=2){var O=t[M-30],P=t[M-30+1],x=f(O,P),I=d(P,O),_=m(O=t[M-4],P=t[M-4+1]),L=y(P,O),D=t[M-14],q=t[M-14+1],j=t[M-32],U=t[M-32+1],B=I+q|0,k=x+D+v(B,I)|0;k=(k=k+_+v(B=B+L|0,L)|0)+j+v(B=B+U|0,U)|0,t[M]=k,t[M+1]=B}for(var F=0;F<160;F+=2){k=t[F],B=t[F+1];var V=l(n,r,i),Q=l(E,T,N),K=h(n,E),H=h(E,n),z=p(s,A),W=p(A,s),Y=o[F],G=o[F+1],J=c(s,u,g),X=c(A,C,S),$=R+W|0,Z=b+z+v($,R)|0;Z=(Z=(Z=Z+J+v($=$+X|0,X)|0)+Y+v($=$+G|0,G)|0)+k+v($=$+B|0,B)|0;var ee=H+Q|0,te=K+V+v(ee,H)|0;b=g,R=S,g=u,S=C,u=s,C=A,s=a+Z+v(A=w+$|0,w)|0,a=i,w=N,i=r,N=T,r=n,T=E,n=Z+te+v(E=$+ee|0,$)|0}this._al=this._al+E|0,this._bl=this._bl+T|0,this._cl=this._cl+N|0,this._dl=this._dl+w|0,this._el=this._el+A|0,this._fl=this._fl+C|0,this._gl=this._gl+S|0,this._hl=this._hl+R|0,this._ah=this._ah+n+v(this._al,E)|0,this._bh=this._bh+r+v(this._bl,T)|0,this._ch=this._ch+i+v(this._cl,N)|0,this._dh=this._dh+a+v(this._dl,w)|0,this._eh=this._eh+s+v(this._el,A)|0,this._fh=this._fh+u+v(this._fl,C)|0,this._gh=this._gh+g+v(this._gl,S)|0,this._hh=this._hh+b+v(this._hl,R)|0},u.prototype._hash=function(){var e=a.allocUnsafe(64);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=u},function(e,t,n){"use strict";var r=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable;function o(e){if(null===e||void 0===e)throw new TypeError("Object.assign cannot be called with null or undefined");return Object(e)}e.exports=function(){try{if(!Object.assign)return!1;var e=new String("abc");if(e[5]="de","5"===Object.getOwnPropertyNames(e)[0])return!1;for(var t={},n=0;n<10;n++)t["_"+String.fromCharCode(n)]=n;if("0123456789"!==Object.getOwnPropertyNames(t).map((function(e){return t[e]})).join(""))return!1;var r={};return"abcdefghijklmnopqrst".split("").forEach((function(e){r[e]=e})),"abcdefghijklmnopqrst"===Object.keys(Object.assign({},r)).join("")}catch(i){return!1}}()?Object.assign:function(e,t){for(var n,s,u=o(e),c=1;c<arguments.length;c++){for(var l in n=Object(arguments[c]))i.call(n,l)&&(u[l]=n[l]);if(r){s=r(n);for(var h=0;h<s.length;h++)a.call(n,s[h])&&(u[s[h]]=n[s[h]])}}return u}},function(e,t,n){"use strict";n.r(t),n.d(t,"SoftDeleteQueryBuilder",(function(){return b}));var r=n(0),i=n(29),a=n(35),o=n(9),s=n(3),u=n(53),c=n(48),l=n(58),h=n(37),p=n(32),f=n(19),d=n(67),m=function(e){function t(n){var r=e.call(this)||this;return r.name="MissingDeleteDateColumnError",Object.setPrototypeOf(r,t.prototype),r.message='Entity "'+n.name+'" does not have delete date columns.',r}return r.c(t,e),t}(Error),y=n(12),v=n(60),g=n(46),b=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.expressionMap.aliasNamePrefixingEnabled=!1,r}return r.c(t,e),t.prototype.getQuery=function(){var e=this.createUpdateExpression();return e+=this.createOrderByExpression(),(e+=this.createLimitExpression()).trim()},t.prototype.execute=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o,c,f,d,m;return r.d(this,(function(y){switch(y.label){case 0:e=this.obtainQueryRunner(),t=!1,y.label=1;case 1:return y.trys.push([1,13,18,23]),!0!==this.expressionMap.useTransaction||!1!==e.isTransactionActive?[3,3]:[4,e.startTransaction()];case 2:y.sent(),t=!0,y.label=3;case 3:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(d=new p.a,e.broadcaster.broadcastBeforeUpdateEvent(d,this.expressionMap.mainAlias.metadata),d.promises.length>0?[4,Promise.all(d.promises)]:[3,5]):[3,5];case 4:y.sent(),y.label=5;case 5:return n=new l.a(e,this.expressionMap),!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0&&(this.expressionMap.extraReturningColumns=n.getUpdationReturningColumns()),i=r.e(this.getQueryAndParameters(),2),a=i[0],o=i[1],c=new u.a,[4,e.query(a,o)];case 6:return f=y.sent(),e.connection.driver instanceof s.f?(c.raw=f[0],c.affected=f[1]):c.raw=f,!0===this.expressionMap.updateEntity&&this.expressionMap.mainAlias.hasMetadata&&this.expressionMap.whereEntities.length>0?[4,n.update(c,this.expressionMap.whereEntities)]:[3,8];case 7:y.sent(),y.label=8;case 8:return!0===this.expressionMap.callListeners&&this.expressionMap.mainAlias.hasMetadata?(d=new p.a,e.broadcaster.broadcastAfterUpdateEvent(d,this.expressionMap.mainAlias.metadata),d.promises.length>0?[4,Promise.all(d.promises)]:[3,10]):[3,10];case 9:y.sent(),y.label=10;case 10:return t?[4,e.commitTransaction()]:[3,12];case 11:y.sent(),y.label=12;case 12:return[2,c];case 13:if(m=y.sent(),!t)return[3,17];y.label=14;case 14:return y.trys.push([14,16,,17]),[4,e.rollbackTransaction()];case 15:return y.sent(),[3,17];case 16:return y.sent(),[3,17];case 17:throw m;case 18:return e===this.queryRunner?[3,20]:[4,e.release()];case 19:y.sent(),y.label=20;case 20:return this.connection.driver instanceof h.a&&!e.isTransactionActive?[4,this.connection.driver.autoSave()]:[3,22];case 21:y.sent(),y.label=22;case 22:return[7];case 23:return[2]}}))}))},t.prototype.from=function(e,t){e=e instanceof g.a?e.options.name:e;var n=this.createFromAlias(e,t);return this.expressionMap.setMainAlias(n),this},t.prototype.where=function(e,t){this.expressionMap.wheres=[];var n=this.computeWhereParameter(e);return n&&(this.expressionMap.wheres=[{type:"simple",condition:n}]),t&&this.setParameters(t),this},t.prototype.andWhere=function(e,t){return this.expressionMap.wheres.push({type:"and",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.orWhere=function(e,t){return this.expressionMap.wheres.push({type:"or",condition:this.computeWhereParameter(e)}),t&&this.setParameters(t),this},t.prototype.whereInIds=function(e){return this.where(this.createWhereIdsExpression(e))},t.prototype.andWhereInIds=function(e){return this.andWhere(this.createWhereIdsExpression(e))},t.prototype.orWhereInIds=function(e){return this.orWhere(this.createWhereIdsExpression(e))},t.prototype.output=function(e){return this.returning(e)},t.prototype.returning=function(e){if(!this.connection.driver.isReturningSqlSupported())throw new c.a;return this.expressionMap.returning=e,this},t.prototype.orderBy=function(e,t,n){var r,i;return void 0===t&&(t="ASC"),this.expressionMap.orderBys=e?e instanceof Object?e:n?((r={})[e]={order:t,nulls:n},r):((i={})[e]=t,i):{},this},t.prototype.addOrderBy=function(e,t,n){return void 0===t&&(t="ASC"),this.expressionMap.orderBys[e]=n?{order:t,nulls:n}:t,this},t.prototype.limit=function(e){return this.expressionMap.limit=e,this},t.prototype.whereEntity=function(e){var t=this;if(!this.expressionMap.mainAlias.hasMetadata)throw new Error(".whereEntity method can only be used on queries which update real entity table.");this.expressionMap.wheres=[];var n=Array.isArray(e)?e:[e];return n.forEach((function(e){var n=t.expressionMap.mainAlias.metadata.getEntityIdMap(e);if(!n)throw new Error("Provided entity does not have ids set, cannot perform operation.");t.orWhereInIds(n)})),this.expressionMap.whereEntities=n,this},t.prototype.updateEntity=function(e){return this.expressionMap.updateEntity=e,this},t.prototype.createUpdateExpression=function(){var e=this.expressionMap.mainAlias.hasMetadata?this.expressionMap.mainAlias.metadata:void 0;if(!e)throw new Error('Cannot get entity metadata for the given alias "'+this.expressionMap.mainAlias+'"');if(!e.deleteDateColumn)throw new m(e);var t=[];switch(this.expressionMap.queryType){case"soft-delete":t.push(this.escape(e.deleteDateColumn.databaseName)+" = CURRENT_TIMESTAMP");break;case"restore":t.push(this.escape(e.deleteDateColumn.databaseName)+" = NULL");break;default:throw new Error('The queryType must be "soft-delete" or "restore"')}if(e.versionColumn&&t.push(this.escape(e.versionColumn.databaseName)+" = "+this.escape(e.versionColumn.databaseName)+" + 1"),e.updateDateColumn&&t.push(this.escape(e.updateDateColumn.databaseName)+" = CURRENT_TIMESTAMP"),t.length<=0)throw new v.a;(this.connection.driver instanceof s.e||this.connection.driver instanceof y.a||this.connection.driver instanceof f.a)&&(this.expressionMap.nativeParameters=Object.assign({},this.expressionMap.nativeParameters));var n=this.createWhereExpression(),r=this.createReturningExpression();return r&&(this.connection.driver instanceof s.f||this.connection.driver instanceof y.a||this.connection.driver instanceof i.a)?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n+" RETURNING "+r:r&&this.connection.driver instanceof o.a?"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+" OUTPUT "+r+n:"UPDATE "+this.getTableName(this.getMainTableName())+" SET "+t.join(", ")+n},t.prototype.createOrderByExpression=function(){var e=this,t=this.expressionMap.orderBys;return Object.keys(t).length>0?" ORDER BY "+Object.keys(t).map((function(n){return"string"===typeof t[n]?e.replacePropertyNames(n)+" "+t[n]:e.replacePropertyNames(n)+" "+t[n].order+" "+t[n].nulls})).join(", "):""},t.prototype.createLimitExpression=function(){var e=this.expressionMap.limit;if(e){if(this.connection.driver instanceof s.e)return" LIMIT "+e;throw new d.a}return""},t}(a.a)},function(e,t,n){"use strict";function r(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,i)}function i(e){return function(){var t=this,n=arguments;return new Promise((function(i,a){var o=e.apply(t,n);function s(e){r(o,i,a,s,u,"next",e)}function u(e){r(o,i,a,s,u,"throw",e)}s(void 0)}))}}n.d(t,"a",(function(){return i}))},function(e,t,n){(t=e.exports=function(e){e=e.toLowerCase();var n=t[e];if(!n)throw new Error(e+" is not supported (we accept pull requests)");return new n}).sha=n(96),t.sha1=n(100),t.sha224=n(101),t.sha256=n(75),t.sha384=n(102),t.sha512=n(76)},function(e,t,n){"use strict";n.d(t,"a",(function(){return T}));var r=n(0),i=n(28),a=n(17),o=n(36),s=n(27),u=n(14),c=n(43),l=n(2),h=n(22),p=n(8),f=n(15),d=n(13),m=n(10),y=n(18),v=n(25),g=n(6),b=n(1),E=n(23),T=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.queryResponsibilityChain=[],r.driver=t,r.connection=t.connection,r.broadcaster=new v.a(r),r.mode=n,r}return r.c(t,e),t.prototype.connect=function(){return Promise.resolve()},t.prototype.release=function(){return this.isReleased=!0,Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,(function(){var t=this;return r.d(this,(function(n){if(this.isReleased)throw new a.a;if(this.isTransactionActive)throw new o.a;return[2,new Promise((function(n,i){return r.b(t,void 0,void 0,(function(){var t,a,o=this;return r.d(this,(function(r){switch(r.label){case 0:return this.isTransactionActive=!0,[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return t=r.sent(),this.databaseConnection=t.transaction(),a=function(t){if(t)return o.isTransactionActive=!1,i(t);n(),o.connection.logger.logQuery("BEGIN TRANSACTION"),e&&o.connection.logger.logQuery("SET TRANSACTION ISOLATION LEVEL "+e)},e?this.databaseConnection.begin(this.convertIsolationLevel(e),a):this.databaseConnection.begin(a),[2]}}))}))}))]}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){if(this.isReleased)throw new a.a;if(!this.isTransactionActive)throw new s.a;return[2,new Promise((function(t,n){e.databaseConnection.commit((function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t(),e.connection.logger.logQuery("COMMIT")}))}))]}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){if(this.isReleased)throw new a.a;if(!this.isTransactionActive)throw new s.a;return[2,new Promise((function(t,n){e.databaseConnection.rollback((function(r){if(r)return n(r);e.isTransactionActive=!1,e.databaseConnection=null,t(),e.connection.logger.logQuery("ROLLBACK")}))}))]}))}))},t.prototype.query=function(e,t){return r.b(this,void 0,void 0,(function(){var n,o,s,u,c=this;return r.d(this,(function(l){switch(l.label){case 0:if(this.isReleased)throw new a.a;return o=new Promise((function(e){return n=e})),this.queryResponsibilityChain.length?(s=r.f(this.queryResponsibilityChain),this.queryResponsibilityChain.push(o),[4,Promise.all(s)]):[3,2];case 1:l.sent(),l.label=2;case 2:return u=new Promise((function(a,s){return r.b(c,void 0,void 0,(function(){var c,l,h,p,f=this;return r.d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return c=r.sent(),l=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:c),t&&t.length&&t.forEach((function(e,t){if(e instanceof E.a){var n=f.mssqlParameterToNativeParameter(e);n?l.input(t,n,e.value):l.input(t,e.value)}else l.input(t,e)})),h=+new Date,l.query(e,(function(r,c){var l=f.driver.connection.options.maxQueryExecutionTime,p=+new Date-h;l&&p>l&&f.driver.connection.logger.logQuerySlow(p,e,t,f);var d=function(){-1!==m&&f.queryResponsibilityChain.splice(m,1),-1!==y&&f.queryResponsibilityChain.splice(y,1),n()},m=f.queryResponsibilityChain.indexOf(u),y=f.queryResponsibilityChain.indexOf(o);if(r)return f.driver.connection.logger.logQueryError(r,e,t,f),d(),s(new i.a(e,t,r));switch(e.slice(0,e.indexOf(" "))){case"DELETE":a([c.recordset,c.rowsAffected[0]]);break;default:a(c.recordset)}d()})),[3,3];case 2:return p=r.sent(),s(p),[3,3];case 3:return[2]}}))}))})),this.queryResponsibilityChain.push(u),[2,u]}}))}))},t.prototype.stream=function(e,t,n,i){return r.b(this,void 0,void 0,(function(){var o,s,u,c,l=this;return r.d(this,(function(h){switch(h.label){case 0:if(this.isReleased)throw new a.a;return s=new Promise((function(e){return o=e})),this.queryResponsibilityChain.length?(u=r.f(this.queryResponsibilityChain),this.queryResponsibilityChain.push(s),[4,Promise.all(u)]):[3,2];case 1:h.sent(),h.label=2;case 2:return c=new Promise((function(a,u){return r.b(l,void 0,void 0,(function(){var l,h,p=this;return r.d(this,(function(r){switch(r.label){case 0:return this.driver.connection.logger.logQuery(e,t,this),[4,"slave"===this.mode?this.driver.obtainSlaveConnection():this.driver.obtainMasterConnection()];case 1:return l=r.sent(),(h=new this.driver.mssql.Request(this.isTransactionActive?this.databaseConnection:l)).stream=!0,t&&t.length&&t.forEach((function(e,t){e instanceof E.a?h.input(t,p.mssqlParameterToNativeParameter(e),e.value):h.input(t,e)})),h.query(e,(function(n,r){var i=function(){-1!==l&&p.queryResponsibilityChain.splice(l,1),-1!==h&&p.queryResponsibilityChain.splice(h,1),o()},l=p.queryResponsibilityChain.indexOf(c),h=p.queryResponsibilityChain.indexOf(s);if(n)return p.driver.connection.logger.logQueryError(n,e,t,p),i(),u(n);a(r.recordset),i()})),n&&h.on("done",n),i&&h.on("error",i),a(h),[2]}}))}))})),this.isTransactionActive&&this.queryResponsibilityChain.push(c),[2,c]}}))}))},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query("EXEC sp_databases")];case 1:return[2,e.sent().map((function(e){return e.DATABASE_NAME}))]}}))}))},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return t=e?'SELECT * FROM "'+e+'"."sys"."schema"':'SELECT * FROM "sys"."schemas"',[4,this.query(t)];case 1:return[2,n.sent().map((function(e){return e.name}))]}}))}))},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return[4,this.query("SELECT DB_ID('"+e+'\') as "db_id"')];case 1:return t=n.sent(),[2,!!t[0].db_id]}}))}))},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return[4,this.query("SELECT SCHEMA_ID('"+e+'\') as "schema_id"')];case 1:return t=n.sent(),[2,!!t[0].schema_id]}}))}))},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i;return r.d(this,(function(r){switch(r.label){case 0:return t=this.parseTableName(e),n="SCHEMA_NAME()"===t.schema?t.schema:"'"+t.schema+"'",i='SELECT * FROM "'+t.database+'"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = \''+t.name+'\' AND "TABLE_SCHEMA" = '+n,[4,this.query(i)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return n=this.parseTableName(e),i="SCHEMA_NAME()"===n.schema?n.schema:"'"+n.schema+"'",a='SELECT * FROM "'+n.database+'"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_NAME" = \''+n.name+"' AND \"COLUMN_NAME\" = '"+t+'\' AND "TABLE_SCHEMA" = '+i,[4,this.query(a)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=t?"IF DB_ID('"+e+"') IS NULL CREATE DATABASE \""+e+'"':'CREATE DATABASE "'+e+'"',i='DROP DATABASE "'+e+'"',[4,this.executeQueries(new b.a(n),new b.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=t?"IF DB_ID('"+e+"') IS NOT NULL DROP DATABASE \""+e+'"':'DROP DATABASE "'+e+'"',i='CREATE DATABASE "'+e+'"',[4,this.executeQueries(new b.a(n),new b.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],-1!==e.indexOf(".")?[3,1]:(u=t?"IF SCHEMA_ID('"+e+"') IS NULL BEGIN EXEC ('CREATE SCHEMA \""+e+"\"') END":'CREATE SCHEMA "'+e+'"',n.push(new b.a(u)),i.push(new b.a('DROP SCHEMA "'+e+'"')),[3,3]);case 1:return a=e.split(".")[0],o=e.split(".")[1],[4,this.getCurrentDatabase()];case 2:s=r.sent(),n.push(new b.a('USE "'+a+'"')),i.push(new b.a('USE "'+s+'"')),u=t?"IF SCHEMA_ID('"+o+"') IS NULL BEGIN EXEC ('CREATE SCHEMA \""+o+"\"') END":'CREATE SCHEMA "'+o+'"',n.push(new b.a(u)),i.push(new b.a('DROP SCHEMA "'+o+'"')),n.push(new b.a('USE "'+s+'"')),i.push(new b.a('USE "'+a+'"')),r.label=3;case 3:return[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}}))}))},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],-1!==e.indexOf(".")?[3,1]:(u=t?"IF SCHEMA_ID('"+e+"') IS NULL BEGIN EXEC ('DROP SCHEMA \""+e+"\"') END":'DROP SCHEMA "'+e+'"',n.push(new b.a(u)),i.push(new b.a('CREATE SCHEMA "'+e+'"')),[3,3]);case 1:return a=e.split(".")[0],o=e.split(".")[1],[4,this.getCurrentDatabase()];case 2:s=r.sent(),n.push(new b.a('USE "'+a+'"')),i.push(new b.a('USE "'+s+'"')),u=t?"IF SCHEMA_ID('"+o+"') IS NULL BEGIN EXEC ('DROP SCHEMA \""+o+"\"') END":'DROP SCHEMA "'+o+'"',n.push(new b.a(u)),i.push(new b.a('CREATE SCHEMA "'+o+'"')),n.push(new b.a('USE "'+s+'"')),i.push(new b.a('USE "'+a+'"')),r.label=3;case 3:return[4,this.executeQueries(n,i)];case 4:return r.sent(),[2]}}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((function(t){return o.push(s.dropForeignKeySql(e,t))})),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s,u,c,h=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof l.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],c=[],i&&o.indices.forEach((function(e){u.push(h.dropIndexSql(o,e)),c.push(h.createIndexSql(o,e))})),n&&o.foreignKeys.forEach((function(e){return u.push(h.dropForeignKeySql(o,e))})),u.push(this.dropTableSql(o)),c.push(this.createTableSql(o,a)),[4,this.executeQueries(u,c)];case 6:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof y.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,f,d,m,y,v=this;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],e instanceof l.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=void 0,c=void 0,h=a.name,3===(p=a.name.split(".")).length?(u=p[0],h=p[2],""!==p[1]&&(c=p[1])):2===p.length&&(c=p[0],h=p[1]),s.name=this.driver.buildTableName(t,c,u),[4,this.getCurrentDatabase()];case 4:return f=r.sent(),u&&u!==f&&(n.push(new b.a('USE "'+u+'"')),i.push(new b.a('USE "'+f+'"'))),n.push(new b.a('EXEC sp_rename "'+this.escapePath(a,!0)+'", "'+t+'"')),i.push(new b.a('EXEC sp_rename "'+this.escapePath(s,!0)+'", "'+h+'"')),s.primaryColumns.length>0&&(d=s.primaryColumns.map((function(e){return e.name})),m=this.connection.namingStrategy.primaryKeyName(a,d),y=this.connection.namingStrategy.primaryKeyName(s,d),n.push(new b.a('EXEC sp_rename "'+this.escapePath(s,!0)+"."+m+'", "'+y+'"')),i.push(new b.a('EXEC sp_rename "'+this.escapePath(s,!0)+"."+y+'", "'+m+'"'))),s.uniques.forEach((function(e){var t=v.connection.namingStrategy.uniqueConstraintName(s,e.columnNames);n.push(new b.a('EXEC sp_rename "'+v.escapePath(s,!0)+"."+e.name+'", "'+t+'"')),i.push(new b.a('EXEC sp_rename "'+v.escapePath(s,!0)+"."+t+'", "'+e.name+'"')),e.name=t})),s.indices.forEach((function(e){var t=v.connection.namingStrategy.indexName(s,e.columnNames,e.where);n.push(new b.a('EXEC sp_rename "'+v.escapePath(s,!0)+"."+e.name+'", "'+t+'", "INDEX"')),i.push(new b.a('EXEC sp_rename "'+v.escapePath(s,!0)+"."+t+'", "'+e.name+'", "INDEX"')),e.name=t})),s.foreignKeys.forEach((function(e){var t=v.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new b.a('EXEC sp_rename "'+v.buildForeignKeyName(e.name,c,u)+'", "'+t+'"')),i.push(new b.a('EXEC sp_rename "'+v.buildForeignKeyName(t,c,u)+'", "'+e.name+'"')),e.name=t})),u&&u!==f&&(n.push(new b.a('USE "'+f+'"')),i.push(new b.a('USE "'+u+'"'))),[4,this.executeQueries(n,i)];case 5:return r.sent(),a.name=s.name,this.replaceCachedTable(a,s),[2]}}))}))},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,f,d,y,v;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),s=[],(o=[]).push(new b.a("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,t,!1,!0))),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+t.name+'"')),t.isPrimary&&((u=a.primaryColumns).length>0&&(c=this.connection.namingStrategy.primaryKeyName(a.name,u.map((function(e){return e.name}))),h=u.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+c+'"')),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+h+")"))),u.push(t),p=this.connection.namingStrategy.primaryKeyName(a.name,u.map((function(e){return e.name}))),f=u.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+f+")")),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+p+'"'))),(d=a.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))&&(o.push(this.createIndexSql(n,d)),s.push(this.dropIndexSql(n,d))),t.isUnique&&(y=new m.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(y),o.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+y.name+'" UNIQUE ("'+t.name+'")')),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+y.name+'"'))),null!==t.default&&void 0!==t.default&&(v=this.connection.namingStrategy.defaultConstraintName(n.name,t.name),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+v+'"'))),[4,this.executeQueries(o,s)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,u.c.runInSequence(t,(function(t){return n.addColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof p.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return s=void 0,n instanceof p.a?s=n:(s=o.clone()).name=n,[4,this.changeColumn(i,o,s)];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s,u,c,h,f,d,y,v,g,E,T,N,w,A,C,S,R,M,O=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(c=t instanceof p.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n.isGenerated!==c.isGenerated&&"uuid"!==n.generationStrategy||n.type!==c.type||n.length!==c.length?[4,this.dropColumn(i,c)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,10];case 6:return n.name===c.name?[3,8]:(h=void 0,f=void 0,3===(d=i.name.split(".")).length?(h=d[0],""!==d[1]&&(f=d[1])):2===d.length&&(f=d[0]),[4,this.getCurrentDatabase()]);case 7:y=r.sent(),h&&h!==y&&(s.push(new b.a('USE "'+h+'"')),u.push(new b.a('USE "'+y+'"'))),s.push(new b.a('EXEC sp_rename "'+this.escapePath(i,!0)+"."+c.name+'", "'+n.name+'"')),u.push(new b.a('EXEC sp_rename "'+this.escapePath(i,!0)+"."+n.name+'", "'+c.name+'"')),!0===c.isPrimary&&(w=o.primaryColumns,S=w.map((function(e){return e.name})),v=this.connection.namingStrategy.primaryKeyName(o,S),S.splice(S.indexOf(c.name),1),S.push(n.name),g=this.connection.namingStrategy.primaryKeyName(o,S),s.push(new b.a('EXEC sp_rename "'+this.escapePath(o,!0)+"."+v+'", "'+g+'"')),u.push(new b.a('EXEC sp_rename "'+this.escapePath(o,!0)+"."+g+'", "'+v+'"'))),o.findColumnIndices(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=O.connection.namingStrategy.indexName(o,e.columnNames,e.where);s.push(new b.a('EXEC sp_rename "'+O.escapePath(o,!0)+"."+e.name+'", "'+t+'", "INDEX"')),u.push(new b.a('EXEC sp_rename "'+O.escapePath(o,!0)+"."+t+'", "'+e.name+'", "INDEX"')),e.name=t})),o.findColumnForeignKeys(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=O.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(new b.a('EXEC sp_rename "'+O.buildForeignKeyName(e.name,f,h)+'", "'+t+'"')),u.push(new b.a('EXEC sp_rename "'+O.buildForeignKeyName(t,f,h)+'", "'+e.name+'"')),e.name=t})),o.findColumnChecks(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=O.connection.namingStrategy.checkConstraintName(o,e.expression);s.push(new b.a('EXEC sp_rename "'+O.escapePath(o,!0)+"."+e.name+'", "'+t+'"')),u.push(new b.a('EXEC sp_rename "'+O.escapePath(o,!0)+"."+t+'", "'+e.name+'"')),e.name=t})),o.findColumnUniques(c).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(c.name),1),e.columnNames.push(n.name);var t=O.connection.namingStrategy.uniqueConstraintName(o,e.columnNames);s.push(new b.a('EXEC sp_rename "'+O.escapePath(o,!0)+"."+e.name+'", "'+t+'"')),u.push(new b.a('EXEC sp_rename "'+O.escapePath(o,!0)+"."+t+'", "'+e.name+'"')),e.name=t})),null!==c.default&&void 0!==c.default&&(E=this.connection.namingStrategy.defaultConstraintName(i.name,c.name),T=this.connection.namingStrategy.defaultConstraintName(i.name,n.name),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+E+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+E+'" DEFAULT '+c.default+' FOR "'+n.name+'"')),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+T+'" DEFAULT '+c.default+' FOR "'+n.name+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+T+'"'))),h&&h!==y&&(s.push(new b.a('USE "'+y+'"')),u.push(new b.a('USE "'+h+'"'))),N=o.columns.find((function(e){return e.name===c.name})),o.columns[o.columns.indexOf(N)].name=n.name,c.name=n.name,r.label=8;case 8:return this.isColumnChanged(c,n,!1)&&(s.push(new b.a("ALTER TABLE "+this.escapePath(i)+" ALTER COLUMN "+this.buildCreateColumnSql(i,n,!0,!1))),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+" ALTER COLUMN "+this.buildCreateColumnSql(i,c,!0,!1)))),n.isPrimary!==c.isPrimary&&((w=o.primaryColumns).length>0&&(C=this.connection.namingStrategy.primaryKeyName(o.name,w.map((function(e){return e.name}))),S=w.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+C+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+C+'" PRIMARY KEY ('+S+")"))),!0===n.isPrimary?(w.push(n),o.columns.find((function(e){return e.name===n.name})).isPrimary=!0,C=this.connection.namingStrategy.primaryKeyName(o.name,w.map((function(e){return e.name}))),S=w.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+C+'" PRIMARY KEY ('+S+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+C+'"'))):(A=w.find((function(e){return e.name===n.name})),w.splice(w.indexOf(A),1),o.columns.find((function(e){return e.name===n.name})).isPrimary=!1,w.length>0&&(C=this.connection.namingStrategy.primaryKeyName(o.name,w.map((function(e){return e.name}))),S=w.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+C+'" PRIMARY KEY ('+S+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+C+'"'))))),n.isUnique!==c.isUnique&&(!0===n.isUnique?(R=new m.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),o.uniques.push(R),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+R.name+'" UNIQUE ("'+n.name+'")')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+R.name+'"'))):(R=o.uniques.find((function(e){return 1===e.columnNames.length&&!!e.columnNames.find((function(e){return e===n.name}))})),o.uniques.splice(o.uniques.indexOf(R),1),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+R.name+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+R.name+'" UNIQUE ("'+n.name+'")')))),n.default!==c.default&&(null!==c.default&&void 0!==c.default&&(M=this.connection.namingStrategy.defaultConstraintName(i.name,c.name),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+M+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+M+'" DEFAULT '+c.default+' FOR "'+c.name+'"'))),null!==n.default&&void 0!==n.default&&(M=this.connection.namingStrategy.defaultConstraintName(i.name,n.name),s.push(new b.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+M+'" DEFAULT '+n.default+' FOR "'+n.name+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+M+'"')))),[4,this.executeQueries(s,u)];case 9:r.sent(),this.replaceCachedTable(i,o),r.label=10;case 10:return[2]}}))}))},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,u.c.runInSequence(t,(function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,f,d,m,y,v,g;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof p.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return o=n.clone(),s=[],u=[],a.isPrimary&&(c=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map((function(e){return e.name}))),h=o.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+c+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+c+'" PRIMARY KEY ('+h+")")),o.findColumnByName(a.name).isPrimary=!1,o.primaryColumns.length>0&&(f=this.connection.namingStrategy.primaryKeyName(o.name,o.primaryColumns.map((function(e){return e.name}))),d=o.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+d+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+f+'"')))),(m=o.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.indices.splice(o.indices.indexOf(m),1),s.push(this.dropIndexSql(n,m)),u.push(this.createIndexSql(n,m))),(y=o.checks.find((function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.checks.splice(o.checks.indexOf(y),1),s.push(this.dropCheckConstraintSql(n,y)),u.push(this.createCheckConstraintSql(n,y))),(v=o.uniques.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(o.uniques.splice(o.uniques.indexOf(v),1),s.push(this.dropUniqueConstraintSql(n,v)),u.push(this.createUniqueConstraintSql(n,v))),null!==a.default&&void 0!==a.default&&(g=this.connection.namingStrategy.defaultConstraintName(n.name,a.name),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+g+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+g+'" DEFAULT '+a.default+' FOR "'+a.name+'"'))),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP COLUMN "'+a.name+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(n,a,!1,!1))),[4,this.executeQueries(s,u)];case 4:return r.sent(),o.removeColumn(a),this.replaceCachedTable(n,o),[2]}}))}))},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,u.c.runInSequence(t,(function(t){return n.dropColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,c,h,p,f,d;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map((function(e){return e.name})),s=[],u=[],(c=a.primaryColumns).length>0&&(h=this.connection.namingStrategy.primaryKeyName(a.name,c.map((function(e){return e.name}))),p=c.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+h+'"')),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+p+")"))),a.columns.filter((function(e){return-1!==o.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),f=this.connection.namingStrategy.primaryKeyName(a.name,o),d=o.map((function(e){return'"'+e+'"'})).join(", "),s.push(new b.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+d+")")),u.push(new b.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+f+'"')),[4,this.executeQueries(s,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name}))),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createUniqueConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof m.a?t:n.uniques.find((function(e){return e.name===t}))))throw new Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropUniqueConstraintSql(n,a),s=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropUniqueConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof h.a?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SqlServer does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SqlServer does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SqlServer does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SqlServer does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof l.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s=this;return r.d(this,(function(u){switch(u.label){case 0:return e?[4,this.hasDatabase(e)]:[3,2];case 1:if(!u.sent())return[2,Promise.resolve()];u.label=2;case 2:return[4,this.startTransaction()];case 3:u.sent(),u.label=4;case 4:return u.trys.push([4,11,,16]),t=e?'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."VIEWS"':'SELECT * FROM "INFORMATION_SCHEMA"."VIEWS"',[4,this.query(t)];case 5:return n=u.sent(),[4,Promise.all(n.map((function(e){var t='DROP VIEW "'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+'"';return s.query(t)})))];case 6:return u.sent(),i=e?'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_TYPE" = \'BASE TABLE\'':'SELECT * FROM "INFORMATION_SCHEMA"."TABLES" WHERE "TABLE_TYPE" = \'BASE TABLE\'',[4,this.query(i)];case 7:return a=u.sent(),[4,Promise.all(a.map((function(e){return r.b(s,void 0,void 0,(function(){var t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return t="SELECT 'ALTER TABLE \""+e.TABLE_CATALOG+'"."\' + OBJECT_SCHEMA_NAME("fk"."parent_object_id", DB_ID(\''+e.TABLE_CATALOG+'\')) + \'"."\' + OBJECT_NAME("fk"."parent_object_id", DB_ID(\''+e.TABLE_CATALOG+'\')) + \'" DROP CONSTRAINT "\' + "fk"."name" + \'"\' as "query" FROM "'+e.TABLE_CATALOG+'"."sys"."foreign_keys" AS "fk" WHERE "fk"."referenced_object_id" = OBJECT_ID(\'"'+e.TABLE_CATALOG+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+"\"')",[4,this.query(t)];case 1:return n=r.sent(),[2,Promise.all(n.map((function(e){return e.query})).map((function(e){return i.query(e)})))]}}))}))})))];case 8:return u.sent(),[4,Promise.all(a.map((function(e){if(!e.TABLE_NAME.startsWith("#")){var t='DROP TABLE "'+e.TABLE_CATALOG+'"."'+e.TABLE_SCHEMA+'"."'+e.TABLE_NAME+'"';return s.query(t)}})))];case 9:return u.sent(),[4,this.commitTransaction()];case 10:return u.sent(),[3,16];case 11:o=u.sent(),u.label=12;case 12:return u.trys.push([12,14,,15]),[4,this.rollbackTransaction()];case 13:return u.sent(),[3,15];case 14:return u.sent(),[3,15];case 15:throw o;case 16:return[2]}}))}))},t.prototype.getCurrentDatabase=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query('SELECT DB_NAME() AS "db_name"')];case 1:return[2,e.sent()[0].db_name]}}))}))},t.prototype.getCurrentSchema=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query('SELECT SCHEMA_NAME() AS "schema_name"')];case 1:return[2,e.sent()[0].schema_name]}}))}))},t.prototype.loadViews=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u=this;return r.d(this,(function(c){switch(c.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return c.sent()?[4,this.getCurrentSchema()]:[2,Promise.resolve([])];case 2:return t=c.sent(),[4,this.getCurrentDatabase()];case 3:return n=c.sent(),i=function(e){var n=r.e(e.split("."),3),i=n[0],a=n[1],o=n[2];return o?""===a&&(a=u.driver.options.schema||t):a?(o=a,a=i):(o=i,a=u.driver.options.schema||t),[a,o]},a=e.filter((function(e){return 3===e.split(".").length})).map((function(e){return e.split(".")[0]})),this.driver.database&&!a.find((function(e){return e===u.driver.database}))&&a.push(this.driver.database),o=e.map((function(e){var t=r.e(i(e),2);return'("T"."SCHEMA" = \''+t[0]+'\' AND "T"."NAME" = \''+t[1]+"')"})).join(" OR "),s=a.map((function(e){return'SELECT "T".*, "V"."CHECK_OPTION" FROM '+u.escapePath(u.getTypeormMetadataTableName())+' "t" INNER JOIN "'+e+'"."INFORMATION_SCHEMA"."VIEWS" "V" ON "V"."TABLE_SCHEMA" = "T"."SCHEMA" AND "v"."TABLE_NAME" = "T"."NAME" WHERE "T"."TYPE" = \'VIEW\' '+(o?"AND ("+o+")":"")})).join(" UNION ALL "),[4,this.query(s)];case 4:return[2,c.sent().map((function(e){var r=new y.a,i=e.TABLE_CATALOG===n?void 0:e.TABLE_CATALOG,a=e.schema!==t||u.driver.options.schema?e.schema:void 0;return r.name=u.driver.buildTableName(e.name,a,i),r.expression=e.value,r}))]}}))}))},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,y,v,b,E,T,N,w,A,C,S,R,M,O,P,x=this;return r.d(this,(function(I){switch(I.label){case 0:return e&&e.length?(t=[],[4,this.getCurrentSchema()]):[2,[]];case 1:return n=I.sent(),[4,this.getCurrentDatabase()];case 2:return i=I.sent(),a=function(e){var t=r.e(e.split("."),3),i=t[0],a=t[1],o=t[2];return o?""===a&&(a=x.driver.options.schema||n):a?(o=a,a=i):(o=i,a=x.driver.options.schema||n),[a,o]},e.filter((function(e){return-1!==e.indexOf(".")})).forEach((function(e){3===e.split(".").length?""!==e.split(".")[1]&&t.push(e.split(".")[1]):t.push(e.split(".")[0])})),t.push(this.driver.options.schema||n),o=e.filter((function(e){return 3===e.split(".").length})).map((function(e){return e.split(".")[0]})),this.driver.database&&!o.find((function(e){return e===x.driver.database}))&&o.push(this.driver.database),s=t.map((function(e){return"'"+e+"'"})).join(", "),u=e.map((function(e){var t=r.e(a(e),2);return'("TABLE_SCHEMA" = \''+t[0]+"' AND \"TABLE_NAME\" = '"+t[1]+"')"})).join(" OR "),c=o.map((function(e){return'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."TABLES" WHERE '+u})).join(" UNION ALL "),y=o.map((function(e){return'SELECT * FROM "'+e+'"."INFORMATION_SCHEMA"."COLUMNS" WHERE '+u})).join(" UNION ALL "),v=e.map((function(e){var t=r.e(a(e),2),n=t[0],i=t[1];return'("columnUsages"."TABLE_SCHEMA" = \''+n+'\' AND "columnUsages"."TABLE_NAME" = \''+i+'\' AND "tableConstraints"."TABLE_SCHEMA" = \''+n+'\' AND "tableConstraints"."TABLE_NAME" = \''+i+"')"})).join(" OR "),b=o.map((function(e){return'SELECT "columnUsages".*, "tableConstraints"."CONSTRAINT_TYPE", "chk"."definition" FROM "'+e+'"."INFORMATION_SCHEMA"."CONSTRAINT_COLUMN_USAGE" "columnUsages" INNER JOIN "'+e+'"."INFORMATION_SCHEMA"."TABLE_CONSTRAINTS" "tableConstraints" ON "tableConstraints"."CONSTRAINT_NAME" = "columnUsages"."CONSTRAINT_NAME" LEFT JOIN "'+e+'"."sys"."check_constraints" "chk" ON "chk"."name" = "columnUsages"."CONSTRAINT_NAME" WHERE ('+v+") AND \"tableConstraints\".\"CONSTRAINT_TYPE\" IN ('PRIMARY KEY', 'UNIQUE', 'CHECK')"})).join(" UNION ALL "),E=o.map((function(e){return'SELECT "fk"."name" AS "FK_NAME", \''+e+'\' AS "TABLE_CATALOG", "s1"."name" AS "TABLE_SCHEMA", "t1"."name" AS "TABLE_NAME", "col1"."name" AS "COLUMN_NAME", "s2"."name" AS "REF_SCHEMA", "t2"."name" AS "REF_TABLE", "col2"."name" AS "REF_COLUMN", "fk"."delete_referential_action_desc" AS "ON_DELETE", "fk"."update_referential_action_desc" AS "ON_UPDATE" FROM "'+e+'"."sys"."foreign_keys" "fk" INNER JOIN "'+e+'"."sys"."foreign_key_columns" "fkc" ON "fkc"."constraint_object_id" = "fk"."object_id" INNER JOIN "'+e+'"."sys"."tables" "t1" ON "t1"."object_id" = "fk"."parent_object_id" INNER JOIN "'+e+'"."sys"."schemas" "s1" ON "s1"."schema_id" = "t1"."schema_id" INNER JOIN "'+e+'"."sys"."tables" "t2" ON "t2"."object_id" = "fk"."referenced_object_id" INNER JOIN "'+e+'"."sys"."schemas" "s2" ON "s2"."schema_id" = "t2"."schema_id" INNER JOIN "'+e+'"."sys"."columns" "col1" ON "col1"."column_id" = "fkc"."parent_column_id" AND "col1"."object_id" = "fk"."parent_object_id" INNER JOIN "'+e+'"."sys"."columns" "col2" ON "col2"."column_id" = "fkc"."referenced_column_id" AND "col2"."object_id" = "fk"."referenced_object_id"'})).join(" UNION ALL "),T=o.map((function(e){return'SELECT "TABLE_CATALOG", "TABLE_SCHEMA", "COLUMN_NAME", "TABLE_NAME" FROM "'+e+'"."INFORMATION_SCHEMA"."COLUMNS" WHERE COLUMNPROPERTY(object_id("TABLE_CATALOG" + \'.\' + "TABLE_SCHEMA" + \'.\' + "TABLE_NAME"), "COLUMN_NAME", \'IsIdentity\') = 1 AND "TABLE_SCHEMA" IN ('+s+")"})).join(" UNION ALL "),'SELECT "NAME", "COLLATION_NAME" FROM "sys"."databases"',N=o.map((function(e){return"SELECT '"+e+'\' AS "TABLE_CATALOG", "s"."name" AS "TABLE_SCHEMA", "t"."name" AS "TABLE_NAME", "ind"."name" AS "INDEX_NAME", "col"."name" AS "COLUMN_NAME", "ind"."is_unique" AS "IS_UNIQUE", "ind"."filter_definition" as "CONDITION" FROM "'+e+'"."sys"."indexes" "ind" INNER JOIN "'+e+'"."sys"."index_columns" "ic" ON "ic"."object_id" = "ind"."object_id" AND "ic"."index_id" = "ind"."index_id" INNER JOIN "'+e+'"."sys"."columns" "col" ON "col"."object_id" = "ic"."object_id" AND "col"."column_id" = "ic"."column_id" INNER JOIN "'+e+'"."sys"."tables" "t" ON "t"."object_id" = "ind"."object_id" INNER JOIN "'+e+'"."sys"."schemas" "s" ON "s"."schema_id" = "t"."schema_id" WHERE "ind"."is_primary_key" = 0 AND "ind"."is_unique_constraint" = 0 AND "t"."is_ms_shipped" = 0'})).join(" UNION ALL "),[4,Promise.all([this.query(c),this.query(y),this.query(b),this.query(E),this.query(T),this.query('SELECT "NAME", "COLLATION_NAME" FROM "sys"."databases"'),this.query(N)])];case 3:return w=r.e.apply(void 0,[I.sent(),7]),A=w[0],C=w[1],S=w[2],R=w[3],M=w[4],O=w[5],P=w[6],A.length?[4,Promise.all(A.map((function(e){return r.b(x,void 0,void 0,(function(){var t,a,o,s,u,c,y,v,b,E=this;return r.d(this,(function(T){return t=new l.a,a=e.TABLE_CATALOG===i?void 0:e.TABLE_CATALOG,o=e.TABLE_SCHEMA!==n||this.driver.options.schema?e.TABLE_SCHEMA:void 0,t.name=this.driver.buildTableName(e.TABLE_NAME,o,a),s=this.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG),u=O.find((function(t){return t.NAME===e.TABLE_CATALOG})),t.columns=C.filter((function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===s})).map((function(e){var n,i,a=S.filter((function(t){return E.driver.buildTableName(t.TABLE_NAME,t.CONSTRAINT_SCHEMA,t.CONSTRAINT_CATALOG)===s&&t.COLUMN_NAME===e.COLUMN_NAME})),o=a.find((function(e){return"UNIQUE"===e.CONSTRAINT_TYPE})),c=!!o&&!!S.find((function(t){return"UNIQUE"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===o.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME})),l=!!a.find((function(e){return"PRIMARY KEY"===e.CONSTRAINT_TYPE})),h=!!M.find((function(t){return E.driver.buildTableName(t.TABLE_NAME,t.TABLE_SCHEMA,t.TABLE_CATALOG)===s&&t.COLUMN_NAME===e.COLUMN_NAME})),f=new p.a;if(f.name=e.COLUMN_NAME,f.type=e.DATA_TYPE.toLowerCase(),-1!==E.driver.withLengthColumnTypes.indexOf(f.type)&&e.CHARACTER_MAXIMUM_LENGTH){var d=e.CHARACTER_MAXIMUM_LENGTH.toString();f.length="-1"===d?"MAX":E.isDefaultColumnLength(t,f,d)?"":d}if("decimal"!==f.type&&"numeric"!==f.type||(null===e.NUMERIC_PRECISION||E.isDefaultColumnPrecision(t,f,e.NUMERIC_PRECISION)||(f.precision=e.NUMERIC_PRECISION),null===e.NUMERIC_SCALE||E.isDefaultColumnScale(t,f,e.NUMERIC_SCALE)||(f.scale=e.NUMERIC_SCALE)),"nvarchar"===f.type){var m=a.filter((function(e){return"CHECK"===e.CONSTRAINT_TYPE}));if(m.length){var y=new RegExp("^\\(\\["+f.name+"\\]='[^']+'(?: OR \\["+f.name+"\\]='[^']+')*\\)$");try{for(var v=r.g(m),g=v.next();!g.done;g=v.next()){var b=g.value;if(y.test(b.definition)){f.type="simple-enum",f.enum=[];for(var T=new RegExp("\\["+f.name+"\\]='([^']+)'","g"),N=void 0;null!==(N=T.exec(b.definition));)f.enum.unshift(N[1]);break}}}catch(w){n={error:w}}finally{try{g&&!g.done&&(i=v.return)&&i.call(v)}finally{if(n)throw n.error}}}}return f.default=null!==e.COLUMN_DEFAULT&&void 0!==e.COLUMN_DEFAULT?E.removeParenthesisFromDefault(e.COLUMN_DEFAULT):void 0,f.isNullable="YES"===e.IS_NULLABLE,f.isPrimary=l,f.isUnique=!!o&&!c,f.isGenerated=h,h&&(f.generationStrategy="increment"),"newsequentialid()"===f.default&&(f.isGenerated=!0,f.generationStrategy="uuid",f.default=void 0),e.COLLATION_NAME&&(f.collation=e.COLLATION_NAME===u.COLLATION_NAME?void 0:e.COLLATION_NAME),"datetime2"!==f.type&&"time"!==f.type&&"datetimeoffset"!==f.type||(f.precision=E.isDefaultColumnPrecision(t,f,e.DATETIME_PRECISION)?void 0:e.DATETIME_PRECISION),f})),c=g.a.uniq(S.filter((function(e){return E.driver.buildTableName(e.TABLE_NAME,e.CONSTRAINT_SCHEMA,e.CONSTRAINT_CATALOG)===s&&"UNIQUE"===e.CONSTRAINT_TYPE})),(function(e){return e.CONSTRAINT_NAME})),t.uniques=c.map((function(e){var t=S.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return new m.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME}))})})),y=g.a.uniq(S.filter((function(e){return E.driver.buildTableName(e.TABLE_NAME,e.CONSTRAINT_SCHEMA,e.CONSTRAINT_CATALOG)===s&&"CHECK"===e.CONSTRAINT_TYPE})),(function(e){return e.CONSTRAINT_NAME})),t.checks=y.map((function(e){var t=S.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return new h.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),expression:e.definition})})),v=g.a.uniq(R.filter((function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===s})),(function(e){return e.FK_NAME})),t.foreignKeys=v.map((function(e){var t=R.filter((function(t){return t.FK_NAME===e.FK_NAME})),r=e.TABLE_CATALOG===i?void 0:e.TABLE_CATALOG,a=e.REF_SCHEMA===n?void 0:e.REF_SCHEMA,o=E.driver.buildTableName(e.REF_TABLE,a,r);return new f.a({name:e.FK_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),referencedTableName:o,referencedColumnNames:t.map((function(e){return e.REF_COLUMN})),onDelete:e.ON_DELETE.replace("_"," "),onUpdate:e.ON_UPDATE.replace("_"," ")})})),b=g.a.uniq(P.filter((function(e){return E.driver.buildTableName(e.TABLE_NAME,e.TABLE_SCHEMA,e.TABLE_CATALOG)===s})),(function(e){return e.INDEX_NAME})),t.indices=b.map((function(e){var n=P.filter((function(t){return t.TABLE_CATALOG===e.TABLE_CATALOG&&t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME}));return new d.a({table:t,name:e.INDEX_NAME,columnNames:n.map((function(e){return e.COLUMN_NAME})),isUnique:e.IS_UNIQUE,where:e.CONDITION})})),[2,t]}))}))})))]:[2,[]];case 4:return[2,I.sent()]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(t){return n.buildCreateColumnSql(e,t,!1,!0)})).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new m.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0)&&(i+=", "+e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", "));e.checks.length>0&&(i+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapePath(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a})).join(", "));var a=e.columns.filter((function(e){return e.isPrimary}));a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map((function(e){return e.name})))+'" PRIMARY KEY ('+a.map((function(e){return'"'+e.name+'"'})).join(", ")+")");return i+=")",new b.a(i)},t.prototype.dropTableSql=function(e,t){var n=t?"DROP TABLE IF EXISTS "+this.escapePath(e):"DROP TABLE "+this.escapePath(e);return new b.a(n)},t.prototype.createViewSql=function(e){return"string"===typeof e.expression?new b.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression):new b.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(u){switch(u.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=u.sent(),n=this.parseTableName(e,t),i="string"===typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),a=r.e(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",database:n.database,schema:n.schema,name:n.name,value:i}).getQueryAndParameters(),2),o=a[0],s=a[1],[2,new b.a(o,s)]}}))}))},t.prototype.dropViewSql=function(e){return new b.a("DROP VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(u){switch(u.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=u.sent(),n=this.parseTableName(e,t),i=this.connection.createQueryBuilder(),a=r.e(i.delete().from(this.getTypeormMetadataTableName()).where(i.escape("type")+" = 'VIEW'").andWhere(i.escape("database")+" = :database",{database:n.database}).andWhere(i.escape("schema")+" = :schema",{schema:n.schema}).andWhere(i.escape("name")+" = :name",{name:n.name}).getQueryAndParameters(),2),o=a[0],s=a[1],[2,new b.a(o,s)]}}))}))},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new b.a("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON '+this.escapePath(e)+" ("+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof d.a?t.name:t;return new b.a('DROP INDEX "'+n+'" ON '+this.escapePath(e))},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map((function(e){return'"'+e+'"'})).join(", ");return new b.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map((function(e){return e.name})),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new b.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof m.a?t.name:t;return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new b.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof h.a?t.name:t;return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(","),i="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapePath(t.referencedTableName)+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),new b.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof f.a?t.name:t;return new b.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.escapePath=function(e,t){var n=e instanceof l.a||e instanceof y.a?e.name:e;if(this.driver.options.schema)if(-1===n.indexOf("."))n=this.driver.options.schema+"."+n;else if(3===n.split(".").length){var r=n.split("."),i=r[0],a=r[2];n=i+"."+this.driver.options.schema+"."+a}return n.split(".").map((function(e){return""===e||t?e:'"'+e+'"'})).join(".")},t.prototype.parseTableName=function(e,t){var n=e instanceof l.a||e instanceof y.a?e.name:e;return 3===n.split(".").length?{database:n.split(".")[0],schema:""===n.split(".")[1]?t||"SCHEMA_NAME()":n.split(".")[1],name:n.split(".")[2]}:2===n.split(".").length?{database:this.driver.database,schema:n.split(".")[0],name:n.split(".")[1]}:{database:this.driver.database,schema:this.driver.options.schema?this.driver.options.schema:t||"SCHEMA_NAME()",name:n}},t.prototype.buildForeignKeyName=function(e,t,n){var r=e;return t&&(r=t+"."+r),n&&(r=n+"."+r),r},t.prototype.removeParenthesisFromDefault=function(e){if("("!==e.substr(0,1))return e;var t=e.substr(1,e.lastIndexOf(")")-1);return this.removeParenthesisFromDefault(t)},t.prototype.buildCreateColumnSql=function(e,t,n,r){var i='"'+t.name+'" '+this.connection.driver.createFullType(t);(t.enum&&(i+=" CHECK( "+t.name+" IN ("+t.enum.map((function(e){return"'"+e+"'"})).join(",")+") )"),t.collation&&(i+=" COLLATE "+t.collation),!0!==t.isNullable&&(i+=" NOT NULL"),!0!==t.isGenerated||"increment"!==t.generationStrategy||n||(i+=" IDENTITY(1,1)"),void 0!==t.default&&null!==t.default&&r)&&(i+=' CONSTRAINT "'+this.connection.namingStrategy.defaultConstraintName(e.name,t.name)+'" DEFAULT '+t.default);t.isGenerated&&"uuid"===t.generationStrategy&&!t.default&&(i+=' CONSTRAINT "'+this.connection.namingStrategy.defaultConstraintName(e.name,t.name)+'" DEFAULT NEWSEQUENTIALID()');return i},t.prototype.mssqlParameterToNativeParameter=function(e){var t,n,i,a,o,s,u,c,l,h;switch(this.driver.normalizeType({type:e.type})){case"bit":return this.driver.mssql.Bit;case"bigint":return this.driver.mssql.BigInt;case"decimal":return(t=this.driver.mssql).Decimal.apply(t,r.f(e.params));case"float":return this.driver.mssql.Float;case"int":return this.driver.mssql.Int;case"money":return this.driver.mssql.Money;case"numeric":return(n=this.driver.mssql).Numeric.apply(n,r.f(e.params));case"smallint":return this.driver.mssql.SmallInt;case"smallmoney":return this.driver.mssql.SmallMoney;case"real":return this.driver.mssql.Real;case"tinyint":return this.driver.mssql.TinyInt;case"char":return(i=this.driver.mssql).Char.apply(i,r.f(e.params));case"nchar":return(a=this.driver.mssql).NChar.apply(a,r.f(e.params));case"text":return this.driver.mssql.Text;case"ntext":return this.driver.mssql.Ntext;case"varchar":return(o=this.driver.mssql).VarChar.apply(o,r.f(e.params));case"nvarchar":return(s=this.driver.mssql).NVarChar.apply(s,r.f(e.params));case"xml":return this.driver.mssql.Xml;case"time":return(u=this.driver.mssql).Time.apply(u,r.f(e.params));case"date":return this.driver.mssql.Date;case"datetime":return this.driver.mssql.DateTime;case"datetime2":return(c=this.driver.mssql).DateTime2.apply(c,r.f(e.params));case"datetimeoffset":return(l=this.driver.mssql).DateTimeOffset.apply(l,r.f(e.params));case"smalldatetime":return this.driver.mssql.SmallDateTime;case"uniqueidentifier":return this.driver.mssql.UniqueIdentifier;case"variant":return this.driver.mssql.Variant;case"binary":return this.driver.mssql.Binary;case"varbinary":return(h=this.driver.mssql).VarBinary.apply(h,r.f(e.params));case"image":return this.driver.mssql.Image;case"udt":return this.driver.mssql.UDT;case"rowversion":return this.driver.mssql.RowVersion}},t.prototype.convertIsolationLevel=function(e){var t=this.driver.mssql.ISOLATION_LEVEL;switch(e){case"READ UNCOMMITTED":return t.READ_UNCOMMITTED;case"REPEATABLE READ":return t.REPEATABLE_READ;case"SERIALIZABLE":return t.SERIALIZABLE;case"READ COMMITTED":default:return t.READ_COMMITTED}},t}(c.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return g}));var r=n(0),i=n(36),a=n(27),o=n(8),s=n(2),u=n(15),c=n(13),l=n(17),h=n(18),p=n(1),f=n(6),d=n(10),m=n(43),y=n(25),v=n(14),g=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new y.a(n),n}return r.c(t,e),t.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,{}]}))}))},t.prototype.release=function(){return this.isReleased=!0,this.databaseConnection&&this.databaseConnection.release(),Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(this.isTransactionActive)throw new i.a;return this.isTransactionActive=!0,[4,this.driver.client.startTransaction()];case 1:return e.sent(),[2]}}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.driver.client.commitTransaction()];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.driver.client.rollbackTransaction()];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.query=function(e,t){return r.b(this,void 0,void 0,(function(){var n;return r.d(this,(function(r){switch(r.label){case 0:if(this.isReleased)throw new l.a;return[4,this.driver.client.query(e,t)];case 1:return(n=r.sent()).records?[2,n.records]:[2,n]}}))}))},t.prototype.stream=function(e,t,n,i){var a=this;if(this.isReleased)throw new l.a;return new Promise((function(o,s){return r.b(a,void 0,void 0,(function(){var a,u,c;return r.d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return a=r.sent(),u=a.query(e,t),n&&u.on("end",n),i&&u.on("error",i),o(u),[3,3];case 2:return c=r.sent(),s(c),[3,3];case 3:return[2]}}))}))}))},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql driver does not support table schemas")}))}))},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query("SELECT * FROM `INFORMATION_SCHEMA`.`SCHEMATA` WHERE `SCHEMA_NAME` = '"+e+"'")];case 1:return[2,!!t.sent().length]}}))}))},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql driver does not support table schemas")}))}))},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return t=this.parseTableName(e),n="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE `TABLE_SCHEMA` = '"+t.database+"' AND `TABLE_NAME` = '"+t.tableName+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return n=this.parseTableName(e),i=t instanceof o.a?t.name:t,a="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE `TABLE_SCHEMA` = '"+n.database+"' AND `TABLE_NAME` = '"+n.tableName+"' AND `COLUMN_NAME` = '"+i+"'",[4,this.query(a)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=t?"CREATE DATABASE IF NOT EXISTS `"+e+"`":"CREATE DATABASE `"+e+"`",i="DROP DATABASE `"+e+"`",[4,this.executeQueries(new p.a(n),new p.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=t?"DROP DATABASE IF EXISTS `"+e+"`":"DROP DATABASE `"+e+"`",i="CREATE DATABASE `"+e+"`",[4,this.executeQueries(new p.a(n),new p.a(i))];case 1:return r.sent(),[2]}}))}))},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Schema create queries are not supported by MySql driver.")}))}))},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Schema drop queries are not supported by MySql driver.")}))}))},t.prototype.createTable=function(e,t,n){return void 0===t&&(t=!1),void 0===n&&(n=!0),r.b(this,void 0,void 0,(function(){var i,a,o=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=[],(i=[]).push(this.createTableSql(e,n)),a.push(this.dropTableSql(e)),e.indices.forEach((function(t){return a.push(o.dropIndexSql(e,t))})),n&&e.foreignKeys.forEach((function(t){return a.push(o.dropForeignKeySql(e,t))})),[2,this.executeQueries(i,a)]}}))}))},t.prototype.dropTable=function(e,t,n){return void 0===n&&(n=!0),r.b(this,void 0,void 0,(function(){var i,a,o,u,c,l=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return i=n,a=e instanceof s.a?e.name:e,[4,this.getCachedTable(a)];case 3:return o=r.sent(),u=[],c=[],n&&o.foreignKeys.forEach((function(e){return u.push(l.dropForeignKeySql(o,e))})),o.indices.forEach((function(e){return u.push(l.dropIndexSql(o,e))})),u.push(this.dropTableSql(o)),c.push(this.createTableSql(o,i)),[4,this.executeQueries(u,c)];case 4:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof h.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u,c,l=this;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],e instanceof s.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return u=(a=o).clone(),c=-1===a.name.indexOf(".")?void 0:a.name.split(".")[0],u.name=c?c+"."+t:t,n.push(new p.a("RENAME TABLE "+this.escapePath(a.name)+" TO "+this.escapePath(u.name))),i.push(new p.a("RENAME TABLE "+this.escapePath(u.name)+" TO "+this.escapePath(a.name))),u.indices.forEach((function(e){var t=e.columnNames.map((function(e){return"`"+e+"`"})).join(", "),r=l.connection.namingStrategy.indexName(u,e.columnNames,e.where),a="";e.isUnique&&(a+="UNIQUE "),e.isSpatial&&(a+="SPATIAL "),e.isFulltext&&(a+="FULLTEXT "),n.push(new p.a("ALTER TABLE "+l.escapePath(u)+" DROP INDEX `"+e.name+"`, ADD "+a+"INDEX `"+r+"` ("+t+")")),i.push(new p.a("ALTER TABLE "+l.escapePath(u)+" DROP INDEX `"+r+"`, ADD "+a+"INDEX `"+e.name+"` ("+t+")")),e.name=r})),u.foreignKeys.forEach((function(e){var t=e.columnNames.map((function(e){return"`"+e+"`"})).join(", "),r=e.referencedColumnNames.map((function(e){return"`"+e+"`"})).join(","),a=l.connection.namingStrategy.foreignKeyName(u,e.columnNames),o="ALTER TABLE "+l.escapePath(u)+" DROP FOREIGN KEY `"+e.name+"`, ADD CONSTRAINT `"+a+"` FOREIGN KEY ("+t+") REFERENCES "+l.escapePath(e.referencedTableName)+"("+r+")";e.onDelete&&(o+=" ON DELETE "+e.onDelete),e.onUpdate&&(o+=" ON UPDATE "+e.onUpdate);var s="ALTER TABLE "+l.escapePath(u)+" DROP FOREIGN KEY `"+a+"`, ADD CONSTRAINT `"+e.name+"` FOREIGN KEY ("+t+") REFERENCES "+l.escapePath(e.referencedTableName)+"("+r+")";e.onDelete&&(s+=" ON DELETE "+e.onDelete),e.onUpdate&&(s+=" ON UPDATE "+e.onUpdate),n.push(new p.a(o)),i.push(new p.a(s)),e.name=a})),[4,this.executeQueries(n,i)];case 4:return r.sent(),a.name=u.name,this.replaceCachedTable(a,u),[2]}}))}))},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u,l,h,f,m,y,v,g;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=[],u=[],l=a.primaryColumns.length>0,o.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(t,l,!1))),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP COLUMN `"+t.name+"`")),t.isPrimary&&l&&((h=a.columns.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})))&&((y=h.clone()).isGenerated=!1,y.generationStrategy=void 0,o.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+t.name+"` "+this.buildCreateColumnSql(y,!0))),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+y.name+"` "+this.buildCreateColumnSql(t,!0)))),f=a.primaryColumns,m=f.map((function(e){return"`"+e.name+"`"})).join(", "),o.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP PRIMARY KEY")),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD PRIMARY KEY ("+m+")")),f.push(t),m=f.map((function(e){return"`"+e.name+"`"})).join(", "),o.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD PRIMARY KEY ("+m+")")),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP PRIMARY KEY")),h&&((y=h.clone()).isGenerated=!1,y.generationStrategy=void 0,o.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+y.name+"` "+this.buildCreateColumnSql(t,!0))),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+t.name+"` "+this.buildCreateColumnSql(y,!0))))),(v=a.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))?(o.push(this.createIndexSql(n,v)),u.push(this.dropIndexSql(n,v))):t.isUnique&&(g=new c.a({name:this.connection.namingStrategy.indexName(n.name,[t.name]),columnNames:[t.name],isUnique:!0}),a.indices.push(g),a.uniques.push(new d.a({name:g.name,columnNames:g.columnNames})),o.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD UNIQUE INDEX `"+g.name+"` (`"+t.name+"`)")),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP INDEX `"+g.name+"`"))),[4,this.executeQueries(o,u)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,v.c.runInSequence(t,(function(t){return n.addColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,u,c;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(u=t instanceof o.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.a?c=n:(c=u.clone()).name=n,[4,this.changeColumn(i,u,c)];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,u,l,h,f,m,y,v,g,b,E,T,N,w,A=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(u=(i=a).clone(),l=[],h=[],!(f=t instanceof o.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n.isGenerated!==f.isGenerated&&"uuid"!==n.generationStrategy||f.type!==n.type||f.length!==n.length||f.generatedType!==n.generatedType?[4,this.dropColumn(i,f)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),u=i.clone(),[3,7];case 6:n.name!==f.name&&(l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+f.name+"` `"+n.name+"` "+this.buildCreateColumnSql(f,!0,!0))),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+n.name+"` `"+f.name+"` "+this.buildCreateColumnSql(f,!0,!0))),u.findColumnIndices(f).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=e.columnNames.map((function(e){return"`"+e+"`"})).join(", "),r=A.connection.namingStrategy.indexName(u,e.columnNames,e.where),a="";e.isUnique&&(a+="UNIQUE "),e.isSpatial&&(a+="SPATIAL "),e.isFulltext&&(a+="FULLTEXT "),l.push(new p.a("ALTER TABLE "+A.escapePath(i)+" DROP INDEX `"+e.name+"`, ADD "+a+"INDEX `"+r+"` ("+t+")")),h.push(new p.a("ALTER TABLE "+A.escapePath(i)+" DROP INDEX `"+r+"`, ADD "+a+"INDEX `"+e.name+"` ("+t+")")),e.name=r})),u.findColumnForeignKeys(f).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(f.name),1),e.columnNames.push(n.name);var t=e.columnNames.map((function(e){return"`"+e+"`"})).join(", "),r=e.referencedColumnNames.map((function(e){return"`"+e+"`"})).join(","),a=A.connection.namingStrategy.foreignKeyName(u,e.columnNames),o="ALTER TABLE "+A.escapePath(i)+" DROP FOREIGN KEY `"+e.name+"`, ADD CONSTRAINT `"+a+"` FOREIGN KEY ("+t+") REFERENCES "+A.escapePath(e.referencedTableName)+"("+r+")";e.onDelete&&(o+=" ON DELETE "+e.onDelete),e.onUpdate&&(o+=" ON UPDATE "+e.onUpdate);var s="ALTER TABLE "+A.escapePath(i)+" DROP FOREIGN KEY `"+a+"`, ADD CONSTRAINT `"+e.name+"` FOREIGN KEY ("+t+") REFERENCES "+A.escapePath(e.referencedTableName)+"("+r+")";e.onDelete&&(s+=" ON DELETE "+e.onDelete),e.onUpdate&&(s+=" ON UPDATE "+e.onUpdate),l.push(new p.a(o)),h.push(new p.a(s)),e.name=a})),m=u.columns.find((function(e){return e.name===f.name})),u.columns[u.columns.indexOf(m)].name=n.name,f.name=n.name),this.isColumnChanged(f,n,!0)&&(l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+f.name+"` "+this.buildCreateColumnSql(n,!0))),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+n.name+"` "+this.buildCreateColumnSql(f,!0)))),n.isPrimary!==f.isPrimary&&((y=u.columns.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})))&&((E=y.clone()).isGenerated=!1,E.generationStrategy=void 0,l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+y.name+"` "+this.buildCreateColumnSql(E,!0))),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+E.name+"` "+this.buildCreateColumnSql(y,!0)))),(v=u.primaryColumns).length>0&&(b=v.map((function(e){return"`"+e.name+"`"})).join(", "),l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" DROP PRIMARY KEY")),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" ADD PRIMARY KEY ("+b+")"))),!0===n.isPrimary?(v.push(n),u.columns.find((function(e){return e.name===n.name})).isPrimary=!0,b=v.map((function(e){return"`"+e.name+"`"})).join(", "),l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" ADD PRIMARY KEY ("+b+")")),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" DROP PRIMARY KEY"))):(g=v.find((function(e){return e.name===n.name})),v.splice(v.indexOf(g),1),u.columns.find((function(e){return e.name===n.name})).isPrimary=!1,v.length>0&&(b=v.map((function(e){return"`"+e.name+"`"})).join(", "),l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" ADD PRIMARY KEY ("+b+")")),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" DROP PRIMARY KEY")))),y&&((E=y.clone()).isGenerated=!1,E.generationStrategy=void 0,l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+E.name+"` "+this.buildCreateColumnSql(y,!0))),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" CHANGE `"+y.name+"` "+this.buildCreateColumnSql(E,!0))))),n.isUnique!==f.isUnique&&(!0===n.isUnique?(T=new c.a({name:this.connection.namingStrategy.indexName(i.name,[n.name]),columnNames:[n.name],isUnique:!0}),u.indices.push(T),u.uniques.push(new d.a({name:T.name,columnNames:T.columnNames})),l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" ADD UNIQUE INDEX `"+T.name+"` (`"+n.name+"`)")),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" DROP INDEX `"+T.name+"`"))):(N=u.indices.find((function(e){return 1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find((function(e){return e===n.name}))})),u.indices.splice(u.indices.indexOf(N),1),w=u.uniques.find((function(e){return e.name===N.name})),u.uniques.splice(u.uniques.indexOf(w),1),l.push(new p.a("ALTER TABLE "+this.escapePath(i)+" DROP INDEX `"+N.name+"`")),h.push(new p.a("ALTER TABLE "+this.escapePath(i)+" ADD UNIQUE INDEX `"+N.name+"` (`"+n.name+"`)")))),r.label=7;case 7:return[4,this.executeQueries(l,h)];case 8:return r.sent(),this.replaceCachedTable(i,u),[2]}}))}))},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,v.c.runInSequence(t,(function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,u,c,l,h,f,d,m,y,v,g,b,E;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return u=n.clone(),c=[],l=[],a.isPrimary&&((h=u.columns.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})))&&((m=h.clone()).isGenerated=!1,m.generationStrategy=void 0,c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+h.name+"` "+this.buildCreateColumnSql(m,!0))),l.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+m.name+"` "+this.buildCreateColumnSql(h,!0)))),f=u.primaryColumns.map((function(e){return"`"+e.name+"`"})).join(", "),c.push(new p.a("ALTER TABLE "+this.escapePath(u)+" DROP PRIMARY KEY")),l.push(new p.a("ALTER TABLE "+this.escapePath(u)+" ADD PRIMARY KEY ("+f+")")),u.findColumnByName(a.name).isPrimary=!1,u.primaryColumns.length>0&&(d=u.primaryColumns.map((function(e){return"`"+e.name+"`"})).join(", "),c.push(new p.a("ALTER TABLE "+this.escapePath(u)+" ADD PRIMARY KEY ("+d+")")),l.push(new p.a("ALTER TABLE "+this.escapePath(u)+" DROP PRIMARY KEY"))),h&&h.name!==a.name&&((m=h.clone()).isGenerated=!1,m.generationStrategy=void 0,c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+m.name+"` "+this.buildCreateColumnSql(h,!0))),l.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+h.name+"` "+this.buildCreateColumnSql(m,!0))))),(y=u.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))?(u.indices.splice(u.indices.indexOf(y),1),c.push(this.dropIndexSql(n,y)),l.push(this.createIndexSql(n,y))):a.isUnique&&(v=this.connection.namingStrategy.uniqueConstraintName(n.name,[a.name]),(g=u.uniques.find((function(e){return e.name===v})))&&u.uniques.splice(u.uniques.indexOf(g),1),b=this.connection.namingStrategy.indexName(n.name,[a.name]),(E=u.indices.find((function(e){return e.name===b})))&&u.indices.splice(u.indices.indexOf(E),1),c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP INDEX `"+b+"`")),l.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD UNIQUE INDEX `"+b+"` (`"+a.name+"`)"))),c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP COLUMN `"+a.name+"`")),l.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD "+this.buildCreateColumnSql(a,!0))),[4,this.executeQueries(c,l)];case 4:return r.sent(),u.removeColumn(a),this.replaceCachedTable(n,u),[2]}}))}))},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,v.c.runInSequence(t,(function(t){return n.dropColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),u=this.dropPrimaryKeySql(n),[4,this.executeQueries(o,u)];case 4:return r.sent(),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h,f,d,m,y,v;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=t.map((function(e){return e.name})),u=[],c=[],(l=a.columns.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})))&&((y=l.clone()).isGenerated=!1,y.generationStrategy=void 0,u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+l.name+"` "+this.buildCreateColumnSql(y,!0))),c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+y.name+"` "+this.buildCreateColumnSql(l,!0)))),(h=a.primaryColumns).length>0&&(f=h.map((function(e){return"`"+e.name+"`"})).join(", "),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP PRIMARY KEY")),c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD PRIMARY KEY ("+f+")"))),a.columns.filter((function(e){return-1!==o.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),d=o.map((function(e){return"`"+e+"`"})).join(", "),u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" ADD PRIMARY KEY ("+d+")")),c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" DROP PRIMARY KEY")),(m=l||t.find((function(e){return e.isGenerated&&"increment"===e.generationStrategy})))&&((y=m.clone()).isGenerated=!1,y.generationStrategy=void 0,u.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+y.name+"` "+this.buildCreateColumnSql(m,!0))),c.push(new p.a("ALTER TABLE "+this.escapePath(n)+" CHANGE `"+m.name+"` "+this.buildCreateColumnSql(y,!0))),(v=a.columns.find((function(e){return e.name===m.name}))).isGenerated=!0,v.generationStrategy="increment"),[4,this.executeQueries(u,c)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name}))),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support unique constraints. Use unique index instead.")}))}))},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support unique constraints. Use unique index instead.")}))}))},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support unique constraints. Use unique index instead.")}))}))},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support unique constraints. Use unique index instead.")}))}))},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support check constraints.")}))}))},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support check constraints.")}))}))},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support check constraints.")}))}))},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support check constraints.")}))}))},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("MySql does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,c;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof u.a?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),c=this.createForeignKeySql(n,a),[4,this.executeQueries(o,c)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t,!0),[2]}}))}))},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),u=this.createIndexSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeIndex(a,!0),[2]}}))}))},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c=this;return r.d(this,(function(r){switch(r.label){case 0:return(t=e||this.driver.database)?[4,this.hasDatabase(t)]:[3,2];case 1:return r.sent()?[3,3]:[2,Promise.resolve()];case 2:throw new Error("Can not clear database. No database is specified");case 3:return[4,this.startTransaction()];case 4:r.sent(),r.label=5;case 5:return r.trys.push([5,13,,18]),n="SELECT concat('DROP VIEW IF EXISTS `', table_schema, '`.`', table_name, '`') AS `query` FROM `INFORMATION_SCHEMA`.`VIEWS` WHERE `TABLE_SCHEMA` = '"+t+"'",[4,this.query(n)];case 6:return i=r.sent(),[4,Promise.all(i.map((function(e){return c.query(e.query)})))];case 7:return r.sent(),"SET FOREIGN_KEY_CHECKS = 0;",a="SELECT concat('DROP TABLE IF EXISTS `', table_schema, '`.`', table_name, '`') AS `query` FROM `INFORMATION_SCHEMA`.`TABLES` WHERE `TABLE_SCHEMA` = '"+t+"'",o="SET FOREIGN_KEY_CHECKS = 1;",[4,this.query("SET FOREIGN_KEY_CHECKS = 0;")];case 8:return r.sent(),[4,this.query(a)];case 9:return s=r.sent(),[4,Promise.all(s.map((function(e){return c.query(e.query)})))];case 10:return r.sent(),[4,this.query(o)];case 11:return r.sent(),[4,this.commitTransaction()];case 12:return r.sent(),[3,18];case 13:u=r.sent(),r.label=14;case 14:return r.trys.push([14,16,,17]),[4,this.rollbackTransaction()];case 15:return r.sent(),[3,17];case 16:return r.sent(),[3,17];case 17:throw u;case 18:return[2]}}))}))},t.prototype.getCurrentDatabase=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query("SELECT DATABASE() AS `db_name`")];case 1:return[2,e.sent()[0].db_name]}}))}))},t.prototype.loadViews=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a=this;return r.d(this,(function(o){switch(o.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return o.sent()?[4,this.getCurrentDatabase()]:[2,Promise.resolve([])];case 2:return t=o.sent(),n=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],o=n[1];return o||(o=i,i=a.driver.database||t),"(`t`.`schema` = '"+i+"' AND `t`.`name` = '"+o+"')"})).join(" OR "),i="SELECT `t`.*, `v`.`check_option` FROM "+this.escapePath(this.getTypeormMetadataTableName())+" `t` INNER JOIN `information_schema`.`views` `v` ON `v`.`table_schema` = `t`.`schema` AND `v`.`table_name` = `t`.`name` WHERE `t`.`type` = 'VIEW' "+(n?"AND ("+n+")":""),[4,this.query(i)];case 3:return[2,o.sent().map((function(e){var n=new h.a,r=e.schema===t?void 0:e.schema;return n.name=a.driver.buildTableName(e.name,void 0,r),n.expression=e.value,n}))]}}))}))},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,l,h,p,d,m,y,v,g,b,E,T,N,w=this;return r.d(this,(function(A){switch(A.label){case 0:return e&&e.length?[4,this.getCurrentDatabase()]:[2,[]];case 1:return t=A.sent(),n=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=w.driver.database||t),"(`TABLE_SCHEMA` = '"+i+"' AND `TABLE_NAME` = '"+a+"')"})).join(" OR "),i="SELECT * FROM `INFORMATION_SCHEMA`.`TABLES` WHERE "+n,a="SELECT * FROM `INFORMATION_SCHEMA`.`COLUMNS` WHERE "+n,l="SELECT * FROM `INFORMATION_SCHEMA`.`KEY_COLUMN_USAGE` WHERE `CONSTRAINT_NAME` = 'PRIMARY' AND ("+n+")","SELECT `SCHEMA_NAME`, `DEFAULT_CHARACTER_SET_NAME` as `CHARSET`, `DEFAULT_COLLATION_NAME` AS `COLLATION` FROM `INFORMATION_SCHEMA`.`SCHEMATA`",h=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=w.driver.database||t),"(`s`.`TABLE_SCHEMA` = '"+i+"' AND `s`.`TABLE_NAME` = '"+a+"')"})).join(" OR "),p="SELECT `s`.* FROM `INFORMATION_SCHEMA`.`STATISTICS` `s` LEFT JOIN `INFORMATION_SCHEMA`.`REFERENTIAL_CONSTRAINTS` `rc` ON `s`.`INDEX_NAME` = `rc`.`CONSTRAINT_NAME` WHERE ("+h+") AND `s`.`INDEX_NAME` != 'PRIMARY' AND `rc`.`CONSTRAINT_NAME` IS NULL",d=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=w.driver.database||t),"(`kcu`.`TABLE_SCHEMA` = '"+i+"' AND `kcu`.`TABLE_NAME` = '"+a+"')"})).join(" OR "),m="SELECT `kcu`.`TABLE_SCHEMA`, `kcu`.`TABLE_NAME`, `kcu`.`CONSTRAINT_NAME`, `kcu`.`COLUMN_NAME`, `kcu`.`REFERENCED_TABLE_SCHEMA`, `kcu`.`REFERENCED_TABLE_NAME`, `kcu`.`REFERENCED_COLUMN_NAME`, `rc`.`DELETE_RULE` `ON_DELETE`, `rc`.`UPDATE_RULE` `ON_UPDATE` FROM `INFORMATION_SCHEMA`.`KEY_COLUMN_USAGE` `kcu` INNER JOIN `INFORMATION_SCHEMA`.`REFERENTIAL_CONSTRAINTS` `rc` ON `rc`.`constraint_name` = `kcu`.`constraint_name` WHERE "+d,[4,Promise.all([this.query(i),this.query(a),this.query(l),this.query("SELECT `SCHEMA_NAME`, `DEFAULT_CHARACTER_SET_NAME` as `CHARSET`, `DEFAULT_COLLATION_NAME` AS `COLLATION` FROM `INFORMATION_SCHEMA`.`SCHEMATA`"),this.query(p),this.query(m)])];case 2:return y=r.e.apply(void 0,[A.sent(),6]),v=y[0],g=y[1],b=y[2],E=y[3],T=y[4],N=y[5],v.length?[2,Promise.all(v.map((function(e){return r.b(w,void 0,void 0,(function(){var n,i,a,l,h,p,d,m,y=this;return r.d(this,(function(r){return n=new s.a,i=E.find((function(t){return t.SCHEMA_NAME===e.TABLE_SCHEMA})),a=i.COLLATION,l=i.CHARSET,h=e.TABLE_SCHEMA===t?void 0:e.TABLE_SCHEMA,n.name=this.driver.buildTableName(e.TABLE_NAME,void 0,h),p=this.driver.buildTableName(e.TABLE_NAME,void 0,e.TABLE_SCHEMA),n.columns=g.filter((function(e){return y.driver.buildTableName(e.TABLE_NAME,void 0,e.TABLE_SCHEMA)===p})).map((function(e){var t=T.find((function(t){return y.driver.buildTableName(t.TABLE_NAME,void 0,t.TABLE_SCHEMA)===p&&(t.COLUMN_NAME===e.COLUMN_NAME&&0===parseInt(t.NON_UNIQUE,10))})),r=y.connection.entityMetadatas.find((function(e){return e.tablePath===n.name})),i=t&&r&&r.indices.some((function(e){return e.name===t.INDEX_NAME&&!1===e.synchronize})),s=!!t&&!!T.find((function(n){return n.INDEX_NAME===t.INDEX_NAME&&n.COLUMN_NAME!==e.COLUMN_NAME})),u=new o.a;if(u.name=e.COLUMN_NAME,u.type=e.DATA_TYPE.toLowerCase(),-1!==y.driver.withWidthColumnTypes.indexOf(u.type)){var c=e.COLUMN_TYPE.substring(e.COLUMN_TYPE.indexOf("(")+1,e.COLUMN_TYPE.indexOf(")"));u.width=c&&!y.isDefaultColumnWidth(n,u,parseInt(c))?parseInt(c):void 0}if(null===e.COLUMN_DEFAULT||void 0===e.COLUMN_DEFAULT?u.default=void 0:u.default="CURRENT_TIMESTAMP"===e.COLUMN_DEFAULT?e.COLUMN_DEFAULT:"'"+e.COLUMN_DEFAULT+"'",-1!==e.EXTRA.indexOf("on update")&&(u.onUpdate=e.EXTRA.substring(e.EXTRA.indexOf("on update")+10)),e.GENERATION_EXPRESSION&&(u.asExpression=e.GENERATION_EXPRESSION,u.generatedType=-1!==e.EXTRA.indexOf("VIRTUAL")?"VIRTUAL":"STORED"),u.isUnique=!!t&&!i&&!s,u.isNullable="YES"===e.IS_NULLABLE,u.isPrimary=b.some((function(e){return y.driver.buildTableName(e.TABLE_NAME,void 0,e.TABLE_SCHEMA)===p&&e.COLUMN_NAME===u.name})),u.zerofill=-1!==e.COLUMN_TYPE.indexOf("zerofill"),u.unsigned=!!u.zerofill||-1!==e.COLUMN_TYPE.indexOf("unsigned"),u.isGenerated=-1!==e.EXTRA.indexOf("auto_increment"),u.isGenerated&&(u.generationStrategy="increment"),u.comment=e.COLUMN_COMMENT,e.CHARACTER_SET_NAME&&(u.charset=e.CHARACTER_SET_NAME===l?void 0:e.CHARACTER_SET_NAME),e.COLLATION_NAME&&(u.collation=e.COLLATION_NAME===a?void 0:e.COLLATION_NAME),-1!==y.driver.withLengthColumnTypes.indexOf(u.type)&&e.CHARACTER_MAXIMUM_LENGTH){var h=e.CHARACTER_MAXIMUM_LENGTH.toString();u.length=y.isDefaultColumnLength(n,u,h)?"":h}if("decimal"!==u.type&&"double"!==u.type&&"float"!==u.type||(null===e.NUMERIC_PRECISION||y.isDefaultColumnPrecision(n,u,e.NUMERIC_PRECISION)||(u.precision=parseInt(e.NUMERIC_PRECISION)),null===e.NUMERIC_SCALE||y.isDefaultColumnScale(n,u,e.NUMERIC_SCALE)||(u.scale=parseInt(e.NUMERIC_SCALE))),"enum"===u.type||"simple-enum"===u.type){var f=e.COLUMN_TYPE,d=f.substring(f.indexOf("(")+1,f.indexOf(")")).split(",");u.enum=d.map((function(e){return e.substring(1,e.length-1)})),u.length=""}return"datetime"!==u.type&&"time"!==u.type&&"timestamp"!==u.type||null===e.DATETIME_PRECISION||void 0===e.DATETIME_PRECISION||y.isDefaultColumnPrecision(n,u,parseInt(e.DATETIME_PRECISION))||(u.precision=parseInt(e.DATETIME_PRECISION)),u})),d=f.a.uniq(N.filter((function(e){return y.driver.buildTableName(e.TABLE_NAME,void 0,e.TABLE_SCHEMA)===p})),(function(e){return e.CONSTRAINT_NAME})),n.foreignKeys=d.map((function(e){var n=N.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME})),r=e.REFERENCED_TABLE_SCHEMA===t?void 0:e.REFERENCED_TABLE_SCHEMA,i=y.driver.buildTableName(e.REFERENCED_TABLE_NAME,void 0,r);return new u.a({name:e.CONSTRAINT_NAME,columnNames:n.map((function(e){return e.COLUMN_NAME})),referencedTableName:i,referencedColumnNames:n.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:e.ON_DELETE,onUpdate:e.ON_UPDATE})})),m=f.a.uniq(T.filter((function(e){return y.driver.buildTableName(e.TABLE_NAME,void 0,e.TABLE_SCHEMA)===p})),(function(e){return e.INDEX_NAME})),n.indices=m.map((function(e){var t=T.filter((function(t){return t.TABLE_SCHEMA===e.TABLE_SCHEMA&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME})),r=parseInt(e.NON_UNIQUE,10);return new c.a({table:n,name:e.INDEX_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),isUnique:0===r,isSpatial:"SPATIAL"===e.INDEX_TYPE,isFulltext:"FULLTEXT"===e.INDEX_TYPE})})),[2,n]}))}))})))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(e){return n.buildCreateColumnSql(e,!0)})).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){var r=e.indices.some((function(e){return 1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name)})),i=e.uniques.some((function(e){return 1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)}));r||i||e.indices.push(new c.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name],isUnique:!0}))})),e.uniques.length>0&&e.uniques.forEach((function(t){e.indices.some((function(e){return e.name===t.name}))||e.indices.push(new c.a({name:t.name,columnNames:t.columnNames,isUnique:!0}))})),e.indices.length>0)&&(i+=", "+e.indices.map((function(t){var r=t.columnNames.map((function(e){return"`"+e+"`"})).join(", ");t.name||(t.name=n.connection.namingStrategy.indexName(e.name,t.columnNames,t.where));var i="";return t.isUnique&&(i+="UNIQUE "),t.isSpatial&&(i+="SPATIAL "),t.isFulltext&&(i+="FULLTEXT "),i+"INDEX `"+t.name+"` ("+r+")"})).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return"`"+e+"`"})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames));var i=t.referencedColumnNames.map((function(e){return"`"+e+"`"})).join(", "),a="CONSTRAINT `"+t.name+"` FOREIGN KEY ("+r+") REFERENCES "+n.escapePath(t.referencedTableName)+" ("+i+")";return t.onDelete&&(a+=" ON DELETE "+t.onDelete),t.onUpdate&&(a+=" ON UPDATE "+t.onUpdate),a})).join(", "));e.primaryColumns.length>0&&(i+=", PRIMARY KEY ("+e.primaryColumns.map((function(e){return"`"+e.name+"`"})).join(", ")+")");return i+=") ENGINE="+(e.engine||"InnoDB"),new p.a(i)},t.prototype.dropTableSql=function(e){return new p.a("DROP TABLE "+this.escapePath(e))},t.prototype.createViewSql=function(e){return"string"===typeof e.expression?new p.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression):new p.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o;return r.d(this,(function(s){switch(s.label){case 0:return[4,this.getCurrentDatabase()];case 1:return t=s.sent(),n="string"===typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),i=r.e(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",schema:t,name:e.name,value:n}).getQueryAndParameters(),2),a=i[0],o=i[1],[2,new p.a(a,o)]}}))}))},t.prototype.dropViewSql=function(e){return new p.a("DROP VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(u){switch(u.label){case 0:return[4,this.getCurrentDatabase()];case 1:return t=u.sent(),n=e instanceof h.a?e.name:e,i=this.connection.createQueryBuilder(),a=r.e(i.delete().from(this.getTypeormMetadataTableName()).where(i.escape("type")+" = 'VIEW'").andWhere(i.escape("schema")+" = :schema",{schema:t}).andWhere(i.escape("name")+" = :name",{name:n}).getQueryAndParameters(),2),o=a[0],s=a[1],[2,new p.a(o,s)]}}))}))},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return"`"+e+"`"})).join(", "),r="";return t.isUnique&&(r+="UNIQUE "),t.isSpatial&&(r+="SPATIAL "),t.isFulltext&&(r+="FULLTEXT "),new p.a("CREATE "+r+"INDEX `"+t.name+"` ON "+this.escapePath(e)+" ("+n+")")},t.prototype.dropIndexSql=function(e,t){var n=t instanceof c.a?t.name:t;return new p.a("DROP INDEX `"+n+"` ON "+this.escapePath(e))},t.prototype.createPrimaryKeySql=function(e,t){var n=t.map((function(e){return"`"+e+"`"})).join(", ");return new p.a("ALTER TABLE "+this.escapePath(e)+" ADD PRIMARY KEY ("+n+")")},t.prototype.dropPrimaryKeySql=function(e){return new p.a("ALTER TABLE "+this.escapePath(e)+" DROP PRIMARY KEY")},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return"`"+e+"`"})).join(", "),r=t.referencedColumnNames.map((function(e){return"`"+e+"`"})).join(","),i="ALTER TABLE "+this.escapePath(e)+" ADD CONSTRAINT `"+t.name+"` FOREIGN KEY ("+n+") REFERENCES "+this.escapePath(t.referencedTableName)+"("+r+")";return t.onDelete&&(i+=" ON DELETE "+t.onDelete),t.onUpdate&&(i+=" ON UPDATE "+t.onUpdate),new p.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof u.a?t.name:t;return new p.a("ALTER TABLE "+this.escapePath(e)+" DROP FOREIGN KEY `"+n+"`")},t.prototype.parseTableName=function(e){var t=e instanceof s.a?e.name:e;return{database:-1!==t.indexOf(".")?t.split(".")[0]:this.driver.database,tableName:-1!==t.indexOf(".")?t.split(".")[1]:t}},t.prototype.escapePath=function(e,t){return(e instanceof s.a||e instanceof h.a?e.name:e).split(".").map((function(e){return t?e:"`"+e+"`"})).join(".")},t.prototype.buildCreateColumnSql=function(e,t,n){void 0===n&&(n=!1);var r="";return r=n?this.connection.driver.createFullType(e):"`"+e.name+"` "+this.connection.driver.createFullType(e),e.asExpression&&(r+=" AS ("+e.asExpression+") "+(e.generatedType?e.generatedType:"VIRTUAL")),e.zerofill?r+=" ZEROFILL":e.unsigned&&(r+=" UNSIGNED"),e.enum&&(r+=" ("+e.enum.map((function(e){return"'"+e+"'"})).join(", ")+")"),e.charset&&(r+=' CHARACTER SET "'+e.charset+'"'),e.collation&&(r+=' COLLATE "'+e.collation+'"'),e.isNullable||(r+=" NOT NULL"),e.isNullable&&(r+=" NULL"),e.isPrimary&&!t&&(r+=" PRIMARY KEY"),e.isGenerated&&"increment"===e.generationStrategy&&(r+=" AUTO_INCREMENT"),e.comment&&(r+=" COMMENT '"+e.comment+"'"),void 0!==e.default&&null!==e.default&&(r+=" DEFAULT "+e.default),e.onUpdate&&(r+=" ON UPDATE "+e.onUpdate),r},t}(m.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return b}));var r=n(0),i=n(17),a=n(36),o=n(27),s=n(14),u=n(43),c=n(2),l=n(22),h=n(8),p=n(15),f=n(13),d=n(10),m=n(18),y=n(25),v=n(6),g=n(1),b=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.queryResponsibilityChain=[],r.driver=t,r.connection=t.connection,r.broadcaster=new y.a(r),r.mode=n,r}return r.c(t,e),t.prototype.connect=function(){return r.b(this,void 0,void 0,(function(){var e;return r.d(this,(function(t){switch(t.label){case 0:return this.databaseConnection?[2,this.databaseConnection]:(e=this,[4,this.driver.obtainMasterConnection()]);case 1:return e.databaseConnection=t.sent(),[2,this.databaseConnection]}}))}))},t.prototype.release=function(){return this.isReleased=!0,this.databaseConnection?this.driver.master.release(this.databaseConnection):Promise.resolve()},t.prototype.startTransaction=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:if(this.isReleased)throw new i.a;if(this.isTransactionActive)throw new a.a;return this.isTransactionActive=!0,e?[4,this.query("SET TRANSACTION ISOLATION LEVEL "+(e||""))]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(this.isReleased)throw new i.a;if(!this.isTransactionActive)throw new o.a;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(this.isReleased)throw new i.a;if(!this.isTransactionActive)throw new o.a;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.query=function(e,t){return r.b(this,void 0,void 0,(function(){var n,a,o,u,c=this;return r.d(this,(function(l){switch(l.label){case 0:if(this.isReleased)throw new i.a;return a=new Promise((function(e){return n=e})),this.queryResponsibilityChain.length?(o=r.f(this.queryResponsibilityChain),this.queryResponsibilityChain.push(a),[4,Promise.all(o)]):[3,2];case 1:l.sent(),l.label=2;case 2:return u=new Promise((function(i,o){return r.b(c,void 0,void 0,(function(){var c,l,h,p,f=this;return r.d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,this.connect()];case 1:return(c=r.sent()).setAutoCommit(!this.isTransactionActive),this.driver.connection.logger.logQuery(e,t,this),l=+new Date,h="INSERT INTO"===e.substr(0,11),c.prepare(e).exec(t,(function(r,p){var d=f.driver.connection.options.maxQueryExecutionTime,m=+new Date-l;d&&m>d&&f.driver.connection.logger.logQuerySlow(m,e,t,f);var y=function(){-1!==v&&f.queryResponsibilityChain.splice(v,1),-1!==g&&f.queryResponsibilityChain.splice(g,1),n()},v=f.queryResponsibilityChain.indexOf(u),g=f.queryResponsibilityChain.indexOf(a);if(r)return f.driver.connection.logger.logQueryError(r,e,t,f),y(),o(new s.d(e,t,r));if(h){var b='SELECT CURRENT_IDENTITY_VALUE() FROM "SYS"."DUMMY"';f.driver.connection.logger.logQuery(b,[],f),c.exec(b,(function(e,t){if(e)return f.driver.connection.logger.logQueryError(e,b,[],f),y(),void o(new s.d(b,[],e));i(t[0]["CURRENT_IDENTITY_VALUE()"]),y()}))}else i(p),y()})),[3,3];case 2:return p=r.sent(),o(p),[3,3];case 3:return[2]}}))}))})),this.queryResponsibilityChain.push(u),[2,u]}}))}))},t.prototype.stream=function(e,t,n,i){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Stream is not supported by SAP driver.")}))}))},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query('SELECT DATABASE_NAME FROM "SYS"."M_DATABASES"')];case 1:return[2,e.sent().map((function(e){return e.DATABASE_NAME}))]}}))}))},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,(function(){var t;return r.d(this,(function(n){switch(n.label){case 0:return t=e?'SELECT * FROM "'+e+'"."SYS"."SCHEMAS"':'SELECT * FROM "SYS"."SCHEMAS"',[4,this.query(t)];case 1:return[2,n.sent().map((function(e){return e.SCHEMA_NAME}))]}}))}))},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.getDatabases()];case 1:return[2,-1!==t.sent().indexOf(e)]}}))}))},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.getSchemas()];case 1:return[2,-1!==t.sent().indexOf(e)]}}))}))},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return t=this.parseTableName(e),n='SELECT * FROM "SYS"."TABLES" WHERE "SCHEMA_NAME" = '+t.schema+' AND "TABLE_NAME" = '+t.tableName,[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=this.parseTableName(e),i='SELECT * FROM "SYS"."TABLE_COLUMNS" WHERE "SCHEMA_NAME" = '+n.schema+' AND "TABLE_NAME" = '+n.tableName+' AND "COLUMN_NAME" = \''+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return n=!1,t?[4,this.query('SELECT * FROM "SYS"."SCHEMAS" WHERE "SCHEMA_NAME" = \''+e+"'")]:[3,2];case 1:i=r.sent(),n=!!i.length,r.label=2;case 2:return!t||t&&!n?(a='CREATE SCHEMA "'+e+'"',o='DROP SCHEMA "'+e+'" CASCADE',[4,this.executeQueries(new g.a(a),new g.a(o))]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},t.prototype.dropSchema=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s,u;return r.d(this,(function(r){switch(r.label){case 0:return i=-1===e.indexOf(".")?e:e.split(".")[0],a=!1,t?[4,this.query('SELECT * FROM "SYS"."SCHEMAS" WHERE "SCHEMA_NAME" = \''+i+"'")]:[3,2];case 1:o=r.sent(),a=!!o.length,r.label=2;case 2:return!t||t&&a?(s='DROP SCHEMA "'+i+'" '+(n?"CASCADE":""),u='CREATE SCHEMA "'+i+'"',[4,this.executeQueries(new g.a(s),new g.a(u))]):[3,4];case 3:r.sent(),r.label=4;case 4:return[2]}}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((function(t){return o.push(s.dropForeignKeySql(e,t))})),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(e,t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s,u,l,h=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof c.a?(s=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:s=r.sent(),r.label=5;case 5:return o=s,u=[],l=[],i&&o.indices.forEach((function(e){u.push(h.dropIndexSql(o,e)),l.push(h.createIndexSql(o,e))})),n&&o.foreignKeys.forEach((function(e){return u.push(h.dropForeignKeySql(o,e))})),u.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(u,l)];case 6:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),a=(i=t).push,[4,this.insertViewDefinitionSql(e)];case 1:return a.apply(i,[r.sent()]),n.push(this.dropViewSql(e)),s=(o=n).push,[4,this.deleteViewDefinitionSql(e)];case 2:return s.apply(o,[r.sent()]),[4,this.executeQueries(t,n)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof m.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],s=(o=i=[]).push,[4,this.deleteViewDefinitionSql(n)];case 2:return s.apply(o,[r.sent()]),i.push(this.dropViewSql(n)),c=(u=a).push,[4,this.insertViewDefinitionSql(n)];case 3:return c.apply(u,[r.sent()]),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 4:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,h,f,d,m,y,v,b,E,T=this;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],e instanceof c.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return s=(a=o).clone(),u=-1===a.name.indexOf(".")?a.name:a.name.split(".")[1],l=-1===a.name.indexOf(".")?void 0:a.name.split(".")[0],s.name=l?l+"."+t:t,n.push(new g.a("RENAME TABLE "+this.escapePath(a.name)+" TO "+this.escapePath(t))),i.push(new g.a("RENAME TABLE "+this.escapePath(s.name)+" TO "+this.escapePath(u))),s.foreignKeys.forEach((function(e){n.push(T.dropForeignKeySql(s,e)),i.push(T.createForeignKeySql(s,e))})),h='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = \''+l+"' AND \"REFERENCED_TABLE_NAME\" = '"+u+"'",[4,this.query(h)];case 4:return f=r.sent(),d=[],m=[],f.length>0&&(d=f.map((function(e){var t=f.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return m.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),referencedTableName:s.name,referencedColumnNames:t.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})}))).forEach((function(e){var t=m.find((function(t){return t.fkName===e.name}));n.push(T.dropForeignKeySql(t.tableName,e)),i.push(T.createForeignKeySql(t.tableName,e))})),s.primaryColumns.length>0&&(y=s.primaryColumns.map((function(e){return e.name})),v=y.map((function(e){return'"'+e+'"'})).join(", "),b=this.connection.namingStrategy.primaryKeyName(a,y),E=this.connection.namingStrategy.primaryKeyName(s,y),n.push(new g.a("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+b+'"')),i.push(new g.a("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+b+'" PRIMARY KEY ('+v+")")),n.push(new g.a("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+E+'" PRIMARY KEY ('+v+")")),i.push(new g.a("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+E+'"'))),s.foreignKeys.forEach((function(e){e.name=T.connection.namingStrategy.foreignKeyName(s,e.columnNames,e.referencedTableName,e.referencedColumnNames),n.push(T.createForeignKeySql(s,e)),i.push(T.dropForeignKeySql(s,e))})),d.forEach((function(e){var t=m.find((function(t){return t.fkName===e.name}));n.push(T.createForeignKeySql(t.tableName,e)),i.push(T.dropForeignKeySql(t.tableName,e))})),s.indices.forEach((function(e){var t=T.connection.namingStrategy.indexName(s,e.columnNames,e.where);n.push(T.dropIndexSql(s,e)),i.push(T.createIndexSql(s,e)),e.name=t,n.push(T.createIndexSql(s,e)),i.push(T.dropIndexSql(s,e))})),[4,this.executeQueries(n,i)];case 5:return r.sent(),a.name=s.name,this.replaceCachedTable(a,s),[2]}}))}))},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,h,m,y,v,b,E,T,N,w,A,C=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=this.parseTableName(n),o=n.clone(),u=[],(s=[]).push(new g.a(this.addColumnSql(n,t))),u.push(new g.a(this.dropColumnSql(n,t))),t.isPrimary?(l=o.primaryColumns).length>0?(h='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+a.schema+' AND "REFERENCED_TABLE_NAME" = '+a.tableName,[4,this.query(h)]):[3,5]:[3,6];case 4:m=r.sent(),y=[],v=[],m.length>0&&(y=m.map((function(e){var t=m.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return v.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),referencedTableName:n.name,referencedColumnNames:t.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})}))).forEach((function(e){var t=v.find((function(t){return t.fkName===e.name}));s.push(C.dropForeignKeySql(t.tableName,e)),u.push(C.createForeignKeySql(t.tableName,e))})),b=this.connection.namingStrategy.primaryKeyName(o.name,l.map((function(e){return e.name}))),E=l.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new g.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+b+'"')),u.push(new g.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+b+'" PRIMARY KEY ('+E+")")),y.forEach((function(e){var t=v.find((function(t){return t.fkName===e.name}));s.push(C.createForeignKeySql(t.tableName,e)),u.push(C.dropForeignKeySql(t.tableName,e))})),r.label=5;case 5:l.push(t),T=this.connection.namingStrategy.primaryKeyName(o.name,l.map((function(e){return e.name}))),N=l.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new g.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+T+'" PRIMARY KEY ('+N+")")),u.push(new g.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+T+'"')),r.label=6;case 6:return(w=o.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))?(s.push(this.createIndexSql(n,w)),u.push(this.dropIndexSql(n,w))):t.isUnique&&(A=new f.a({name:this.connection.namingStrategy.indexName(n.name,[t.name]),columnNames:[t.name],isUnique:!0}),o.indices.push(A),o.uniques.push(new d.a({name:A.name,columnNames:A.columnNames})),s.push(this.createIndexSql(n,A)),u.push(this.dropIndexSql(n,A))),[4,this.executeQueries(s,u)];case 7:return r.sent(),o.addColumn(t),this.replaceCachedTable(n,o),[2]}}))}))},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,s.c.runInSequence(t,(function(t){return n.addColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(o=t instanceof h.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return s=void 0,n instanceof h.a?s=n:(s=o.clone()).name=n,[4,this.changeColumn(i,o,s)];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,o,s,u,l,p,m,y,v,b,E,T,N,w,A,C,S=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(o=(i=a).clone(),s=[],u=[],!(l=t instanceof h.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n.isGenerated!==l.isGenerated&&"uuid"!==n.generationStrategy||n.type!==l.type||n.length!==l.length?[4,this.dropColumn(i,l)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),o=i.clone(),[3,8];case 6:return n.name!==l.name&&(s.push(new g.a("RENAME COLUMN "+this.escapePath(i)+'."'+l.name+'" TO "'+n.name+'"')),u.push(new g.a("RENAME COLUMN "+this.escapePath(i)+'."'+n.name+'" TO "'+l.name+'"')),!0===l.isPrimary&&(b=o.primaryColumns,N=b.map((function(e){return e.name})),p=this.connection.namingStrategy.primaryKeyName(o,N),N.splice(N.indexOf(l.name),1),N.push(n.name),m=N.map((function(e){return'"'+e+'"'})).join(", "),s.push(new g.a("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+p+'"')),u.push(new g.a("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+p+'" PRIMARY KEY ('+m+")")),y=this.connection.namingStrategy.primaryKeyName(o,N),s.push(new g.a("ALTER TABLE "+this.escapePath(o)+' ADD CONSTRAINT "'+y+'" PRIMARY KEY ('+m+")")),u.push(new g.a("ALTER TABLE "+this.escapePath(o)+' DROP CONSTRAINT "'+y+'"'))),o.findColumnIndices(l).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.indexName(o,e.columnNames,e.where);s.push(S.dropIndexSql(o,e)),u.push(S.createIndexSql(o,e)),e.name=t,s.push(S.createIndexSql(o,e)),u.push(S.dropIndexSql(o,e))})),o.findColumnForeignKeys(l).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.foreignKeyName(o,e.columnNames,e.referencedTableName,e.referencedColumnNames);s.push(S.dropForeignKeySql(o,e)),u.push(S.createForeignKeySql(o,e)),e.name=t,s.push(S.createForeignKeySql(o,e)),u.push(S.dropForeignKeySql(o,e))})),o.findColumnChecks(l).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(l.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.checkConstraintName(o,e.expression);s.push(S.dropCheckConstraintSql(o,e)),u.push(S.createCheckConstraintSql(o,e)),e.name=t,s.push(S.createCheckConstraintSql(o,e)),u.push(S.dropCheckConstraintSql(o,e))})),v=o.columns.find((function(e){return e.name===l.name})),o.columns[o.columns.indexOf(v)].name=n.name,l.name=n.name),this.isColumnChanged(l,n)&&(s.push(new g.a("ALTER TABLE "+this.escapePath(i)+" ALTER ("+this.buildCreateColumnSql(n)+")")),u.push(new g.a("ALTER TABLE "+this.escapePath(i)+" ALTER ("+this.buildCreateColumnSql(l)+")"))),n.isPrimary!==l.isPrimary&&((b=o.primaryColumns).length>0&&(T=this.connection.namingStrategy.primaryKeyName(o.name,b.map((function(e){return e.name}))),N=b.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new g.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+T+'"')),u.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+T+'" PRIMARY KEY ('+N+")"))),!0===n.isPrimary?(b.push(n),o.columns.find((function(e){return e.name===n.name})).isPrimary=!0,T=this.connection.namingStrategy.primaryKeyName(o.name,b.map((function(e){return e.name}))),N=b.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+T+'" PRIMARY KEY ('+N+")")),u.push(new g.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+T+'"'))):(E=b.find((function(e){return e.name===n.name})),b.splice(b.indexOf(E),1),o.columns.find((function(e){return e.name===n.name})).isPrimary=!1,b.length>0&&(T=this.connection.namingStrategy.primaryKeyName(o.name,b.map((function(e){return e.name}))),N=b.map((function(e){return'"'+e.name+'"'})).join(", "),s.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ADD CONSTRAINT "'+T+'" PRIMARY KEY ('+N+")")),u.push(new g.a("ALTER TABLE "+this.escapePath(i)+' DROP CONSTRAINT "'+T+'"'))))),n.isUnique!==l.isUnique&&(!0===n.isUnique?(w=new f.a({name:this.connection.namingStrategy.indexName(i.name,[n.name]),columnNames:[n.name],isUnique:!0}),o.indices.push(w),o.uniques.push(new d.a({name:w.name,columnNames:w.columnNames})),s.push(this.createIndexSql(i,w)),u.push(this.dropIndexSql(i,w))):(A=o.indices.find((function(e){return 1===e.columnNames.length&&!0===e.isUnique&&!!e.columnNames.find((function(e){return e===n.name}))})),o.indices.splice(o.indices.indexOf(A),1),C=o.uniques.find((function(e){return e.name===A.name})),o.uniques.splice(o.uniques.indexOf(C),1),s.push(this.dropIndexSql(i,A)),u.push(this.createIndexSql(i,A)))),n.default!==l.default&&(null!==n.default&&void 0!==n.default?(s.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+n.name+'" '+this.connection.driver.createFullType(n)+" DEFAULT "+n.default+")")),null!==l.default&&void 0!==l.default?u.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+l.name+'" '+this.connection.driver.createFullType(l)+" DEFAULT "+l.default+")")):u.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+l.name+'" '+this.connection.driver.createFullType(l)+" DEFAULT NULL)"))):null!==l.default&&void 0!==l.default&&(s.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+n.name+'" '+this.connection.driver.createFullType(n)+" DEFAULT NULL)")),u.push(new g.a("ALTER TABLE "+this.escapePath(i)+' ALTER ("'+l.name+'" '+this.connection.driver.createFullType(l)+" DEFAULT "+l.default+")")))),[4,this.executeQueries(s,u)];case 7:r.sent(),this.replaceCachedTable(i,o),r.label=8;case 8:return[2]}}))}))},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,s.c.runInSequence(t,(function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,f,d,m,y,v,b,E,T,N,w,A,C,S,R,M=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,a=this.parseTableName(n),!(o=t instanceof h.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return s=n.clone(),u=[],l=[],o.isPrimary?(f='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+a.schema+' AND "REFERENCED_TABLE_NAME" = '+a.tableName,[4,this.query(f)]):[3,5];case 4:d=r.sent(),m=[],y=[],d.length>0&&(m=d.map((function(e){var t=d.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return y.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),referencedTableName:n.name,referencedColumnNames:t.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})}))).forEach((function(e){var t=y.find((function(t){return t.fkName===e.name}));u.push(M.dropForeignKeySql(t.tableName,e)),l.push(M.createForeignKeySql(t.tableName,e))})),v=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map((function(e){return e.name}))),b=s.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new g.a("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+v+'"')),l.push(new g.a("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+b+")")),s.findColumnByName(o.name).isPrimary=!1,s.primaryColumns.length>0&&(E=this.connection.namingStrategy.primaryKeyName(s.name,s.primaryColumns.map((function(e){return e.name}))),T=s.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new g.a("ALTER TABLE "+this.escapePath(s)+' ADD CONSTRAINT "'+E+'" PRIMARY KEY ('+T+")")),l.push(new g.a("ALTER TABLE "+this.escapePath(s)+' DROP CONSTRAINT "'+E+'"'))),m.forEach((function(e){var t=y.find((function(t){return t.fkName===e.name}));u.push(M.createForeignKeySql(t.tableName,e)),l.push(M.dropForeignKeySql(t.tableName,e))})),r.label=5;case 5:return(N=s.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===o.name})))?(s.indices.splice(s.indices.indexOf(N),1),u.push(this.dropIndexSql(n,N)),l.push(this.createIndexSql(n,N))):o.isUnique&&(w=this.connection.namingStrategy.uniqueConstraintName(n.name,[o.name]),(A=s.uniques.find((function(e){return e.name===w})))&&(s.uniques.splice(s.uniques.indexOf(A),1),u.push(this.dropIndexSql(n,w)),l.push(new g.a('CREATE UNIQUE INDEX "'+w+'" ON '+this.escapePath(n)+' ("'+o.name+'")'))),C=this.connection.namingStrategy.indexName(n.name,[o.name]),(S=s.indices.find((function(e){return e.name===C})))&&(s.indices.splice(s.indices.indexOf(S),1),u.push(this.dropIndexSql(n,C)),l.push(new g.a('CREATE UNIQUE INDEX "'+C+'" ON '+this.escapePath(n)+' ("'+o.name+'")')))),(R=s.checks.find((function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===o.name})))&&(s.checks.splice(s.checks.indexOf(R),1),u.push(this.dropCheckConstraintSql(n,R)),l.push(this.createCheckConstraintSql(n,R))),u.push(new g.a(this.dropColumnSql(n,o))),l.push(new g.a(this.addColumnSql(n,o))),[4,this.executeQueries(u,l)];case 6:return r.sent(),s.removeColumn(o),this.replaceCachedTable(n,s),[2]}}))}))},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,s.c.runInSequence(t,(function(t){return n.dropColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),s=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,s)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s,u,l,h,f,d,m,y,v,b,E,T,N=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=this.parseTableName(n),o=n.clone(),s=t.map((function(e){return e.name})),u=[],l=[],h='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+a.schema+' AND "REFERENCED_TABLE_NAME" = '+a.tableName,[4,this.query(h)];case 4:return f=r.sent(),d=[],m=[],f.length>0&&(d=f.map((function(e){var t=f.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return m.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),referencedTableName:n.name,referencedColumnNames:t.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})}))).forEach((function(e){var t=m.find((function(t){return t.fkName===e.name}));u.push(N.dropForeignKeySql(t.tableName,e)),l.push(N.createForeignKeySql(t.tableName,e))})),(y=o.primaryColumns).length>0&&(v=this.connection.namingStrategy.primaryKeyName(o.name,y.map((function(e){return e.name}))),b=y.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new g.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+v+'"')),l.push(new g.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+v+'" PRIMARY KEY ('+b+")"))),o.columns.filter((function(e){return-1!==s.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),E=this.connection.namingStrategy.primaryKeyName(o.name,s),T=s.map((function(e){return'"'+e+'"'})).join(", "),u.push(new g.a("ALTER TABLE "+this.escapePath(n)+' ADD CONSTRAINT "'+E+'" PRIMARY KEY ('+T+")")),l.push(new g.a("ALTER TABLE "+this.escapePath(n)+' DROP CONSTRAINT "'+E+'"')),d.forEach((function(e){var t=m.find((function(t){return t.fkName===e.name}));u.push(N.createForeignKeySql(t.tableName,e)),l.push(N.dropForeignKeySql(t.tableName,e))})),[4,this.executeQueries(u,l)];case 5:return r.sent(),this.replaceCachedTable(n,o),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,l,h,f=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.parseTableName(t),a=[],o=[],s='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE "REFERENCED_SCHEMA_NAME" = '+i.schema+' AND "REFERENCED_TABLE_NAME" = '+i.tableName,[4,this.query(s)];case 4:return u=r.sent(),l=[],h=[],u.length>0&&(l=u.map((function(e){var n=u.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return h.push({tableName:e.SCHEMA_NAME+"."+e.TABLE_NAME,fkName:e.CONSTRAINT_NAME}),new p.a({name:e.CONSTRAINT_NAME,columnNames:n.map((function(e){return e.COLUMN_NAME})),referencedTableName:t.name,referencedColumnNames:n.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})}))).forEach((function(e){var t=h.find((function(t){return t.fkName===e.name}));a.push(f.dropForeignKeySql(t.tableName,e)),o.push(f.createForeignKeySql(t.tableName,e))})),a.push(this.dropPrimaryKeySql(t)),o.push(this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name})))),l.forEach((function(e){var t=h.find((function(t){return t.fkName===e.name}));a.push(f.createForeignKeySql(t.tableName,e)),o.push(f.dropForeignKeySql(t.tableName,e))})),[4,this.executeQueries(a,o)];case 5:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support unique constraints. Use unique index instead.")}))}))},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support unique constraints. Use unique index instead.")}))}))},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support unique constraints. Use unique index instead.")}))}))},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support unique constraints. Use unique index instead.")}))}))},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof l.a?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),s=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("SAP HANA does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof p.a?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),s=this.createForeignKeySql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,s;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof c.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof f.a?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(n,a),s=this.createIndexSql(n,a),[4,this.executeQueries(o,s)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query("TRUNCATE TABLE "+this.escapePath(e))];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i,a,o=this;return r.d(this,(function(r){switch(r.label){case 0:return e=[],this.connection.entityMetadatas.filter((function(e){return e.schema})).forEach((function(t){!!e.find((function(e){return e===t.schema}))||e.push(t.schema)})),e.push(this.driver.options.schema||"current_schema"),t=e.map((function(e){return"current_schema"===e?e:"'"+e+"'"})).join(", "),[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,6,,11]),n='SELECT \'DROP TABLE "\' || schema_name || \'"."\' || table_name || \'" CASCADE;\' as "query" FROM "SYS"."TABLES" WHERE "SCHEMA_NAME" IN ('+t+") AND \"TABLE_NAME\" NOT IN ('SYS_AFL_GENERATOR_PARAMETERS') AND \"IS_COLUMN_TABLE\" = 'TRUE'",[4,this.query(n)];case 3:return i=r.sent(),[4,Promise.all(i.map((function(e){return o.query(e.query)})))];case 4:return r.sent(),[4,this.commitTransaction()];case 5:return r.sent(),[3,11];case 6:a=r.sent(),r.label=7;case 7:return r.trys.push([7,9,,10]),[4,this.rollbackTransaction()];case 8:return r.sent(),[3,10];case 9:return r.sent(),[3,10];case 10:throw a;case 11:return[2]}}))}))},t.prototype.getCurrentDatabase=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query('SELECT "VALUE" AS "db_name" FROM "SYS"."M_SYSTEM_OVERVIEW" WHERE "SECTION" = \'System\' and "NAME" = \'Instance ID\'')];case 1:return[2,e.sent()[0].db_name]}}))}))},t.prototype.getCurrentSchema=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:return[4,this.query('SELECT CURRENT_SCHEMA AS "schema_name" FROM "SYS"."DUMMY"')];case 1:return[2,e.sent()[0].schema_name]}}))}))},t.prototype.loadViews=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a=this;return r.d(this,(function(o){switch(o.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return o.sent()?[4,this.getCurrentSchema()]:[2,Promise.resolve([])];case 2:return t=o.sent(),n=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],o=n[1];return o||(o=i,i=a.driver.options.schema||t),'("t"."schema" = \''+i+'\' AND "t"."name" = \''+o+"')"})).join(" OR "),i='SELECT "t".* FROM '+this.escapePath(this.getTypeormMetadataTableName())+' "t" WHERE "t"."type" = \'VIEW\' '+(n?"AND ("+n+")":""),[4,this.query(i)];case 3:return[2,o.sent().map((function(e){var n=new m.a,r=e.schema!==t||a.driver.options.schema?e.schema:void 0;return n.name=a.driver.buildTableName(e.name,r),n.expression=e.value,n}))]}}))}))},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,d,m,y,g,b,E,T,N,w,A=this;return r.d(this,(function(C){switch(C.label){case 0:return e&&e.length?[4,this.getCurrentSchema()]:[2,[]];case 1:return t=C.sent(),n=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'("SCHEMA_NAME" = \''+i+"' AND \"TABLE_NAME\" = '"+a+"')"})).join(" OR "),i='SELECT * FROM "SYS"."TABLES" WHERE '+n,a='SELECT * FROM "SYS"."TABLE_COLUMNS" WHERE '+n+' ORDER BY "POSITION"',o=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'("SCHEMA_NAME" = \''+i+"' AND \"TABLE_NAME\" = '"+a+"')"})).join(" OR "),s='SELECT * FROM "SYS"."CONSTRAINTS" WHERE ('+o+') ORDER BY "POSITION"',u=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'("I"."SCHEMA_NAME" = \''+i+'\' AND "I"."TABLE_NAME" = \''+a+"')"})).join(" OR "),d='SELECT "I"."INDEX_TYPE", "I"."SCHEMA_NAME", "I"."TABLE_NAME", "I"."INDEX_NAME", "IC"."COLUMN_NAME", "I"."CONSTRAINT" FROM "SYS"."INDEXES" "I" INNER JOIN "SYS"."INDEX_COLUMNS" "IC" ON "IC"."INDEX_OID" = "I"."INDEX_OID" WHERE ('+u+') AND ("I"."CONSTRAINT" IS NULL OR "I"."CONSTRAINT" != \'PRIMARY KEY\') AND "I"."INDEX_NAME" NOT LIKE \'%_SYS_FULLTEXT_%\' ORDER BY "IC"."POSITION"',m=e.map((function(e){var n=r.e(e.split("."),2),i=n[0],a=n[1];return a||(a=i,i=A.driver.options.schema||t),'("SCHEMA_NAME" = \''+i+"' AND \"TABLE_NAME\" = '"+a+"')"})).join(" OR "),y='SELECT * FROM "SYS"."REFERENTIAL_CONSTRAINTS" WHERE ('+m+') ORDER BY "POSITION"',[4,Promise.all([this.query(i),this.query(a),this.query(s),this.query(d),this.query(y)])];case 2:return g=r.e.apply(void 0,[C.sent(),5]),b=g[0],E=g[1],T=g[2],N=g[3],w=g[4],b.length?[2,Promise.all(b.map((function(e){return r.b(A,void 0,void 0,(function(){var n,i,a,o,s,u,d,m=this;return r.d(this,(function(y){switch(y.label){case 0:return n=new c.a,i=e.SCHEMA_NAME!==t||this.driver.options.schema?e.SCHEMA_NAME:void 0,n.name=this.driver.buildTableName(e.TABLE_NAME,i),a=this.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME),o=n,[4,Promise.all(E.filter((function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a})).map((function(e){return r.b(m,void 0,void 0,(function(){var t,i,o,s,u,c,l,p=this;return r.d(this,(function(r){return t=T.filter((function(t){return p.driver.buildTableName(t.TABLE_NAME,t.SCHEMA_NAME)===a&&t.COLUMN_NAME===e.COLUMN_NAME})),i=N.find((function(t){return p.driver.buildTableName(t.TABLE_NAME,t.SCHEMA_NAME)===a&&(t.COLUMN_NAME===e.COLUMN_NAME&&(t.CONSTRAINT&&-1!==t.CONSTRAINT.indexOf("UNIQUE")))})),o=this.connection.entityMetadatas.find((function(e){return e.tablePath===n.name})),s=i&&o&&o.indices.some((function(e){return e.name===i.INDEX_NAME&&!1===e.synchronize})),u=!!i&&!!N.find((function(t){return t.INDEX_NAME===i.INDEX_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME})),(c=new h.a).name=e.COLUMN_NAME,c.type=e.DATA_TYPE_NAME.toLowerCase(),"dec"!==c.type&&"decimal"!==c.type||(null===e.LENGTH||this.isDefaultColumnPrecision(n,c,e.LENGTH)?null===e.SCALE||this.isDefaultColumnScale(n,c,e.SCALE)||(c.precision=void 0):c.precision=e.LENGTH,null===e.SCALE||this.isDefaultColumnScale(n,c,e.SCALE)?null===e.LENGTH||this.isDefaultColumnPrecision(n,c,e.LENGTH)||(c.scale=void 0):c.scale=e.SCALE),"array"===e.DATA_TYPE_NAME.toLowerCase()&&(c.isArray=!0,c.type=e.CS_DATA_TYPE_NAME.toLowerCase()),-1!==this.driver.withLengthColumnTypes.indexOf(c.type)&&e.LENGTH&&(l=e.LENGTH.toString(),c.length=this.isDefaultColumnLength(n,c,l)?"":l),c.isUnique=!!i&&!s&&!u,c.isNullable="TRUE"===e.IS_NULLABLE,c.isPrimary=!!t.find((function(e){return"TRUE"===e.IS_PRIMARY_KEY})),c.isGenerated="ALWAYS AS IDENTITY"===e.GENERATION_TYPE,c.isGenerated&&(c.generationStrategy="increment"),null===e.DEFAULT_VALUE||void 0===e.DEFAULT_VALUE?c.default=void 0:"char"===c.type||"nchar"===c.type||"varchar"===c.type||"nvarchar"===c.type||"alphanum"===c.type||"shorttext"===c.type?c.default="'"+e.DEFAULT_VALUE+"'":"boolean"===c.type?c.default="1"===e.DEFAULT_VALUE?"true":"false":c.default=e.DEFAULT_VALUE,c.comment="",e.character_set_name&&(c.charset=e.character_set_name),e.collation_name&&(c.collation=e.collation_name),[2,c]}))}))})))];case 1:return o.columns=y.sent(),s=v.a.uniq(T.filter((function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a&&null!==e.CHECK_CONDITION&&void 0!==e.CHECK_CONDITION})),(function(e){return e.CONSTRAINT_NAME})),n.checks=s.map((function(e){var t=T.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return new l.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),expression:e.CHECK_CONDITION})})),u=v.a.uniq(w.filter((function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a})),(function(e){return e.CONSTRAINT_NAME})),n.foreignKeys=u.map((function(e){var n=w.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME})),r=e.REFERENCED_SCHEMA_NAME===t?void 0:e.REFERENCED_SCHEMA_NAME,i=m.driver.buildTableName(e.REFERENCED_TABLE_NAME,r);return new p.a({name:e.CONSTRAINT_NAME,columnNames:n.map((function(e){return e.COLUMN_NAME})),referencedTableName:i,referencedColumnNames:n.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:"RESTRICT"===e.DELETE_RULE?"NO ACTION":e.DELETE_RULE,onUpdate:"RESTRICT"===e.UPDATE_RULE?"NO ACTION":e.UPDATE_RULE})})),d=v.a.uniq(N.filter((function(e){return m.driver.buildTableName(e.TABLE_NAME,e.SCHEMA_NAME)===a})),(function(e){return e.INDEX_NAME})),n.indices=d.map((function(e){var t=N.filter((function(t){return t.SCHEMA_NAME===e.SCHEMA_NAME&&t.TABLE_NAME===e.TABLE_NAME&&t.INDEX_NAME===e.INDEX_NAME}));return new f.a({table:n,name:e.INDEX_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),isUnique:e.CONSTRAINT&&-1!==e.CONSTRAINT.indexOf("UNIQUE"),isFulltext:"FULLTEXT"===e.INDEX_TYPE})})),[2,n]}}))}))})))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(e){return n.buildCreateColumnSql(e)})).join(", "),i="CREATE TABLE "+this.escapePath(e)+" ("+r;(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){var r=e.indices.some((function(e){return 1===e.columnNames.length&&!!e.isUnique&&-1!==e.columnNames.indexOf(t.name)})),i=e.uniques.some((function(e){return 1===e.columnNames.length&&-1!==e.columnNames.indexOf(t.name)}));r||i||e.indices.push(new f.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name],isUnique:!0}))})),e.uniques.length>0&&e.uniques.forEach((function(t){e.indices.some((function(e){return e.name===t.name}))||e.indices.push(new f.a({name:t.name,columnNames:t.columnNames,isUnique:!0}))})),e.checks.length>0)&&(i+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+") REFERENCES "+n.escapePath(t.referencedTableName)+" ("+i+")";t.onDelete&&(a+=" ON DELETE "+("NO ACTION"===t.onDelete?"RESTRICT":t.onDelete));t.onUpdate&&(a+=" ON UPDATE "+("NO ACTION"===t.onUpdate?"RESTRICT":t.onUpdate));return a})).join(", "));var a=e.columns.filter((function(e){return e.isPrimary}));a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map((function(e){return e.name})))+'" PRIMARY KEY ('+a.map((function(e){return'"'+e.name+'"'})).join(", ")+")");return i+=")",new g.a(i)},t.prototype.dropTableSql=function(e,t){var n=t?"DROP TABLE IF EXISTS "+this.escapePath(e):"DROP TABLE "+this.escapePath(e);return new g.a(n)},t.prototype.createViewSql=function(e){return"string"===typeof e.expression?new g.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression):new g.a("CREATE VIEW "+this.escapePath(e)+" AS "+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c;return r.d(this,(function(l){switch(l.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=l.sent(),n=e.name.split("."),i=this.driver.options.schema||t,a=e.name,2===n.length&&(i=n[0],a=n[1]),o="string"===typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),s=r.e(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",schema:i,name:a,value:o}).getQueryAndParameters(),2),u=s[0],c=s[1],[2,new g.a(u,c)]}}))}))},t.prototype.dropViewSql=function(e){return new g.a("DROP VIEW "+this.escapePath(e))},t.prototype.deleteViewDefinitionSql=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,o,s,u,c,l;return r.d(this,(function(h){switch(h.label){case 0:return[4,this.getCurrentSchema()];case 1:return t=h.sent(),n=e instanceof m.a?e.name:e,i=n.split("."),a=this.driver.options.schema||t,o=n,2===i.length&&(a=i[0],o=i[1]),s=this.connection.createQueryBuilder(),u=r.e(s.delete().from(this.getTypeormMetadataTableName()).where(s.escape("type")+" = 'VIEW'").andWhere(s.escape("schema")+" = :schema",{schema:a}).andWhere(s.escape("name")+" = :name",{name:o}).getQueryAndParameters(),2),c=u[0],l=u[1],[2,new g.a(c,l)]}}))}))},t.prototype.addColumnSql=function(e,t){return"ALTER TABLE "+this.escapePath(e)+" ADD ("+this.buildCreateColumnSql(t)+")"},t.prototype.dropColumnSql=function(e,t){return"ALTER TABLE "+this.escapePath(e)+' DROP ("'+t.name+'")'},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r="";return t.isUnique&&(r+="UNIQUE "),t.isFulltext&&(r+="FULLTEXT "),new g.a("CREATE "+r+'INDEX "'+t.name+'" ON '+this.escapePath(e)+" ("+n+") "+(t.where?"WHERE "+t.where:""))},t.prototype.dropIndexSql=function(e,t){var n=t instanceof f.a?t.name:t,r=this.parseTableName(e);return"current_schema"===r.schema?new g.a('DROP INDEX "'+n+'"'):new g.a('DROP INDEX "'+r.schema.replace(/'/g,"")+'"."'+n+'"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map((function(e){return'"'+e+'"'})).join(", ");return new g.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map((function(e){return e.name})),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new g.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new g.a("ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof l.a?t.name:t;return new g.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(","),i="ALTER TABLE "+this.escapePath(e)+' ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+") REFERENCES "+this.escapePath(t.referencedTableName)+"("+r+")";t.onDelete&&(i+=" ON DELETE "+("NO ACTION"===t.onDelete?"RESTRICT":t.onDelete));t.onUpdate&&(i+=" ON UPDATE "+("NO ACTION"===t.onUpdate?"RESTRICT":t.onUpdate));return new g.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof p.a?t.name:t;return new g.a("ALTER TABLE "+this.escapePath(e)+' DROP CONSTRAINT "'+n+'"')},t.prototype.escapePath=function(e,t){var n=e instanceof c.a||e instanceof m.a?e.name:e;return(n=-1===n.indexOf(".")&&this.driver.options.schema?this.driver.options.schema+"."+n:n).split(".").map((function(e){return t?e:'"'+e+'"'})).join(".")},t.prototype.parseTableName=function(e){var t=e instanceof c.a?e.name:e;return-1===t.indexOf(".")?{schema:this.driver.options.schema?"'"+this.driver.options.schema+"'":"current_schema",tableName:"'"+t+"'"}:{schema:"'"+t.split(".")[0]+"'",tableName:"'"+t.split(".")[1]+"'"}},t.prototype.buildForeignKeyName=function(e,t,n){var r=e;return t&&(r=t+"."+r),n&&(r=n+"."+r),r},t.prototype.removeParenthesisFromDefault=function(e){if("("!==e.substr(0,1))return e;var t=e.substr(1,e.lastIndexOf(")")-1);return this.removeParenthesisFromDefault(t)},t.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(t+=" GENERATED ALWAYS AS IDENTITY"),t},t}(u.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return E}));var r=n(0),i=n(36),a=n(27),o=n(8),s=n(2),u=n(15),c=n(13),l=n(17),h=n(18),p=n(1),f=n(28),d=n(10),m=n(25),y=n(43),v=n(6),g=n(22),b=n(14),E=function(e){function t(t,n){void 0===n&&(n="master");var r=e.call(this)||this;return r.driver=t,r.connection=t.connection,r.broadcaster=new m.a(r),r.mode=n,r}return r.c(t,e),t.prototype.connect=function(){var e=this;return this.databaseConnection?Promise.resolve(this.databaseConnection):(this.databaseConnectionPromise||("slave"===this.mode&&this.driver.isReplicated?this.databaseConnectionPromise=this.driver.obtainSlaveConnection().then((function(t){return e.databaseConnection=t,e.databaseConnection})):this.databaseConnectionPromise=this.driver.obtainMasterConnection().then((function(t){return e.databaseConnection=t,e.databaseConnection}))),this.databaseConnectionPromise)},t.prototype.release=function(){var e=this;return new Promise((function(t,n){e.isReleased=!0,e.databaseConnection?e.databaseConnection.close((function(e){if(e)return n(e);t()})):t()}))},t.prototype.startTransaction=function(e){return void 0===e&&(e="READ COMMITTED"),r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:if(this.isReleased)throw new l.a;if(this.isTransactionActive)throw new i.a;if("SERIALIZABLE"!==e&&"READ COMMITTED"!==e)throw new Error("Oracle only supports SERIALIZABLE and READ COMMITTED isolation");return[4,this.query("SET TRANSACTION ISOLATION LEVEL "+e)];case 1:return t.sent(),this.isTransactionActive=!0,[2]}}))}))},t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("COMMIT")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.rollbackTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){switch(e.label){case 0:if(!this.isTransactionActive)throw new a.a;return[4,this.query("ROLLBACK")];case 1:return e.sent(),this.isTransactionActive=!1,[2]}}))}))},t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new l.a;return new Promise((function(i,a){return r.b(n,void 0,void 0,(function(){var n,o,s,u,c=this;return r.d(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),this.driver.connection.logger.logQuery(e,t,this),n=+new Date,o=function(r,o){var s=c.driver.connection.options.maxQueryExecutionTime,u=+new Date-n;if(s&&u>s&&c.driver.connection.logger.logQuerySlow(u,e,t,c),r)return c.driver.connection.logger.logQueryError(r,e,t,c),a(new f.a(e,t,r));i(o.rows||o.outBinds||o.rowsAffected)},s={autoCommit:!this.isTransactionActive},[4,this.connect()];case 1:return r.sent().execute(e,t||{},s,o),[3,3];case 2:return u=r.sent(),a(u),[3,3];case 3:return[2]}}))}))}))},t.prototype.stream=function(e,t,n,r){throw new Error("Stream is not supported by Oracle driver.")},t.prototype.getDatabases=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.getSchemas=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve([])]}))}))},t.prototype.hasDatabase=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve(!1)]}))}))},t.prototype.hasSchema=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve(!1)]}))}))},t.prototype.hasTable=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof s.a?e.name:e,n='SELECT "TABLE_NAME" FROM "USER_TABLES" WHERE "TABLE_NAME" = \''+t+"'",[4,this.query(n)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.hasColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i;return r.d(this,(function(r){switch(r.label){case 0:return n=e instanceof s.a?e.name:e,i='SELECT "COLUMN_NAME" FROM "USER_TAB_COLS" WHERE "TABLE_NAME" = \''+n+"' AND \"COLUMN_NAME\" = '"+t+"'",[4,this.query(i)];case 1:return[2,!!r.sent().length]}}))}))},t.prototype.createDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query('CREATE DATABASE IF NOT EXISTS "'+e+'"')];case 1:return t.sent(),[2]}}))}))},t.prototype.dropDatabase=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){return[2,Promise.resolve()]}))}))},t.prototype.createSchema=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Schema create queries are not supported by Oracle driver.")}))}))},t.prototype.dropSchema=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Schema drop queries are not supported by Oracle driver.")}))}))},t.prototype.createTable=function(e,t,n,i){return void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,s=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(r.sent())return[2,Promise.resolve()];r.label=2;case 2:return o=[],(a=[]).push(this.createTableSql(e,n)),o.push(this.dropTableSql(e)),n&&e.foreignKeys.forEach((function(t){return o.push(s.dropForeignKeySql(e,t))})),i&&e.indices.forEach((function(t){t.name||(t.name=s.connection.namingStrategy.indexName(e.name,t.columnNames,t.where)),a.push(s.createIndexSql(e,t)),o.push(s.dropIndexSql(t))})),[4,this.executeQueries(a,o)];case 3:return r.sent(),[2]}}))}))},t.prototype.dropTable=function(e,t,n,i){return void 0===n&&(n=!0),void 0===i&&(i=!0),r.b(this,void 0,void 0,(function(){var a,o,u,c,l,h=this;return r.d(this,(function(r){switch(r.label){case 0:return t?[4,this.hasTable(e)]:[3,2];case 1:if(!r.sent())return[2,Promise.resolve()];r.label=2;case 2:return a=n,e instanceof s.a?(u=e,[3,5]):[3,3];case 3:return[4,this.getCachedTable(e)];case 4:u=r.sent(),r.label=5;case 5:return o=u,c=[],l=[],i&&o.indices.forEach((function(e){c.push(h.dropIndexSql(e)),l.push(h.createIndexSql(o,e))})),n&&o.foreignKeys.forEach((function(e){return c.push(h.dropForeignKeySql(o,e))})),c.push(this.dropTableSql(o)),l.push(this.createTableSql(o,a)),[4,this.executeQueries(c,l)];case 6:return r.sent(),[2]}}))}))},t.prototype.createView=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return n=[],(t=[]).push(this.createViewSql(e)),t.push(this.insertViewDefinitionSql(e)),n.push(this.dropViewSql(e)),n.push(this.deleteViewDefinitionSql(e)),[4,this.executeQueries(t,n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropView=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return t=e instanceof h.a?e.name:e,[4,this.getCachedView(t)];case 1:return n=r.sent(),a=[],(i=[]).push(this.deleteViewDefinitionSql(n)),i.push(this.dropViewSql(n)),a.push(this.insertViewDefinitionSql(n)),a.push(this.createViewSql(n)),[4,this.executeQueries(i,a)];case 2:return r.sent(),[2]}}))}))},t.prototype.renameTable=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h,f=this;return r.d(this,(function(r){switch(r.label){case 0:return n=[],i=[],e instanceof s.a?(o=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:o=r.sent(),r.label=3;case 3:return u=(a=o).clone(),t instanceof s.a?u=t:u.name=t,n.push(new p.a('ALTER TABLE "'+a.name+'" RENAME TO "'+u.name+'"')),i.push(new p.a('ALTER TABLE "'+u.name+'" RENAME TO "'+a.name+'"')),u.primaryColumns.length>0&&(c=u.primaryColumns.map((function(e){return e.name})),l=this.connection.namingStrategy.primaryKeyName(a,c),h=this.connection.namingStrategy.primaryKeyName(u,c),n.push(new p.a('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+l+'" TO "'+h+'"')),i.push(new p.a('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+h+'" TO "'+l+'"'))),u.uniques.forEach((function(e){var t=f.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);n.push(new p.a('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new p.a('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),u.indices.forEach((function(e){var t=f.connection.namingStrategy.indexName(u,e.columnNames,e.where);n.push(new p.a('ALTER INDEX "'+e.name+'" RENAME TO "'+t+'"')),i.push(new p.a('ALTER INDEX "'+t+'" RENAME TO "'+e.name+'"')),e.name=t})),u.foreignKeys.forEach((function(e){var t=f.connection.namingStrategy.foreignKeyName(u,e.columnNames,e.referencedTableName,e.referencedColumnNames);n.push(new p.a('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),i.push(new p.a('ALTER TABLE "'+u.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),[4,this.executeQueries(n,i)];case 4:return r.sent(),a.name=u.name,this.replaceCachedTable(a,u),[2]}}))}))},t.prototype.addColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h,f,m,y,v;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),u=[],(o=[]).push(new p.a('ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(t))),u.push(new p.a('ALTER TABLE "'+n.name+'" DROP COLUMN "'+t.name+'"')),t.isPrimary&&((c=a.primaryColumns).length>0&&(l=this.connection.namingStrategy.primaryKeyName(a.name,c.map((function(e){return e.name}))),h=c.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new p.a('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+l+'"')),u.push(new p.a('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+l+'" PRIMARY KEY ('+h+")"))),c.push(t),f=this.connection.namingStrategy.primaryKeyName(a.name,c.map((function(e){return e.name}))),m=c.map((function(e){return'"'+e.name+'"'})).join(", "),o.push(new p.a('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+f+'" PRIMARY KEY ('+m+")")),u.push(new p.a('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+f+'"'))),(y=a.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name})))&&(a.indices.splice(a.indices.indexOf(y),1),o.push(this.createIndexSql(n,y)),u.push(this.dropIndexSql(y))),t.isUnique&&(v=new d.a({name:this.connection.namingStrategy.uniqueConstraintName(n.name,[t.name]),columnNames:[t.name]}),a.uniques.push(v),o.push(new p.a('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+v.name+'" UNIQUE ("'+t.name+'")')),u.push(new p.a('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+v.name+'"'))),[4,this.executeQueries(o,u)];case 4:return r.sent(),a.addColumn(t),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.addColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,b.c.runInSequence(t,(function(t){return n.addColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.renameColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,u,c;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(i=a,!(u=t instanceof o.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return c=void 0,n instanceof o.a?c=n:(c=u.clone()).name=n,[4,this.changeColumn(i,u,c)];case 4:return r.sent(),[2]}}))}))},t.prototype.changeColumn=function(e,t,n){return r.b(this,void 0,void 0,(function(){var i,a,u,c,l,h,f,m,y,v,g,b,E,T,N,w,A,C,S=this;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(a=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:a=r.sent(),r.label=3;case 3:if(u=(i=a).clone(),c=[],l=[],!(h=t instanceof o.a?t:i.columns.find((function(e){return e.name===t}))))throw new Error('Column "'+t+'" was not found in the "'+i.name+'" table.');return n.isGenerated!==h.isGenerated&&"uuid"!==n.generationStrategy||h.type!==n.type||h.length!==n.length?[4,this.dropColumn(i,h)]:[3,6];case 4:return r.sent(),[4,this.addColumn(i,n)];case 5:return r.sent(),u=i.clone(),[3,8];case 6:return n.name!==h.name&&(c.push(new p.a('ALTER TABLE "'+i.name+'" RENAME COLUMN "'+h.name+'" TO "'+n.name+'"')),l.push(new p.a('ALTER TABLE "'+i.name+'" RENAME COLUMN "'+n.name+'" TO "'+h.name+'"')),!0===h.isPrimary&&(T=u.primaryColumns,A=T.map((function(e){return e.name})),f=this.connection.namingStrategy.primaryKeyName(u,A),A.splice(A.indexOf(h.name),1),A.push(n.name),m=this.connection.namingStrategy.primaryKeyName(u,A),c.push(new p.a('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+f+'" TO "'+m+'"')),l.push(new p.a('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+m+'" TO "'+f+'"'))),u.findColumnUniques(h).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.uniqueConstraintName(u,e.columnNames);c.push(new p.a('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),l.push(new p.a('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),u.findColumnIndices(h).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.indexName(u,e.columnNames,e.where);c.push(new p.a('ALTER INDEX "'+e.name+'" RENAME TO "'+t+'"')),l.push(new p.a('ALTER INDEX "'+t+'" RENAME TO "'+e.name+'"')),e.name=t})),u.findColumnForeignKeys(h).forEach((function(e){e.columnNames.splice(e.columnNames.indexOf(h.name),1),e.columnNames.push(n.name);var t=S.connection.namingStrategy.foreignKeyName(u,e.columnNames,e.referencedTableName,e.referencedColumnNames);c.push(new p.a('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+e.name+'" TO "'+t+'"')),l.push(new p.a('ALTER TABLE "'+i.name+'" RENAME CONSTRAINT "'+t+'" TO "'+e.name+'"')),e.name=t})),y=u.columns.find((function(e){return e.name===h.name})),u.columns[u.columns.indexOf(y)].name=n.name,h.name=n.name),this.isColumnChanged(h,n,!0)&&(v="",g="",b="",E="",null!==n.default&&void 0!==n.default?(v="DEFAULT "+n.default,g=null!==h.default&&void 0!==h.default?"DEFAULT "+h.default:"DEFAULT NULL"):null!==h.default&&void 0!==h.default&&(v="DEFAULT NULL",g="DEFAULT "+h.default),n.isNullable!==h.isNullable&&(!0===n.isNullable?(b="NULL",E="NOT NULL"):(b="NOT NULL",E="NULL")),c.push(new p.a('ALTER TABLE "'+i.name+'" MODIFY "'+h.name+'" '+this.connection.driver.createFullType(n)+" "+v+" "+b)),l.push(new p.a('ALTER TABLE "'+i.name+'" MODIFY "'+h.name+'" '+this.connection.driver.createFullType(h)+" "+g+" "+E))),n.isPrimary!==h.isPrimary&&((T=u.primaryColumns).length>0&&(w=this.connection.namingStrategy.primaryKeyName(u.name,T.map((function(e){return e.name}))),A=T.map((function(e){return'"'+e.name+'"'})).join(", "),c.push(new p.a('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+w+'"')),l.push(new p.a('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+A+")"))),!0===n.isPrimary?(T.push(n),u.columns.find((function(e){return e.name===n.name})).isPrimary=!0,w=this.connection.namingStrategy.primaryKeyName(u.name,T.map((function(e){return e.name}))),A=T.map((function(e){return'"'+e.name+'"'})).join(", "),c.push(new p.a('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+A+")")),l.push(new p.a('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+w+'"'))):(N=T.find((function(e){return e.name===n.name})),T.splice(T.indexOf(N),1),u.columns.find((function(e){return e.name===n.name})).isPrimary=!1,T.length>0&&(w=this.connection.namingStrategy.primaryKeyName(u.name,T.map((function(e){return e.name}))),A=T.map((function(e){return'"'+e.name+'"'})).join(", "),c.push(new p.a('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+w+'" PRIMARY KEY ('+A+")")),l.push(new p.a('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+w+'"'))))),n.isUnique!==h.isUnique&&(!0===n.isUnique?(C=new d.a({name:this.connection.namingStrategy.uniqueConstraintName(i.name,[n.name]),columnNames:[n.name]}),u.uniques.push(C),c.push(new p.a('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C.name+'" UNIQUE ("'+n.name+'")')),l.push(new p.a('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C.name+'"'))):(C=u.uniques.find((function(e){return 1===e.columnNames.length&&!!e.columnNames.find((function(e){return e===n.name}))})),u.uniques.splice(u.uniques.indexOf(C),1),c.push(new p.a('ALTER TABLE "'+i.name+'" DROP CONSTRAINT "'+C.name+'"')),l.push(new p.a('ALTER TABLE "'+i.name+'" ADD CONSTRAINT "'+C.name+'" UNIQUE ("'+n.name+'")')))),[4,this.executeQueries(c,l)];case 7:r.sent(),this.replaceCachedTable(i,u),r.label=8;case 8:return[2]}}))}))},t.prototype.changeColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,b.c.runInSequence(t,(function(t){return n.changeColumn(e,t.oldColumn,t.newColumn)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.dropColumn=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,u,c,l,h,f,d,m,y,v,g;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof o.a?t:n.findColumnByName(t)))throw new Error('Column "'+t+'" was not found in table "'+n.name+'"');return u=n.clone(),c=[],l=[],a.isPrimary&&(h=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map((function(e){return e.name}))),f=u.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),c.push(new p.a('ALTER TABLE "'+u.name+'" DROP CONSTRAINT "'+h+'"')),l.push(new p.a('ALTER TABLE "'+u.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+f+")")),u.findColumnByName(a.name).isPrimary=!1,u.primaryColumns.length>0&&(d=this.connection.namingStrategy.primaryKeyName(u.name,u.primaryColumns.map((function(e){return e.name}))),m=u.primaryColumns.map((function(e){return'"'+e.name+'"'})).join(", "),c.push(new p.a('ALTER TABLE "'+u.name+'" ADD CONSTRAINT "'+d+'" PRIMARY KEY ('+m+")")),l.push(new p.a('ALTER TABLE "'+u.name+'" DROP CONSTRAINT "'+d+'"')))),(y=u.indices.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(c.push(this.dropIndexSql(y)),l.push(this.createIndexSql(n,y))),(v=u.checks.find((function(e){return!!e.columnNames&&1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(u.checks.splice(u.checks.indexOf(v),1),c.push(this.dropCheckConstraintSql(n,v)),l.push(this.createCheckConstraintSql(n,v))),(g=u.uniques.find((function(e){return 1===e.columnNames.length&&e.columnNames[0]===a.name})))&&(u.uniques.splice(u.uniques.indexOf(g),1),c.push(this.dropUniqueConstraintSql(n,g)),l.push(this.createUniqueConstraintSql(n,g))),c.push(new p.a('ALTER TABLE "'+n.name+'" DROP COLUMN "'+a.name+'"')),l.push(new p.a('ALTER TABLE "'+n.name+'" ADD '+this.buildCreateColumnSql(a))),[4,this.executeQueries(c,l)];case 4:return r.sent(),u.removeColumn(a),this.replaceCachedTable(n,u),[2]}}))}))},t.prototype.dropColumns=function(e,t){return r.b(this,void 0,void 0,(function(){var n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,b.c.runInSequence(t,(function(t){return n.dropColumn(e,t)}))];case 1:return r.sent(),[2]}}))}))},t.prototype.createPrimaryKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return a=(n=i).clone(),o=this.createPrimaryKeySql(n,t),a.columns.forEach((function(e){t.find((function(t){return t===e.name}))&&(e.isPrimary=!0)})),u=this.dropPrimaryKeySql(a),[4,this.executeQueries(o,u)];case 4:return r.sent(),this.replaceCachedTable(n,a),[2]}}))}))},t.prototype.updatePrimaryKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u,c,l,h,f,d,m;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,a=t.map((function(e){return e.name})),o=n.clone(),u=[],c=[],(l=o.primaryColumns).length>0&&(h=this.connection.namingStrategy.primaryKeyName(o.name,l.map((function(e){return e.name}))),f=l.map((function(e){return'"'+e.name+'"'})).join(", "),u.push(new p.a('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+h+'"')),c.push(new p.a('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+h+'" PRIMARY KEY ('+f+")"))),o.columns.filter((function(e){return-1!==a.indexOf(e.name)})).forEach((function(e){return e.isPrimary=!0})),d=this.connection.namingStrategy.primaryKeyName(o.name,a),m=a.map((function(e){return'"'+e+'"'})).join(", "),u.push(new p.a('ALTER TABLE "'+n.name+'" ADD CONSTRAINT "'+d+'" PRIMARY KEY ('+m+")")),c.push(new p.a('ALTER TABLE "'+n.name+'" DROP CONSTRAINT "'+d+'"')),[4,this.executeQueries(u,c)];case 4:return r.sent(),this.replaceCachedTable(n,o),[2]}}))}))},t.prototype.dropPrimaryKey=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(n=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:n=r.sent(),r.label=3;case 3:return t=n,i=this.dropPrimaryKeySql(t),a=this.createPrimaryKeySql(t,t.primaryColumns.map((function(e){return e.name}))),[4,this.executeQueries(i,a)];case 4:return r.sent(),t.primaryColumns.forEach((function(e){e.isPrimary=!1})),[2]}}))}))},t.prototype.createUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.uniqueConstraintName(n.name,t.columnNames)),a=this.createUniqueConstraintSql(n,t),o=this.dropUniqueConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addUniqueConstraint(t),[2]}}))}))},t.prototype.createUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createUniqueConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropUniqueConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof d.a?t:n.uniques.find((function(e){return e.name===t}))))throw new Error("Supplied unique constraint was not found in table "+n.name);return o=this.dropUniqueConstraintSql(n,a),u=this.createUniqueConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeUniqueConstraint(a),[2]}}))}))},t.prototype.dropUniqueConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropUniqueConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.checkConstraintName(n.name,t.expression)),a=this.createCheckConstraintSql(n,t),o=this.dropCheckConstraintSql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addCheckConstraint(t),[2]}}))}))},t.prototype.createCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropCheckConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof g.a?t:n.checks.find((function(e){return e.name===t}))))throw new Error("Supplied check constraint was not found in table "+n.name);return o=this.dropCheckConstraintSql(n,a),u=this.createCheckConstraintSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeCheckConstraint(a),[2]}}))}))},t.prototype.dropCheckConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropCheckConstraint(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Oracle does not support exclusion constraints.")}))}))},t.prototype.createExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Oracle does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraint=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Oracle does not support exclusion constraints.")}))}))},t.prototype.dropExclusionConstraints=function(e,t){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(e){throw new Error("Oracle does not support exclusion constraints.")}))}))},t.prototype.createForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.foreignKeyName(n.name,t.columnNames,t.referencedTableName,t.referencedColumnNames)),a=this.createForeignKeySql(n,t),o=this.dropForeignKeySql(n,t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addForeignKey(t),[2]}}))}))},t.prototype.createForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropForeignKey=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,c;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof u.a?t:n.foreignKeys.find((function(e){return e.name===t}))))throw new Error("Supplied foreign key was not found in table "+n.name);return o=this.dropForeignKeySql(n,a),c=this.createForeignKeySql(n,a),[4,this.executeQueries(o,c)];case 4:return r.sent(),n.removeForeignKey(a),[2]}}))}))},t.prototype.dropForeignKeys=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropForeignKey(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.createIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:return n=i,t.name||(t.name=this.connection.namingStrategy.indexName(n.name,t.columnNames,t.where)),a=this.createIndexSql(n,t),o=this.dropIndexSql(t),[4,this.executeQueries(a,o)];case 4:return r.sent(),n.addIndex(t),[2]}}))}))},t.prototype.createIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.createIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.dropIndex=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i,a,o,u;return r.d(this,(function(r){switch(r.label){case 0:return e instanceof s.a?(i=e,[3,3]):[3,1];case 1:return[4,this.getCachedTable(e)];case 2:i=r.sent(),r.label=3;case 3:if(n=i,!(a=t instanceof c.a?t:n.indices.find((function(e){return e.name===t}))))throw new Error("Supplied index was not found in table "+n.name);return o=this.dropIndexSql(a),u=this.createIndexSql(n,a),[4,this.executeQueries(o,u)];case 4:return r.sent(),n.removeIndex(a),[2]}}))}))},t.prototype.dropIndices=function(e,t){return r.b(this,void 0,void 0,(function(){var n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return n=t.map((function(t){return i.dropIndex(e,t)})),[4,Promise.all(n)];case 1:return r.sent(),[2]}}))}))},t.prototype.clearTable=function(e){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,this.query('TRUNCATE TABLE "'+e+'"')];case 1:return t.sent(),[2]}}))}))},t.prototype.clearDatabase=function(){return r.b(this,void 0,void 0,(function(){var e,t,n,i=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.startTransaction()];case 1:r.sent(),r.label=2;case 2:return r.trys.push([2,8,,13]),'SELECT \'DROP VIEW "\' || VIEW_NAME || \'"\' AS "query" FROM "USER_VIEWS"',[4,this.query('SELECT \'DROP VIEW "\' || VIEW_NAME || \'"\' AS "query" FROM "USER_VIEWS"')];case 3:return e=r.sent(),[4,Promise.all(e.map((function(e){return i.query(e.query)})))];case 4:return r.sent(),'SELECT \'DROP TABLE "\' || TABLE_NAME || \'" CASCADE CONSTRAINTS\' AS "query" FROM "USER_TABLES"',[4,this.query('SELECT \'DROP TABLE "\' || TABLE_NAME || \'" CASCADE CONSTRAINTS\' AS "query" FROM "USER_TABLES"')];case 5:return t=r.sent(),[4,Promise.all(t.map((function(e){return i.query(e.query)})))];case 6:return r.sent(),[4,this.commitTransaction()];case 7:return r.sent(),[3,13];case 8:n=r.sent(),r.label=9;case 9:return r.trys.push([9,11,,12]),[4,this.rollbackTransaction()];case 10:return r.sent(),[3,12];case 11:return r.sent(),[3,12];case 12:throw n;case 13:return[2]}}))}))},t.prototype.loadViews=function(e){return r.b(this,void 0,void 0,(function(){var t,n;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.hasTable(this.getTypeormMetadataTableName())];case 1:return r.sent()?(t=e.map((function(e){return"'"+e+"'"})).join(", "),n='SELECT "T".* FROM "'+this.getTypeormMetadataTableName()+'" "T" INNER JOIN "USER_VIEWS" "V" ON "V"."VIEW_NAME" = "T"."name" WHERE "T"."type" = \'VIEW\'',t.length>0&&(n+=' AND "T"."name" IN ('+t+")"),[4,this.query(n)]):[2,Promise.resolve([])];case 2:return[2,r.sent().map((function(e){var t=new h.a;return t.name=e.name,t.expression=e.value,t}))]}}))}))},t.prototype.loadTables=function(e){return r.b(this,void 0,void 0,(function(){var t,n,i,a,l,h,p,f,m,y,b,E,T=this;return r.d(this,(function(N){switch(N.label){case 0:return e&&e.length?(t=e.map((function(e){return"'"+e+"'"})).join(", "),n='SELECT * FROM "USER_TABLES" WHERE "TABLE_NAME" IN ('+t+")",i='SELECT * FROM "USER_TAB_COLS" WHERE "TABLE_NAME" IN ('+t+")",a='SELECT "IND"."INDEX_NAME", "IND"."TABLE_NAME", "IND"."UNIQUENESS", LISTAGG ("COL"."COLUMN_NAME", \',\') WITHIN GROUP (ORDER BY "COL"."COLUMN_NAME") AS "COLUMN_NAMES" FROM "USER_INDEXES" "IND" INNER JOIN "USER_IND_COLUMNS" "COL" ON "COL"."INDEX_NAME" = "IND"."INDEX_NAME" LEFT JOIN "USER_CONSTRAINTS" "CON" ON "CON"."CONSTRAINT_NAME" = "IND"."INDEX_NAME" WHERE "IND"."TABLE_NAME" IN ('+t+') AND "CON"."CONSTRAINT_NAME" IS NULL GROUP BY "IND"."INDEX_NAME", "IND"."TABLE_NAME", "IND"."UNIQUENESS"',l='SELECT "C"."CONSTRAINT_NAME", "C"."TABLE_NAME", "COL"."COLUMN_NAME", "REF_COL"."TABLE_NAME" AS "REFERENCED_TABLE_NAME", "REF_COL"."COLUMN_NAME" AS "REFERENCED_COLUMN_NAME", "C"."DELETE_RULE" AS "ON_DELETE" FROM "USER_CONSTRAINTS" "C" INNER JOIN "USER_CONS_COLUMNS" "COL" ON "COL"."OWNER" = "C"."OWNER" AND "COL"."CONSTRAINT_NAME" = "C"."CONSTRAINT_NAME" INNER JOIN "USER_CONS_COLUMNS" "REF_COL" ON "REF_COL"."OWNER" = "C"."R_OWNER" AND "REF_COL"."CONSTRAINT_NAME" = "C"."R_CONSTRAINT_NAME" AND "REF_COL"."POSITION" = "COL"."POSITION" WHERE "C"."TABLE_NAME" IN ('+t+') AND "C"."CONSTRAINT_TYPE" = \'R\'',h='SELECT "C"."CONSTRAINT_NAME", "C"."CONSTRAINT_TYPE", "C"."TABLE_NAME", "COL"."COLUMN_NAME", "C"."SEARCH_CONDITION" FROM "USER_CONSTRAINTS" "C" INNER JOIN "USER_CONS_COLUMNS" "COL" ON "COL"."OWNER" = "C"."OWNER" AND "COL"."CONSTRAINT_NAME" = "C"."CONSTRAINT_NAME" WHERE "C"."TABLE_NAME" IN ('+t+") AND \"C\".\"CONSTRAINT_TYPE\" IN ('C', 'U', 'P') AND \"C\".\"GENERATED\" = 'USER NAME'",[4,Promise.all([this.query(n),this.query(i),this.query(a),this.query(l),this.query(h)])]):[2,[]];case 1:return p=r.e.apply(void 0,[N.sent(),5]),f=p[0],m=p[1],y=p[2],b=p[3],E=p[4],f.length?[2,f.map((function(e){var t=new s.a;t.name=e.TABLE_NAME,t.columns=m.filter((function(e){return e.TABLE_NAME===t.name})).map((function(e){var n=E.filter((function(n){return n.TABLE_NAME===t.name&&n.COLUMN_NAME===e.COLUMN_NAME})),r=n.find((function(e){return"U"===e.CONSTRAINT_TYPE})),i=!!r&&!!E.find((function(t){return"U"===t.CONSTRAINT_TYPE&&t.CONSTRAINT_NAME===r.CONSTRAINT_NAME&&t.COLUMN_NAME!==e.COLUMN_NAME})),a=!!r&&!i,s=!!n.find((function(e){return"P"===e.CONSTRAINT_TYPE})),u=new o.a;if(u.name=e.COLUMN_NAME,u.type=e.DATA_TYPE.toLowerCase(),-1!==u.type.indexOf("(")&&(u.type=u.type.replace(/\([0-9]*\)/,"")),-1!==T.driver.withLengthColumnTypes.indexOf(u.type)){var c="raw"===u.type?e.DATA_LENGTH:e.CHAR_COL_DECL_LENGTH;u.length=c&&!T.isDefaultColumnLength(t,u,c)?c.toString():""}return"number"===u.type||"float"===u.type?(null===e.DATA_PRECISION||T.isDefaultColumnPrecision(t,u,e.DATA_PRECISION)||(u.precision=e.DATA_PRECISION),null===e.DATA_SCALE||T.isDefaultColumnScale(t,u,e.DATA_SCALE)||(u.scale=e.DATA_SCALE)):"timestamp"!==u.type&&"timestamp with time zone"!==u.type&&"timestamp with local time zone"!==u.type||null===e.DATA_SCALE||(u.precision=T.isDefaultColumnPrecision(t,u,e.DATA_SCALE)?void 0:e.DATA_SCALE),u.default=null!==e.DATA_DEFAULT&&void 0!==e.DATA_DEFAULT&&"NULL"!==e.DATA_DEFAULT.trim()?u.default=e.DATA_DEFAULT.trim():void 0,u.isNullable="Y"===e.NULLABLE,u.isUnique=a,u.isPrimary=s,u.isGenerated="YES"===e.IDENTITY_COLUMN,u.isGenerated&&(u.generationStrategy="increment",u.default=void 0),u.comment="",u}));var n=v.a.uniq(E.filter((function(e){return e.TABLE_NAME===t.name&&"U"===e.CONSTRAINT_TYPE})),(function(e){return e.CONSTRAINT_NAME}));t.uniques=n.map((function(e){var t=E.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return new d.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME}))})}));var r=v.a.uniq(E.filter((function(e){return e.TABLE_NAME===t.name&&"C"===e.CONSTRAINT_TYPE})),(function(e){return e.CONSTRAINT_NAME}));t.checks=r.map((function(e){var t=E.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return new g.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),expression:e.SEARCH_CONDITION})}));var i=v.a.uniq(b.filter((function(e){return e.TABLE_NAME===t.name})),(function(e){return e.CONSTRAINT_NAME}));return t.foreignKeys=i.map((function(e){var t=b.filter((function(t){return t.CONSTRAINT_NAME===e.CONSTRAINT_NAME}));return new u.a({name:e.CONSTRAINT_NAME,columnNames:t.map((function(e){return e.COLUMN_NAME})),referencedTableName:e.REFERENCED_TABLE_NAME,referencedColumnNames:t.map((function(e){return e.REFERENCED_COLUMN_NAME})),onDelete:e.ON_DELETE,onUpdate:"NO ACTION"})})),t.indices=y.filter((function(e){return e.TABLE_NAME===t.name})).map((function(e){return new c.a({name:e.INDEX_NAME,columnNames:e.COLUMN_NAMES.split(","),isUnique:"UNIQUE"===e.UNIQUENESS})})),t}))]:[2,[]]}}))}))},t.prototype.createTableSql=function(e,t){var n=this,r=e.columns.map((function(e){return n.buildCreateColumnSql(e)})).join(", "),i='CREATE TABLE "'+e.name+'" ('+r;(e.columns.filter((function(e){return e.isUnique})).forEach((function(t){e.uniques.some((function(e){return 1===e.columnNames.length&&e.columnNames[0]===t.name}))||e.uniques.push(new d.a({name:n.connection.namingStrategy.uniqueConstraintName(e.name,[t.name]),columnNames:[t.name]}))})),e.uniques.length>0)&&(i+=", "+e.uniques.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.uniqueConstraintName(e.name,t.columnNames))+'" UNIQUE ('+t.columnNames.map((function(e){return'"'+e+'"'})).join(", ")+")"})).join(", "));e.checks.length>0&&(i+=", "+e.checks.map((function(t){return'CONSTRAINT "'+(t.name?t.name:n.connection.namingStrategy.checkConstraintName(e.name,t.expression))+'" CHECK ('+t.expression+")"})).join(", "));e.foreignKeys.length>0&&t&&(i+=", "+e.foreignKeys.map((function(t){var r=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");t.name||(t.name=n.connection.namingStrategy.foreignKeyName(e.name,t.columnNames,t.referencedTableName,t.referencedColumnNames));var i=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(", "),a='CONSTRAINT "'+t.name+'" FOREIGN KEY ('+r+') REFERENCES "'+t.referencedTableName+'" ('+i+")";return t.onDelete&&"NO ACTION"!==t.onDelete&&(a+=" ON DELETE "+t.onDelete),a})).join(", "));var a=e.columns.filter((function(e){return e.isPrimary}));a.length>0&&(i+=', CONSTRAINT "'+this.connection.namingStrategy.primaryKeyName(e.name,a.map((function(e){return e.name})))+'" PRIMARY KEY ('+a.map((function(e){return'"'+e.name+'"'})).join(", ")+")");return i+=")",new p.a(i)},t.prototype.dropTableSql=function(e,t){var n=e instanceof s.a?e.name:e,r=t?'DROP TABLE IF EXISTS "'+n+'"':'DROP TABLE "'+n+'"';return new p.a(r)},t.prototype.createViewSql=function(e){var t=e.materialized?"MATERIALIZED ":"";return"string"===typeof e.expression?new p.a("CREATE "+t+'VIEW "'+e.name+'" AS '+e.expression):new p.a("CREATE "+t+'VIEW "'+e.name+'" AS '+e.expression(this.connection).getQuery())},t.prototype.insertViewDefinitionSql=function(e){var t="string"===typeof e.expression?e.expression.trim():e.expression(this.connection).getQuery(),n=r.e(this.connection.createQueryBuilder().insert().into(this.getTypeormMetadataTableName()).values({type:"VIEW",name:e.name,value:t}).getQueryAndParameters(),2),i=n[0],a=n[1];return new p.a(i,a)},t.prototype.dropViewSql=function(e){var t=e instanceof h.a?e.name:e;return new p.a('DROP VIEW "'+t+'"')},t.prototype.deleteViewDefinitionSql=function(e){var t=e instanceof h.a?e.name:e,n=this.connection.createQueryBuilder(),i=r.e(n.delete().from(this.getTypeormMetadataTableName()).where(n.escape("type")+" = 'VIEW'").andWhere(n.escape("name")+" = :name",{name:t}).getQueryAndParameters(),2),a=i[0],o=i[1];return new p.a(a,o)},t.prototype.createIndexSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new p.a("CREATE "+(t.isUnique?"UNIQUE ":"")+'INDEX "'+t.name+'" ON "'+e.name+'" ('+n+")")},t.prototype.dropIndexSql=function(e){var t=e instanceof c.a?e.name:e;return new p.a('DROP INDEX "'+t+'"')},t.prototype.createPrimaryKeySql=function(e,t){var n=this.connection.namingStrategy.primaryKeyName(e.name,t),r=t.map((function(e){return'"'+e+'"'})).join(", ");return new p.a('ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+n+'" PRIMARY KEY ('+r+")")},t.prototype.dropPrimaryKeySql=function(e){var t=e.primaryColumns.map((function(e){return e.name})),n=this.connection.namingStrategy.primaryKeyName(e.name,t);return new p.a('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.createUniqueConstraintSql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", ");return new p.a('ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" UNIQUE ('+n+")")},t.prototype.dropUniqueConstraintSql=function(e,t){var n=t instanceof d.a?t.name:t;return new p.a('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.createCheckConstraintSql=function(e,t){return new p.a('ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" CHECK ('+t.expression+")")},t.prototype.dropCheckConstraintSql=function(e,t){var n=t instanceof g.a?t.name:t;return new p.a('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.createForeignKeySql=function(e,t){var n=t.columnNames.map((function(e){return'"'+e+'"'})).join(", "),r=t.referencedColumnNames.map((function(e){return'"'+e+'"'})).join(","),i='ALTER TABLE "'+e.name+'" ADD CONSTRAINT "'+t.name+'" FOREIGN KEY ('+n+') REFERENCES "'+t.referencedTableName+'" ('+r+")";return t.onDelete&&"NO ACTION"!==t.onDelete&&(i+=" ON DELETE "+t.onDelete),new p.a(i)},t.prototype.dropForeignKeySql=function(e,t){var n=t instanceof u.a?t.name:t;return new p.a('ALTER TABLE "'+e.name+'" DROP CONSTRAINT "'+n+'"')},t.prototype.buildCreateColumnSql=function(e){var t='"'+e.name+'" '+this.connection.driver.createFullType(e);return e.charset&&(t+=" CHARACTER SET "+e.charset),e.collation&&(t+=" COLLATE "+e.collation),void 0!==e.default&&null!==e.default&&(t+=" DEFAULT "+e.default),!0===e.isNullable||e.isGenerated||(t+=" NOT NULL"),!0===e.isGenerated&&"increment"===e.generationStrategy&&(t+=" GENERATED BY DEFAULT AS IDENTITY"),t},t}(y.a)},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),i=n(17),a=n(42),o=n(25),s=n(28),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new o.a(n),n}return r.c(t,e),t.prototype.commitTransaction=function(){return r.b(this,void 0,void 0,(function(){return r.d(this,(function(t){switch(t.label){case 0:return[4,e.prototype.commitTransaction.call(this)];case 1:return t.sent(),[4,this.driver.autoSave()];case 2:return t.sent(),[2]}}))}))},t.prototype.query=function(e,t){var n=this;if(void 0===t&&(t=[]),this.isReleased)throw new i.a;return new Promise((function(i,a){return r.b(n,void 0,void 0,(function(){var n,o,u,c,l,h,p;return r.d(this,(function(r){n=this.driver.databaseConnection,this.driver.connection.logger.logQuery(e,t,this),o=+new Date;try{for(u=n.prepare(e),t&&u.bind(t),c=this.driver.connection.options.maxQueryExecutionTime,l=+new Date,h=l-o,c&&h>c&&this.driver.connection.logger.logQuerySlow(h,e,t,this),p=[];u.step();)p.push(u.getAsObject());u.free(),i(p)}catch(f){u&&u.free(),this.driver.connection.logger.logQueryError(f,e,t,this),a(new s.a(e,t,f))}return[2]}))}))}))},t}(a.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(0),i=n(30),a=n(87),o=n(34),s=n(4),u=function(t){function n(e){var n=t.call(this,e)||this;if(n.connection=e,n.options=e.options,n.database=n.options.database,!n.options.database)throw new o.a("database");return n.loadDependencies(),n}return r.c(n,t),n.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close((function(e){return e?n(e):t()}))}))]}))}))},n.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.normalizeType=function(n){return n.type===e?"blob":t.prototype.normalizeType.call(this,n)},n.prototype.createDatabaseConnection=function(){return r.b(this,void 0,void 0,(function(){function e(e){return new Promise((function(n,r){t.run(e,(function(e){if(e)return r(e);n()}))}))}var t,n=this;return r.d(this,(function(r){switch(r.label){case 0:return[4,this.createDatabaseDirectory(this.options.database)];case 1:return r.sent(),[4,new Promise((function(e,t){var r=new n.sqlite.Database(n.options.database,(function(n){if(n)return t(n);e(r)}))}))];case 2:return t=r.sent(),[4,e("PRAGMA foreign_keys = ON;")];case 3:return r.sent(),this.options.key?[4,e("PRAGMA key = "+JSON.stringify(this.options.key)+";")]:[3,5];case 4:r.sent(),r.label=5;case 5:return[2,t]}}))}))},n.prototype.loadDependencies=function(){try{this.sqlite=s.a.load("sqlite3").verbose()}catch(e){throw new i.a("SQLite","sqlite3")}},n.prototype.createDatabaseDirectory=function(e){return s.a.load("mkdirp")(s.a.load("path").dirname(e))},n}(n(19).a)}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),i=n(17),a=n(28),o=n(42),s=n(25),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new i.a;var o=this.driver.connection;return new Promise((function(i,s){return r.b(n,void 0,void 0,(function(){var n,u,c,l;return r.d(this,(function(r){switch(r.label){case 0:return n=function(n,r){var u=o.options.maxQueryExecutionTime,h=+new Date-c;u&&h>u&&o.logger.logQuerySlow(h,e,t,this),n?(o.logger.logQueryError(n,e,t,this),s(new a.a(e,t,n))):i(l?this.lastID:r)},[4,this.connect()];case 1:return u=r.sent(),this.driver.connection.logger.logQuery(e,t,this),c=+new Date,(l="INSERT INTO"===e.substr(0,11))?u.run(e,t,n):u.all(e,t,n),[2]}}))}))}))},t}(o.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return u}));var r=n(0),i=n(19),a=n(89),o=n(34),s=n(30),u=function(t){function n(e){var n=t.call(this,e)||this;if(n.connection=e,n.options=e.options,n.database=n.options.database,n.driver=n.options.driver,!n.options.database)throw new o.a("database");return n.loadDependencies(),n}return r.c(n,t),n.prototype.disconnect=function(){return r.b(this,void 0,void 0,(function(){var e=this;return r.d(this,(function(t){return[2,new Promise((function(t,n){e.queryRunner=void 0,e.databaseConnection.close().then(t).catch(n)}))]}))}))},n.prototype.createQueryRunner=function(e){return void 0===e&&(e="master"),this.queryRunner||(this.queryRunner=new a.a(this)),this.queryRunner},n.prototype.normalizeType=function(n){return n.type===e?"blob":t.prototype.normalizeType.call(this,n)},n.prototype.createDatabaseConnection=function(){var e=this;return new Promise((function(t,n){var r=Object.assign({},{readOnly:e.options.readOnly,key:e.options.key,multithreading:e.options.multithreading,migrate:e.options.migrate,iosFlags:e.options.iosFlags,androidFlags:e.options.androidFlags},e.options.extra||{});new e.sqlite(e.options.database,r,(function(r,i){if(r)return n(r);i.resultType(e.sqlite.RESULTSASOBJECT),i.execSQL("PRAGMA foreign_keys = ON;",[],(function(e,r){if(e)return n(e);t(i)}))}))}))},n.prototype.loadDependencies=function(){if(this.sqlite=this.driver,!this.driver)throw new s.a("Nativescript","nativescript-sqlite")},n}(i.a)}).call(this,n(40).Buffer)},function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),i=n(17),a=n(28),o=n(42),s=n(25),u=function(e){function t(t){var n=e.call(this)||this;return n.driver=t,n.connection=t.connection,n.broadcaster=new s.a(n),n}return r.c(t,e),t.prototype.query=function(e,t){var n=this;if(this.isReleased)throw new i.a;var r=this.driver.connection;return new Promise((function(i,o){var s="INSERT INTO"===e.substr(0,11),u=function(n,s){var u=r.options.maxQueryExecutionTime,l=+new Date-c;u&&l>u&&r.logger.logQuerySlow(l,e,t,this),n?(r.logger.logQueryError(n,e,t,this),o(new a.a(e,t,n))):i(s)};n.driver.connection.logger.logQuery(e,t,n);var c=+new Date;n.connect().then((function(n){s?n.execSQL(e,t,u):n.all(e,t,u)}))}))},t.prototype.parametrize=function(e,t){return void 0===t&&(t=0),Object.keys(e).map((function(e,t){return'"'+e+'"=?'}))},t}(o.a)},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return o}));var r=n(0),i=n(6),a=n(20),o=function(){function t(e,t,n,r,i){this.expressionMap=e,this.driver=t,this.rawRelationIdResults=n,this.rawRelationCountResults=r,this.queryRunner=i}return t.prototype.transform=function(e,t){var n=this,r=this.group(e,t),i=[];return r.forEach((function(e){var r=n.transformRawResultsGroup(e,t);void 0!==r&&i.push(r)})),i},t.prototype.group=function(t,n){var i=this,o=new Map,s=[];return"view"===n.metadata.tableType?s.push.apply(s,r.f(n.metadata.columns.map((function(e){return a.a.buildColumnAlias(i.driver,n.name,e.databaseName)})))):s.push.apply(s,r.f(n.metadata.primaryColumns.map((function(e){return a.a.buildColumnAlias(i.driver,n.name,e.databaseName)})))),t.forEach((function(t){var n=s.map((function(n){var r=t[n];return e.isBuffer(r)?r.toString("hex"):r})).join("_"),r=o.get(n);r?r.push(t):o.set(n,[t])})),o},t.prototype.transformRawResultsGroup=function(e,t){var n=this,r=t.metadata;if(r.discriminatorColumn){var i=e.map((function(e){return e[a.a.buildColumnAlias(n.driver,t.name,t.metadata.discriminatorColumn.databaseName)]})),o=r.childEntityMetadatas.find((function(e){return!!i.find((function(t){return t===e.discriminatorValue}))}));o&&(r=o)}var s=-1!==this.expressionMap.options.indexOf("create-pojo")?{}:r.create(this.queryRunner),u=this.transformColumns(e,t,s,r),c=this.transformJoins(e,s,t,r),l=this.transformRelationIds(e,t,s,r),h=this.transformRelationCounts(e,t,s);return u||0===r.primaryColumns.filter((function(e){return!1===e.isVirtual})).length&&(c||l||h)?s:void 0},t.prototype.transformColumns=function(e,t,n,r){var i=this,o=!1;return r.columns.forEach((function(s){if(!(r.childEntityMetadatas.length>0&&-1!==r.childEntityMetadatas.map((function(e){return e.target})).indexOf(s.target))){var u=e[0][a.a.buildColumnAlias(i.driver,t.name,s.databaseName)];void 0===u||s.isVirtual||i.expressionMap.selects.find((function(e){return e.selection===t.name||e.selection===t.name+"."+s.propertyPath}))&&(s.setEntityValue(n,i.driver.prepareHydratedValue(u,s)),null!==u&&(o=!0))}})),o},t.prototype.transformJoins=function(e,t,n,r){var i=this,a=!1;return this.expressionMap.joinAttributes.forEach((function(o){if(o.metadata&&o.isSelected&&(!o.relation||r.relations.find((function(e){return e===o.relation})))){if(o.mapToProperty){if(o.mapToPropertyParentAlias!==n.name)return}else if(!o.relation||o.parentAlias!==n.name||o.relationPropertyPath!==o.relation.propertyPath)return;var s=i.transform(e,o.alias);s=o.isMany?s:s[0],void 0!==(s=o.isMany||void 0!==s?s:null)&&(o.mapToPropertyPropertyName?t[o.mapToPropertyPropertyName]=s:o.relation.setEntityValue(t,s),a=!0)}})),a},t.prototype.transformRelationIds=function(e,t,n,r){var a=this,o=!1;return this.rawRelationIdResults.forEach((function(r){if(r.relationIdAttribute.parentAlias===t.name){var s=r.relationIdAttribute.relation,u=a.createValueMapFromJoinColumns(s,r.relationIdAttribute.parentAlias,e);if(void 0!==u&&null!==u){var c=r.results.map((function(e){var t=a.extractEntityPrimaryIds(s,e);if(!1!==i.a.compareIds(t,u)){var n,o=(n=s.isManyToOne||s.isOneToOneOwner?s.joinColumns.map((function(e){return e})):s.isOneToMany||s.isOneToOneNotOwner?s.inverseEntityMetadata.primaryColumns.map((function(e){return e})):s.isOwning?s.inverseJoinColumns.map((function(e){return e})):s.inverseRelation.joinColumns.map((function(e){return e}))).reduce((function(t,n){var r=e[n.databaseName];return s.isOneToMany||s.isOneToOneNotOwner?(n.referencedColumn&&(r=n.referencedColumn.createValueMap(r)),i.a.mergeDeep(t,n.createValueMap(r))):(n.referencedColumn.referencedColumn&&(r=n.referencedColumn.referencedColumn.createValueMap(r)),i.a.mergeDeep(t,n.referencedColumn.createValueMap(r)))}),{});return 1===n.length&&!1===r.relationIdAttribute.disableMixedMap?s.isOneToMany||s.isOneToOneNotOwner?n[0].getEntityValue(o):n[0].referencedColumn.getEntityValue(o):o}})).filter((function(e){return e})),l=r.relationIdAttribute.mapToPropertyPropertyPath.split("."),h=function e(t,n,r){var i=t.shift();return i&&0===t.length?(n[i]=r,n):i&&t.length>0?void e(t,n[i],r):n};s.isOneToOne||s.isManyToOne?void 0!==c[0]&&(h(l,n,c[0]),o=!0):(h(l,n,c),c.length>0&&(o=!0))}}})),o},t.prototype.transformRelationCounts=function(e,t,n){var r=this,i=!1;return this.rawRelationCountResults.filter((function(e){return e.relationCountAttribute.parentAlias===t.name})).forEach((function(o){var s,u=o.relationCountAttribute.relation;s=u.isOneToMany?u.inverseRelation.joinColumns[0].referencedColumn.databaseName:u.isOwning?u.joinColumns[0].referencedColumn.databaseName:u.inverseRelation.joinColumns[0].referencedColumn.databaseName;var c=e[0][a.a.buildColumnAlias(r.driver,t.name,s)];void 0!==c&&null!==c&&(n[o.relationCountAttribute.mapToPropertyPropertyName]=0,o.results.filter((function(e){return e.parentId===c})).forEach((function(e){n[o.relationCountAttribute.mapToPropertyPropertyName]=parseInt(e.cnt),i=!0})))})),i},t.prototype.createValueMapFromJoinColumns=function(e,t,n){var r=this;return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((function(e){return e})):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((function(e){return e})):e.isOwning?e.joinColumns.map((function(e){return e})):e.inverseRelation.inverseJoinColumns.map((function(e){return e}))).reduce((function(i,o){return n.forEach((function(n){e.isManyToOne||e.isOneToOneOwner?i[o.databaseName]=r.driver.prepareHydratedValue(n[a.a.buildColumnAlias(r.driver,t,o.databaseName)],o):i[o.databaseName]=r.driver.prepareHydratedValue(n[a.a.buildColumnAlias(r.driver,t,o.referencedColumn.databaseName)],o)})),i}),{})},t.prototype.extractEntityPrimaryIds=function(e,t){return(e.isManyToOne||e.isOneToOneOwner?e.entityMetadata.primaryColumns.map((function(e){return e})):e.isOneToMany||e.isOneToOneNotOwner?e.inverseRelation.joinColumns.map((function(e){return e})):e.isOwning?e.joinColumns.map((function(e){return e})):e.inverseRelation.inverseJoinColumns.map((function(e){return e}))).reduce((function(e,n){return e[n.databaseName]=t[n.databaseName],e}),{})},t}()}).call(this,n(40).Buffer)},function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE){0;try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}}(),e.exports=n(110)},,,function(e,t,n){var r=function(e){"use strict";var t=Object.prototype,n=t.hasOwnProperty,r="function"===typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n,r){var i=t&&t.prototype instanceof l?t:l,a=Object.create(i.prototype),o=new N(r||[]);return a._invoke=function(e,t,n){var r="suspendedStart";return function(i,a){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw a;return A()}for(n.method=i,n.arg=a;;){var o=n.delegate;if(o){var s=b(o,n);if(s){if(s===c)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var l=u(e,t,n);if("normal"===l.type){if(r=n.done?"completed":"suspendedYield",l.arg===c)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(r="completed",n.method="throw",n.arg=l.arg)}}}(e,n,o),a}function u(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(r){return{type:"throw",arg:r}}}e.wrap=s;var c={};function l(){}function h(){}function p(){}var f={};f[i]=function(){return this};var d=Object.getPrototypeOf,m=d&&d(d(w([])));m&&m!==t&&n.call(m,i)&&(f=m);var y=p.prototype=l.prototype=Object.create(f);function v(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function g(e,t){var r;this._invoke=function(i,a){function o(){return new t((function(r,o){!function r(i,a,o,s){var c=u(e[i],e,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"===typeof h&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,s)}))}s(c.arg)}(i,a,r,o)}))}return r=r?r.then(o,o):o()}}function b(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,b(e,t),"throw"===t.method))return c;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return c}var r=u(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,c;var i=r.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,c):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,c)}function E(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function T(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function N(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(E,this),this.reset(!0)}function w(e){if(e){var t=e[i];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var r=-1,a=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return a.next=a}}return{next:A}}function A(){return{value:void 0,done:!0}}return h.prototype=y.constructor=p,p.constructor=h,p[o]=h.displayName="GeneratorFunction",e.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===h||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,p):(e.__proto__=p,o in e||(e[o]="GeneratorFunction")),e.prototype=Object.create(y),e},e.awrap=function(e){return{__await:e}},v(g.prototype),g.prototype[a]=function(){return this},e.AsyncIterator=g,e.async=function(t,n,r,i,a){void 0===a&&(a=Promise);var o=new g(s(t,n,r,i),a);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},v(y),y[o]="Generator",y[i]=function(){return this},y.toString=function(){return"[object Generator]"},e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=w,N.prototype={constructor:N,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(T),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],o=a.completion;if("root"===a.tryLoc)return r("end");if(a.tryLoc<=this.prev){var s=n.call(a,"catchLoc"),u=n.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r];if(i.tryLoc<=this.prev&&n.call(i,"finallyLoc")&&this.prev<i.finallyLoc){var a=i;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,c):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),c},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),T(n),c}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var i=r.arg;T(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:w(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),c}},e}(e.exports);try{regeneratorRuntime=r}catch(i){Function("r","regeneratorRuntime = r")(r)}},function(e,t){var n,r,i=e.exports={};function a(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function s(e){if(n===setTimeout)return setTimeout(e,0);if((n===a||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"===typeof setTimeout?setTimeout:a}catch(e){n=a}try{r="function"===typeof clearTimeout?clearTimeout:o}catch(e){r=o}}();var u,c=[],l=!1,h=-1;function p(){l&&u&&(l=!1,u.length?c=u.concat(c):h=-1,c.length&&f())}function f(){if(!l){var e=s(p);l=!0;for(var t=c.length;t;){for(u=c,c=[];++h<t;)u&&u[h].run();h=-1,t=c.length}u=null,l=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===o||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function d(e,t){this.fun=e,this.array=t}function m(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];c.push(new d(e,t)),1!==c.length||l||s(f)},d.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=m,i.addListener=m,i.once=m,i.off=m,i.removeListener=m,i.removeAllListeners=m,i.emit=m,i.prependListener=m,i.prependOnceListener=m,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){var r=n(50),i=n(51),a=n(49).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<30|e>>>2}function l(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,h=0;h<16;++h)n[h]=e.readInt32BE(4*h);for(;h<80;++h)n[h]=n[h-3]^n[h-8]^n[h-14]^n[h-16];for(var p=0;p<80;++p){var f=~~(p/20),d=0|((t=r)<<5|t>>>27)+l(f,i,a,s)+u+n[p]+o[f];u=s,s=a,a=c(i),i=r,r=d}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},function(e,t,n){"use strict";t.byteLength=function(e){var t=c(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=c(e),o=r[0],s=r[1],u=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],u[l++]=t>>16&255,u[l++]=t>>8&255,u[l++]=255&t;2===s&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,u[l++]=255&t);1===s&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,u[l++]=t>>8&255,u[l++]=255&t);return u},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,a=[],o=0,s=n-i;o<s;o+=16383)a.push(l(e,o,o+16383>s?s:o+16383));1===i?(t=e[n-1],a.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],a.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return a.join("")};for(var r=[],i=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,u=o.length;s<u;++s)r[s]=o[s],i[o.charCodeAt(s)]=s;function c(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function l(e,t,n){for(var i,a,o=[],s=t;s<n;s+=3)i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(r[(a=i)>>18&63]+r[a>>12&63]+r[a>>6&63]+r[63&a]);return o.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,n,r,i){var a,o,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,p=n?-1:1,f=e[t+h];for(h+=p,a=f&(1<<-l)-1,f>>=-l,l+=s;l>0;a=256*a+e[t+h],h+=p,l-=8);for(o=a&(1<<-l)-1,a>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=p,l-=8);if(0===a)a=1-c;else{if(a===u)return o?NaN:1/0*(f?-1:1);o+=Math.pow(2,r),a-=c}return(f?-1:1)*o*Math.pow(2,a-r)},t.write=function(e,t,n,r,i,a){var o,s,u,c=8*a-i-1,l=(1<<c)-1,h=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,f=r?0:a-1,d=r?1:-1,m=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?p/u:p*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,i),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,i),o=0));i>=8;e[n+f]=255&s,f+=d,s/=256,i-=8);for(o=o<<i|s,c+=i;c>0;e[n+f]=255&o,f+=d,o/=256,c-=8);e[n+f-d]|=128*m}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){var r=n(50),i=n(51),a=n(49).Buffer,o=[1518500249,1859775393,-1894007588,-899497514],s=new Array(80);function u(){this.init(),this._w=s,i.call(this,64,56)}function c(e){return e<<5|e>>>27}function l(e){return e<<30|e>>>2}function h(e,t,n,r){return 0===e?t&n|~t&r:2===e?t&n|t&r|n&r:t^n^r}r(u,i),u.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},u.prototype._update=function(e){for(var t,n=this._w,r=0|this._a,i=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,p=0;p<16;++p)n[p]=e.readInt32BE(4*p);for(;p<80;++p)n[p]=(t=n[p-3]^n[p-8]^n[p-14]^n[p-16])<<1|t>>>31;for(var f=0;f<80;++f){var d=~~(f/20),m=c(r)+h(d,i,a,s)+u+n[f]+o[d]|0;u=s,s=a,a=l(i),i=r,r=m}this._a=r+this._a|0,this._b=i+this._b|0,this._c=a+this._c|0,this._d=s+this._d|0,this._e=u+this._e|0},u.prototype._hash=function(){var e=a.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=u},function(e,t,n){var r=n(50),i=n(75),a=n(51),o=n(49).Buffer,s=new Array(64);function u(){this.init(),this._w=s,a.call(this,64,56)}r(u,i),u.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=u},function(e,t,n){var r=n(50),i=n(76),a=n(51),o=n(49).Buffer,s=new Array(160);function u(){this.init(),this._w=s,a.call(this,128,112)}r(u,i),u.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},u.prototype._hash=function(){var e=o.allocUnsafe(48);function t(t,n,r){e.writeInt32BE(t,r),e.writeInt32BE(n,r+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=u},function(e,t,n){(function(e,r){var i;!function(a){t&&t.nodeType,e&&e.nodeType;var o="object"==typeof r&&r;o.global!==o&&o.window!==o&&o.self;var s,u=2147483647,c=/^xn--/,l=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,p={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},f=Math.floor,d=String.fromCharCode;function m(e){throw new RangeError(p[e])}function y(e,t){for(var n=e.length,r=[];n--;)r[n]=t(e[n]);return r}function v(e,t){var n=e.split("@"),r="";return n.length>1&&(r=n[0]+"@",e=n[1]),r+y((e=e.replace(h,".")).split("."),t).join(".")}function g(e){for(var t,n,r=[],i=0,a=e.length;i<a;)(t=e.charCodeAt(i++))>=55296&&t<=56319&&i<a?56320==(64512&(n=e.charCodeAt(i++)))?r.push(((1023&t)<<10)+(1023&n)+65536):(r.push(t),i--):r.push(t);return r}function b(e){return y(e,(function(e){var t="";return e>65535&&(t+=d((e-=65536)>>>10&1023|55296),e=56320|1023&e),t+=d(e)})).join("")}function E(e,t){return e+22+75*(e<26)-((0!=t)<<5)}function T(e,t,n){var r=0;for(e=n?f(e/700):e>>1,e+=f(e/t);e>455;r+=36)e=f(e/35);return f(r+36*e/(e+38))}function N(e){var t,n,r,i,a,o,s,c,l,h,p,d=[],y=e.length,v=0,g=128,E=72;for((n=e.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)e.charCodeAt(r)>=128&&m("not-basic"),d.push(e.charCodeAt(r));for(i=n>0?n+1:0;i<y;){for(a=v,o=1,s=36;i>=y&&m("invalid-input"),((c=(p=e.charCodeAt(i++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:36)>=36||c>f((u-v)/o))&&m("overflow"),v+=c*o,!(c<(l=s<=E?1:s>=E+26?26:s-E));s+=36)o>f(u/(h=36-l))&&m("overflow"),o*=h;E=T(v-a,t=d.length+1,0==a),f(v/t)>u-g&&m("overflow"),g+=f(v/t),v%=t,d.splice(v++,0,g)}return b(d)}function w(e){var t,n,r,i,a,o,s,c,l,h,p,y,v,b,N,w=[];for(y=(e=g(e)).length,t=128,n=0,a=72,o=0;o<y;++o)(p=e[o])<128&&w.push(d(p));for(r=i=w.length,i&&w.push("-");r<y;){for(s=u,o=0;o<y;++o)(p=e[o])>=t&&p<s&&(s=p);for(s-t>f((u-n)/(v=r+1))&&m("overflow"),n+=(s-t)*v,t=s,o=0;o<y;++o)if((p=e[o])<t&&++n>u&&m("overflow"),p==t){for(c=n,l=36;!(c<(h=l<=a?1:l>=a+26?26:l-a));l+=36)N=c-h,b=36-h,w.push(d(E(h+N%b,0))),c=f(N/b);w.push(d(E(c,0))),a=T(n,v,r==i),n=0,++r}++n,++t}return w.join("")}s={version:"1.4.1",ucs2:{decode:g,encode:b},decode:N,encode:w,toASCII:function(e){return v(e,(function(e){return l.test(e)?"xn--"+w(e):e}))},toUnicode:function(e){return v(e,(function(e){return c.test(e)?N(e.slice(4).toLowerCase()):e}))}},void 0===(i=function(){return s}.call(t,n,t,e))||(e.exports=i)}()}).call(this,n(104)(e),n(61))},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},function(e,t,n){"use strict";e.exports={isString:function(e){return"string"===typeof e},isObject:function(e){return"object"===typeof e&&null!==e},isNull:function(e){return null===e},isNullOrUndefined:function(e){return null==e}}},function(e,t,n){"use strict";t.decode=t.parse=n(107),t.encode=t.stringify=n(108)},function(e,t,n){"use strict";function r(e,t){return Object.prototype.hasOwnProperty.call(e,t)}e.exports=function(e,t,n,a){t=t||"&",n=n||"=";var o={};if("string"!==typeof e||0===e.length)return o;var s=/\+/g;e=e.split(t);var u=1e3;a&&"number"===typeof a.maxKeys&&(u=a.maxKeys);var c=e.length;u>0&&c>u&&(c=u);for(var l=0;l<c;++l){var h,p,f,d,m=e[l].replace(s,"%20"),y=m.indexOf(n);y>=0?(h=m.substr(0,y),p=m.substr(y+1)):(h=m,p=""),f=decodeURIComponent(h),d=decodeURIComponent(p),r(o,f)?i(o[f])?o[f].push(d):o[f]=[o[f],d]:o[f]=d}return o};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)}},function(e,t,n){"use strict";var r=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};e.exports=function(e,t,n,s){return t=t||"&",n=n||"=",null===e&&(e=void 0),"object"===typeof e?a(o(e),(function(o){var s=encodeURIComponent(r(o))+n;return i(e[o])?a(e[o],(function(e){return s+encodeURIComponent(r(e))})).join(t):s+encodeURIComponent(r(e[o]))})).join(t):s?encodeURIComponent(r(s))+n+encodeURIComponent(r(e)):""};var i=Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)};function a(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++)n.push(t(e[r],r));return n}var o=Object.keys||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.push(n);return t}},function(e,t,n){"use strict";var r=n(77),i="function"===typeof Symbol&&Symbol.for,a=i?Symbol.for("react.element"):60103,o=i?Symbol.for("react.portal"):60106,s=i?Symbol.for("react.fragment"):60107,u=i?Symbol.for("react.strict_mode"):60108,c=i?Symbol.for("react.profiler"):60114,l=i?Symbol.for("react.provider"):60109,h=i?Symbol.for("react.context"):60110,p=i?Symbol.for("react.forward_ref"):60112,f=i?Symbol.for("react.suspense"):60113,d=i?Symbol.for("react.memo"):60115,m=i?Symbol.for("react.lazy"):60116,y="function"===typeof Symbol&&Symbol.iterator;function v(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var g={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},b={};function E(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||g}function T(){}function N(e,t,n){this.props=e,this.context=t,this.refs=b,this.updater=n||g}E.prototype.isReactComponent={},E.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error(v(85));this.updater.enqueueSetState(this,e,t,"setState")},E.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},T.prototype=E.prototype;var w=N.prototype=new T;w.constructor=N,r(w,E.prototype),w.isPureReactComponent=!0;var A={current:null},C=Object.prototype.hasOwnProperty,S={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,n){var r,i={},o=null,s=null;if(null!=t)for(r in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)C.call(t,r)&&!S.hasOwnProperty(r)&&(i[r]=t[r]);var u=arguments.length-2;if(1===u)i.children=n;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(r in u=e.defaultProps)void 0===i[r]&&(i[r]=u[r]);return{$$typeof:a,type:e,key:o,ref:s,props:i,_owner:A.current}}function M(e){return"object"===typeof e&&null!==e&&e.$$typeof===a}var O=/\/+/g,P=[];function x(e,t,n,r){if(P.length){var i=P.pop();return i.result=e,i.keyPrefix=t,i.func=n,i.context=r,i.count=0,i}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function I(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>P.length&&P.push(e)}function _(e,t,n){return null==e?0:function e(t,n,r,i){var s=typeof t;"undefined"!==s&&"boolean"!==s||(t=null);var u=!1;if(null===t)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(t.$$typeof){case a:case o:u=!0}}if(u)return r(i,t,""===n?"."+L(t,0):n),1;if(u=0,n=""===n?".":n+":",Array.isArray(t))for(var c=0;c<t.length;c++){var l=n+L(s=t[c],c);u+=e(s,l,r,i)}else if(null===t||"object"!==typeof t?l=null:l="function"===typeof(l=y&&t[y]||t["@@iterator"])?l:null,"function"===typeof l)for(t=l.call(t),c=0;!(s=t.next()).done;)u+=e(s=s.value,l=n+L(s,c++),r,i);else if("object"===s)throw r=""+t,Error(v(31,"[object Object]"===r?"object with keys {"+Object.keys(t).join(", ")+"}":r,""));return u}(e,"",t,n)}function L(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,(function(e){return t[e]}))}(e.key):t.toString(36)}function D(e,t){e.func.call(e.context,t,e.count++)}function q(e,t,n){var r=e.result,i=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?j(e,r,n,(function(e){return e})):null!=e&&(M(e)&&(e=function(e,t){return{$$typeof:a,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,i+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(O,"$&/")+"/")+n)),r.push(e))}function j(e,t,n,r,i){var a="";null!=n&&(a=(""+n).replace(O,"$&/")+"/"),_(e,q,t=x(t,a,r,i)),I(t)}var U={current:null};function B(){var e=U.current;if(null===e)throw Error(v(321));return e}var k={ReactCurrentDispatcher:U,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:A,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return j(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;_(e,D,t=x(null,null,t,n)),I(t)},count:function(e){return _(e,(function(){return null}),null)},toArray:function(e){var t=[];return j(e,t,null,(function(e){return e})),t},only:function(e){if(!M(e))throw Error(v(143));return e}},t.Component=E,t.Fragment=s,t.Profiler=c,t.PureComponent=N,t.StrictMode=u,t.Suspense=f,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=k,t.cloneElement=function(e,t,n){if(null===e||void 0===e)throw Error(v(267,e));var i=r({},e.props),o=e.key,s=e.ref,u=e._owner;if(null!=t){if(void 0!==t.ref&&(s=t.ref,u=A.current),void 0!==t.key&&(o=""+t.key),e.type&&e.type.defaultProps)var c=e.type.defaultProps;for(l in t)C.call(t,l)&&!S.hasOwnProperty(l)&&(i[l]=void 0===t[l]&&void 0!==c?c[l]:t[l])}var l=arguments.length-2;if(1===l)i.children=n;else if(1<l){c=Array(l);for(var h=0;h<l;h++)c[h]=arguments[h+2];i.children=c}return{$$typeof:a,type:e.type,key:o,ref:s,props:i,_owner:u}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:h,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:p,render:e}},t.isValidElement=M,t.lazy=function(e){return{$$typeof:m,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return B().useCallback(e,t)},t.useContext=function(e,t){return B().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return B().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return B().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return B().useLayoutEffect(e,t)},t.useMemo=function(e,t){return B().useMemo(e,t)},t.useReducer=function(e,t,n){return B().useReducer(e,t,n)},t.useRef=function(e){return B().useRef(e)},t.useState=function(e){return B().useState(e)},t.version="16.13.1"},function(e,t,n){"use strict";var r=n(44),i=n(77),a=n(111);function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}if(!r)throw Error(o(227));function s(e,t,n,r,i,a,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var u=!1,c=null,l=!1,h=null,p={onError:function(e){u=!0,c=e}};function f(e,t,n,r,i,a,o,l,h){u=!1,c=null,s.apply(p,arguments)}var d=null,m=null,y=null;function v(e,t,n){var r=e.type||"unknown-event";e.currentTarget=y(n),function(e,t,n,r,i,a,s,p,d){if(f.apply(this,arguments),u){if(!u)throw Error(o(198));var m=c;u=!1,c=null,l||(l=!0,h=m)}}(r,t,void 0,e),e.currentTarget=null}var g=null,b={};function E(){if(g)for(var e in b){var t=b[e],n=g.indexOf(e);if(!(-1<n))throw Error(o(96,e));if(!N[n]){if(!t.extractEvents)throw Error(o(97,e));for(var r in N[n]=t,n=t.eventTypes){var i=void 0,a=n[r],s=t,u=r;if(w.hasOwnProperty(u))throw Error(o(99,u));w[u]=a;var c=a.phasedRegistrationNames;if(c){for(i in c)c.hasOwnProperty(i)&&T(c[i],s,u);i=!0}else a.registrationName?(T(a.registrationName,s,u),i=!0):i=!1;if(!i)throw Error(o(98,r,e))}}}}function T(e,t,n){if(A[e])throw Error(o(100,e));A[e]=t,C[e]=t.eventTypes[n].dependencies}var N=[],w={},A={},C={};function S(e){var t,n=!1;for(t in e)if(e.hasOwnProperty(t)){var r=e[t];if(!b.hasOwnProperty(t)||b[t]!==r){if(b[t])throw Error(o(102,t));b[t]=r,n=!0}}n&&E()}var R=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=null,O=null,P=null;function x(e){if(e=m(e)){if("function"!==typeof M)throw Error(o(280));var t=e.stateNode;t&&(t=d(t),M(e.stateNode,e.type,t))}}function I(e){O?P?P.push(e):P=[e]:O=e}function _(){if(O){var e=O,t=P;if(P=O=null,x(e),t)for(e=0;e<t.length;e++)x(t[e])}}function L(e,t){return e(t)}function D(e,t,n,r,i){return e(t,n,r,i)}function q(){}var j=L,U=!1,B=!1;function k(){null===O&&null===P||(q(),_())}function F(e,t,n){if(B)return e(t,n);B=!0;try{return j(e,t,n)}finally{B=!1,k()}}var V=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Q=Object.prototype.hasOwnProperty,K={},H={};function z(e,t,n,r,i,a){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=i,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=a}var W={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){W[e]=new z(e,0,!1,e,null,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];W[t]=new z(t,1,!1,e[1],null,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){W[e]=new z(e,2,!1,e.toLowerCase(),null,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){W[e]=new z(e,2,!1,e,null,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){W[e]=new z(e,3,!1,e.toLowerCase(),null,!1)})),["checked","multiple","muted","selected"].forEach((function(e){W[e]=new z(e,3,!0,e,null,!1)})),["capture","download"].forEach((function(e){W[e]=new z(e,4,!1,e,null,!1)})),["cols","rows","size","span"].forEach((function(e){W[e]=new z(e,6,!1,e,null,!1)})),["rowSpan","start"].forEach((function(e){W[e]=new z(e,5,!1,e.toLowerCase(),null,!1)}));var Y=/[\-:]([a-z])/g;function G(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(Y,G);W[t]=new z(t,1,!1,e,null,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(Y,G);W[t]=new z(t,1,!1,e,"http://www.w3.org/1999/xlink",!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(Y,G);W[t]=new z(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1)})),["tabIndex","crossOrigin"].forEach((function(e){W[e]=new z(e,1,!1,e.toLowerCase(),null,!1)})),W.xlinkHref=new z("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0),["src","href","action","formAction"].forEach((function(e){W[e]=new z(e,1,!1,e.toLowerCase(),null,!0)}));var J=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;function X(e,t,n,r){var i=W.hasOwnProperty(t)?W[t]:null;(null!==i?0===i.type:!r&&(2<t.length&&("o"===t[0]||"O"===t[0])&&("n"===t[1]||"N"===t[1])))||(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,i,r)&&(n=null),r||null===i?function(e){return!!Q.call(H,e)||!Q.call(K,e)&&(V.test(e)?H[e]=!0:(K[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):i.mustUseProperty?e[i.propertyName]=null===n?3!==i.type&&"":n:(t=i.attributeName,r=i.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(i=i.type)||4===i&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}J.hasOwnProperty("ReactCurrentDispatcher")||(J.ReactCurrentDispatcher={current:null}),J.hasOwnProperty("ReactCurrentBatchConfig")||(J.ReactCurrentBatchConfig={suspense:null});var $=/^(.*)[\\\/]/,Z="function"===typeof Symbol&&Symbol.for,ee=Z?Symbol.for("react.element"):60103,te=Z?Symbol.for("react.portal"):60106,ne=Z?Symbol.for("react.fragment"):60107,re=Z?Symbol.for("react.strict_mode"):60108,ie=Z?Symbol.for("react.profiler"):60114,ae=Z?Symbol.for("react.provider"):60109,oe=Z?Symbol.for("react.context"):60110,se=Z?Symbol.for("react.concurrent_mode"):60111,ue=Z?Symbol.for("react.forward_ref"):60112,ce=Z?Symbol.for("react.suspense"):60113,le=Z?Symbol.for("react.suspense_list"):60120,he=Z?Symbol.for("react.memo"):60115,pe=Z?Symbol.for("react.lazy"):60116,fe=Z?Symbol.for("react.block"):60121,de="function"===typeof Symbol&&Symbol.iterator;function me(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=de&&e[de]||e["@@iterator"])?e:null}function ye(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case ne:return"Fragment";case te:return"Portal";case ie:return"Profiler";case re:return"StrictMode";case ce:return"Suspense";case le:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case oe:return"Context.Consumer";case ae:return"Context.Provider";case ue:var t=e.render;return t=t.displayName||t.name||"",e.displayName||(""!==t?"ForwardRef("+t+")":"ForwardRef");case he:return ye(e.type);case fe:return ye(e.render);case pe:if(e=1===e._status?e._result:null)return ye(e)}return null}function ve(e){var t="";do{e:switch(e.tag){case 3:case 4:case 6:case 7:case 10:case 9:var n="";break e;default:var r=e._debugOwner,i=e._debugSource,a=ye(e.type);n=null,r&&(n=ye(r.type)),r=a,a="",i?a=" (at "+i.fileName.replace($,"")+":"+i.lineNumber+")":n&&(a=" (created by "+n+")"),n="\n    in "+(r||"Unknown")+a}t+=n,e=e.return}while(e);return t}function ge(e){switch(typeof e){case"boolean":case"number":case"object":case"string":case"undefined":return e;default:return""}}function be(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function Ee(e){e._valueTracker||(e._valueTracker=function(e){var t=be(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,a=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,a.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function Te(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=be(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function Ne(e,t){var n=t.checked;return i({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function we(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=ge(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Ae(e,t){null!=(t=t.checked)&&X(e,"checked",t,!1)}function Ce(e,t){Ae(e,t);var n=ge(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?Re(e,t.type,n):t.hasOwnProperty("defaultValue")&&Re(e,t.type,ge(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function Se(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function Re(e,t,n){"number"===t&&e.ownerDocument.activeElement===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}function Me(e,t){return e=i({children:void 0},t),(t=function(e){var t="";return r.Children.forEach(e,(function(e){null!=e&&(t+=e)})),t}(t.children))&&(e.children=t),e}function Oe(e,t,n,r){if(e=e.options,t){t={};for(var i=0;i<n.length;i++)t["$"+n[i]]=!0;for(n=0;n<e.length;n++)i=t.hasOwnProperty("$"+e[n].value),e[n].selected!==i&&(e[n].selected=i),i&&r&&(e[n].defaultSelected=!0)}else{for(n=""+ge(n),t=null,i=0;i<e.length;i++){if(e[i].value===n)return e[i].selected=!0,void(r&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function Pe(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(o(91));return i({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function xe(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(o(92));if(Array.isArray(n)){if(!(1>=n.length))throw Error(o(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:ge(n)}}function Ie(e,t){var n=ge(t.value),r=ge(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function _e(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}var Le="http://www.w3.org/1999/xhtml",De="http://www.w3.org/2000/svg";function qe(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function je(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?qe(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var Ue,Be=function(e){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(t,n,r,i){MSApp.execUnsafeLocalFunction((function(){return e(t,n)}))}:e}((function(e,t){if(e.namespaceURI!==De||"innerHTML"in e)e.innerHTML=t;else{for((Ue=Ue||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=Ue.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}}));function ke(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}function Fe(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Ve={animationend:Fe("Animation","AnimationEnd"),animationiteration:Fe("Animation","AnimationIteration"),animationstart:Fe("Animation","AnimationStart"),transitionend:Fe("Transition","TransitionEnd")},Qe={},Ke={};function He(e){if(Qe[e])return Qe[e];if(!Ve[e])return e;var t,n=Ve[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ke)return Qe[e]=n[t];return e}R&&(Ke=document.createElement("div").style,"AnimationEvent"in window||(delete Ve.animationend.animation,delete Ve.animationiteration.animation,delete Ve.animationstart.animation),"TransitionEvent"in window||delete Ve.transitionend.transition);var ze=He("animationend"),We=He("animationiteration"),Ye=He("animationstart"),Ge=He("transitionend"),Je="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Xe=new("function"===typeof WeakMap?WeakMap:Map);function $e(e){var t=Xe.get(e);return void 0===t&&(t=new Map,Xe.set(e,t)),t}function Ze(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(1026&(t=e).effectTag)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function et(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function tt(e){if(Ze(e)!==e)throw Error(o(188))}function nt(e){if(!(e=function(e){var t=e.alternate;if(!t){if(null===(t=Ze(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var i=n.return;if(null===i)break;var a=i.alternate;if(null===a){if(null!==(r=i.return)){n=r;continue}break}if(i.child===a.child){for(a=i.child;a;){if(a===n)return tt(i),e;if(a===r)return tt(i),t;a=a.sibling}throw Error(o(188))}if(n.return!==r.return)n=i,r=a;else{for(var s=!1,u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s){for(u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}(e)))return null;for(var t=e;;){if(5===t.tag||6===t.tag)return t;if(t.child)t.child.return=t,t=t.child;else{if(t===e)break;for(;!t.sibling;){if(!t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}}return null}function rt(e,t){if(null==t)throw Error(o(30));return null==e?t:Array.isArray(e)?Array.isArray(t)?(e.push.apply(e,t),e):(e.push(t),e):Array.isArray(t)?[e].concat(t):[e,t]}function it(e,t,n){Array.isArray(e)?e.forEach(t,n):e&&t.call(n,e)}var at=null;function ot(e){if(e){var t=e._dispatchListeners,n=e._dispatchInstances;if(Array.isArray(t))for(var r=0;r<t.length&&!e.isPropagationStopped();r++)v(e,t[r],n[r]);else t&&v(e,t,n);e._dispatchListeners=null,e._dispatchInstances=null,e.isPersistent()||e.constructor.release(e)}}function st(e){if(null!==e&&(at=rt(at,e)),e=at,at=null,e){if(it(e,ot),at)throw Error(o(95));if(l)throw e=h,l=!1,h=null,e}}function ut(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}function ct(e){if(!R)return!1;var t=(e="on"+e)in document;return t||((t=document.createElement("div")).setAttribute(e,"return;"),t="function"===typeof t[e]),t}var lt=[];function ht(e){e.topLevelType=null,e.nativeEvent=null,e.targetInst=null,e.ancestors.length=0,10>lt.length&&lt.push(e)}function pt(e,t,n,r){if(lt.length){var i=lt.pop();return i.topLevelType=e,i.eventSystemFlags=r,i.nativeEvent=t,i.targetInst=n,i}return{topLevelType:e,eventSystemFlags:r,nativeEvent:t,targetInst:n,ancestors:[]}}function ft(e){var t=e.targetInst,n=t;do{if(!n){e.ancestors.push(n);break}var r=n;if(3===r.tag)r=r.stateNode.containerInfo;else{for(;r.return;)r=r.return;r=3!==r.tag?null:r.stateNode.containerInfo}if(!r)break;5!==(t=n.tag)&&6!==t||e.ancestors.push(n),n=Rn(r)}while(n);for(n=0;n<e.ancestors.length;n++){t=e.ancestors[n];var i=ut(e.nativeEvent);r=e.topLevelType;var a=e.nativeEvent,o=e.eventSystemFlags;0===n&&(o|=64);for(var s=null,u=0;u<N.length;u++){var c=N[u];c&&(c=c.extractEvents(r,t,a,i,o))&&(s=rt(s,c))}st(s)}}function dt(e,t,n){if(!n.has(e)){switch(e){case"scroll":Yt(t,"scroll",!0);break;case"focus":case"blur":Yt(t,"focus",!0),Yt(t,"blur",!0),n.set("blur",null),n.set("focus",null);break;case"cancel":case"close":ct(e)&&Yt(t,e,!0);break;case"invalid":case"submit":case"reset":break;default:-1===Je.indexOf(e)&&Wt(e,t)}n.set(e,null)}}var mt,yt,vt,gt=!1,bt=[],Et=null,Tt=null,Nt=null,wt=new Map,At=new Map,Ct=[],St="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),Rt="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" ");function Mt(e,t,n,r,i){return{blockedOn:e,topLevelType:t,eventSystemFlags:32|n,nativeEvent:i,container:r}}function Ot(e,t){switch(e){case"focus":case"blur":Et=null;break;case"dragenter":case"dragleave":Tt=null;break;case"mouseover":case"mouseout":Nt=null;break;case"pointerover":case"pointerout":wt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":At.delete(t.pointerId)}}function Pt(e,t,n,r,i,a){return null===e||e.nativeEvent!==a?(e=Mt(t,n,r,i,a),null!==t&&(null!==(t=Mn(t))&&yt(t)),e):(e.eventSystemFlags|=r,e)}function xt(e){var t=Rn(e.target);if(null!==t){var n=Ze(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=et(n)))return e.blockedOn=t,void a.unstable_runWithPriority(e.priority,(function(){vt(n)}))}else if(3===t&&n.stateNode.hydrate)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function It(e){if(null!==e.blockedOn)return!1;var t=$t(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);if(null!==t){var n=Mn(t);return null!==n&&yt(n),e.blockedOn=t,!1}return!0}function _t(e,t,n){It(e)&&n.delete(t)}function Lt(){for(gt=!1;0<bt.length;){var e=bt[0];if(null!==e.blockedOn){null!==(e=Mn(e.blockedOn))&&mt(e);break}var t=$t(e.topLevelType,e.eventSystemFlags,e.container,e.nativeEvent);null!==t?e.blockedOn=t:bt.shift()}null!==Et&&It(Et)&&(Et=null),null!==Tt&&It(Tt)&&(Tt=null),null!==Nt&&It(Nt)&&(Nt=null),wt.forEach(_t),At.forEach(_t)}function Dt(e,t){e.blockedOn===t&&(e.blockedOn=null,gt||(gt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Lt)))}function qt(e){function t(t){return Dt(t,e)}if(0<bt.length){Dt(bt[0],e);for(var n=1;n<bt.length;n++){var r=bt[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Et&&Dt(Et,e),null!==Tt&&Dt(Tt,e),null!==Nt&&Dt(Nt,e),wt.forEach(t),At.forEach(t),n=0;n<Ct.length;n++)(r=Ct[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Ct.length&&null===(n=Ct[0]).blockedOn;)xt(n),null===n.blockedOn&&Ct.shift()}var jt={},Ut=new Map,Bt=new Map,kt=["abort","abort",ze,"animationEnd",We,"animationIteration",Ye,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata","loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",Ge,"transitionEnd","waiting","waiting"];function Ft(e,t){for(var n=0;n<e.length;n+=2){var r=e[n],i=e[n+1],a="on"+(i[0].toUpperCase()+i.slice(1));a={phasedRegistrationNames:{bubbled:a,captured:a+"Capture"},dependencies:[r],eventPriority:t},Bt.set(r,t),Ut.set(r,a),jt[i]=a}}Ft("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),0),Ft("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1),Ft(kt,2);for(var Vt="change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),Qt=0;Qt<Vt.length;Qt++)Bt.set(Vt[Qt],0);var Kt=a.unstable_UserBlockingPriority,Ht=a.unstable_runWithPriority,zt=!0;function Wt(e,t){Yt(t,e,!1)}function Yt(e,t,n){var r=Bt.get(t);switch(void 0===r?2:r){case 0:r=Gt.bind(null,t,1,e);break;case 1:r=Jt.bind(null,t,1,e);break;default:r=Xt.bind(null,t,1,e)}n?e.addEventListener(t,r,!0):e.addEventListener(t,r,!1)}function Gt(e,t,n,r){U||q();var i=Xt,a=U;U=!0;try{D(i,e,t,n,r)}finally{(U=a)||k()}}function Jt(e,t,n,r){Ht(Kt,Xt.bind(null,e,t,n,r))}function Xt(e,t,n,r){if(zt)if(0<bt.length&&-1<St.indexOf(e))e=Mt(null,e,t,n,r),bt.push(e);else{var i=$t(e,t,n,r);if(null===i)Ot(e,r);else if(-1<St.indexOf(e))e=Mt(i,e,t,n,r),bt.push(e);else if(!function(e,t,n,r,i){switch(t){case"focus":return Et=Pt(Et,e,t,n,r,i),!0;case"dragenter":return Tt=Pt(Tt,e,t,n,r,i),!0;case"mouseover":return Nt=Pt(Nt,e,t,n,r,i),!0;case"pointerover":var a=i.pointerId;return wt.set(a,Pt(wt.get(a)||null,e,t,n,r,i)),!0;case"gotpointercapture":return a=i.pointerId,At.set(a,Pt(At.get(a)||null,e,t,n,r,i)),!0}return!1}(i,e,t,n,r)){Ot(e,r),e=pt(e,r,null,t);try{F(ft,e)}finally{ht(e)}}}}function $t(e,t,n,r){if(null!==(n=Rn(n=ut(r)))){var i=Ze(n);if(null===i)n=null;else{var a=i.tag;if(13===a){if(null!==(n=et(i)))return n;n=null}else if(3===a){if(i.stateNode.hydrate)return 3===i.tag?i.stateNode.containerInfo:null;n=null}else i!==n&&(n=null)}}e=pt(e,r,n,t);try{F(ft,e)}finally{ht(e)}return null}var Zt={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},en=["Webkit","ms","Moz","O"];function tn(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||Zt.hasOwnProperty(e)&&Zt[e]?(""+t).trim():t+"px"}function nn(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),i=tn(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,i):e[n]=i}}Object.keys(Zt).forEach((function(e){en.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),Zt[t]=Zt[e]}))}));var rn=i({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function an(e,t){if(t){if(rn[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(o(137,e,""));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(o(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(o(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(o(62,""))}}function on(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var sn=Le;function un(e,t){var n=$e(e=9===e.nodeType||11===e.nodeType?e:e.ownerDocument);t=C[t];for(var r=0;r<t.length;r++)dt(t[r],e,n)}function cn(){}function ln(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function hn(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function pn(e,t){var n,r=hn(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=hn(r)}}function fn(){for(var e=window,t=ln();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=ln((e=t.contentWindow).document)}return t}function dn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var mn=null,yn=null;function vn(e,t){switch(e){case"button":case"input":case"select":case"textarea":return!!t.autoFocus}return!1}function gn(e,t){return"textarea"===e||"option"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var bn="function"===typeof setTimeout?setTimeout:void 0,En="function"===typeof clearTimeout?clearTimeout:void 0;function Tn(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break}return e}function Nn(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var wn=Math.random().toString(36).slice(2),An="__reactInternalInstance$"+wn,Cn="__reactEventHandlers$"+wn,Sn="__reactContainere$"+wn;function Rn(e){var t=e[An];if(t)return t;for(var n=e.parentNode;n;){if(t=n[Sn]||n[An]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=Nn(e);null!==e;){if(n=e[An])return n;e=Nn(e)}return t}n=(e=n).parentNode}return null}function Mn(e){return!(e=e[An]||e[Sn])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function On(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(o(33))}function Pn(e){return e[Cn]||null}function xn(e){do{e=e.return}while(e&&5!==e.tag);return e||null}function In(e,t){var n=e.stateNode;if(!n)return null;var r=d(n);if(!r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(o(231,t,typeof n));return n}function _n(e,t,n){(t=In(e,n.dispatchConfig.phasedRegistrationNames[t]))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function Ln(e){if(e&&e.dispatchConfig.phasedRegistrationNames){for(var t=e._targetInst,n=[];t;)n.push(t),t=xn(t);for(t=n.length;0<t--;)_n(n[t],"captured",e);for(t=0;t<n.length;t++)_n(n[t],"bubbled",e)}}function Dn(e,t,n){e&&n&&n.dispatchConfig.registrationName&&(t=In(e,n.dispatchConfig.registrationName))&&(n._dispatchListeners=rt(n._dispatchListeners,t),n._dispatchInstances=rt(n._dispatchInstances,e))}function qn(e){e&&e.dispatchConfig.registrationName&&Dn(e._targetInst,null,e)}function jn(e){it(e,Ln)}var Un=null,Bn=null,kn=null;function Fn(){if(kn)return kn;var e,t,n=Bn,r=n.length,i="value"in Un?Un.value:Un.textContent,a=i.length;for(e=0;e<r&&n[e]===i[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===i[a-t];t++);return kn=i.slice(e,1<t?1-t:void 0)}function Vn(){return!0}function Qn(){return!1}function Kn(e,t,n,r){for(var i in this.dispatchConfig=e,this._targetInst=t,this.nativeEvent=n,e=this.constructor.Interface)e.hasOwnProperty(i)&&((t=e[i])?this[i]=t(n):"target"===i?this.target=r:this[i]=n[i]);return this.isDefaultPrevented=(null!=n.defaultPrevented?n.defaultPrevented:!1===n.returnValue)?Vn:Qn,this.isPropagationStopped=Qn,this}function Hn(e,t,n,r){if(this.eventPool.length){var i=this.eventPool.pop();return this.call(i,e,t,n,r),i}return new this(e,t,n,r)}function zn(e){if(!(e instanceof this))throw Error(o(279));e.destructor(),10>this.eventPool.length&&this.eventPool.push(e)}function Wn(e){e.eventPool=[],e.getPooled=Hn,e.release=zn}i(Kn.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Vn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Vn)},persist:function(){this.isPersistent=Vn},isPersistent:Qn,destructor:function(){var e,t=this.constructor.Interface;for(e in t)this[e]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null,this.isPropagationStopped=this.isDefaultPrevented=Qn,this._dispatchInstances=this._dispatchListeners=null}}),Kn.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:null,isTrusted:null},Kn.extend=function(e){function t(){}function n(){return r.apply(this,arguments)}var r=this;t.prototype=r.prototype;var a=new t;return i(a,n.prototype),n.prototype=a,n.prototype.constructor=n,n.Interface=i({},r.Interface,e),n.extend=r.extend,Wn(n),n},Wn(Kn);var Yn=Kn.extend({data:null}),Gn=Kn.extend({data:null}),Jn=[9,13,27,32],Xn=R&&"CompositionEvent"in window,$n=null;R&&"documentMode"in document&&($n=document.documentMode);var Zn=R&&"TextEvent"in window&&!$n,er=R&&(!Xn||$n&&8<$n&&11>=$n),tr=String.fromCharCode(32),nr={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},rr=!1;function ir(e,t){switch(e){case"keyup":return-1!==Jn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"blur":return!0;default:return!1}}function ar(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var or=!1;var sr={eventTypes:nr,extractEvents:function(e,t,n,r){var i;if(Xn)e:{switch(e){case"compositionstart":var a=nr.compositionStart;break e;case"compositionend":a=nr.compositionEnd;break e;case"compositionupdate":a=nr.compositionUpdate;break e}a=void 0}else or?ir(e,n)&&(a=nr.compositionEnd):"keydown"===e&&229===n.keyCode&&(a=nr.compositionStart);return a?(er&&"ko"!==n.locale&&(or||a!==nr.compositionStart?a===nr.compositionEnd&&or&&(i=Fn()):(Bn="value"in(Un=r)?Un.value:Un.textContent,or=!0)),a=Yn.getPooled(a,t,n,r),i?a.data=i:null!==(i=ar(n))&&(a.data=i),jn(a),i=a):i=null,(e=Zn?function(e,t){switch(e){case"compositionend":return ar(t);case"keypress":return 32!==t.which?null:(rr=!0,tr);case"textInput":return(e=t.data)===tr&&rr?null:e;default:return null}}(e,n):function(e,t){if(or)return"compositionend"===e||!Xn&&ir(e,t)?(e=Fn(),kn=Bn=Un=null,or=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return er&&"ko"!==t.locale?null:t.data;default:return null}}(e,n))?((t=Gn.getPooled(nr.beforeInput,t,n,r)).data=e,jn(t)):t=null,null===i?t:null===t?i:[i,t]}},ur={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!ur[e.type]:"textarea"===t}var lr={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}};function hr(e,t,n){return(e=Kn.getPooled(lr.change,e,t,n)).type="change",I(n),jn(e),e}var pr=null,fr=null;function dr(e){st(e)}function mr(e){if(Te(On(e)))return e}function yr(e,t){if("change"===e)return t}var vr=!1;function gr(){pr&&(pr.detachEvent("onpropertychange",br),fr=pr=null)}function br(e){if("value"===e.propertyName&&mr(fr))if(e=hr(fr,e,ut(e)),U)st(e);else{U=!0;try{L(dr,e)}finally{U=!1,k()}}}function Er(e,t,n){"focus"===e?(gr(),fr=n,(pr=t).attachEvent("onpropertychange",br)):"blur"===e&&gr()}function Tr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return mr(fr)}function Nr(e,t){if("click"===e)return mr(t)}function wr(e,t){if("input"===e||"change"===e)return mr(t)}R&&(vr=ct("input")&&(!document.documentMode||9<document.documentMode));var Ar={eventTypes:lr,_isInputEventSupported:vr,extractEvents:function(e,t,n,r){var i=t?On(t):window,a=i.nodeName&&i.nodeName.toLowerCase();if("select"===a||"input"===a&&"file"===i.type)var o=yr;else if(cr(i))if(vr)o=wr;else{o=Tr;var s=Er}else(a=i.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===i.type||"radio"===i.type)&&(o=Nr);if(o&&(o=o(e,t)))return hr(o,n,r);s&&s(e,i,t),"blur"===e&&(e=i._wrapperState)&&e.controlled&&"number"===i.type&&Re(i,"number",i.value)}},Cr=Kn.extend({view:null,detail:null}),Sr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Rr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=Sr[e])&&!!t[e]}function Mr(){return Rr}var Or=0,Pr=0,xr=!1,Ir=!1,_r=Cr.extend({screenX:null,screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:Mr,button:null,buttons:null,relatedTarget:function(e){return e.relatedTarget||(e.fromElement===e.srcElement?e.toElement:e.fromElement)},movementX:function(e){if("movementX"in e)return e.movementX;var t=Or;return Or=e.screenX,xr?"mousemove"===e.type?e.screenX-t:0:(xr=!0,0)},movementY:function(e){if("movementY"in e)return e.movementY;var t=Pr;return Pr=e.screenY,Ir?"mousemove"===e.type?e.screenY-t:0:(Ir=!0,0)}}),Lr=_r.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),Dr={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout","pointerover"]}},qr={eventTypes:Dr,extractEvents:function(e,t,n,r,i){var a="mouseover"===e||"pointerover"===e,o="mouseout"===e||"pointerout"===e;if(a&&0===(32&i)&&(n.relatedTarget||n.fromElement)||!o&&!a)return null;(a=r.window===r?r:(a=r.ownerDocument)?a.defaultView||a.parentWindow:window,o)?(o=t,null!==(t=(t=n.relatedTarget||n.toElement)?Rn(t):null)&&(t!==Ze(t)||5!==t.tag&&6!==t.tag)&&(t=null)):o=null;if(o===t)return null;if("mouseout"===e||"mouseover"===e)var s=_r,u=Dr.mouseLeave,c=Dr.mouseEnter,l="mouse";else"pointerout"!==e&&"pointerover"!==e||(s=Lr,u=Dr.pointerLeave,c=Dr.pointerEnter,l="pointer");if(e=null==o?a:On(o),a=null==t?a:On(t),(u=s.getPooled(u,o,n,r)).type=l+"leave",u.target=e,u.relatedTarget=a,(n=s.getPooled(c,t,n,r)).type=l+"enter",n.target=a,n.relatedTarget=e,l=t,(r=o)&&l)e:{for(c=l,o=0,e=s=r;e;e=xn(e))o++;for(e=0,t=c;t;t=xn(t))e++;for(;0<o-e;)s=xn(s),o--;for(;0<e-o;)c=xn(c),e--;for(;o--;){if(s===c||s===c.alternate)break e;s=xn(s),c=xn(c)}s=null}else s=null;for(c=s,s=[];r&&r!==c&&(null===(o=r.alternate)||o!==c);)s.push(r),r=xn(r);for(r=[];l&&l!==c&&(null===(o=l.alternate)||o!==c);)r.push(l),l=xn(l);for(l=0;l<s.length;l++)Dn(s[l],"bubbled",u);for(l=r.length;0<l--;)Dn(r[l],"captured",n);return 0===(64&i)?[u]:[u,n]}};var jr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Ur=Object.prototype.hasOwnProperty;function Br(e,t){if(jr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++)if(!Ur.call(t,n[r])||!jr(e[n[r]],t[n[r]]))return!1;return!0}var kr=R&&"documentMode"in document&&11>=document.documentMode,Fr={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},Vr=null,Qr=null,Kr=null,Hr=!1;function zr(e,t){var n=t.window===t?t.document:9===t.nodeType?t:t.ownerDocument;return Hr||null==Vr||Vr!==ln(n)?null:("selectionStart"in(n=Vr)&&dn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},Kr&&Br(Kr,n)?null:(Kr=n,(e=Kn.getPooled(Fr.select,Qr,e,t)).type="select",e.target=Vr,jn(e),e))}var Wr={eventTypes:Fr,extractEvents:function(e,t,n,r,i,a){if(!(a=!(i=a||(r.window===r?r.document:9===r.nodeType?r:r.ownerDocument)))){e:{i=$e(i),a=C.onSelect;for(var o=0;o<a.length;o++)if(!i.has(a[o])){i=!1;break e}i=!0}a=!i}if(a)return null;switch(i=t?On(t):window,e){case"focus":(cr(i)||"true"===i.contentEditable)&&(Vr=i,Qr=t,Kr=null);break;case"blur":Kr=Qr=Vr=null;break;case"mousedown":Hr=!0;break;case"contextmenu":case"mouseup":case"dragend":return Hr=!1,zr(n,r);case"selectionchange":if(kr)break;case"keydown":case"keyup":return zr(n,r)}return null}},Yr=Kn.extend({animationName:null,elapsedTime:null,pseudoElement:null}),Gr=Kn.extend({clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),Jr=Cr.extend({relatedTarget:null});function Xr(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}var $r={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Zr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},ei=Cr.extend({key:function(e){if(e.key){var t=$r[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Xr(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?Zr[e.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:Mr,charCode:function(e){return"keypress"===e.type?Xr(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Xr(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),ti=_r.extend({dataTransfer:null}),ni=Cr.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:Mr}),ri=Kn.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),ii=_r.extend({deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:null,deltaMode:null}),ai={eventTypes:jt,extractEvents:function(e,t,n,r){var i=Ut.get(e);if(!i)return null;switch(e){case"keypress":if(0===Xr(n))return null;case"keydown":case"keyup":e=ei;break;case"blur":case"focus":e=Jr;break;case"click":if(2===n.button)return null;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":e=_r;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":e=ti;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":e=ni;break;case ze:case We:case Ye:e=Yr;break;case Ge:e=ri;break;case"scroll":e=Cr;break;case"wheel":e=ii;break;case"copy":case"cut":case"paste":e=Gr;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":e=Lr;break;default:e=Kn}return jn(t=e.getPooled(i,t,n,r)),t}};if(g)throw Error(o(101));g=Array.prototype.slice.call("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" ")),E(),d=Pn,m=Mn,y=On,S({SimpleEventPlugin:ai,EnterLeaveEventPlugin:qr,ChangeEventPlugin:Ar,SelectEventPlugin:Wr,BeforeInputEventPlugin:sr});var oi=[],si=-1;function ui(e){0>si||(e.current=oi[si],oi[si]=null,si--)}function ci(e,t){si++,oi[si]=e.current,e.current=t}var li={},hi={current:li},pi={current:!1},fi=li;function di(e,t){var n=e.type.contextTypes;if(!n)return li;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var i,a={};for(i in n)a[i]=t[i];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=a),a}function mi(e){return null!==(e=e.childContextTypes)&&void 0!==e}function yi(){ui(pi),ui(hi)}function vi(e,t,n){if(hi.current!==li)throw Error(o(168));ci(hi,t),ci(pi,n)}function gi(e,t,n){var r=e.stateNode;if(e=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in e))throw Error(o(108,ye(t)||"Unknown",a));return i({},n,{},r)}function bi(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||li,fi=hi.current,ci(hi,e),ci(pi,pi.current),!0}function Ei(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=gi(e,t,fi),r.__reactInternalMemoizedMergedChildContext=e,ui(pi),ui(hi),ci(hi,e)):ui(pi),ci(pi,n)}var Ti=a.unstable_runWithPriority,Ni=a.unstable_scheduleCallback,wi=a.unstable_cancelCallback,Ai=a.unstable_requestPaint,Ci=a.unstable_now,Si=a.unstable_getCurrentPriorityLevel,Ri=a.unstable_ImmediatePriority,Mi=a.unstable_UserBlockingPriority,Oi=a.unstable_NormalPriority,Pi=a.unstable_LowPriority,xi=a.unstable_IdlePriority,Ii={},_i=a.unstable_shouldYield,Li=void 0!==Ai?Ai:function(){},Di=null,qi=null,ji=!1,Ui=Ci(),Bi=1e4>Ui?Ci:function(){return Ci()-Ui};function ki(){switch(Si()){case Ri:return 99;case Mi:return 98;case Oi:return 97;case Pi:return 96;case xi:return 95;default:throw Error(o(332))}}function Fi(e){switch(e){case 99:return Ri;case 98:return Mi;case 97:return Oi;case 96:return Pi;case 95:return xi;default:throw Error(o(332))}}function Vi(e,t){return e=Fi(e),Ti(e,t)}function Qi(e,t,n){return e=Fi(e),Ni(e,t,n)}function Ki(e){return null===Di?(Di=[e],qi=Ni(Ri,zi)):Di.push(e),Ii}function Hi(){if(null!==qi){var e=qi;qi=null,wi(e)}zi()}function zi(){if(!ji&&null!==Di){ji=!0;var e=0;try{var t=Di;Vi(99,(function(){for(;e<t.length;e++){var n=t[e];do{n=n(!0)}while(null!==n)}})),Di=null}catch(n){throw null!==Di&&(Di=Di.slice(e+1)),Ni(Ri,Hi),n}finally{ji=!1}}}function Wi(e,t,n){return 1073741821-(1+((1073741821-e+t/10)/(n/=10)|0))*n}function Yi(e,t){if(e&&e.defaultProps)for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}var Gi={current:null},Ji=null,Xi=null,$i=null;function Zi(){$i=Xi=Ji=null}function ea(e){var t=Gi.current;ui(Gi),e.type._context._currentValue=t}function ta(e,t){for(;null!==e;){var n=e.alternate;if(e.childExpirationTime<t)e.childExpirationTime=t,null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t);else{if(!(null!==n&&n.childExpirationTime<t))break;n.childExpirationTime=t}e=e.return}}function na(e,t){Ji=e,$i=Xi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(e.expirationTime>=t&&(Po=!0),e.firstContext=null)}function ra(e,t){if($i!==e&&!1!==t&&0!==t)if("number"===typeof t&&1073741823!==t||($i=e,t=1073741823),t={context:e,observedBits:t,next:null},null===Xi){if(null===Ji)throw Error(o(308));Xi=t,Ji.dependencies={expirationTime:0,firstContext:t,responders:null}}else Xi=Xi.next=t;return e._currentValue}var ia=!1;function aa(e){e.updateQueue={baseState:e.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oa(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,baseQueue:e.baseQueue,shared:e.shared,effects:e.effects})}function sa(e,t){return(e={expirationTime:e,suspenseConfig:t,tag:0,payload:null,callback:null,next:null}).next=e}function ua(e,t){if(null!==(e=e.updateQueue)){var n=(e=e.shared).pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}}function ca(e,t){var n=e.alternate;null!==n&&oa(n,e),null===(n=(e=e.updateQueue).baseQueue)?(e.baseQueue=t.next=t,t.next=t):(t.next=n.next,n.next=t)}function la(e,t,n,r){var a=e.updateQueue;ia=!1;var o=a.baseQueue,s=a.shared.pending;if(null!==s){if(null!==o){var u=o.next;o.next=s.next,s.next=u}o=s,a.shared.pending=null,null!==(u=e.alternate)&&(null!==(u=u.updateQueue)&&(u.baseQueue=s))}if(null!==o){u=o.next;var c=a.baseState,l=0,h=null,p=null,f=null;if(null!==u)for(var d=u;;){if((s=d.expirationTime)<r){var m={expirationTime:d.expirationTime,suspenseConfig:d.suspenseConfig,tag:d.tag,payload:d.payload,callback:d.callback,next:null};null===f?(p=f=m,h=c):f=f.next=m,s>l&&(l=s)}else{null!==f&&(f=f.next={expirationTime:1073741823,suspenseConfig:d.suspenseConfig,tag:d.tag,payload:d.payload,callback:d.callback,next:null}),au(s,d.suspenseConfig);e:{var y=e,v=d;switch(s=t,m=n,v.tag){case 1:if("function"===typeof(y=v.payload)){c=y.call(m,c,s);break e}c=y;break e;case 3:y.effectTag=-4097&y.effectTag|64;case 0:if(null===(s="function"===typeof(y=v.payload)?y.call(m,c,s):y)||void 0===s)break e;c=i({},c,s);break e;case 2:ia=!0}}null!==d.callback&&(e.effectTag|=32,null===(s=a.effects)?a.effects=[d]:s.push(d))}if(null===(d=d.next)||d===u){if(null===(s=a.shared.pending))break;d=o.next=s.next,s.next=u,a.baseQueue=o=s,a.shared.pending=null}}null===f?h=c:f.next=p,a.baseState=h,a.baseQueue=f,ou(l),e.expirationTime=l,e.memoizedState=c}}function ha(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],i=r.callback;if(null!==i){if(r.callback=null,r=i,i=n,"function"!==typeof r)throw Error(o(191,r));r.call(i)}}}var pa=J.ReactCurrentBatchConfig,fa=(new r.Component).refs;function da(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.expirationTime&&(e.updateQueue.baseState=n)}var ma={isMounted:function(e){return!!(e=e._reactInternalFiber)&&Ze(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternalFiber;var r=zs(),i=pa.suspense;(i=sa(r=Ws(r,e,i),i)).payload=t,void 0!==n&&null!==n&&(i.callback=n),ua(e,i),Ys(e,r)},enqueueReplaceState:function(e,t,n){e=e._reactInternalFiber;var r=zs(),i=pa.suspense;(i=sa(r=Ws(r,e,i),i)).tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),ua(e,i),Ys(e,r)},enqueueForceUpdate:function(e,t){e=e._reactInternalFiber;var n=zs(),r=pa.suspense;(r=sa(n=Ws(n,e,r),r)).tag=2,void 0!==t&&null!==t&&(r.callback=t),ua(e,r),Ys(e,n)}};function ya(e,t,n,r,i,a,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,a,o):!t.prototype||!t.prototype.isPureReactComponent||(!Br(n,r)||!Br(i,a))}function va(e,t,n){var r=!1,i=li,a=t.contextType;return"object"===typeof a&&null!==a?a=ra(a):(i=mi(t)?fi:hi.current,a=(r=null!==(r=t.contextTypes)&&void 0!==r)?di(e,i):li),t=new t(n,a),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=ma,e.stateNode=t,t._reactInternalFiber=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=i,e.__reactInternalMemoizedMaskedChildContext=a),t}function ga(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&ma.enqueueReplaceState(t,t.state,null)}function ba(e,t,n,r){var i=e.stateNode;i.props=n,i.state=e.memoizedState,i.refs=fa,aa(e);var a=t.contextType;"object"===typeof a&&null!==a?i.context=ra(a):(a=mi(t)?fi:hi.current,i.context=di(e,a)),la(e,n,i,r),i.state=e.memoizedState,"function"===typeof(a=t.getDerivedStateFromProps)&&(da(e,t,a,n),i.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof i.getSnapshotBeforeUpdate||"function"!==typeof i.UNSAFE_componentWillMount&&"function"!==typeof i.componentWillMount||(t=i.state,"function"===typeof i.componentWillMount&&i.componentWillMount(),"function"===typeof i.UNSAFE_componentWillMount&&i.UNSAFE_componentWillMount(),t!==i.state&&ma.enqueueReplaceState(i,i.state,null),la(e,n,i,r),i.state=e.memoizedState),"function"===typeof i.componentDidMount&&(e.effectTag|=4)}var Ea=Array.isArray;function Ta(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:((t=function(e){var t=r.refs;t===fa&&(t=r.refs={}),null===e?delete t[i]:t[i]=e})._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function Na(e,t){if("textarea"!==e.type)throw Error(o(31,"[object Object]"===Object.prototype.toString.call(t)?"object with keys {"+Object.keys(t).join(", ")+"}":t,""))}function wa(e){function t(t,n){if(e){var r=t.lastEffect;null!==r?(r.nextEffect=n,t.lastEffect=n):t.firstEffect=t.lastEffect=n,n.nextEffect=null,n.effectTag=8}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function i(e,t){return(e=Su(e,t)).index=0,e.sibling=null,e}function a(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.effectTag=2,n):r:(t.effectTag=2,n):n}function s(t){return e&&null===t.alternate&&(t.effectTag=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Ou(n,e.mode,r)).return=e,t):((t=i(t,n)).return=e,t)}function c(e,t,n,r){return null!==t&&t.elementType===n.type?((r=i(t,n.props)).ref=Ta(e,t,n),r.return=e,r):((r=Ru(n.type,n.key,n.props,null,e.mode,r)).ref=Ta(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Pu(n,e.mode,r)).return=e,t):((t=i(t,n.children||[])).return=e,t)}function h(e,t,n,r,a){return null===t||7!==t.tag?((t=Mu(n,e.mode,r,a)).return=e,t):((t=i(t,n)).return=e,t)}function p(e,t,n){if("string"===typeof t||"number"===typeof t)return(t=Ou(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case ee:return(n=Ru(t.type,t.key,t.props,null,e.mode,n)).ref=Ta(e,null,t),n.return=e,n;case te:return(t=Pu(t,e.mode,n)).return=e,t}if(Ea(t)||me(t))return(t=Mu(t,e.mode,n,null)).return=e,t;Na(e,t)}return null}function f(e,t,n,r){var i=null!==t?t.key:null;if("string"===typeof n||"number"===typeof n)return null!==i?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case ee:return n.key===i?n.type===ne?h(e,t,n.props.children,r,i):c(e,t,n,r):null;case te:return n.key===i?l(e,t,n,r):null}if(Ea(n)||me(n))return null!==i?null:h(e,t,n,r,null);Na(e,n)}return null}function d(e,t,n,r,i){if("string"===typeof r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,i);if("object"===typeof r&&null!==r){switch(r.$$typeof){case ee:return e=e.get(null===r.key?n:r.key)||null,r.type===ne?h(t,e,r.props.children,i,r.key):c(t,e,r,i);case te:return l(t,e=e.get(null===r.key?n:r.key)||null,r,i)}if(Ea(r)||me(r))return h(t,e=e.get(n)||null,r,i,null);Na(t,r)}return null}function m(i,o,s,u){for(var c=null,l=null,h=o,m=o=0,y=null;null!==h&&m<s.length;m++){h.index>m?(y=h,h=null):y=h.sibling;var v=f(i,h,s[m],u);if(null===v){null===h&&(h=y);break}e&&h&&null===v.alternate&&t(i,h),o=a(v,o,m),null===l?c=v:l.sibling=v,l=v,h=y}if(m===s.length)return n(i,h),c;if(null===h){for(;m<s.length;m++)null!==(h=p(i,s[m],u))&&(o=a(h,o,m),null===l?c=h:l.sibling=h,l=h);return c}for(h=r(i,h);m<s.length;m++)null!==(y=d(h,i,m,s[m],u))&&(e&&null!==y.alternate&&h.delete(null===y.key?m:y.key),o=a(y,o,m),null===l?c=y:l.sibling=y,l=y);return e&&h.forEach((function(e){return t(i,e)})),c}function y(i,s,u,c){var l=me(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var h=l=null,m=s,y=s=0,v=null,g=u.next();null!==m&&!g.done;y++,g=u.next()){m.index>y?(v=m,m=null):v=m.sibling;var b=f(i,m,g.value,c);if(null===b){null===m&&(m=v);break}e&&m&&null===b.alternate&&t(i,m),s=a(b,s,y),null===h?l=b:h.sibling=b,h=b,m=v}if(g.done)return n(i,m),l;if(null===m){for(;!g.done;y++,g=u.next())null!==(g=p(i,g.value,c))&&(s=a(g,s,y),null===h?l=g:h.sibling=g,h=g);return l}for(m=r(i,m);!g.done;y++,g=u.next())null!==(g=d(m,i,y,g.value,c))&&(e&&null!==g.alternate&&m.delete(null===g.key?y:g.key),s=a(g,s,y),null===h?l=g:h.sibling=g,h=g);return e&&m.forEach((function(e){return t(i,e)})),l}return function(e,r,a,u){var c="object"===typeof a&&null!==a&&a.type===ne&&null===a.key;c&&(a=a.props.children);var l="object"===typeof a&&null!==a;if(l)switch(a.$$typeof){case ee:e:{for(l=a.key,c=r;null!==c;){if(c.key===l){switch(c.tag){case 7:if(a.type===ne){n(e,c.sibling),(r=i(c,a.props.children)).return=e,e=r;break e}break;default:if(c.elementType===a.type){n(e,c.sibling),(r=i(c,a.props)).ref=Ta(e,c,a),r.return=e,e=r;break e}}n(e,c);break}t(e,c),c=c.sibling}a.type===ne?((r=Mu(a.props.children,e.mode,u,a.key)).return=e,e=r):((u=Ru(a.type,a.key,a.props,null,e.mode,u)).ref=Ta(e,r,a),u.return=e,e=u)}return s(e);case te:e:{for(c=a.key;null!==r;){if(r.key===c){if(4===r.tag&&r.stateNode.containerInfo===a.containerInfo&&r.stateNode.implementation===a.implementation){n(e,r.sibling),(r=i(r,a.children||[])).return=e,e=r;break e}n(e,r);break}t(e,r),r=r.sibling}(r=Pu(a,e.mode,u)).return=e,e=r}return s(e)}if("string"===typeof a||"number"===typeof a)return a=""+a,null!==r&&6===r.tag?(n(e,r.sibling),(r=i(r,a)).return=e,e=r):(n(e,r),(r=Ou(a,e.mode,u)).return=e,e=r),s(e);if(Ea(a))return m(e,r,a,u);if(me(a))return y(e,r,a,u);if(l&&Na(e,a),"undefined"===typeof a&&!c)switch(e.tag){case 1:case 0:throw e=e.type,Error(o(152,e.displayName||e.name||"Component"))}return n(e,r)}}var Aa=wa(!0),Ca=wa(!1),Sa={},Ra={current:Sa},Ma={current:Sa},Oa={current:Sa};function Pa(e){if(e===Sa)throw Error(o(174));return e}function xa(e,t){switch(ci(Oa,t),ci(Ma,e),ci(Ra,Sa),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:je(null,"");break;default:t=je(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}ui(Ra),ci(Ra,t)}function Ia(){ui(Ra),ui(Ma),ui(Oa)}function _a(e){Pa(Oa.current);var t=Pa(Ra.current),n=je(t,e.type);t!==n&&(ci(Ma,e),ci(Ra,n))}function La(e){Ma.current===e&&(ui(Ra),ui(Ma))}var Da={current:0};function qa(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(64&t.effectTag))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}function ja(e,t){return{responder:e,props:t}}var Ua=J.ReactCurrentDispatcher,Ba=J.ReactCurrentBatchConfig,ka=0,Fa=null,Va=null,Qa=null,Ka=!1;function Ha(){throw Error(o(321))}function za(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!jr(e[n],t[n]))return!1;return!0}function Wa(e,t,n,r,i,a){if(ka=a,Fa=t,t.memoizedState=null,t.updateQueue=null,t.expirationTime=0,Ua.current=null===e||null===e.memoizedState?vo:go,e=n(r,i),t.expirationTime===ka){a=0;do{if(t.expirationTime=0,!(25>a))throw Error(o(301));a+=1,Qa=Va=null,t.updateQueue=null,Ua.current=bo,e=n(r,i)}while(t.expirationTime===ka)}if(Ua.current=yo,t=null!==Va&&null!==Va.next,ka=0,Qa=Va=Fa=null,Ka=!1,t)throw Error(o(300));return e}function Ya(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Qa?Fa.memoizedState=Qa=e:Qa=Qa.next=e,Qa}function Ga(){if(null===Va){var e=Fa.alternate;e=null!==e?e.memoizedState:null}else e=Va.next;var t=null===Qa?Fa.memoizedState:Qa.next;if(null!==t)Qa=t,Va=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Va=e).memoizedState,baseState:Va.baseState,baseQueue:Va.baseQueue,queue:Va.queue,next:null},null===Qa?Fa.memoizedState=Qa=e:Qa=Qa.next=e}return Qa}function Ja(e,t){return"function"===typeof t?t(e):t}function Xa(e){var t=Ga(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Va,i=r.baseQueue,a=n.pending;if(null!==a){if(null!==i){var s=i.next;i.next=a.next,a.next=s}r.baseQueue=i=a,n.pending=null}if(null!==i){i=i.next,r=r.baseState;var u=s=a=null,c=i;do{var l=c.expirationTime;if(l<ka){var h={expirationTime:c.expirationTime,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null};null===u?(s=u=h,a=r):u=u.next=h,l>Fa.expirationTime&&(Fa.expirationTime=l,ou(l))}else null!==u&&(u=u.next={expirationTime:1073741823,suspenseConfig:c.suspenseConfig,action:c.action,eagerReducer:c.eagerReducer,eagerState:c.eagerState,next:null}),au(l,c.suspenseConfig),r=c.eagerReducer===e?c.eagerState:e(r,c.action);c=c.next}while(null!==c&&c!==i);null===u?a=r:u.next=s,jr(r,t.memoizedState)||(Po=!0),t.memoizedState=r,t.baseState=a,t.baseQueue=u,n.lastRenderedState=r}return[t.memoizedState,n.dispatch]}function $a(e){var t=Ga(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,i=n.pending,a=t.memoizedState;if(null!==i){n.pending=null;var s=i=i.next;do{a=e(a,s.action),s=s.next}while(s!==i);jr(a,t.memoizedState)||(Po=!0),t.memoizedState=a,null===t.baseQueue&&(t.baseState=a),n.lastRenderedState=a}return[a,r]}function Za(e){var t=Ya();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e=(e=t.queue={pending:null,dispatch:null,lastRenderedReducer:Ja,lastRenderedState:e}).dispatch=mo.bind(null,Fa,e),[t.memoizedState,e]}function eo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=Fa.updateQueue)?(t={lastEffect:null},Fa.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function to(){return Ga().memoizedState}function no(e,t,n,r){var i=Ya();Fa.effectTag|=e,i.memoizedState=eo(1|t,n,void 0,void 0===r?null:r)}function ro(e,t,n,r){var i=Ga();r=void 0===r?null:r;var a=void 0;if(null!==Va){var o=Va.memoizedState;if(a=o.destroy,null!==r&&za(r,o.deps))return void eo(t,n,a,r)}Fa.effectTag|=e,i.memoizedState=eo(1|t,n,a,r)}function io(e,t){return no(516,4,e,t)}function ao(e,t){return ro(516,4,e,t)}function oo(e,t){return ro(4,2,e,t)}function so(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function uo(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,ro(4,2,so.bind(null,t,e),n)}function co(){}function lo(e,t){return Ya().memoizedState=[e,void 0===t?null:t],e}function ho(e,t){var n=Ga();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&za(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function po(e,t){var n=Ga();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&za(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function fo(e,t,n){var r=ki();Vi(98>r?98:r,(function(){e(!0)})),Vi(97<r?97:r,(function(){var r=Ba.suspense;Ba.suspense=void 0===t?null:t;try{e(!1),n()}finally{Ba.suspense=r}}))}function mo(e,t,n){var r=zs(),i=pa.suspense;i={expirationTime:r=Ws(r,e,i),suspenseConfig:i,action:n,eagerReducer:null,eagerState:null,next:null};var a=t.pending;if(null===a?i.next=i:(i.next=a.next,a.next=i),t.pending=i,a=e.alternate,e===Fa||null!==a&&a===Fa)Ka=!0,i.expirationTime=ka,Fa.expirationTime=ka;else{if(0===e.expirationTime&&(null===a||0===a.expirationTime)&&null!==(a=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=a(o,n);if(i.eagerReducer=a,i.eagerState=s,jr(s,o))return}catch(u){}Ys(e,r)}}var yo={readContext:ra,useCallback:Ha,useContext:Ha,useEffect:Ha,useImperativeHandle:Ha,useLayoutEffect:Ha,useMemo:Ha,useReducer:Ha,useRef:Ha,useState:Ha,useDebugValue:Ha,useResponder:Ha,useDeferredValue:Ha,useTransition:Ha},vo={readContext:ra,useCallback:lo,useContext:ra,useEffect:io,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,no(4,2,so.bind(null,t,e),n)},useLayoutEffect:function(e,t){return no(4,2,e,t)},useMemo:function(e,t){var n=Ya();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Ya();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e=(e=r.queue={pending:null,dispatch:null,lastRenderedReducer:e,lastRenderedState:t}).dispatch=mo.bind(null,Fa,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Ya().memoizedState=e},useState:Za,useDebugValue:co,useResponder:ja,useDeferredValue:function(e,t){var n=Za(e),r=n[0],i=n[1];return io((function(){var n=Ba.suspense;Ba.suspense=void 0===t?null:t;try{i(e)}finally{Ba.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Za(!1),n=t[0];return t=t[1],[lo(fo.bind(null,t,e),[t,e]),n]}},go={readContext:ra,useCallback:ho,useContext:ra,useEffect:ao,useImperativeHandle:uo,useLayoutEffect:oo,useMemo:po,useReducer:Xa,useRef:to,useState:function(){return Xa(Ja)},useDebugValue:co,useResponder:ja,useDeferredValue:function(e,t){var n=Xa(Ja),r=n[0],i=n[1];return ao((function(){var n=Ba.suspense;Ba.suspense=void 0===t?null:t;try{i(e)}finally{Ba.suspense=n}}),[e,t]),r},useTransition:function(e){var t=Xa(Ja),n=t[0];return t=t[1],[ho(fo.bind(null,t,e),[t,e]),n]}},bo={readContext:ra,useCallback:ho,useContext:ra,useEffect:ao,useImperativeHandle:uo,useLayoutEffect:oo,useMemo:po,useReducer:$a,useRef:to,useState:function(){return $a(Ja)},useDebugValue:co,useResponder:ja,useDeferredValue:function(e,t){var n=$a(Ja),r=n[0],i=n[1];return ao((function(){var n=Ba.suspense;Ba.suspense=void 0===t?null:t;try{i(e)}finally{Ba.suspense=n}}),[e,t]),r},useTransition:function(e){var t=$a(Ja),n=t[0];return t=t[1],[ho(fo.bind(null,t,e),[t,e]),n]}},Eo=null,To=null,No=!1;function wo(e,t){var n=Au(5,null,null,0);n.elementType="DELETED",n.type="DELETED",n.stateNode=t,n.return=e,n.effectTag=8,null!==e.lastEffect?(e.lastEffect.nextEffect=n,e.lastEffect=n):e.firstEffect=e.lastEffect=n}function Ao(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,!0);case 13:default:return!1}}function Co(e){if(No){var t=To;if(t){var n=t;if(!Ao(e,t)){if(!(t=Tn(n.nextSibling))||!Ao(e,t))return e.effectTag=-1025&e.effectTag|2,No=!1,void(Eo=e);wo(Eo,n)}Eo=e,To=Tn(t.firstChild)}else e.effectTag=-1025&e.effectTag|2,No=!1,Eo=e}}function So(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Eo=e}function Ro(e){if(e!==Eo)return!1;if(!No)return So(e),No=!0,!1;var t=e.type;if(5!==e.tag||"head"!==t&&"body"!==t&&!gn(t,e.memoizedProps))for(t=To;t;)wo(e,t),t=Tn(t.nextSibling);if(So(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){To=Tn(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}To=null}}else To=Eo?Tn(e.stateNode.nextSibling):null;return!0}function Mo(){To=Eo=null,No=!1}var Oo=J.ReactCurrentOwner,Po=!1;function xo(e,t,n,r){t.child=null===e?Ca(t,null,n,r):Aa(t,e.child,n,r)}function Io(e,t,n,r,i){n=n.render;var a=t.ref;return na(t,i),r=Wa(e,t,n,r,a,i),null===e||Po?(t.effectTag|=1,xo(e,t,r,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Yo(e,t,i))}function _o(e,t,n,r,i,a){if(null===e){var o=n.type;return"function"!==typeof o||Cu(o)||void 0!==o.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Ru(n.type,null,r,null,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=o,Lo(e,t,o,r,i,a))}return o=e.child,i<a&&(i=o.memoizedProps,(n=null!==(n=n.compare)?n:Br)(i,r)&&e.ref===t.ref)?Yo(e,t,a):(t.effectTag|=1,(e=Su(o,r)).ref=t.ref,e.return=t,t.child=e)}function Lo(e,t,n,r,i,a){return null!==e&&Br(e.memoizedProps,r)&&e.ref===t.ref&&(Po=!1,i<a)?(t.expirationTime=e.expirationTime,Yo(e,t,a)):qo(e,t,n,r,a)}function Do(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.effectTag|=128)}function qo(e,t,n,r,i){var a=mi(n)?fi:hi.current;return a=di(t,a),na(t,i),n=Wa(e,t,n,r,a,i),null===e||Po?(t.effectTag|=1,xo(e,t,n,i),t.child):(t.updateQueue=e.updateQueue,t.effectTag&=-517,e.expirationTime<=i&&(e.expirationTime=0),Yo(e,t,i))}function jo(e,t,n,r,i){if(mi(n)){var a=!0;bi(t)}else a=!1;if(na(t,i),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),va(t,n,r),ba(t,n,r,i),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=ra(c):c=di(t,c=mi(n)?fi:hi.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&ga(t,o,r,c),ia=!1;var p=t.memoizedState;o.state=p,la(t,r,o,i),u=t.memoizedState,s!==r||p!==u||pi.current||ia?("function"===typeof l&&(da(t,n,l,r),u=t.memoizedState),(s=ia||ya(t,n,s,r,p,u,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.effectTag|=4)):("function"===typeof o.componentDidMount&&(t.effectTag|=4),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.effectTag|=4),r=!1)}else o=t.stateNode,oa(e,t),s=t.memoizedProps,o.props=t.type===t.elementType?s:Yi(t.type,s),u=o.context,"object"===typeof(c=n.contextType)&&null!==c?c=ra(c):c=di(t,c=mi(n)?fi:hi.current),(h="function"===typeof(l=n.getDerivedStateFromProps)||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&ga(t,o,r,c),ia=!1,u=t.memoizedState,o.state=u,la(t,r,o,i),p=t.memoizedState,s!==r||u!==p||pi.current||ia?("function"===typeof l&&(da(t,n,l,r),p=t.memoizedState),(l=ia||ya(t,n,s,r,u,p,c))?(h||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,c),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,c)),"function"===typeof o.componentDidUpdate&&(t.effectTag|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.effectTag|=256)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=c,r=l):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&u===e.memoizedState||(t.effectTag|=256),r=!1);return Uo(e,t,n,r,a,i)}function Uo(e,t,n,r,i,a){Do(e,t);var o=0!==(64&t.effectTag);if(!r&&!o)return i&&Ei(t,n,!1),Yo(e,t,a);r=t.stateNode,Oo.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.effectTag|=1,null!==e&&o?(t.child=Aa(t,e.child,null,a),t.child=Aa(t,null,s,a)):xo(e,t,s,a),t.memoizedState=r.state,i&&Ei(t,n,!0),t.child}function Bo(e){var t=e.stateNode;t.pendingContext?vi(0,t.pendingContext,t.pendingContext!==t.context):t.context&&vi(0,t.context,!1),xa(e,t.containerInfo)}var ko,Fo,Vo,Qo={dehydrated:null,retryTime:0};function Ko(e,t,n){var r,i=t.mode,a=t.pendingProps,o=Da.current,s=!1;if((r=0!==(64&t.effectTag))||(r=0!==(2&o)&&(null===e||null!==e.memoizedState)),r?(s=!0,t.effectTag&=-65):null!==e&&null===e.memoizedState||void 0===a.fallback||!0===a.unstable_avoidThisFallback||(o|=1),ci(Da,1&o),null===e){if(void 0!==a.fallback&&Co(t),s){if(s=a.fallback,(a=Mu(null,i,0,null)).return=t,0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,a.child=e;null!==e;)e.return=a,e=e.sibling;return(n=Mu(s,i,n,null)).return=t,a.sibling=n,t.memoizedState=Qo,t.child=a,n}return i=a.children,t.memoizedState=null,t.child=Ca(t,null,i,n)}if(null!==e.memoizedState){if(i=(e=e.child).sibling,s){if(a=a.fallback,(n=Su(e,e.pendingProps)).return=t,0===(2&t.mode)&&(s=null!==t.memoizedState?t.child.child:t.child)!==e.child)for(n.child=s;null!==s;)s.return=n,s=s.sibling;return(i=Su(i,a)).return=t,n.sibling=i,n.childExpirationTime=0,t.memoizedState=Qo,t.child=n,i}return n=Aa(t,e.child,a.children,n),t.memoizedState=null,t.child=n}if(e=e.child,s){if(s=a.fallback,(a=Mu(null,i,0,null)).return=t,a.child=e,null!==e&&(e.return=a),0===(2&t.mode))for(e=null!==t.memoizedState?t.child.child:t.child,a.child=e;null!==e;)e.return=a,e=e.sibling;return(n=Mu(s,i,n,null)).return=t,a.sibling=n,n.effectTag|=2,a.childExpirationTime=0,t.memoizedState=Qo,t.child=a,n}return t.memoizedState=null,t.child=Aa(t,e,a.children,n)}function Ho(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t),ta(e.return,t)}function zo(e,t,n,r,i,a){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailExpiration:0,tailMode:i,lastEffect:a}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=r,o.tail=n,o.tailExpiration=0,o.tailMode=i,o.lastEffect=a)}function Wo(e,t,n){var r=t.pendingProps,i=r.revealOrder,a=r.tail;if(xo(e,t,r.children,n),0!==(2&(r=Da.current)))r=1&r|2,t.effectTag|=64;else{if(null!==e&&0!==(64&e.effectTag))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Ho(e,n);else if(19===e.tag)Ho(e,n);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ci(Da,r),0===(2&t.mode))t.memoizedState=null;else switch(i){case"forwards":for(n=t.child,i=null;null!==n;)null!==(e=n.alternate)&&null===qa(e)&&(i=n),n=n.sibling;null===(n=i)?(i=t.child,t.child=null):(i=n.sibling,n.sibling=null),zo(t,!1,i,n,a,t.lastEffect);break;case"backwards":for(n=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===qa(e)){t.child=i;break}e=i.sibling,i.sibling=n,n=i,i=e}zo(t,!0,n,null,a,t.lastEffect);break;case"together":zo(t,!1,null,null,void 0,t.lastEffect);break;default:t.memoizedState=null}return t.child}function Yo(e,t,n){null!==e&&(t.dependencies=e.dependencies);var r=t.expirationTime;if(0!==r&&ou(r),t.childExpirationTime<n)return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=Su(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Su(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Go(e,t){switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Jo(e,t,n){var r=t.pendingProps;switch(t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return mi(t.type)&&yi(),null;case 3:return Ia(),ui(pi),ui(hi),(n=t.stateNode).pendingContext&&(n.context=n.pendingContext,n.pendingContext=null),null!==e&&null!==e.child||!Ro(t)||(t.effectTag|=4),null;case 5:La(t),n=Pa(Oa.current);var a=t.type;if(null!==e&&null!=t.stateNode)Fo(e,t,a,r,n),e.ref!==t.ref&&(t.effectTag|=128);else{if(!r){if(null===t.stateNode)throw Error(o(166));return null}if(e=Pa(Ra.current),Ro(t)){r=t.stateNode,a=t.type;var s=t.memoizedProps;switch(r[An]=t,r[Cn]=s,a){case"iframe":case"object":case"embed":Wt("load",r);break;case"video":case"audio":for(e=0;e<Je.length;e++)Wt(Je[e],r);break;case"source":Wt("error",r);break;case"img":case"image":case"link":Wt("error",r),Wt("load",r);break;case"form":Wt("reset",r),Wt("submit",r);break;case"details":Wt("toggle",r);break;case"input":we(r,s),Wt("invalid",r),un(n,"onChange");break;case"select":r._wrapperState={wasMultiple:!!s.multiple},Wt("invalid",r),un(n,"onChange");break;case"textarea":xe(r,s),Wt("invalid",r),un(n,"onChange")}for(var u in an(a,s),e=null,s)if(s.hasOwnProperty(u)){var c=s[u];"children"===u?"string"===typeof c?r.textContent!==c&&(e=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(e=["children",""+c]):A.hasOwnProperty(u)&&null!=c&&un(n,u)}switch(a){case"input":Ee(r),Se(r,s,!0);break;case"textarea":Ee(r),_e(r);break;case"select":case"option":break;default:"function"===typeof s.onClick&&(r.onclick=cn)}n=e,t.updateQueue=n,null!==n&&(t.effectTag|=4)}else{switch(u=9===n.nodeType?n:n.ownerDocument,e===sn&&(e=qe(a)),e===sn?"script"===a?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(a,{is:r.is}):(e=u.createElement(a),"select"===a&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,a),e[An]=t,e[Cn]=r,ko(e,t),t.stateNode=e,u=on(a,r),a){case"iframe":case"object":case"embed":Wt("load",e),c=r;break;case"video":case"audio":for(c=0;c<Je.length;c++)Wt(Je[c],e);c=r;break;case"source":Wt("error",e),c=r;break;case"img":case"image":case"link":Wt("error",e),Wt("load",e),c=r;break;case"form":Wt("reset",e),Wt("submit",e),c=r;break;case"details":Wt("toggle",e),c=r;break;case"input":we(e,r),c=Ne(e,r),Wt("invalid",e),un(n,"onChange");break;case"option":c=Me(e,r);break;case"select":e._wrapperState={wasMultiple:!!r.multiple},c=i({},r,{value:void 0}),Wt("invalid",e),un(n,"onChange");break;case"textarea":xe(e,r),c=Pe(e,r),Wt("invalid",e),un(n,"onChange");break;default:c=r}an(a,c);var l=c;for(s in l)if(l.hasOwnProperty(s)){var h=l[s];"style"===s?nn(e,h):"dangerouslySetInnerHTML"===s?null!=(h=h?h.__html:void 0)&&Be(e,h):"children"===s?"string"===typeof h?("textarea"!==a||""!==h)&&ke(e,h):"number"===typeof h&&ke(e,""+h):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(A.hasOwnProperty(s)?null!=h&&un(n,s):null!=h&&X(e,s,h,u))}switch(a){case"input":Ee(e),Se(e,r,!1);break;case"textarea":Ee(e),_e(e);break;case"option":null!=r.value&&e.setAttribute("value",""+ge(r.value));break;case"select":e.multiple=!!r.multiple,null!=(n=r.value)?Oe(e,!!r.multiple,n,!1):null!=r.defaultValue&&Oe(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof c.onClick&&(e.onclick=cn)}vn(a,r)&&(t.effectTag|=4)}null!==t.ref&&(t.effectTag|=128)}return null;case 6:if(e&&null!=t.stateNode)Vo(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));n=Pa(Oa.current),Pa(Ra.current),Ro(t)?(n=t.stateNode,r=t.memoizedProps,n[An]=t,n.nodeValue!==r&&(t.effectTag|=4)):((n=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[An]=t,t.stateNode=n)}return null;case 13:return ui(Da),r=t.memoizedState,0!==(64&t.effectTag)?(t.expirationTime=n,t):(n=null!==r,r=!1,null===e?void 0!==t.memoizedProps.fallback&&Ro(t):(r=null!==(a=e.memoizedState),n||null===a||null!==(a=e.child.sibling)&&(null!==(s=t.firstEffect)?(t.firstEffect=a,a.nextEffect=s):(t.firstEffect=t.lastEffect=a,a.nextEffect=null),a.effectTag=8)),n&&!r&&0!==(2&t.mode)&&(null===e&&!0!==t.memoizedProps.unstable_avoidThisFallback||0!==(1&Da.current)?Rs===Es&&(Rs=Ts):(Rs!==Es&&Rs!==Ts||(Rs=Ns),0!==Is&&null!==As&&(_u(As,Ss),Lu(As,Is)))),(n||r)&&(t.effectTag|=4),null);case 4:return Ia(),null;case 10:return ea(t),null;case 17:return mi(t.type)&&yi(),null;case 19:if(ui(Da),null===(r=t.memoizedState))return null;if(a=0!==(64&t.effectTag),null===(s=r.rendering)){if(a)Go(r,!1);else if(Rs!==Es||null!==e&&0!==(64&e.effectTag))for(s=t.child;null!==s;){if(null!==(e=qa(s))){for(t.effectTag|=64,Go(r,!1),null!==(a=e.updateQueue)&&(t.updateQueue=a,t.effectTag|=4),null===r.lastEffect&&(t.firstEffect=null),t.lastEffect=r.lastEffect,r=t.child;null!==r;)s=n,(a=r).effectTag&=2,a.nextEffect=null,a.firstEffect=null,a.lastEffect=null,null===(e=a.alternate)?(a.childExpirationTime=0,a.expirationTime=s,a.child=null,a.memoizedProps=null,a.memoizedState=null,a.updateQueue=null,a.dependencies=null):(a.childExpirationTime=e.childExpirationTime,a.expirationTime=e.expirationTime,a.child=e.child,a.memoizedProps=e.memoizedProps,a.memoizedState=e.memoizedState,a.updateQueue=e.updateQueue,s=e.dependencies,a.dependencies=null===s?null:{expirationTime:s.expirationTime,firstContext:s.firstContext,responders:s.responders}),r=r.sibling;return ci(Da,1&Da.current|2),t.child}s=s.sibling}}else{if(!a)if(null!==(e=qa(s))){if(t.effectTag|=64,a=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.effectTag|=4),Go(r,!0),null===r.tail&&"hidden"===r.tailMode&&!s.alternate)return null!==(t=t.lastEffect=r.lastEffect)&&(t.nextEffect=null),null}else 2*Bi()-r.renderingStartTime>r.tailExpiration&&1<n&&(t.effectTag|=64,a=!0,Go(r,!1),t.expirationTime=t.childExpirationTime=n-1);r.isBackwards?(s.sibling=t.child,t.child=s):(null!==(n=r.last)?n.sibling=s:t.child=s,r.last=s)}return null!==r.tail?(0===r.tailExpiration&&(r.tailExpiration=Bi()+500),n=r.tail,r.rendering=n,r.tail=n.sibling,r.lastEffect=t.lastEffect,r.renderingStartTime=Bi(),n.sibling=null,t=Da.current,ci(Da,a?1&t|2:1&t),n):null}throw Error(o(156,t.tag))}function Xo(e){switch(e.tag){case 1:mi(e.type)&&yi();var t=e.effectTag;return 4096&t?(e.effectTag=-4097&t|64,e):null;case 3:if(Ia(),ui(pi),ui(hi),0!==(64&(t=e.effectTag)))throw Error(o(285));return e.effectTag=-4097&t|64,e;case 5:return La(e),null;case 13:return ui(Da),4096&(t=e.effectTag)?(e.effectTag=-4097&t|64,e):null;case 19:return ui(Da),null;case 4:return Ia(),null;case 10:return ea(e),null;default:return null}}function $o(e,t){return{value:e,source:t,stack:ve(t)}}ko=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Fo=function(e,t,n,r,a){var o=e.memoizedProps;if(o!==r){var s,u,c=t.stateNode;switch(Pa(Ra.current),e=null,n){case"input":o=Ne(c,o),r=Ne(c,r),e=[];break;case"option":o=Me(c,o),r=Me(c,r),e=[];break;case"select":o=i({},o,{value:void 0}),r=i({},r,{value:void 0}),e=[];break;case"textarea":o=Pe(c,o),r=Pe(c,r),e=[];break;default:"function"!==typeof o.onClick&&"function"===typeof r.onClick&&(c.onclick=cn)}for(s in an(n,r),n=null,o)if(!r.hasOwnProperty(s)&&o.hasOwnProperty(s)&&null!=o[s])if("style"===s)for(u in c=o[s])c.hasOwnProperty(u)&&(n||(n={}),n[u]="");else"dangerouslySetInnerHTML"!==s&&"children"!==s&&"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&"autoFocus"!==s&&(A.hasOwnProperty(s)?e||(e=[]):(e=e||[]).push(s,null));for(s in r){var l=r[s];if(c=null!=o?o[s]:void 0,r.hasOwnProperty(s)&&l!==c&&(null!=l||null!=c))if("style"===s)if(c){for(u in c)!c.hasOwnProperty(u)||l&&l.hasOwnProperty(u)||(n||(n={}),n[u]="");for(u in l)l.hasOwnProperty(u)&&c[u]!==l[u]&&(n||(n={}),n[u]=l[u])}else n||(e||(e=[]),e.push(s,n)),n=l;else"dangerouslySetInnerHTML"===s?(l=l?l.__html:void 0,c=c?c.__html:void 0,null!=l&&c!==l&&(e=e||[]).push(s,l)):"children"===s?c===l||"string"!==typeof l&&"number"!==typeof l||(e=e||[]).push(s,""+l):"suppressContentEditableWarning"!==s&&"suppressHydrationWarning"!==s&&(A.hasOwnProperty(s)?(null!=l&&un(a,s),e||c===l||(e=[])):(e=e||[]).push(s,l))}n&&(e=e||[]).push("style",n),a=e,(t.updateQueue=a)&&(t.effectTag|=4)}},Vo=function(e,t,n,r){n!==r&&(t.effectTag|=4)};var Zo="function"===typeof WeakSet?WeakSet:Set;function es(e,t){var n=t.source,r=t.stack;null===r&&null!==n&&(r=ve(n)),null!==n&&ye(n.type),t=t.value,null!==e&&1===e.tag&&ye(e.type);try{console.error(t)}catch(i){setTimeout((function(){throw i}))}}function ts(e){var t=e.ref;if(null!==t)if("function"===typeof t)try{t(null)}catch(n){gu(e,n)}else t.current=null}function ns(e,t){switch(t.tag){case 0:case 11:case 15:case 22:return;case 1:if(256&t.effectTag&&null!==e){var n=e.memoizedProps,r=e.memoizedState;t=(e=t.stateNode).getSnapshotBeforeUpdate(t.elementType===t.type?n:Yi(t.type,n),r),e.__reactInternalSnapshotBeforeUpdate=t}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(o(163))}function rs(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.destroy;n.destroy=void 0,void 0!==r&&r()}n=n.next}while(n!==t)}}function is(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function as(e,t,n){switch(n.tag){case 0:case 11:case 15:case 22:return void is(3,n);case 1:if(e=n.stateNode,4&n.effectTag)if(null===t)e.componentDidMount();else{var r=n.elementType===n.type?t.memoizedProps:Yi(n.type,t.memoizedProps);e.componentDidUpdate(r,t.memoizedState,e.__reactInternalSnapshotBeforeUpdate)}return void(null!==(t=n.updateQueue)&&ha(n,t,e));case 3:if(null!==(t=n.updateQueue)){if(e=null,null!==n.child)switch(n.child.tag){case 5:e=n.child.stateNode;break;case 1:e=n.child.stateNode}ha(n,t,e)}return;case 5:return e=n.stateNode,void(null===t&&4&n.effectTag&&vn(n.type,n.memoizedProps)&&e.focus());case 6:case 4:case 12:return;case 13:return void(null===n.memoizedState&&(n=n.alternate,null!==n&&(n=n.memoizedState,null!==n&&(n=n.dehydrated,null!==n&&qt(n)))));case 19:case 17:case 20:case 21:return}throw Error(o(163))}function os(e,t,n){switch("function"===typeof Nu&&Nu(t),t.tag){case 0:case 11:case 14:case 15:case 22:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e.next;Vi(97<n?97:n,(function(){var e=r;do{var n=e.destroy;if(void 0!==n){var i=t;try{n()}catch(a){gu(i,a)}}e=e.next}while(e!==r)}))}break;case 1:ts(t),"function"===typeof(n=t.stateNode).componentWillUnmount&&function(e,t){try{t.props=e.memoizedProps,t.state=e.memoizedState,t.componentWillUnmount()}catch(n){gu(e,n)}}(t,n);break;case 5:ts(t);break;case 4:ls(e,t,n)}}function ss(e){var t=e.alternate;e.return=null,e.child=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.alternate=null,e.firstEffect=null,e.lastEffect=null,e.pendingProps=null,e.memoizedProps=null,e.stateNode=null,null!==t&&ss(t)}function us(e){return 5===e.tag||3===e.tag||4===e.tag}function cs(e){e:{for(var t=e.return;null!==t;){if(us(t)){var n=t;break e}t=t.return}throw Error(o(160))}switch(t=n.stateNode,n.tag){case 5:var r=!1;break;case 3:case 4:t=t.containerInfo,r=!0;break;default:throw Error(o(161))}16&n.effectTag&&(ke(t,""),n.effectTag&=-17);e:t:for(n=e;;){for(;null===n.sibling;){if(null===n.return||us(n.return)){n=null;break e}n=n.return}for(n.sibling.return=n.return,n=n.sibling;5!==n.tag&&6!==n.tag&&18!==n.tag;){if(2&n.effectTag)continue t;if(null===n.child||4===n.tag)continue t;n.child.return=n,n=n.child}if(!(2&n.effectTag)){n=n.stateNode;break e}}r?function e(t,n,r){var i=t.tag,a=5===i||6===i;if(a)t=a?t.stateNode:t.stateNode.instance,n?8===r.nodeType?r.parentNode.insertBefore(t,n):r.insertBefore(t,n):(8===r.nodeType?(n=r.parentNode).insertBefore(t,r):(n=r).appendChild(t),null!==(r=r._reactRootContainer)&&void 0!==r||null!==n.onclick||(n.onclick=cn));else if(4!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t):function e(t,n,r){var i=t.tag,a=5===i||6===i;if(a)t=a?t.stateNode:t.stateNode.instance,n?r.insertBefore(t,n):r.appendChild(t);else if(4!==i&&null!==(t=t.child))for(e(t,n,r),t=t.sibling;null!==t;)e(t,n,r),t=t.sibling}(e,n,t)}function ls(e,t,n){for(var r,i,a=t,s=!1;;){if(!s){s=a.return;e:for(;;){if(null===s)throw Error(o(160));switch(r=s.stateNode,s.tag){case 5:i=!1;break e;case 3:case 4:r=r.containerInfo,i=!0;break e}s=s.return}s=!0}if(5===a.tag||6===a.tag){e:for(var u=e,c=a,l=n,h=c;;)if(os(u,h,l),null!==h.child&&4!==h.tag)h.child.return=h,h=h.child;else{if(h===c)break e;for(;null===h.sibling;){if(null===h.return||h.return===c)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}i?(u=r,c=a.stateNode,8===u.nodeType?u.parentNode.removeChild(c):u.removeChild(c)):r.removeChild(a.stateNode)}else if(4===a.tag){if(null!==a.child){r=a.stateNode.containerInfo,i=!0,a.child.return=a,a=a.child;continue}}else if(os(e,a,n),null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;4===(a=a.return).tag&&(s=!1)}a.sibling.return=a.return,a=a.sibling}}function hs(e,t){switch(t.tag){case 0:case 11:case 14:case 15:case 22:return void rs(3,t);case 1:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps,i=null!==e?e.memoizedProps:r;e=t.type;var a=t.updateQueue;if(t.updateQueue=null,null!==a){for(n[Cn]=r,"input"===e&&"radio"===r.type&&null!=r.name&&Ae(n,r),on(e,i),t=on(e,r),i=0;i<a.length;i+=2){var s=a[i],u=a[i+1];"style"===s?nn(n,u):"dangerouslySetInnerHTML"===s?Be(n,u):"children"===s?ke(n,u):X(n,s,u,t)}switch(e){case"input":Ce(n,r);break;case"textarea":Ie(n,r);break;case"select":t=n._wrapperState.wasMultiple,n._wrapperState.wasMultiple=!!r.multiple,null!=(e=r.value)?Oe(n,!!r.multiple,e,!1):t!==!!r.multiple&&(null!=r.defaultValue?Oe(n,!!r.multiple,r.defaultValue,!0):Oe(n,!!r.multiple,r.multiple?[]:"",!1))}}}return;case 6:if(null===t.stateNode)throw Error(o(162));return void(t.stateNode.nodeValue=t.memoizedProps);case 3:return void((t=t.stateNode).hydrate&&(t.hydrate=!1,qt(t.containerInfo)));case 12:return;case 13:if(n=t,null===t.memoizedState?r=!1:(r=!0,n=t.child,Ls=Bi()),null!==n)e:for(e=n;;){if(5===e.tag)a=e.stateNode,r?"function"===typeof(a=a.style).setProperty?a.setProperty("display","none","important"):a.display="none":(a=e.stateNode,i=void 0!==(i=e.memoizedProps.style)&&null!==i&&i.hasOwnProperty("display")?i.display:null,a.style.display=tn("display",i));else if(6===e.tag)e.stateNode.nodeValue=r?"":e.memoizedProps;else{if(13===e.tag&&null!==e.memoizedState&&null===e.memoizedState.dehydrated){(a=e.child.sibling).return=e,e=a;continue}if(null!==e.child){e.child.return=e,e=e.child;continue}}if(e===n)break;for(;null===e.sibling;){if(null===e.return||e.return===n)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}return void ps(t);case 19:return void ps(t);case 17:return}throw Error(o(163))}function ps(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zo),t.forEach((function(t){var r=Eu.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}var fs="function"===typeof WeakMap?WeakMap:Map;function ds(e,t,n){(n=sa(n,null)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){qs||(qs=!0,js=r),es(e,t)},n}function ms(e,t,n){(n=sa(n,null)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var i=t.value;n.payload=function(){return es(e,t),r(i)}}var a=e.stateNode;return null!==a&&"function"===typeof a.componentDidCatch&&(n.callback=function(){"function"!==typeof r&&(null===Us?Us=new Set([this]):Us.add(this),es(e,t));var n=t.stack;this.componentDidCatch(t.value,{componentStack:null!==n?n:""})}),n}var ys,vs=Math.ceil,gs=J.ReactCurrentDispatcher,bs=J.ReactCurrentOwner,Es=0,Ts=3,Ns=4,ws=0,As=null,Cs=null,Ss=0,Rs=Es,Ms=null,Os=1073741823,Ps=1073741823,xs=null,Is=0,_s=!1,Ls=0,Ds=null,qs=!1,js=null,Us=null,Bs=!1,ks=null,Fs=90,Vs=null,Qs=0,Ks=null,Hs=0;function zs(){return 0!==(48&ws)?1073741821-(Bi()/10|0):0!==Hs?Hs:Hs=1073741821-(Bi()/10|0)}function Ws(e,t,n){if(0===(2&(t=t.mode)))return 1073741823;var r=ki();if(0===(4&t))return 99===r?1073741823:1073741822;if(0!==(16&ws))return Ss;if(null!==n)e=Wi(e,0|n.timeoutMs||5e3,250);else switch(r){case 99:e=1073741823;break;case 98:e=Wi(e,150,100);break;case 97:case 96:e=Wi(e,5e3,250);break;case 95:e=2;break;default:throw Error(o(326))}return null!==As&&e===Ss&&--e,e}function Ys(e,t){if(50<Qs)throw Qs=0,Ks=null,Error(o(185));if(null!==(e=Gs(e,t))){var n=ki();1073741823===t?0!==(8&ws)&&0===(48&ws)?Zs(e):(Xs(e),0===ws&&Hi()):Xs(e),0===(4&ws)||98!==n&&99!==n||(null===Vs?Vs=new Map([[e,t]]):(void 0===(n=Vs.get(e))||n>t)&&Vs.set(e,t))}}function Gs(e,t){e.expirationTime<t&&(e.expirationTime=t);var n=e.alternate;null!==n&&n.expirationTime<t&&(n.expirationTime=t);var r=e.return,i=null;if(null===r&&3===e.tag)i=e.stateNode;else for(;null!==r;){if(n=r.alternate,r.childExpirationTime<t&&(r.childExpirationTime=t),null!==n&&n.childExpirationTime<t&&(n.childExpirationTime=t),null===r.return&&3===r.tag){i=r.stateNode;break}r=r.return}return null!==i&&(As===i&&(ou(t),Rs===Ns&&_u(i,Ss)),Lu(i,t)),i}function Js(e){var t=e.lastExpiredTime;if(0!==t)return t;if(!Iu(e,t=e.firstPendingTime))return t;var n=e.lastPingedTime;return 2>=(e=n>(e=e.nextKnownPendingLevel)?n:e)&&t!==e?0:e}function Xs(e){if(0!==e.lastExpiredTime)e.callbackExpirationTime=1073741823,e.callbackPriority=99,e.callbackNode=Ki(Zs.bind(null,e));else{var t=Js(e),n=e.callbackNode;if(0===t)null!==n&&(e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90);else{var r=zs();if(1073741823===t?r=99:1===t||2===t?r=95:r=0>=(r=10*(1073741821-t)-10*(1073741821-r))?99:250>=r?98:5250>=r?97:95,null!==n){var i=e.callbackPriority;if(e.callbackExpirationTime===t&&i>=r)return;n!==Ii&&wi(n)}e.callbackExpirationTime=t,e.callbackPriority=r,t=1073741823===t?Ki(Zs.bind(null,e)):Qi(r,$s.bind(null,e),{timeout:10*(1073741821-t)-Bi()}),e.callbackNode=t}}}function $s(e,t){if(Hs=0,t)return Du(e,t=zs()),Xs(e),null;var n=Js(e);if(0!==n){if(t=e.callbackNode,0!==(48&ws))throw Error(o(327));if(mu(),e===As&&n===Ss||nu(e,n),null!==Cs){var r=ws;ws|=16;for(var i=iu();;)try{uu();break}catch(u){ru(e,u)}if(Zi(),ws=r,gs.current=i,1===Rs)throw t=Ms,nu(e,n),_u(e,n),Xs(e),t;if(null===Cs)switch(i=e.finishedWork=e.current.alternate,e.finishedExpirationTime=n,r=Rs,As=null,r){case Es:case 1:throw Error(o(345));case 2:Du(e,2<n?2:n);break;case Ts:if(_u(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=hu(i)),1073741823===Os&&10<(i=Ls+500-Bi())){if(_s){var a=e.lastPingedTime;if(0===a||a>=n){e.lastPingedTime=n,nu(e,n);break}}if(0!==(a=Js(e))&&a!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}e.timeoutHandle=bn(pu.bind(null,e),i);break}pu(e);break;case Ns:if(_u(e,n),n===(r=e.lastSuspendedTime)&&(e.nextKnownPendingLevel=hu(i)),_s&&(0===(i=e.lastPingedTime)||i>=n)){e.lastPingedTime=n,nu(e,n);break}if(0!==(i=Js(e))&&i!==n)break;if(0!==r&&r!==n){e.lastPingedTime=r;break}if(1073741823!==Ps?r=10*(1073741821-Ps)-Bi():1073741823===Os?r=0:(r=10*(1073741821-Os)-5e3,0>(r=(i=Bi())-r)&&(r=0),(n=10*(1073741821-n)-i)<(r=(120>r?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*vs(r/1960))-r)&&(r=n)),10<r){e.timeoutHandle=bn(pu.bind(null,e),r);break}pu(e);break;case 5:if(1073741823!==Os&&null!==xs){a=Os;var s=xs;if(0>=(r=0|s.busyMinDurationMs)?r=0:(i=0|s.busyDelayMs,r=(a=Bi()-(10*(1073741821-a)-(0|s.timeoutMs||5e3)))<=i?0:i+r-a),10<r){_u(e,n),e.timeoutHandle=bn(pu.bind(null,e),r);break}}pu(e);break;default:throw Error(o(329))}if(Xs(e),e.callbackNode===t)return $s.bind(null,e)}}return null}function Zs(e){var t=e.lastExpiredTime;if(t=0!==t?t:1073741823,0!==(48&ws))throw Error(o(327));if(mu(),e===As&&t===Ss||nu(e,t),null!==Cs){var n=ws;ws|=16;for(var r=iu();;)try{su();break}catch(i){ru(e,i)}if(Zi(),ws=n,gs.current=r,1===Rs)throw n=Ms,nu(e,t),_u(e,t),Xs(e),n;if(null!==Cs)throw Error(o(261));e.finishedWork=e.current.alternate,e.finishedExpirationTime=t,As=null,pu(e),Xs(e)}return null}function eu(e,t){var n=ws;ws|=1;try{return e(t)}finally{0===(ws=n)&&Hi()}}function tu(e,t){var n=ws;ws&=-2,ws|=8;try{return e(t)}finally{0===(ws=n)&&Hi()}}function nu(e,t){e.finishedWork=null,e.finishedExpirationTime=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,En(n)),null!==Cs)for(n=Cs.return;null!==n;){var r=n;switch(r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&yi();break;case 3:Ia(),ui(pi),ui(hi);break;case 5:La(r);break;case 4:Ia();break;case 13:case 19:ui(Da);break;case 10:ea(r)}n=n.return}As=e,Cs=Su(e.current,null),Ss=t,Rs=Es,Ms=null,Ps=Os=1073741823,xs=null,Is=0,_s=!1}function ru(e,t){for(;;){try{if(Zi(),Ua.current=yo,Ka)for(var n=Fa.memoizedState;null!==n;){var r=n.queue;null!==r&&(r.pending=null),n=n.next}if(ka=0,Qa=Va=Fa=null,Ka=!1,null===Cs||null===Cs.return)return Rs=1,Ms=t,Cs=null;e:{var i=e,a=Cs.return,o=Cs,s=t;if(t=Ss,o.effectTag|=2048,o.firstEffect=o.lastEffect=null,null!==s&&"object"===typeof s&&"function"===typeof s.then){var u=s;if(0===(2&o.mode)){var c=o.alternate;c?(o.updateQueue=c.updateQueue,o.memoizedState=c.memoizedState,o.expirationTime=c.expirationTime):(o.updateQueue=null,o.memoizedState=null)}var l=0!==(1&Da.current),h=a;do{var p;if(p=13===h.tag){var f=h.memoizedState;if(null!==f)p=null!==f.dehydrated;else{var d=h.memoizedProps;p=void 0!==d.fallback&&(!0!==d.unstable_avoidThisFallback||!l)}}if(p){var m=h.updateQueue;if(null===m){var y=new Set;y.add(u),h.updateQueue=y}else m.add(u);if(0===(2&h.mode)){if(h.effectTag|=64,o.effectTag&=-2981,1===o.tag)if(null===o.alternate)o.tag=17;else{var v=sa(1073741823,null);v.tag=2,ua(o,v)}o.expirationTime=1073741823;break e}s=void 0,o=t;var g=i.pingCache;if(null===g?(g=i.pingCache=new fs,s=new Set,g.set(u,s)):void 0===(s=g.get(u))&&(s=new Set,g.set(u,s)),!s.has(o)){s.add(o);var b=bu.bind(null,i,u,o);u.then(b,b)}h.effectTag|=4096,h.expirationTime=t;break e}h=h.return}while(null!==h);s=Error((ye(o.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+ve(o))}5!==Rs&&(Rs=2),s=$o(s,o),h=a;do{switch(h.tag){case 3:u=s,h.effectTag|=4096,h.expirationTime=t,ca(h,ds(h,u,t));break e;case 1:u=s;var E=h.type,T=h.stateNode;if(0===(64&h.effectTag)&&("function"===typeof E.getDerivedStateFromError||null!==T&&"function"===typeof T.componentDidCatch&&(null===Us||!Us.has(T)))){h.effectTag|=4096,h.expirationTime=t,ca(h,ms(h,u,t));break e}}h=h.return}while(null!==h)}Cs=lu(Cs)}catch(N){t=N;continue}break}}function iu(){var e=gs.current;return gs.current=yo,null===e?yo:e}function au(e,t){e<Os&&2<e&&(Os=e),null!==t&&e<Ps&&2<e&&(Ps=e,xs=t)}function ou(e){e>Is&&(Is=e)}function su(){for(;null!==Cs;)Cs=cu(Cs)}function uu(){for(;null!==Cs&&!_i();)Cs=cu(Cs)}function cu(e){var t=ys(e.alternate,e,Ss);return e.memoizedProps=e.pendingProps,null===t&&(t=lu(e)),bs.current=null,t}function lu(e){Cs=e;do{var t=Cs.alternate;if(e=Cs.return,0===(2048&Cs.effectTag)){if(t=Jo(t,Cs,Ss),1===Ss||1!==Cs.childExpirationTime){for(var n=0,r=Cs.child;null!==r;){var i=r.expirationTime,a=r.childExpirationTime;i>n&&(n=i),a>n&&(n=a),r=r.sibling}Cs.childExpirationTime=n}if(null!==t)return t;null!==e&&0===(2048&e.effectTag)&&(null===e.firstEffect&&(e.firstEffect=Cs.firstEffect),null!==Cs.lastEffect&&(null!==e.lastEffect&&(e.lastEffect.nextEffect=Cs.firstEffect),e.lastEffect=Cs.lastEffect),1<Cs.effectTag&&(null!==e.lastEffect?e.lastEffect.nextEffect=Cs:e.firstEffect=Cs,e.lastEffect=Cs))}else{if(null!==(t=Xo(Cs)))return t.effectTag&=2047,t;null!==e&&(e.firstEffect=e.lastEffect=null,e.effectTag|=2048)}if(null!==(t=Cs.sibling))return t;Cs=e}while(null!==Cs);return Rs===Es&&(Rs=5),null}function hu(e){var t=e.expirationTime;return t>(e=e.childExpirationTime)?t:e}function pu(e){var t=ki();return Vi(99,fu.bind(null,e,t)),null}function fu(e,t){do{mu()}while(null!==ks);if(0!==(48&ws))throw Error(o(327));var n=e.finishedWork,r=e.finishedExpirationTime;if(null===n)return null;if(e.finishedWork=null,e.finishedExpirationTime=0,n===e.current)throw Error(o(177));e.callbackNode=null,e.callbackExpirationTime=0,e.callbackPriority=90,e.nextKnownPendingLevel=0;var i=hu(n);if(e.firstPendingTime=i,r<=e.lastSuspendedTime?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:r<=e.firstSuspendedTime&&(e.firstSuspendedTime=r-1),r<=e.lastPingedTime&&(e.lastPingedTime=0),r<=e.lastExpiredTime&&(e.lastExpiredTime=0),e===As&&(Cs=As=null,Ss=0),1<n.effectTag?null!==n.lastEffect?(n.lastEffect.nextEffect=n,i=n.firstEffect):i=n:i=n.firstEffect,null!==i){var a=ws;ws|=32,bs.current=null,mn=zt;var s=fn();if(dn(s)){if("selectionStart"in s)var u={start:s.selectionStart,end:s.selectionEnd};else e:{var c=(u=(u=s.ownerDocument)&&u.defaultView||window).getSelection&&u.getSelection();if(c&&0!==c.rangeCount){u=c.anchorNode;var l=c.anchorOffset,h=c.focusNode;c=c.focusOffset;try{u.nodeType,h.nodeType}catch(S){u=null;break e}var p=0,f=-1,d=-1,m=0,y=0,v=s,g=null;t:for(;;){for(var b;v!==u||0!==l&&3!==v.nodeType||(f=p+l),v!==h||0!==c&&3!==v.nodeType||(d=p+c),3===v.nodeType&&(p+=v.nodeValue.length),null!==(b=v.firstChild);)g=v,v=b;for(;;){if(v===s)break t;if(g===u&&++m===l&&(f=p),g===h&&++y===c&&(d=p),null!==(b=v.nextSibling))break;g=(v=g).parentNode}v=b}u=-1===f||-1===d?null:{start:f,end:d}}else u=null}u=u||{start:0,end:0}}else u=null;yn={activeElementDetached:null,focusedElem:s,selectionRange:u},zt=!1,Ds=i;do{try{du()}catch(S){if(null===Ds)throw Error(o(330));gu(Ds,S),Ds=Ds.nextEffect}}while(null!==Ds);Ds=i;do{try{for(s=e,u=t;null!==Ds;){var E=Ds.effectTag;if(16&E&&ke(Ds.stateNode,""),128&E){var T=Ds.alternate;if(null!==T){var N=T.ref;null!==N&&("function"===typeof N?N(null):N.current=null)}}switch(1038&E){case 2:cs(Ds),Ds.effectTag&=-3;break;case 6:cs(Ds),Ds.effectTag&=-3,hs(Ds.alternate,Ds);break;case 1024:Ds.effectTag&=-1025;break;case 1028:Ds.effectTag&=-1025,hs(Ds.alternate,Ds);break;case 4:hs(Ds.alternate,Ds);break;case 8:ls(s,l=Ds,u),ss(l)}Ds=Ds.nextEffect}}catch(S){if(null===Ds)throw Error(o(330));gu(Ds,S),Ds=Ds.nextEffect}}while(null!==Ds);if(N=yn,T=fn(),E=N.focusedElem,u=N.selectionRange,T!==E&&E&&E.ownerDocument&&function e(t,n){return!(!t||!n)&&(t===n||(!t||3!==t.nodeType)&&(n&&3===n.nodeType?e(t,n.parentNode):"contains"in t?t.contains(n):!!t.compareDocumentPosition&&!!(16&t.compareDocumentPosition(n))))}(E.ownerDocument.documentElement,E)){null!==u&&dn(E)&&(T=u.start,void 0===(N=u.end)&&(N=T),"selectionStart"in E?(E.selectionStart=T,E.selectionEnd=Math.min(N,E.value.length)):(N=(T=E.ownerDocument||document)&&T.defaultView||window).getSelection&&(N=N.getSelection(),l=E.textContent.length,s=Math.min(u.start,l),u=void 0===u.end?s:Math.min(u.end,l),!N.extend&&s>u&&(l=u,u=s,s=l),l=pn(E,s),h=pn(E,u),l&&h&&(1!==N.rangeCount||N.anchorNode!==l.node||N.anchorOffset!==l.offset||N.focusNode!==h.node||N.focusOffset!==h.offset)&&((T=T.createRange()).setStart(l.node,l.offset),N.removeAllRanges(),s>u?(N.addRange(T),N.extend(h.node,h.offset)):(T.setEnd(h.node,h.offset),N.addRange(T))))),T=[];for(N=E;N=N.parentNode;)1===N.nodeType&&T.push({element:N,left:N.scrollLeft,top:N.scrollTop});for("function"===typeof E.focus&&E.focus(),E=0;E<T.length;E++)(N=T[E]).element.scrollLeft=N.left,N.element.scrollTop=N.top}zt=!!mn,yn=mn=null,e.current=n,Ds=i;do{try{for(E=e;null!==Ds;){var w=Ds.effectTag;if(36&w&&as(E,Ds.alternate,Ds),128&w){T=void 0;var A=Ds.ref;if(null!==A){var C=Ds.stateNode;switch(Ds.tag){case 5:T=C;break;default:T=C}"function"===typeof A?A(T):A.current=T}}Ds=Ds.nextEffect}}catch(S){if(null===Ds)throw Error(o(330));gu(Ds,S),Ds=Ds.nextEffect}}while(null!==Ds);Ds=null,Li(),ws=a}else e.current=n;if(Bs)Bs=!1,ks=e,Fs=t;else for(Ds=i;null!==Ds;)t=Ds.nextEffect,Ds.nextEffect=null,Ds=t;if(0===(t=e.firstPendingTime)&&(Us=null),1073741823===t?e===Ks?Qs++:(Qs=0,Ks=e):Qs=0,"function"===typeof Tu&&Tu(n.stateNode,r),Xs(e),qs)throw qs=!1,e=js,js=null,e;return 0!==(8&ws)||Hi(),null}function du(){for(;null!==Ds;){var e=Ds.effectTag;0!==(256&e)&&ns(Ds.alternate,Ds),0===(512&e)||Bs||(Bs=!0,Qi(97,(function(){return mu(),null}))),Ds=Ds.nextEffect}}function mu(){if(90!==Fs){var e=97<Fs?97:Fs;return Fs=90,Vi(e,yu)}}function yu(){if(null===ks)return!1;var e=ks;if(ks=null,0!==(48&ws))throw Error(o(331));var t=ws;for(ws|=32,e=e.current.firstEffect;null!==e;){try{var n=e;if(0!==(512&n.effectTag))switch(n.tag){case 0:case 11:case 15:case 22:rs(5,n),is(5,n)}}catch(r){if(null===e)throw Error(o(330));gu(e,r)}n=e.nextEffect,e.nextEffect=null,e=n}return ws=t,Hi(),!0}function vu(e,t,n){ua(e,t=ds(e,t=$o(n,t),1073741823)),null!==(e=Gs(e,1073741823))&&Xs(e)}function gu(e,t){if(3===e.tag)vu(e,e,t);else for(var n=e.return;null!==n;){if(3===n.tag){vu(n,e,t);break}if(1===n.tag){var r=n.stateNode;if("function"===typeof n.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Us||!Us.has(r))){ua(n,e=ms(n,e=$o(t,e),1073741823)),null!==(n=Gs(n,1073741823))&&Xs(n);break}}n=n.return}}function bu(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),As===e&&Ss===n?Rs===Ns||Rs===Ts&&1073741823===Os&&Bi()-Ls<500?nu(e,Ss):_s=!0:Iu(e,n)&&(0!==(t=e.lastPingedTime)&&t<n||(e.lastPingedTime=n,Xs(e)))}function Eu(e,t){var n=e.stateNode;null!==n&&n.delete(t),0===(t=0)&&(t=Ws(t=zs(),e,null)),null!==(e=Gs(e,t))&&Xs(e)}ys=function(e,t,n){var r=t.expirationTime;if(null!==e){var i=t.pendingProps;if(e.memoizedProps!==i||pi.current)Po=!0;else{if(r<n){switch(Po=!1,t.tag){case 3:Bo(t),Mo();break;case 5:if(_a(t),4&t.mode&&1!==n&&i.hidden)return t.expirationTime=t.childExpirationTime=1,null;break;case 1:mi(t.type)&&bi(t);break;case 4:xa(t,t.stateNode.containerInfo);break;case 10:r=t.memoizedProps.value,i=t.type._context,ci(Gi,i._currentValue),i._currentValue=r;break;case 13:if(null!==t.memoizedState)return 0!==(r=t.child.childExpirationTime)&&r>=n?Ko(e,t,n):(ci(Da,1&Da.current),null!==(t=Yo(e,t,n))?t.sibling:null);ci(Da,1&Da.current);break;case 19:if(r=t.childExpirationTime>=n,0!==(64&e.effectTag)){if(r)return Wo(e,t,n);t.effectTag|=64}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null),ci(Da,Da.current),!r)return null}return Yo(e,t,n)}Po=!1}}else Po=!1;switch(t.expirationTime=0,t.tag){case 2:if(r=t.type,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,i=di(t,hi.current),na(t,n),i=Wa(null,t,r,e,i,n),t.effectTag|=1,"object"===typeof i&&null!==i&&"function"===typeof i.render&&void 0===i.$$typeof){if(t.tag=1,t.memoizedState=null,t.updateQueue=null,mi(r)){var a=!0;bi(t)}else a=!1;t.memoizedState=null!==i.state&&void 0!==i.state?i.state:null,aa(t);var s=r.getDerivedStateFromProps;"function"===typeof s&&da(t,r,s,e),i.updater=ma,t.stateNode=i,i._reactInternalFiber=t,ba(t,r,e,n),t=Uo(null,t,r,!0,a,n)}else t.tag=0,xo(null,t,i,n),t=t.child;return t;case 16:e:{if(i=t.elementType,null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),e=t.pendingProps,function(e){if(-1===e._status){e._status=0;var t=e._ctor;t=t(),e._result=t,t.then((function(t){0===e._status&&(t=t.default,e._status=1,e._result=t)}),(function(t){0===e._status&&(e._status=2,e._result=t)}))}}(i),1!==i._status)throw i._result;switch(i=i._result,t.type=i,a=t.tag=function(e){if("function"===typeof e)return Cu(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===ue)return 11;if(e===he)return 14}return 2}(i),e=Yi(i,e),a){case 0:t=qo(null,t,i,e,n);break e;case 1:t=jo(null,t,i,e,n);break e;case 11:t=Io(null,t,i,e,n);break e;case 14:t=_o(null,t,i,Yi(i.type,e),r,n);break e}throw Error(o(306,i,""))}return t;case 0:return r=t.type,i=t.pendingProps,qo(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 1:return r=t.type,i=t.pendingProps,jo(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 3:if(Bo(t),r=t.updateQueue,null===e||null===r)throw Error(o(282));if(r=t.pendingProps,i=null!==(i=t.memoizedState)?i.element:null,oa(e,t),la(t,r,null,n),(r=t.memoizedState.element)===i)Mo(),t=Yo(e,t,n);else{if((i=t.stateNode.hydrate)&&(To=Tn(t.stateNode.containerInfo.firstChild),Eo=t,i=No=!0),i)for(n=Ca(t,null,r,n),t.child=n;n;)n.effectTag=-3&n.effectTag|1024,n=n.sibling;else xo(e,t,r,n),Mo();t=t.child}return t;case 5:return _a(t),null===e&&Co(t),r=t.type,i=t.pendingProps,a=null!==e?e.memoizedProps:null,s=i.children,gn(r,i)?s=null:null!==a&&gn(r,a)&&(t.effectTag|=16),Do(e,t),4&t.mode&&1!==n&&i.hidden?(t.expirationTime=t.childExpirationTime=1,t=null):(xo(e,t,s,n),t=t.child),t;case 6:return null===e&&Co(t),null;case 13:return Ko(e,t,n);case 4:return xa(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Aa(t,null,r,n):xo(e,t,r,n),t.child;case 11:return r=t.type,i=t.pendingProps,Io(e,t,r,i=t.elementType===r?i:Yi(r,i),n);case 7:return xo(e,t,t.pendingProps,n),t.child;case 8:case 12:return xo(e,t,t.pendingProps.children,n),t.child;case 10:e:{r=t.type._context,i=t.pendingProps,s=t.memoizedProps,a=i.value;var u=t.type._context;if(ci(Gi,u._currentValue),u._currentValue=a,null!==s)if(u=s.value,0===(a=jr(u,a)?0:0|("function"===typeof r._calculateChangedBits?r._calculateChangedBits(u,a):1073741823))){if(s.children===i.children&&!pi.current){t=Yo(e,t,n);break e}}else for(null!==(u=t.child)&&(u.return=t);null!==u;){var c=u.dependencies;if(null!==c){s=u.child;for(var l=c.firstContext;null!==l;){if(l.context===r&&0!==(l.observedBits&a)){1===u.tag&&((l=sa(n,null)).tag=2,ua(u,l)),u.expirationTime<n&&(u.expirationTime=n),null!==(l=u.alternate)&&l.expirationTime<n&&(l.expirationTime=n),ta(u.return,n),c.expirationTime<n&&(c.expirationTime=n);break}l=l.next}}else s=10===u.tag&&u.type===t.type?null:u.child;if(null!==s)s.return=u;else for(s=u;null!==s;){if(s===t){s=null;break}if(null!==(u=s.sibling)){u.return=s.return,s=u;break}s=s.return}u=s}xo(e,t,i.children,n),t=t.child}return t;case 9:return i=t.type,r=(a=t.pendingProps).children,na(t,n),r=r(i=ra(i,a.unstable_observedBits)),t.effectTag|=1,xo(e,t,r,n),t.child;case 14:return a=Yi(i=t.type,t.pendingProps),_o(e,t,i,a=Yi(i.type,a),r,n);case 15:return Lo(e,t,t.type,t.pendingProps,r,n);case 17:return r=t.type,i=t.pendingProps,i=t.elementType===r?i:Yi(r,i),null!==e&&(e.alternate=null,t.alternate=null,t.effectTag|=2),t.tag=1,mi(r)?(e=!0,bi(t)):e=!1,na(t,n),va(t,r,i),ba(t,r,i,n),Uo(null,t,r,!0,e,n);case 19:return Wo(e,t,n)}throw Error(o(156,t.tag))};var Tu=null,Nu=null;function wu(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.effectTag=0,this.lastEffect=this.firstEffect=this.nextEffect=null,this.childExpirationTime=this.expirationTime=0,this.alternate=null}function Au(e,t,n,r){return new wu(e,t,n,r)}function Cu(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Su(e,t){var n=e.alternate;return null===n?((n=Au(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.effectTag=0,n.nextEffect=null,n.firstEffect=null,n.lastEffect=null),n.childExpirationTime=e.childExpirationTime,n.expirationTime=e.expirationTime,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{expirationTime:t.expirationTime,firstContext:t.firstContext,responders:t.responders},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ru(e,t,n,r,i,a){var s=2;if(r=e,"function"===typeof e)Cu(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case ne:return Mu(n.children,i,a,t);case se:s=8,i|=7;break;case re:s=8,i|=1;break;case ie:return(e=Au(12,n,t,8|i)).elementType=ie,e.type=ie,e.expirationTime=a,e;case ce:return(e=Au(13,n,t,i)).type=ce,e.elementType=ce,e.expirationTime=a,e;case le:return(e=Au(19,n,t,i)).elementType=le,e.expirationTime=a,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case ae:s=10;break e;case oe:s=9;break e;case ue:s=11;break e;case he:s=14;break e;case pe:s=16,r=null;break e;case fe:s=22;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Au(s,n,t,i)).elementType=e,t.type=r,t.expirationTime=a,t}function Mu(e,t,n,r){return(e=Au(7,e,r,t)).expirationTime=n,e}function Ou(e,t,n){return(e=Au(6,e,null,t)).expirationTime=n,e}function Pu(e,t,n){return(t=Au(4,null!==e.children?e.children:[],e.key,t)).expirationTime=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function xu(e,t,n){this.tag=t,this.current=null,this.containerInfo=e,this.pingCache=this.pendingChildren=null,this.finishedExpirationTime=0,this.finishedWork=null,this.timeoutHandle=-1,this.pendingContext=this.context=null,this.hydrate=n,this.callbackNode=null,this.callbackPriority=90,this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Iu(e,t){var n=e.firstSuspendedTime;return e=e.lastSuspendedTime,0!==n&&n>=t&&e<=t}function _u(e,t){var n=e.firstSuspendedTime,r=e.lastSuspendedTime;n<t&&(e.firstSuspendedTime=t),(r>t||0===n)&&(e.lastSuspendedTime=t),t<=e.lastPingedTime&&(e.lastPingedTime=0),t<=e.lastExpiredTime&&(e.lastExpiredTime=0)}function Lu(e,t){t>e.firstPendingTime&&(e.firstPendingTime=t);var n=e.firstSuspendedTime;0!==n&&(t>=n?e.firstSuspendedTime=e.lastSuspendedTime=e.nextKnownPendingLevel=0:t>=e.lastSuspendedTime&&(e.lastSuspendedTime=t+1),t>e.nextKnownPendingLevel&&(e.nextKnownPendingLevel=t))}function Du(e,t){var n=e.lastExpiredTime;(0===n||n>t)&&(e.lastExpiredTime=t)}function qu(e,t,n,r){var i=t.current,a=zs(),s=pa.suspense;a=Ws(a,i,s);e:if(n){t:{if(Ze(n=n._reactInternalFiber)!==n||1!==n.tag)throw Error(o(170));var u=n;do{switch(u.tag){case 3:u=u.stateNode.context;break t;case 1:if(mi(u.type)){u=u.stateNode.__reactInternalMemoizedMergedChildContext;break t}}u=u.return}while(null!==u);throw Error(o(171))}if(1===n.tag){var c=n.type;if(mi(c)){n=gi(n,c,u);break e}}n=u}else n=li;return null===t.context?t.context=n:t.pendingContext=n,(t=sa(a,s)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),ua(i,t),Ys(i,a),a}function ju(e){if(!(e=e.current).child)return null;switch(e.child.tag){case 5:default:return e.child.stateNode}}function Uu(e,t){null!==(e=e.memoizedState)&&null!==e.dehydrated&&e.retryTime<t&&(e.retryTime=t)}function Bu(e,t){Uu(e,t),(e=e.alternate)&&Uu(e,t)}function ku(e,t,n){var r=new xu(e,t,n=null!=n&&!0===n.hydrate),i=Au(3,null,null,2===t?7:1===t?3:0);r.current=i,i.stateNode=r,aa(i),e[Sn]=r.current,n&&0!==t&&function(e,t){var n=$e(t);St.forEach((function(e){dt(e,t,n)})),Rt.forEach((function(e){dt(e,t,n)}))}(0,9===e.nodeType?e:e.ownerDocument),this._internalRoot=r}function Fu(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function Vu(e,t,n,r,i){var a=n._reactRootContainer;if(a){var o=a._internalRoot;if("function"===typeof i){var s=i;i=function(){var e=ju(o);s.call(e)}}qu(t,o,e,i)}else{if(a=n._reactRootContainer=function(e,t){if(t||(t=!(!(t=e?9===e.nodeType?e.documentElement:e.firstChild:null)||1!==t.nodeType||!t.hasAttribute("data-reactroot"))),!t)for(var n;n=e.lastChild;)e.removeChild(n);return new ku(e,0,t?{hydrate:!0}:void 0)}(n,r),o=a._internalRoot,"function"===typeof i){var u=i;i=function(){var e=ju(o);u.call(e)}}tu((function(){qu(t,o,e,i)}))}return ju(o)}function Qu(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:te,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Ku(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Fu(t))throw Error(o(200));return Qu(e,t,null,n)}ku.prototype.render=function(e){qu(e,this._internalRoot,null,null)},ku.prototype.unmount=function(){var e=this._internalRoot,t=e.containerInfo;qu(null,e,null,(function(){t[Sn]=null}))},mt=function(e){if(13===e.tag){var t=Wi(zs(),150,100);Ys(e,t),Bu(e,t)}},yt=function(e){13===e.tag&&(Ys(e,3),Bu(e,3))},vt=function(e){if(13===e.tag){var t=zs();Ys(e,t=Ws(t,e,null)),Bu(e,t)}},M=function(e,t,n){switch(t){case"input":if(Ce(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var i=Pn(r);if(!i)throw Error(o(90));Te(r),Ce(r,i)}}}break;case"textarea":Ie(e,n);break;case"select":null!=(t=n.value)&&Oe(e,!!n.multiple,t,!1)}},L=eu,D=function(e,t,n,r,i){var a=ws;ws|=4;try{return Vi(98,e.bind(null,t,n,r,i))}finally{0===(ws=a)&&Hi()}},q=function(){0===(49&ws)&&(function(){if(null!==Vs){var e=Vs;Vs=null,e.forEach((function(e,t){Du(t,e),Xs(t)})),Hi()}}(),mu())},j=function(e,t){var n=ws;ws|=2;try{return e(t)}finally{0===(ws=n)&&Hi()}};var Hu={Events:[Mn,On,Pn,S,w,jn,function(e){it(e,qn)},I,_,Xt,st,mu,{current:!1}]};!function(e){var t=e.findFiberByHostInstance;(function(e){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)return!0;try{var n=t.inject(e);Tu=function(e){try{t.onCommitFiberRoot(n,e,void 0,64===(64&e.current.effectTag))}catch(r){}},Nu=function(e){try{t.onCommitFiberUnmount(n,e)}catch(r){}}}catch(r){}})(i({},e,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:J.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=nt(e))?null:e.stateNode},findFiberByHostInstance:function(e){return t?t(e):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))}({findFiberByHostInstance:Rn,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"}),t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Hu,t.createPortal=Ku,t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternalFiber;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw Error(o(268,Object.keys(e)))}return e=null===(e=nt(t))?null:e.stateNode},t.flushSync=function(e,t){if(0!==(48&ws))throw Error(o(187));var n=ws;ws|=1;try{return Vi(99,e.bind(null,t))}finally{ws=n,Hi()}},t.hydrate=function(e,t,n){if(!Fu(t))throw Error(o(200));return Vu(null,e,t,!0,n)},t.render=function(e,t,n){if(!Fu(t))throw Error(o(200));return Vu(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Fu(e))throw Error(o(40));return!!e._reactRootContainer&&(tu((function(){Vu(null,null,e,!1,(function(){e._reactRootContainer=null,e[Sn]=null}))})),!0)},t.unstable_batchedUpdates=eu,t.unstable_createPortal=function(e,t){return Ku(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)},t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Fu(n))throw Error(o(200));if(null==e||void 0===e._reactInternalFiber)throw Error(o(38));return Vu(e,t,n,!1,r)},t.version="16.13.1"},function(e,t,n){"use strict";e.exports=n(112)},function(e,t,n){"use strict";var r,i,a,o,s;if("undefined"===typeof window||"function"!==typeof MessageChannel){var u=null,c=null,l=function e(){if(null!==u)try{var n=t.unstable_now();u(!0,n),u=null}catch(r){throw setTimeout(e,0),r}},h=Date.now();t.unstable_now=function(){return Date.now()-h},r=function(e){null!==u?setTimeout(r,0,e):(u=e,setTimeout(l,0))},i=function(e,t){c=setTimeout(e,t)},a=function(){clearTimeout(c)},o=function(){return!1},s=t.unstable_forceFrameRate=function(){}}else{var p=window.performance,f=window.Date,d=window.setTimeout,m=window.clearTimeout;if("undefined"!==typeof console){var y=window.cancelAnimationFrame;"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),"function"!==typeof y&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills")}if("object"===typeof p&&"function"===typeof p.now)t.unstable_now=function(){return p.now()};else{var v=f.now();t.unstable_now=function(){return f.now()-v}}var g=!1,b=null,E=-1,T=5,N=0;o=function(){return t.unstable_now()>=N},s=function(){},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):T=0<e?Math.floor(1e3/e):5};var w=new MessageChannel,A=w.port2;w.port1.onmessage=function(){if(null!==b){var e=t.unstable_now();N=e+T;try{b(!0,e)?A.postMessage(null):(g=!1,b=null)}catch(n){throw A.postMessage(null),n}}else g=!1},r=function(e){b=e,g||(g=!0,A.postMessage(null))},i=function(e,n){E=d((function(){e(t.unstable_now())}),n)},a=function(){m(E),E=-1}}function C(e,t){var n=e.length;e.push(t);e:for(;;){var r=n-1>>>1,i=e[r];if(!(void 0!==i&&0<M(i,t)))break e;e[r]=t,e[n]=i,n=r}}function S(e){return void 0===(e=e[0])?null:e}function R(e){var t=e[0];if(void 0!==t){var n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length;r<i;){var a=2*(r+1)-1,o=e[a],s=a+1,u=e[s];if(void 0!==o&&0>M(o,n))void 0!==u&&0>M(u,o)?(e[r]=u,e[s]=n,r=s):(e[r]=o,e[a]=n,r=a);else{if(!(void 0!==u&&0>M(u,n)))break e;e[r]=u,e[s]=n,r=s}}}return t}return null}function M(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}var O=[],P=[],x=1,I=null,_=3,L=!1,D=!1,q=!1;function j(e){for(var t=S(P);null!==t;){if(null===t.callback)R(P);else{if(!(t.startTime<=e))break;R(P),t.sortIndex=t.expirationTime,C(O,t)}t=S(P)}}function U(e){if(q=!1,j(e),!D)if(null!==S(O))D=!0,r(B);else{var t=S(P);null!==t&&i(U,t.startTime-e)}}function B(e,n){D=!1,q&&(q=!1,a()),L=!0;var r=_;try{for(j(n),I=S(O);null!==I&&(!(I.expirationTime>n)||e&&!o());){var s=I.callback;if(null!==s){I.callback=null,_=I.priorityLevel;var u=s(I.expirationTime<=n);n=t.unstable_now(),"function"===typeof u?I.callback=u:I===S(O)&&R(O),j(n)}else R(O);I=S(O)}if(null!==I)var c=!0;else{var l=S(P);null!==l&&i(U,l.startTime-n),c=!1}return c}finally{I=null,_=r,L=!1}}function k(e){switch(e){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1e4;default:return 5e3}}var F=s;t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){D||L||(D=!0,r(B))},t.unstable_getCurrentPriorityLevel=function(){return _},t.unstable_getFirstCallbackNode=function(){return S(O)},t.unstable_next=function(e){switch(_){case 1:case 2:case 3:var t=3;break;default:t=_}var n=_;_=t;try{return e()}finally{_=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=F,t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=_;_=e;try{return t()}finally{_=n}},t.unstable_scheduleCallback=function(e,n,o){var s=t.unstable_now();if("object"===typeof o&&null!==o){var u=o.delay;u="number"===typeof u&&0<u?s+u:s,o="number"===typeof o.timeout?o.timeout:k(e)}else o=k(e),u=s;return e={id:x++,callback:n,priorityLevel:e,startTime:u,expirationTime:o=u+o,sortIndex:-1},u>s?(e.sortIndex=u,C(P,e),null===S(O)&&e===S(P)&&(q?a():q=!0,i(U,u-s))):(e.sortIndex=o,C(O,e),D||L||(D=!0,r(B))),e},t.unstable_shouldYield=function(){var e=t.unstable_now();j(e);var n=S(O);return n!==I&&null!==I&&null!==n&&null!==n.callback&&n.startTime<=e&&n.expirationTime<I.expirationTime||o()},t.unstable_wrapCallback=function(e){var t=_;return function(){var n=_;_=t;try{return e.apply(this,arguments)}finally{_=n}}}}]]);
//# sourceMappingURL=2.6c7278ae.chunk.js.map